<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Martín Lozano.">

<title>Options and VaR with  R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="index_files/libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="index_files/libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="index_files/libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<style>html{ scroll-behavior: smooth; }</style>



  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    #btn-back-to-top {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 15px; /* Adjust the width */
      height: 15px; /* Adjust the height */
      box-sizing: content-box;
      z-index: 1000;
      background-color: rgba(0, 123, 255, 0.7);
      border: none;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>
<body>

<button type="button" class="btn btn-primary btn-lg bi bi-arrow-up" id="btn-back-to-top"></button>

<script>
  let backToTopButton = document.getElementById("btn-back-to-top");

  backToTopButton.addEventListener("click", function () {
    document.documentElement.scrollTop = 0;
  });
</script>



<div id="progress-bar" style="width: 0%; height:2px; background-color: rgb(89 127 235);; position: fixed; top: 0px; z-index: 2000;"></div>

<script id="progressbar" type="text/javascript">

document.addEventListener("DOMContentLoaded", function() {

    const bar = document.querySelector('#progress-bar');
    const post = document.querySelector('#quarto-content');
    const html = document.documentElement;
    
    const height = post.scrollHeight + post.offsetTop;
    
    window.addEventListener('scroll', () => {
        bar.style.width = (html.scrollTop / (height- html.clientHeight)) * 100 + '%';
    });
});
</script>
<script src="index_files/libs/htmlwidgets-1.6.3/htmlwidgets.js"></script>
<script src="index_files/libs/plotly-binding-4.10.3/plotly.js"></script>
<script src="index_files/libs/typedarray-0.1/typedarray.min.js"></script>
<script src="index_files/libs/jquery-3.5.1/jquery.min.js"></script>
<link href="index_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="index_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="index_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="index_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
<link href="index_files/libs/vembedr-0.1.5/css/vembedr.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>





<div id="quarto-content" class="page-columns page-rows-contents page-layout-full toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul class="collapse">
  <li><a href="#introduction." id="toc-introduction." class="nav-link active" data-scroll-target="#introduction.">Introduction.</a></li>
  <li><a href="#payoff-functions." id="toc-payoff-functions." class="nav-link" data-scroll-target="#payoff-functions."><span class="header-section-number">1</span> Payoff functions.</a>
  <ul class="collapse">
  <li><a href="#european-options." id="toc-european-options." class="nav-link" data-scroll-target="#european-options."><span class="header-section-number">1.1</span> European options.</a></li>
  <li><a href="#stocks." id="toc-stocks." class="nav-link" data-scroll-target="#stocks."><span class="header-section-number">1.2</span> Stocks.</a></li>
  <li><a href="#bonds." id="toc-bonds." class="nav-link" data-scroll-target="#bonds."><span class="header-section-number">1.3</span> Bonds.</a></li>
  <li><a href="#options-stocks-and-bonds." id="toc-options-stocks-and-bonds." class="nav-link" data-scroll-target="#options-stocks-and-bonds."><span class="header-section-number">1.4</span> Options, stocks and bonds.</a></li>
  </ul></li>
  <li><a href="#options-properties." id="toc-options-properties." class="nav-link" data-scroll-target="#options-properties."><span class="header-section-number">2</span> Options properties.</a>
  <ul class="collapse">
  <li><a href="#determinants." id="toc-determinants." class="nav-link" data-scroll-target="#determinants."><span class="header-section-number">2.1</span> Determinants.</a></li>
  <li><a href="#option-bounds." id="toc-option-bounds." class="nav-link" data-scroll-target="#option-bounds."><span class="header-section-number">2.2</span> Option bounds.</a></li>
  <li><a href="#put-call-parity." id="toc-put-call-parity." class="nav-link" data-scroll-target="#put-call-parity."><span class="header-section-number">2.3</span> Put-call parity.</a></li>
  </ul></li>
  <li><a href="#binomial-trees." id="toc-binomial-trees." class="nav-link" data-scroll-target="#binomial-trees."><span class="header-section-number">3</span> Binomial trees.</a>
  <ul class="collapse">
  <li><a href="#implementation." id="toc-implementation." class="nav-link" data-scroll-target="#implementation."><span class="header-section-number">3.1</span> Implementation.</a></li>
  <li><a href="#stock-price-paths." id="toc-stock-price-paths." class="nav-link" data-scroll-target="#stock-price-paths."><span class="header-section-number">3.2</span> Stock price paths.</a></li>
  <li><a href="#real-vs.-risk-neutral-world." id="toc-real-vs.-risk-neutral-world." class="nav-link" data-scroll-target="#real-vs.-risk-neutral-world."><span class="header-section-number">3.3</span> Real vs.&nbsp;risk-neutral world.</a></li>
  <li><a href="#parrondos-paradox." id="toc-parrondos-paradox." class="nav-link" data-scroll-target="#parrondos-paradox."><span class="header-section-number">3.4</span> Parrondo’s paradox.</a></li>
  </ul></li>
  <li><a href="#wiener-processes." id="toc-wiener-processes." class="nav-link" data-scroll-target="#wiener-processes."><span class="header-section-number">4</span> Wiener processes.</a>
  <ul class="collapse">
  <li><a href="#the-basic-process." id="toc-the-basic-process." class="nav-link" data-scroll-target="#the-basic-process."><span class="header-section-number">4.1</span> The basic process.</a></li>
  <li><a href="#the-generalized-wiener-process." id="toc-the-generalized-wiener-process." class="nav-link" data-scroll-target="#the-generalized-wiener-process."><span class="header-section-number">4.2</span> The generalized Wiener process.</a></li>
  </ul></li>
  <li><a href="#value-at-risk." id="toc-value-at-risk." class="nav-link" data-scroll-target="#value-at-risk."><span class="header-section-number">5</span> Value at risk.</a>
  <ul class="collapse">
  <li><a href="#prepare-the-data." id="toc-prepare-the-data." class="nav-link" data-scroll-target="#prepare-the-data."><span class="header-section-number">5.1</span> Prepare the data.</a></li>
  <li><a href="#historical-simulation." id="toc-historical-simulation." class="nav-link" data-scroll-target="#historical-simulation."><span class="header-section-number">5.2</span> Historical simulation.</a></li>
  <li><a href="#model-building-approach." id="toc-model-building-approach." class="nav-link" data-scroll-target="#model-building-approach."><span class="header-section-number">5.3</span> Model building approach.</a></li>
  <li><a href="#optimal-allocation." id="toc-optimal-allocation." class="nav-link" data-scroll-target="#optimal-allocation."><span class="header-section-number">5.4</span> Optimal allocation.</a></li>
  <li><a href="#model-building-approach-with-optimal-weights." id="toc-model-building-approach-with-optimal-weights." class="nav-link" data-scroll-target="#model-building-approach-with-optimal-weights."><span class="header-section-number">5.5</span> Model building approach with optimal weights.</a></li>
  <li><a href="#historic-approach-with-optimal-weights." id="toc-historic-approach-with-optimal-weights." class="nav-link" data-scroll-target="#historic-approach-with-optimal-weights."><span class="header-section-number">5.6</span> Historic approach with optimal weights.</a></li>
  </ul></li>
  <li><a href="#references." id="toc-references." class="nav-link" data-scroll-target="#references.">References.</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Options and VaR with <i class="fa-brands fa-r-project" aria-label="r-project"></i> <span style="color:white">R</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dr.&nbsp;Martín Lozano. </p>
          </div>
  </div>
    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">December 30, 2023, 00:35:50 am.</p>
    </div>
  </div>
    
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Abstract</div>
    This material relies on <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span>. Some mathematical background is skipped to emphasize the data analysis, model logic, discussion, graphical approach and R coding <span class="citation" data-cites="Rref">(<a href="#ref-Rref" role="doc-biblioref">R Core Team 2024</a>)</span>. As in the philosophy of <span class="citation" data-cites="knuth1984literate">Knuth (<a href="#ref-knuth1984literate" role="doc-biblioref">1984</a>)</span>, the objective of this document is to explain to human beings what we want a computer to do as literate programming. This is a work in progress and it is under revision.
  </div>
</div>

</header>


<br>
<p align="right"> 
  <a href="https://mlozanoqf.github.io/">
    <span style="color: black">Back to Quantitative Finance with </span>
    <img src="https://cdn.jsdelivr.net/npm/simple-icons@3.0.1/icons/r.svg" alt="R Icon" style="width: 30px; height: 30px;">
  </a>
</p>

<p align="right"> 
    <a href="https://github.com/mlozanoqf" target="blank"><img align="center" src="https://cdn.jsdelivr.net/npm/simple-icons@3.0.1/icons/github.svg" alt="martin-lozano-21818a22" height="20" width="30"></a>
    <a href="https://ssrn.com/author=1490785" target="blank"><img align="center" src="./ssrn.svg" height="90" width="30"></a>
    <a href="mailto:mlozanoqf@gmail.com" target="blank"><img align="center" src="./envelope-solid.svg" alt="mailto:mlozanoqf@gmail.com" height="20" width="30"></a>
    <a href="https://linkedin.com/in/martin-lozano-21818a22" target="blank"><img align="center" src="https://cdn.jsdelivr.net/npm/simple-icons@3.0.1/icons/linkedin.svg" alt="martin-lozano-21818a22" height="20" width="30"></a>
    <a href="https://www.youtube.com/user/drmartinlozano" target="blank"><img align="center" src="https://cdn.jsdelivr.net/npm/simple-icons@3.0.1/icons/youtube.svg" alt="https://www.youtube.com/channel/drmartinlozano" height="20" width="30"></a>
    <a href="https://scholar.google.com/citations?user=w8boOboAAAAJ&amp;hl=en" target="blank"><img align="center" src="./google-scholar.svg" height="30" width="25"></a>
    <a href="https://sites.google.com/site/mlozanoqf" target="blank"><img align="center" src="https://cdn.jsdelivr.net/npm/simple-icons@3.0.1/icons/icloud.svg" alt="https://www.youtube.com/channel/drmartinlozano" height="20" width="30"></a>
    <a href="https://us02web.zoom.us/j/9209945512" target="blank"><img align="center" src="https://cdn.jsdelivr.net/npm/simple-icons@3.0.1/icons/zoom.svg" alt="zoom" height="60" width="50"></a>
</p>

<hr style="border:2px solid gray">

<section id="introduction." class="level1 unnumbered">
<h1 class="unnumbered">Introduction.</h1>
<p>Option pricing and Value at Risk (VaR) play pivotal roles in risk management and quantitative finance, serving as indispensable tools for assessing and mitigating financial risks. Option pricing, exemplified by models like Black-Scholes, provides a systematic framework for valuing financial derivatives, enabling market participants to determine fair prices and make informed investment decisions. By understanding the potential future value of options, investors can hedge against adverse market movements and strategically allocate resources. On the other hand, VaR quantifies the potential loss that a portfolio may incur within a specified confidence interval and time horizon, offering a comprehensive measure of risk exposure. This metric assists financial institutions and investors in setting risk tolerance levels, optimizing portfolio diversification, and ensuring regulatory compliance. Together, option pricing and VaR contribute to the development of robust risk management strategies, enhancing the stability and resilience of financial markets in the face of uncertainties.</p>
</section>
<section id="payoff-functions." class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Payoff functions.</h1>
<p>The payoff is the cash realized by the holder of an option or other asset at the end of its life.</p>
<section id="european-options." class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="european-options."><span class="header-section-number">1.1</span> European options.</h2>
<p>It is often useful to characterize a European option in terms of its payoff to the purchaser of the option. The initial cost of the option is then not included in the calculation. The payoff functions for European options are the following.</p>
<ul>
<li>Payoff from a long position in a European call option: <span class="math inline">\(c^{+} = \mathrm{max}(S_T-K, 0)\)</span>. Or equivalently: <span class="math inline">\(c^{+}=-\mathrm{min}(K-S_T, 0)\)</span>.</li>
<li>Payoff to the holder of a short position in the European call option: <span class="math inline">\(c^{-}=\mathrm{min}(K-S_T, 0)\)</span>. Or equivalently: <span class="math inline">\(c^{-}=-\mathrm{max}(S_T-K, 0)\)</span>.</li>
<li>Payoff to the holder of a long position in a European put option: <span class="math inline">\(p^{+}=\mathrm{max}(K-S_T, 0)\)</span>. Or equivalently: <span class="math inline">\(p^{+}=-\mathrm{min}(S_T-K, 0)\)</span>.</li>
<li>Payoff from a short position in a European put option: <span class="math inline">\(p^{-}=\mathrm{min}(S_T-K, 0)\)</span>. Or equivalently: <span class="math inline">\(p^{-}=-\mathrm{max}(K-S_T, 0)\)</span>.</li>
</ul>
<p>Options are zero sum games because the payoffs to the holder or a long position and to the holder of a short position offset each other.</p>
<p>In the case of a call option:</p>
<p><span class="math inline">\(c^{+}+c^{-}=\mathrm{max}(S_T-K, 0) + \mathrm{min}(K-S_T, 0)\)</span>,</p>
<p><span class="math inline">\(\rightarrow c^{+}+c^{-}=\mathrm{max}(S_T-K, 0) - \mathrm{max}(S_T-K, 0)\)</span>,</p>
<p><span class="math inline">\(\rightarrow c^{+}+c^{-}=0\)</span>.</p>
<p>In the case of a put option:</p>
<p><span class="math inline">\(p^{+}+p^{-}=\mathrm{max}(K-S_T, 0) + \mathrm{min}(S_T-K, 0)\)</span>,</p>
<p><span class="math inline">\(\rightarrow p^{+}+p^{-}=\mathrm{max}(K-S_T, 0) - \mathrm{max}(K-S_T, 0)\)</span>,</p>
<p><span class="math inline">\(\rightarrow p^{+}+p^{-}=0\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>ST.seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">150</span>, <span class="at">length.out =</span> <span class="dv">150</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a>K <span class="ot">=</span> <span class="dv">75</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>cl <span class="ot">&lt;-</span> <span class="fu">pmax</span>(ST.seq <span class="sc">-</span> K, <span class="dv">0</span>) <span class="co"># long call payoff.</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>pl <span class="ot">&lt;-</span> <span class="fu">pmax</span>(K <span class="sc">-</span> ST.seq, <span class="dv">0</span>) <span class="co"># long put payoff.</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>cs <span class="ot">&lt;-</span> <span class="fu">pmin</span>(K <span class="sc">-</span> ST.seq, <span class="dv">0</span>) <span class="co"># short call payoff.</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>ps <span class="ot">&lt;-</span> <span class="fu">pmin</span>(ST.seq <span class="sc">-</span> K, <span class="dv">0</span>) <span class="co"># short put payoff.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Graphically (assuming <span class="math inline">\(K=\$75\)</span>):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>))</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="fu">plot</span>(ST.seq, cl, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">150</span>), <span class="at">lwd =</span> <span class="dv">4</span>,</span>
<span id="cb2-4"><a href="#cb2-4"></a>     <span class="at">ylab =</span> <span class="st">"Payoff"</span>, <span class="at">xlab =</span> <span class="st">""</span>)</span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Long call"</span>),</span>
<span id="cb2-6"><a href="#cb2-6"></a>       <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="fu">plot</span>(ST.seq, pl, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">150</span>), <span class="at">lwd =</span> <span class="dv">4</span>,</span>
<span id="cb2-9"><a href="#cb2-9"></a>     <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">xlab =</span> <span class="st">""</span>)</span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Long put"</span>),</span>
<span id="cb2-11"><a href="#cb2-11"></a>       <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="fu">plot</span>(ST.seq, cs, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">150</span>, <span class="dv">0</span>), <span class="at">lwd =</span> <span class="dv">4</span>,</span>
<span id="cb2-14"><a href="#cb2-14"></a>     <span class="at">ylab =</span> <span class="st">"Payoff"</span>, <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[T])))</span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Short call"</span>),</span>
<span id="cb2-16"><a href="#cb2-16"></a>       <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="fu">plot</span>(ST.seq, ps, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">150</span>, <span class="dv">0</span>), <span class="at">lwd =</span> <span class="dv">4</span>,</span>
<span id="cb2-19"><a href="#cb2-19"></a>     <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[T])))</span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Short put"</span>),</span>
<span id="cb2-21"><a href="#cb2-21"></a>       <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-poeop" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-poeop-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1.1: Payoffs of European option positions.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="stocks." class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="stocks."><span class="header-section-number">1.2</span> Stocks.</h2>
<p>The payoff functions for stocks are the following.</p>
<ul>
<li><p>Long position in a stock: <span class="math inline">\(S_T-S_0\)</span>.</p></li>
<li><p>Short position in a stock: <span class="math inline">\(S_0-S_T\)</span>.</p></li>
</ul>
<p>Graphically:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>S0 <span class="ot">=</span> <span class="dv">75</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">0</span>))</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co"># Long position</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="fu">plot</span>(ST.seq, ST.seq<span class="sc">-</span>S0, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylab =</span> <span class="st">"Payoff"</span>, <span class="at">main =</span> <span class="st">"Long stock"</span>,</span>
<span id="cb3-7"><a href="#cb3-7"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[T])), <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"blue"</span>, </span>
<span id="cb3-8"><a href="#cb3-8"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">75</span>, <span class="dv">75</span>))</span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co"># Short position</span></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="fu">plot</span>(ST.seq, S0<span class="sc">-</span>ST.seq, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">"Short stock"</span>,</span>
<span id="cb3-14"><a href="#cb3-14"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[T])), <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"red"</span>, </span>
<span id="cb3-15"><a href="#cb3-15"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">75</span>, <span class="dv">75</span>))</span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-lassp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-lassp-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1.2: Long and short stock payoffs.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="bonds." class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="bonds."><span class="header-section-number">1.3</span> Bonds.</h2>
<p>The payoff functions for zero coupon bonds are the following.</p>
<ul>
<li><p>Long position in a bond: <span class="math inline">\(K\)</span>.</p></li>
<li><p>Short position in a bond: <span class="math inline">\(-K\)</span>.</p></li>
</ul>
<p>Graphically (assuming <span class="math inline">\(K=\$75\)</span>):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>K <span class="ot">=</span> <span class="dv">75</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">0</span>))</span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co"># Long position</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="fu">plot</span>(ST.seq, <span class="fu">rep</span>(K, <span class="dv">150</span>), <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylab =</span> <span class="st">"Payoff"</span>, <span class="at">main =</span> <span class="st">"Long bond"</span>,</span>
<span id="cb4-7"><a href="#cb4-7"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[T])), <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"blue"</span>, </span>
<span id="cb4-8"><a href="#cb4-8"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">150</span>))</span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co"># Short position</span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="fu">plot</span>(ST.seq, <span class="fu">rep</span>(<span class="sc">-</span>K, <span class="dv">150</span>), <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">"Short bond"</span>,</span>
<span id="cb4-14"><a href="#cb4-14"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[T])), <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"red"</span>, </span>
<span id="cb4-15"><a href="#cb4-15"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">150</span>, <span class="dv">0</span>))</span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-laszcbp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-laszcbp-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1.3: Long and short zero coupon bond payoffs.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="options-stocks-and-bonds." class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="options-stocks-and-bonds."><span class="header-section-number">1.4</span> Options, stocks and bonds.</h2>
<p>We look at what can be achieved when an option is traded in conjunction with other assets. In particular, we examine the properties of portfolios consisting of (a) an option and a zero-coupon bond, (b) an option and the asset underlying the option, and (c) two or more options on the same asset. This section is based in <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span> chapter 12, you can also see <span class="citation" data-cites="brealey2020principles">Brealey et al. (<a href="#ref-brealey2020principles" role="doc-biblioref">2020</a>)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>S0 <span class="ot">=</span> <span class="dv">65</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co"># Here I assume the stock price is currently 65.</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>Sl <span class="ot">&lt;-</span> ST.seq <span class="sc">-</span> S0</span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co"># I assume the option price is 5.</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>cs.pr <span class="ot">&lt;-</span> <span class="fu">pmin</span>(K <span class="sc">-</span> ST.seq, <span class="dv">0</span>) <span class="sc">+</span> <span class="dv">5</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co"># A short put profit is replicated by taking a short call and a long stock.</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>ans <span class="ot">&lt;-</span> cs.pr <span class="sc">+</span> Sl</span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="fu">plot</span>(ST.seq, ans, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">75</span>, <span class="dv">75</span>), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>,</span>
<span id="cb5-10"><a href="#cb5-10"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[T])), </span>
<span id="cb5-11"><a href="#cb5-11"></a>     <span class="at">ylab =</span> <span class="st">"Profit"</span>)</span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="fu">lines</span>(ST.seq, Sl, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"orange"</span>)</span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="fu">lines</span>(ST.seq, cs.pr, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>)</span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>)</span>
<span id="cb5-16"><a href="#cb5-16"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">65</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb5-17"><a href="#cb5-17"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">75</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb5-18"><a href="#cb5-18"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">80</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb5-19"><a href="#cb5-19"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Short call"</span>, <span class="st">"Long stock"</span>, <span class="st">"Short put"</span>),</span>
<span id="cb5-20"><a href="#cb5-20"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"orange"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>), </span>
<span id="cb5-21"><a href="#cb5-21"></a>       <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">bg =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-hf1pdassp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-hf1pdassp-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1.4: Hull: Figure 12.1a, profit diagram. A synthetic short put.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>S0 <span class="ot">=</span> <span class="dv">65</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>c_price <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co"># Here I assume the stock price is currently 65.</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>Sl <span class="ot">&lt;-</span> ST.seq <span class="sc">-</span> S0</span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co"># I assume the option price is 5.</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>cs.pr <span class="ot">&lt;-</span> <span class="fu">pmin</span>(K <span class="sc">-</span> ST.seq, <span class="dv">0</span>) <span class="sc">+</span> c_price</span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co"># A short put profit is replicated by taking a short call and a long stock.</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>ans <span class="ot">&lt;-</span> cs.pr <span class="sc">+</span> Sl</span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="fu">plot</span>(ST.seq, ans, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">15</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">60</span>, <span class="dv">80</span>),</span>
<span id="cb6-11"><a href="#cb6-11"></a>     <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"red"</span>,</span>
<span id="cb6-12"><a href="#cb6-12"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[T])), </span>
<span id="cb6-13"><a href="#cb6-13"></a>     <span class="at">ylab =</span> <span class="st">"Profit"</span>)</span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="fu">lines</span>(ST.seq, Sl, <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"orange"</span>)</span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="fu">lines</span>(ST.seq, cs.pr, <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>)</span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>)</span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">65</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">75</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb6-20"><a href="#cb6-20"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">80</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb6-21"><a href="#cb6-21"></a><span class="fu">points</span>(S0 <span class="sc">-</span> c_price, <span class="dv">0</span>, <span class="at">cex =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb6-22"><a href="#cb6-22"></a><span class="fu">points</span>(K, K <span class="sc">-</span> S0 <span class="sc">+</span> c_price, <span class="at">cex =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">pch =</span> <span class="dv">0</span>)</span>
<span id="cb6-23"><a href="#cb6-23"></a><span class="fu">points</span>(K <span class="sc">+</span> c_price, <span class="dv">0</span>, <span class="at">cex =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb6-24"><a href="#cb6-24"></a><span class="fu">points</span>(K, c_price, <span class="at">cex =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">pch =</span> <span class="dv">0</span>)</span>
<span id="cb6-25"><a href="#cb6-25"></a><span class="fu">points</span>(S0, <span class="dv">0</span>, <span class="at">cex =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"orange"</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb6-26"><a href="#cb6-26"></a><span class="fu">points</span>(K, K <span class="sc">-</span> S0, <span class="at">cex =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"orange"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">pch =</span> <span class="dv">0</span>)</span>
<span id="cb6-27"><a href="#cb6-27"></a><span class="fu">points</span>(K, <span class="dv">0</span>, <span class="at">cex =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-hf1pdzassp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-hf1pdzassp-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1.5: Hull: Figure 12.1a, profit diagram (zoom). A synthetic short put.</figcaption>
</figure>
</div>
</div>
</div>
<p>We can identify at least three isosceles right triangles, they have two sides of equal measure. The short call profit is zero at <span class="math inline">\(S_T = \$80\)</span>, in the code above: <tt><code>K + c_price</code></tt>. The stock profit is zero at <span class="math inline">\(S_T=\$65\)</span>, in the coded above: <tt><code>S0</code></tt>. Finally, the short put profit is zero at <span class="math inline">\(S_T=\$60\)</span>, in the code above: <tt><code>S0 - c_price</code></tt>.</p>
<p>Now see how it looks if we plot a payoff diagram instead.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>S0 <span class="ot">=</span> K</span>
<span id="cb7-2"><a href="#cb7-2"></a>Sl <span class="ot">&lt;-</span> ST.seq <span class="sc">-</span> S0</span>
<span id="cb7-3"><a href="#cb7-3"></a>cs.pr <span class="ot">&lt;-</span> <span class="fu">pmin</span>(K <span class="sc">-</span> ST.seq, <span class="dv">0</span>)</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co"># A short put profit is replicated by taking a short call and a long stock.</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>ans <span class="ot">&lt;-</span> cs.pr <span class="sc">+</span> Sl</span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="fu">plot</span>(ST.seq, ans, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">75</span>, <span class="dv">75</span>), <span class="at">lwd =</span> <span class="dv">5</span>, <span class="at">col =</span> <span class="st">"red"</span>,</span>
<span id="cb7-8"><a href="#cb7-8"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[T])), </span>
<span id="cb7-9"><a href="#cb7-9"></a>     <span class="at">ylab =</span> <span class="st">"Payoff"</span>)</span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="fu">lines</span>(ST.seq, Sl, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"orange"</span>)</span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="fu">lines</span>(ST.seq, cs.pr, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Short call"</span>, <span class="st">"Long stock"</span>, <span class="st">"Short put"</span>),</span>
<span id="cb7-15"><a href="#cb7-15"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"orange"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>), </span>
<span id="cb7-16"><a href="#cb7-16"></a>       <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-hf1pd" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-hf1pd-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1.6: Hull: Figure 12.1a, payoff diagram.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="fu">library</span>(plotly)</span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="fu">library</span>(vembedr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="options-properties." class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Options properties.</h1>
<p>Financial options are one of the most flexible, popular and versatile financial instruments. They are relevant by themselves and important as building blocks to create other financial products and financial strategies. In order to fully understand options we need to understand their properties first. This is, what are the determinant of financial options, how these determinants change the option prices, what are the limits of financial options, what happens when these limits are violated, methods for determining the theoretical option prices and the relationship between call and put options. This section is based in <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span> chapter 11.</p>
<section id="determinants." class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="determinants."><span class="header-section-number">2.1</span> Determinants.</h2>
<p>The main determinants of option prices are those parameters of the Black-Scholes formula:</p>
<ul>
<li>The price of the underlying stock at time zero: <span class="math inline">\(S_0\)</span>.</li>
<li>The option strike price: <span class="math inline">\(K\)</span>.</li>
<li>The risk-free rate: <span class="math inline">\(rf\)</span>.</li>
<li>The option maturity: <span class="math inline">\(T\)</span>.</li>
<li>The volatility of the underlying stock <span class="math inline">\(\sigma\)</span>.</li>
</ul>
<p>This is, <span class="math inline">\(BS = f(S_0, K, rf, T, \sigma)\)</span>. Here we set up the BS function and then evaluate it at <span class="math inline">\(BS = f(S_0=50, K=50, rf=0.05, T=1, \sigma=0.3)\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Black-Scholes call.</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>c.bs <span class="ot">&lt;-</span> <span class="cf">function</span>(S, K, rf, TT, sigma) {</span>
<span id="cb9-3"><a href="#cb9-3"></a>  d1 <span class="ot">&lt;-</span> (<span class="fu">log</span>(S <span class="sc">/</span> K) <span class="sc">+</span> (rf <span class="sc">+</span> sigma<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> TT) <span class="sc">/</span> (sigma <span class="sc">*</span> <span class="fu">sqrt</span>(TT))</span>
<span id="cb9-4"><a href="#cb9-4"></a>  d2 <span class="ot">&lt;-</span> d1 <span class="sc">-</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(TT)</span>
<span id="cb9-5"><a href="#cb9-5"></a>  c <span class="ot">&lt;-</span> S <span class="sc">*</span> <span class="fu">pnorm</span>(d1) <span class="sc">-</span> K <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>rf <span class="sc">*</span> TT) <span class="sc">*</span> <span class="fu">pnorm</span>(d2)</span>
<span id="cb9-6"><a href="#cb9-6"></a>}</span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co"># Black-Scholes put.</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>p.bs <span class="ot">&lt;-</span> <span class="cf">function</span>(S, K, rf, TT, sigma) {</span>
<span id="cb9-9"><a href="#cb9-9"></a>  d1 <span class="ot">&lt;-</span> (<span class="fu">log</span>(S <span class="sc">/</span> K) <span class="sc">+</span> (rf <span class="sc">+</span> sigma<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> TT) <span class="sc">/</span> (sigma <span class="sc">*</span> <span class="fu">sqrt</span>(TT))</span>
<span id="cb9-10"><a href="#cb9-10"></a>  d2 <span class="ot">&lt;-</span> d1 <span class="sc">-</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(TT)</span>
<span id="cb9-11"><a href="#cb9-11"></a>  p <span class="ot">&lt;-</span> K <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>rf <span class="sc">*</span> TT) <span class="sc">*</span> <span class="fu">pnorm</span>(<span class="sc">-</span>d2) <span class="sc">-</span> S <span class="sc">*</span> <span class="fu">pnorm</span>(<span class="sc">-</span>d1)</span>
<span id="cb9-12"><a href="#cb9-12"></a>}</span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="co"># Calculate and report results.</span></span>
<span id="cb9-14"><a href="#cb9-14"></a>c <span class="ot">&lt;-</span> <span class="fu">c.bs</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="fl">0.05</span>, <span class="dv">1</span>, <span class="fl">0.3</span>)</span>
<span id="cb9-15"><a href="#cb9-15"></a>p <span class="ot">&lt;-</span> <span class="fu">p.bs</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="fl">0.05</span>, <span class="dv">1</span>, <span class="fl">0.3</span>)</span>
<span id="cb9-16"><a href="#cb9-16"></a><span class="fu">data.frame</span>(<span class="st">"Black-Scholes call"</span> <span class="ot">=</span> c, <span class="st">"Black-Scholes put"</span> <span class="ot">=</span> p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Black.Scholes.call Black.Scholes.put
1           7.115627          4.677099</code></pre>
</div>
</div>
<p>Now, let’s see how Black-Scholes option prices changes (call and put) when we leave <span class="math inline">\(S_0\)</span> as a variable and the rest of the parameters as fixed: <span class="math inline">\(BS = f(S_0, K=50, rf=0.05, T=1, \sigma=0.3)\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Parameters.</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>K <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>rf <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>TT <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>sigma <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>S0 <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co"># Sequence of S0.</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>S0.seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">100</span>, <span class="at">length.out =</span> <span class="dv">50</span>)</span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="co"># Evaluation of the c.bs and p.bs function.</span></span>
<span id="cb11-10"><a href="#cb11-10"></a>c.S0 <span class="ot">&lt;-</span> <span class="fu">mapply</span>(c.bs, S0.seq, K, rf, TT, sigma)</span>
<span id="cb11-11"><a href="#cb11-11"></a>p.S0 <span class="ot">&lt;-</span> <span class="fu">mapply</span>(p.bs, S0.seq, K, rf, TT, sigma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We produce as many <tt><code>c.S0</code></tt> as values for <tt><code>S0.seq</code></tt>. Then, we can plot.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># See the results.</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="fu">plot</span>(S0.seq, c.S0, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[<span class="dv">0</span>])), </span>
<span id="cb12-3"><a href="#cb12-3"></a>     <span class="at">ylab =</span> <span class="st">"Call option price, c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-cpaafos" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-cpaafos-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.1: Call price as a function of <span class="math inline">\(S_0\)</span>.</figcaption>
</figure>
</div>
</div>
</div>
<p>The call option price is an increasing function of <span class="math inline">\(S_0\)</span>. This makes sense because a right to buy the stock at a fix price in the future becomes more valuable as the current value of the stock increases. In other words, it is more expensive to lock the price of an expensive asset for a potential buyer.</p>
<p>See the case of the put option.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">plot</span>(S0.seq, p.S0, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[<span class="dv">0</span>])), </span>
<span id="cb13-2"><a href="#cb13-2"></a>     <span class="at">ylab =</span> <span class="st">"Put option price, p"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-ppaafos" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-ppaafos-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.2: Put price as a function of <span class="math inline">\(S_0\)</span>.</figcaption>
</figure>
</div>
</div>
</div>
<p>Here, it is cheaper to lock the price of an expensive asset for a potential seller. This makes sense because it looks unnecessary to lock the selling price of an expensive stock.</p>
<p>Let’s put both plots together.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># What is the interpretation of S0.star, and how did I found this value?</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>S0.star <span class="ot">&lt;-</span> K <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>rf <span class="sc">*</span> TT)</span>
<span id="cb14-3"><a href="#cb14-3"></a>c.S0.star <span class="ot">&lt;-</span> <span class="fu">mapply</span>(c.bs, S0.star, K, rf, TT, sigma)</span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co"># Plot.</span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="fu">plot</span>(S0.seq, c.S0, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>), </span>
<span id="cb14-6"><a href="#cb14-6"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[<span class="dv">0</span>])), <span class="at">ylab =</span> <span class="st">"Option theoretical price"</span>, </span>
<span id="cb14-7"><a href="#cb14-7"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">40</span>, <span class="dv">55</span>))</span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="fu">lines</span>(S0.seq, p.S0, <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="fu">abline</span>(<span class="at">v =</span> S0.star, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="fu">abline</span>(<span class="at">h =</span> c.S0.star, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="fu">abline</span>(<span class="at">h =</span> c, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb14-12"><a href="#cb14-12"></a><span class="fu">abline</span>(<span class="at">h =</span> p, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="fu">abline</span>(<span class="at">v =</span> S0, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb14-14"><a href="#cb14-14"></a><span class="fu">points</span>(S0, c, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">cex =</span> <span class="dv">3</span>)</span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="fu">points</span>(S0, p, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">cex =</span> <span class="dv">3</span>)</span>
<span id="cb14-16"><a href="#cb14-16"></a><span class="fu">points</span>(S0.star, c.S0.star, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="dv">3</span>)</span>
<span id="cb14-17"><a href="#cb14-17"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Call"</span>, <span class="st">"Put"</span>),</span>
<span id="cb14-18"><a href="#cb14-18"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-cappaafosz" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-cappaafosz-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.3: Call and put prices as a function of <span class="math inline">\(S_0\)</span> (zoom).</figcaption>
</figure>
</div>
</div>
</div>
<p>Note that there is a single case in which both options (call and put) are the same. It is interesting to find out the value of <span class="math inline">\(S_0\)</span> that makes <span class="math inline">\(c=p\)</span>. Clearly, this value is lower than <span class="math inline">\(S_0=\$50\)</span>, the point here is to find the mathematical expression of <span class="math inline">\(S_0\)</span> that makes <span class="math inline">\(c=p\)</span>.</p>
</section>
<section id="option-bounds." class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="option-bounds."><span class="header-section-number">2.2</span> Option bounds.</h2>
<p>Option values (or prices) are subject or constrained to upper and lower bounds. This basically mean that in theory option prices cannot exceed upper bounds and cannot decrease below lower bounds. If they do, then arbitrage opportunities arise.</p>
<p>We can extend our analysis by incorporating the corresponding call and put option bounds.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Put lower bound.</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>lb.put <span class="ot">&lt;-</span> <span class="fu">pmax</span>(K <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>rf <span class="sc">*</span> TT) <span class="sc">-</span> S0.seq, <span class="dv">0</span>)</span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="co"># Call lower bound.</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>lb.call <span class="ot">&lt;-</span> <span class="fu">pmax</span>(S0.seq <span class="sc">-</span> K <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>rf <span class="sc">*</span> TT), <span class="dv">0</span>)</span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="co"># Again the S0.star. Where did this value comes from?</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>line.star <span class="ot">&lt;-</span> S0.star <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="co"># Plot.</span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="fu">plot</span>(S0.seq, c.S0, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb15-10"><a href="#cb15-10"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[<span class="dv">0</span>])), <span class="at">ylab =</span> <span class="st">"Call (blue), put (red)"</span>)</span>
<span id="cb15-11"><a href="#cb15-11"></a><span class="fu">lines</span>(S0.seq, p.S0, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="fu">abline</span>(<span class="at">v =</span> S0.star, <span class="at">lty =</span> <span class="dv">2</span>) </span>
<span id="cb15-13"><a href="#cb15-13"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb15-14"><a href="#cb15-14"></a><span class="fu">abline</span>(<span class="at">v =</span> line.star, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"green"</span>)</span>
<span id="cb15-15"><a href="#cb15-15"></a><span class="fu">abline</span>(<span class="at">h =</span> line.star, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"green"</span>)</span>
<span id="cb15-16"><a href="#cb15-16"></a><span class="co"># Put upper bound.</span></span>
<span id="cb15-17"><a href="#cb15-17"></a><span class="fu">abline</span>(<span class="at">h =</span> K <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>rf <span class="sc">*</span> TT), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb15-18"><a href="#cb15-18"></a><span class="fu">lines</span>(S0.seq, lb.put, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb15-19"><a href="#cb15-19"></a><span class="co"># Call upper bound.</span></span>
<span id="cb15-20"><a href="#cb15-20"></a><span class="fu">lines</span>(S0.seq, S0.seq, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">2</span>) </span>
<span id="cb15-21"><a href="#cb15-21"></a><span class="fu">lines</span>(S0.seq, lb.call, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-ovaafosiob" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-ovaafosiob-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.4: Option values as a function of <span class="math inline">\(S_0\)</span> including option bounds.</figcaption>
</figure>
</div>
</div>
</div>
<p>Note that the stock price range of values is from zero to positive infinity. However, this is not the case for the options. The option values depend on these bounds. We can illustrate the same plot in a cleaner way, to make emphasis on a geometric approach.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="fu">plot</span>(S0.seq, lb.put, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>,  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), </span>
<span id="cb16-3"><a href="#cb16-3"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[<span class="dv">0</span>])), <span class="at">ylab =</span> <span class="st">"Call (blue), put (red)"</span>)</span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="fu">abline</span>(<span class="at">v =</span> S0.star, <span class="at">lty =</span> <span class="dv">2</span>) </span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="fu">abline</span>(<span class="at">v =</span> line.star, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="fu">abline</span>(<span class="at">h =</span> line.star, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="fu">abline</span>(<span class="at">h =</span> S0.star, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb16-9"><a href="#cb16-9"></a><span class="fu">lines</span>(S0.seq, S0.seq, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb16-10"><a href="#cb16-10"></a><span class="fu">lines</span>(S0.seq, lb.call, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="co"># Enumerate the areas.</span></span>
<span id="cb16-12"><a href="#cb16-12"></a><span class="fu">text</span>(S0.star <span class="sc">/</span> <span class="dv">2</span>, (S0.star <span class="sc">+</span> (S0.star <span class="sc">/</span> <span class="dv">2</span>)), <span class="st">"1"</span>)</span>
<span id="cb16-13"><a href="#cb16-13"></a><span class="fu">text</span>(<span class="dv">60</span>, <span class="dv">80</span>, <span class="st">"2"</span>)</span>
<span id="cb16-14"><a href="#cb16-14"></a><span class="fu">text</span>(<span class="dv">80</span>, <span class="dv">60</span>, <span class="st">"3"</span>)</span>
<span id="cb16-15"><a href="#cb16-15"></a><span class="fu">text</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="st">"4"</span>)</span>
<span id="cb16-16"><a href="#cb16-16"></a><span class="fu">text</span>(<span class="dv">25</span>, <span class="dv">35</span>, <span class="st">"5"</span>)</span>
<span id="cb16-17"><a href="#cb16-17"></a><span class="fu">text</span>(<span class="dv">25</span>, <span class="dv">10</span>, <span class="st">"6"</span>)</span>
<span id="cb16-18"><a href="#cb16-18"></a><span class="fu">text</span>(<span class="dv">40</span>, <span class="dv">20</span>, <span class="st">"7"</span>)</span>
<span id="cb16-19"><a href="#cb16-19"></a><span class="fu">text</span>(<span class="dv">60</span>, <span class="dv">35</span>, <span class="st">"8"</span>)</span>
<span id="cb16-20"><a href="#cb16-20"></a><span class="fu">text</span>(<span class="dv">80</span>, <span class="dv">20</span>, <span class="st">"9"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-capobgiotp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-capobgiotp-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.5: Call and put option bounds: geometric inspection (or ‘the puzzle’).</figcaption>
</figure>
</div>
</div>
</div>
<p>Every number from 1 to 9 is assigned to a specific geometric shape in the plot above. This is, a square as in 1, and triangles of two different shapes in the rest of the cases (2 to 9). It is interesting to analyze whether each area represents a possible price range for call and/or put options.</p>
<p>Now, let’s see how Black-Scholes option prices changes (call and put) when we leave <span class="math inline">\(S_0\)</span> as a variable, three levels of <span class="math inline">\(\sigma\)</span> and the rest of the parameters as fixed: <span class="math inline">\(BS = f(S_0, K=50, rf=0.05, T=1, \sigma)\)</span>. We can show this in a 2 dimension plot, including the correspondent bounds.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Evaluate the function.</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>c.S0.s1 <span class="ot">&lt;-</span> <span class="fu">mapply</span>(c.bs, S0.seq, K, rf, TT, sigma)</span>
<span id="cb17-3"><a href="#cb17-3"></a>c.S0.s5 <span class="ot">&lt;-</span> <span class="fu">mapply</span>(c.bs, S0.seq, K, rf, TT, sigma <span class="sc">*</span> <span class="dv">5</span>)</span>
<span id="cb17-4"><a href="#cb17-4"></a>c.S0.s15 <span class="ot">&lt;-</span> <span class="fu">mapply</span>(c.bs, S0.seq, K, rf, TT, sigma <span class="sc">*</span> <span class="dv">15</span>)</span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="co"># Plot.</span></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="fu">plot</span>(S0.seq, c.S0.s1, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lwd =</span> <span class="dv">3</span>,  <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[<span class="dv">0</span>])),</span>
<span id="cb17-7"><a href="#cb17-7"></a>     <span class="at">ylab =</span> <span class="st">"Call option price, c"</span>)</span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="fu">lines</span>(S0.seq, c.S0.s5, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"blue"</span>) <span class="co"># call with higher sigma</span></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="fu">lines</span>(S0.seq, c.S0.s15, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"red"</span>) <span class="co"># call with even higher sigma</span></span>
<span id="cb17-10"><a href="#cb17-10"></a><span class="fu">lines</span>(S0.seq, lb.call, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="co"># lower bound</span></span>
<span id="cb17-11"><a href="#cb17-11"></a><span class="fu">lines</span>(S0.seq, S0.seq, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="co"># upper bound</span></span>
<span id="cb17-12"><a href="#cb17-12"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>,<span class="at">legend=</span><span class="fu">expression</span>(sigma <span class="sc">==</span> <span class="fl">0.3</span>, sigma <span class="sc">==</span> <span class="fl">1.5</span>,</span>
<span id="cb17-13"><a href="#cb17-13"></a>                                   sigma <span class="sc">==</span> <span class="fl">4.5</span>, <span class="st">"call bounds"</span>), </span>
<span id="cb17-14"><a href="#cb17-14"></a>       <span class="at">text.width =</span> <span class="dv">12</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"black"</span>), <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb17-15"><a href="#cb17-15"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-cocasasitrob" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-cocasasitrob-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.6: Call option changes as <span class="math inline">\(S_0\)</span> and <span class="math inline">\(\sigma\)</span> increases: the role of bounds.</figcaption>
</figure>
</div>
</div>
</div>
<p>And the same for the put option.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Evaluate the function.</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>p.S0.s1 <span class="ot">&lt;-</span> <span class="fu">mapply</span>(p.bs, S0.seq, K, rf, TT, sigma)</span>
<span id="cb18-3"><a href="#cb18-3"></a>p.S0.s5 <span class="ot">&lt;-</span> <span class="fu">mapply</span>(p.bs, S0.seq, K, rf, TT, sigma <span class="sc">*</span> <span class="dv">5</span>)</span>
<span id="cb18-4"><a href="#cb18-4"></a>p.S0.s15 <span class="ot">&lt;-</span> <span class="fu">mapply</span>(p.bs, S0.seq, K, rf, TT, sigma <span class="sc">*</span> <span class="dv">15</span>)</span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="co"># Plot.</span></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="fu">plot</span>(S0.seq, p.S0.s1, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lwd =</span> <span class="dv">3</span>,  <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[<span class="dv">0</span>])),</span>
<span id="cb18-7"><a href="#cb18-7"></a>     <span class="at">ylab =</span> <span class="st">"Put option price, p"</span>)</span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="fu">lines</span>(S0.seq, p.S0.s5, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"blue"</span>) <span class="co"># put with higher sigma</span></span>
<span id="cb18-9"><a href="#cb18-9"></a><span class="fu">lines</span>(S0.seq, p.S0.s15, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"red"</span>) <span class="co"># put with even higher sigma</span></span>
<span id="cb18-10"><a href="#cb18-10"></a><span class="fu">lines</span>(S0.seq, lb.put, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="co"># lower bound</span></span>
<span id="cb18-11"><a href="#cb18-11"></a><span class="fu">lines</span>(S0.seq, <span class="fu">rep</span>(S0.star, <span class="dv">50</span>) , <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="co"># upper bound</span></span>
<span id="cb18-12"><a href="#cb18-12"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>, <span class="at">legend =</span> <span class="fu">expression</span>(sigma <span class="sc">==</span> <span class="fl">0.3</span>, sigma <span class="sc">==</span> <span class="fl">1.5</span>,</span>
<span id="cb18-13"><a href="#cb18-13"></a>                                   sigma <span class="sc">==</span> <span class="fl">4.5</span>, <span class="st">"put bounds"</span>), </span>
<span id="cb18-14"><a href="#cb18-14"></a>       <span class="at">text.width =</span> <span class="dv">12</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"black"</span>), <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb18-15"><a href="#cb18-15"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-pocaasasittrob" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-pocaasasittrob-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.7: Put option changes as <span class="math inline">\(S_0\)</span> and <span class="math inline">\(\sigma\)</span> increase: the role of bounds.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># Evaluate the function.</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>p.S0.s1 <span class="ot">&lt;-</span> <span class="fu">mapply</span>(p.bs, S0.seq, K, rf, TT, sigma)</span>
<span id="cb19-3"><a href="#cb19-3"></a>p.S0.s5 <span class="ot">&lt;-</span> <span class="fu">mapply</span>(p.bs, S0.seq, K, rf, TT, sigma <span class="sc">*</span> <span class="dv">5</span>)</span>
<span id="cb19-4"><a href="#cb19-4"></a>p.S0.s15 <span class="ot">&lt;-</span> <span class="fu">mapply</span>(p.bs, S0.seq, K, rf, TT, sigma <span class="sc">*</span> <span class="dv">15</span>)</span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="co"># Plot.</span></span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="fu">plot</span>(S0.seq, p.S0.s5, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lwd =</span> <span class="dv">3</span>,  <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[<span class="dv">0</span>])),</span>
<span id="cb19-7"><a href="#cb19-7"></a>     <span class="at">ylab =</span> <span class="st">"Put option price, p"</span>, <span class="at">col =</span> <span class="st">"blue"</span>,</span>
<span id="cb19-8"><a href="#cb19-8"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">47</span>, <span class="fl">47.8</span>))</span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="fu">lines</span>(S0.seq, p.S0.s15, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"red"</span>) <span class="co"># put with even higher sigma</span></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="fu">lines</span>(S0.seq, lb.put, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="co"># lower bound</span></span>
<span id="cb19-11"><a href="#cb19-11"></a><span class="fu">lines</span>(S0.seq, <span class="fu">rep</span>(S0.star, <span class="dv">50</span>) , <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="co"># upper bound</span></span>
<span id="cb19-12"><a href="#cb19-12"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">expression</span>(sigma <span class="sc">==</span> <span class="fl">1.5</span>,</span>
<span id="cb19-13"><a href="#cb19-13"></a>                                   sigma <span class="sc">==</span> <span class="fl">4.5</span>, <span class="st">"put bounds"</span>), </span>
<span id="cb19-14"><a href="#cb19-14"></a>       <span class="at">text.width =</span> <span class="dv">12</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"black"</span>), <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb19-15"><a href="#cb19-15"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="at">bg =</span> <span class="st">"transparent"</span>, <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-pocaasasittrobz" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-pocaasasittrobz-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.8: Put option changes as <span class="math inline">\(S_0\)</span> and <span class="math inline">\(\sigma\)</span> increase: the role of bounds (zoom).</figcaption>
</figure>
</div>
</div>
</div>
<p>Then, regardless of the extreme value of parameters, option bounds represent the maximum and minimum values for the call and put options. These option prices are theoretical as they are calculated by implementing the Black-Scholes formula. We normally evaluate whether the option <em>market</em> prices violates these bounds because this will flag an opportunity to implement an arbitrage strategy to generate a risk-free profit.</p>
<p>A different way to illustrate the option properties is by looking at a plane. Here, we let <span class="math inline">\(S_0\)</span> and <span class="math inline">\(K\)</span> as a free variables and remain the rest as fixed: <span class="math inline">\(BS = f(S_0, K, rf=0.05, T=1, \sigma = 0.3)\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># K as a variable.</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>K.seq <span class="ot">&lt;-</span> S0.seq</span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="co"># Create the empty matrix.</span></span>
<span id="cb20-4"><a href="#cb20-4"></a>c.S0.s <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">50</span>, <span class="at">ncol =</span> <span class="dv">50</span>)</span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="co"># Fill the empty matrix.</span></span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>){ <span class="co"># Is there an easier way to do this?</span></span>
<span id="cb20-7"><a href="#cb20-7"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>){</span>
<span id="cb20-8"><a href="#cb20-8"></a>    c.S0.s[i, j] <span class="ot">&lt;-</span> <span class="fu">c.bs</span>(S0.seq[i], K.seq[j], rf, TT, sigma) } }</span>
<span id="cb20-9"><a href="#cb20-9"></a><span class="co"># Plot.</span></span>
<span id="cb20-10"><a href="#cb20-10"></a>c.S0.s.plot <span class="ot">&lt;-</span> <span class="fu">persp</span>(S0.seq, K.seq, c.S0.s, <span class="at">zlab =</span> <span class="st">"Call"</span>, </span>
<span id="cb20-11"><a href="#cb20-11"></a>                     <span class="at">xlab =</span> <span class="st">"S_0"</span>, </span>
<span id="cb20-12"><a href="#cb20-12"></a>      <span class="at">ylab =</span> <span class="st">"K"</span>, <span class="at">theta =</span> <span class="sc">-</span><span class="dv">60</span>, <span class="at">phi =</span> <span class="dv">10</span>, <span class="at">expand =</span>  <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">"orange"</span>, </span>
<span id="cb20-13"><a href="#cb20-13"></a>      <span class="at">shade =</span> <span class="fl">0.2</span>, <span class="at">ticktype =</span> <span class="st">"detailed"</span>) </span>
<span id="cb20-14"><a href="#cb20-14"></a><span class="fu">points</span>(<span class="fu">trans3d</span>(S0, K, c, c.S0.s.plot), <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-cvasakcapv" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-cvasakcapv-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.9: Call value as <span class="math inline">\(S_0\)</span> and <span class="math inline">\(K\)</span> change, a plane view.</figcaption>
</figure>
</div>
</div>
</div>
<p>An alternative view is by showing a contour plot. A contour plot is a graphical technique for representing a 3-dimensional surface by plotting constant <span class="math inline">\(z\)</span> slices (option prices), called contours, on a 2-dimensional format. That is, given a value for <span class="math inline">\(z\)</span>, lines are drawn for connecting the <span class="math inline">\((x, y)\)</span> coordinates (<span class="math inline">\(S_0\)</span>, <span class="math inline">\(K\)</span>) where that <span class="math inline">\(z\)</span> value occurs.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">contour</span>(S0.seq, K.seq, c.S0.s, <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[<span class="dv">0</span>])), </span>
<span id="cb21-2"><a href="#cb21-2"></a>        <span class="at">ylab =</span> <span class="st">"K"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">nlevels =</span> <span class="dv">20</span>)</span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="fu">points</span>(S0, K, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">cex =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-cvasakcacv" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-cvasakcacv-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.10: Call value as <span class="math inline">\(S_0\)</span> and <span class="math inline">\(K\)</span> change, a contour view.</figcaption>
</figure>
</div>
</div>
</div>
<p>Note that the blue circle <span class="math inline">\(S_0=\$50, K=\$50\)</span> is between the contour line 5 and 10, this makes sense because the call option at <span class="math inline">\(call(S_0=50, K=50, rf=0.05, T=1, \sigma = 0.3) = \$7.115627\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">plot_ly</span>(<span class="at">type =</span> <span class="st">"surface"</span> , <span class="at">x =</span> S0.seq, <span class="at">y =</span> K.seq , <span class="at">z =</span> c.S0.s ) <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="fu">layout</span>(<span class="at">scene =</span> <span class="fu">list</span>(<span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Stock price"</span>), </span>
<span id="cb22-3"><a href="#cb22-3"></a>                    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"K"</span>, </span>
<span id="cb22-4"><a href="#cb22-4"></a>                    <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Call price"</span>))))  <span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="fu">hide_colorbar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-cvasakcaiv" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div class="plotly html-widget html-fill-item" id="htmlwidget-d5ea4488dcebaac4ad89" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-d5ea4488dcebaac4ad89">{"x":{"visdat":{"4cc02ec11583":["function () ","plotlyVisDat"]},"cur_data":"4cc02ec11583","attrs":{"4cc02ec11583":{"x":[0,2.0408163265306123,4.0816326530612246,6.1224489795918373,8.1632653061224492,10.204081632653061,12.244897959183675,14.285714285714286,16.326530612244898,18.367346938775512,20.408163265306122,22.448979591836736,24.489795918367349,26.530612244897959,28.571428571428573,30.612244897959183,32.653061224489797,34.693877551020407,36.734693877551024,38.775510204081634,40.816326530612244,42.857142857142861,44.897959183673471,46.938775510204081,48.979591836734699,51.020408163265309,53.061224489795919,55.102040816326529,57.142857142857146,59.183673469387756,61.224489795918366,63.265306122448983,65.306122448979593,67.34693877551021,69.387755102040813,71.428571428571431,73.469387755102048,75.510204081632651,77.551020408163268,79.591836734693885,81.632653061224488,83.673469387755105,85.714285714285722,87.755102040816325,89.795918367346943,91.83673469387756,93.877551020408163,95.91836734693878,97.959183673469397,100],"y":[0,2.0408163265306123,4.0816326530612246,6.1224489795918373,8.1632653061224492,10.204081632653061,12.244897959183675,14.285714285714286,16.326530612244898,18.367346938775512,20.408163265306122,22.448979591836736,24.489795918367349,26.530612244897959,28.571428571428573,30.612244897959183,32.653061224489797,34.693877551020407,36.734693877551024,38.775510204081634,40.816326530612244,42.857142857142861,44.897959183673471,46.938775510204081,48.979591836734699,51.020408163265309,53.061224489795919,55.102040816326529,57.142857142857146,59.183673469387756,61.224489795918366,63.265306122448983,65.306122448979593,67.34693877551021,69.387755102040813,71.428571428571431,73.469387755102048,75.510204081632651,77.551020408163268,79.591836734693885,81.632653061224488,83.673469387755105,85.714285714285722,87.755102040816325,89.795918367346943,91.83673469387756,93.877551020408163,95.91836734693878,97.959183673469397,100],"z":[[null,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[2.0408163265306123,0.29043377114256774,0.0047923753801042551,6.0992773001745893e-05,1.0250942288844112e-06,2.3967366486603431e-08,7.5648853704853836e-10,3.0956301231516447e-11,1.583207533850954e-12,9.8137896849610565e-14,7.1893931606459517e-15,6.0968911988858051e-16,5.8837183013325498e-17,6.3698375124128226e-18,7.6441677328715491e-19,1.0065622513510075e-19,1.4417250657957422e-20,2.2294634823569652e-21,3.6980160966439835e-22,6.5421264620556544e-23,1.2282324284152412e-23,2.4363251522255563e-24,5.0860238843866948e-25,1.1134946727299555e-25,2.5485889126050472e-26,6.0811334264402044e-27,1.5088001640803589e-27,3.8835950061809085e-28,1.0348426981742625e-28,2.849154340037394e-29,8.0908204451653241e-30,2.3659230874238087e-30,7.1136528517201809e-31,2.1961970797509568e-31,6.953190366872057e-32,2.254857722836581e-32,7.4817116825198546e-33,2.5373901830696466e-33,8.7875070778411644e-34,3.1049260323506096e-34,1.118365765864188e-34,4.1032328431826644e-35,1.5323629844425632e-35,5.8209378773387988e-36,2.247710182188891e-36,8.8173912823283795e-37,3.5119128463283428e-37,1.4194377181892049e-37,5.8188333642039077e-38,2.4182004565277333e-38],[4.0816326530612246,2.1421473797465183,0.58086754228513549,0.083999415506478159,0.0095847507602085102,0.0010570035439489076,0.00012198554600349179,1.5168983553796595e-05,2.0501884577688224e-06,3.0120484719583156e-07,4.7934732973206862e-08,8.2235293525080805e-09,1.5129770740970767e-09,2.9700569127730379e-10,6.1912602463032894e-11,1.3644629491984715e-11,3.166415067701908e-12,7.709284220355492e-13,1.9627579369922113e-13,5.209884295834018e-14,1.4378786321291903e-14,4.1160657403958226e-15,1.219378239777161e-15,3.7308445753570042e-16,1.17674366026651e-16,3.8196585281703346e-17,1.2739675024825645e-17,4.3597464332471692e-18,1.5288335465743098e-18,5.4868917464124272e-19,2.0131245027020151e-19,7.5429219965058548e-20,2.8834501315914844e-20,1.1235635002854284e-20,4.4589269647139304e-21,1.800819477312688e-21,7.3960321932879671e-22,3.0868689245571205e-22,1.3084252924111309e-22,5.6289660202740352e-23,2.4564648568304825e-23,1.0868320130786213e-23,4.8726503044511126e-24,2.2126480337064758e-24,1.017204776877339e-24,4.7322605621992155e-25,2.2269893454599109e-25,1.0597196489340882e-25,5.0971778252100944e-26,2.4773365883060127e-26],[6.1224489795918373,4.181179861644547,2.2806625520277217,0.87130131342770323,0.25039292689047743,0.061884065807870203,0.014377126140312751,0.0032976532113556528,0.00076645099793488936,0.00018297831900523833,4.5174038217605443e-05,1.1567926691784323e-05,3.0752826866532268e-06,8.4848951434648675e-07,2.4272924359596869e-07,7.1902099459810134e-08,2.2022227497459657e-08,6.9632389805168403e-09,2.2694656111456184e-09,7.6128609475921811e-10,2.6245858396784005e-10,9.2868903694549651e-11,3.3683551256150818e-11,1.2507724123592721e-11,4.7496226015528684e-12,1.8424643910365266e-12,7.2940155739811497e-13,2.9441369054883452e-13,1.21058446879446e-13,5.0666873430025979e-14,2.1568179481937931e-14,9.3315201715297139e-15,4.1006162918669409e-15,1.8290673596657384e-15,8.2763052377298159e-16,3.7968820159781724e-16,1.7651154903997748e-16,8.3111134295356383e-17,3.9617043643200836e-17,1.9109512537238493e-17,9.3235257985158014e-18,4.5994063922570612e-18,2.2932503198614678e-18,1.1552464513211079e-18,5.8779324731045567e-19,3.0196867540530188e-19,1.5658637440131688e-19,8.193597673483606e-20,4.3251751973872363e-20,2.3026429510277401e-20],[8.1632653061224492,6.2219809594690929,4.2842947594930365,2.4733151147873036,1.161735084570271,0.46461421939441694,0.16799883101295632,0.05747726019764815,0.01916950152041702,0.0063503116408681615,0.0021140070878978151,0.00071229332087375911,0.00024397109200698357,8.5162416914953253e-05,3.0337967107593191e-05,1.1036350781438666e-05,4.1003769155376448e-06,1.5556143360016707e-06,6.0240969439166312e-07,2.379963571200791e-07,9.5869465946413724e-08,3.9350220015735909e-08,1.6447058705016161e-08,6.9955191212495312e-09,3.0259541481941534e-09,1.3302772635024158e-09,5.9401138255460757e-10,2.692559058838121e-10,1.2382520492606579e-10,5.7742065927725497e-11,2.7289258983969429e-11,1.3064550859798936e-11,6.3328301354038159e-12,3.1067684250340638e-12,1.5418568440710984e-12,7.7379998841750101e-13,3.9255158739844226e-13,2.0122874348306646e-13,1.0419768591668036e-13,5.4482576404977234e-14,2.8757572642583807e-14,1.5318342688978531e-14,8.2321314807916452e-15,4.4620608100345336e-15,2.438756479554322e-15,1.3437031431879726e-15,7.4616891507140084e-16,4.1751434492045912e-16,2.3534873205330199e-16,1.3361904396086603e-16],[10.204081632653061,8.2627970964331094,6.32183293343064,4.4076572431998073,2.7002128275175279,1.4521688557128396,0.70448954601415936,0.31823546447099926,0.13737830642318227,0.057756107546032498,0.023961876900521289,0.0098997939172372346,0.0040982996229484078,0.001707187172787776,0.00071761283180747648,0.00030496386500873055,0.00013118473797612174,5.716345458328827e-05,2.5242532531334324e-05,1.1298046282826014e-05,5.1254711444220628e-06,2.3565519713540563e-06,1.0978674217936948e-06,5.1813690759071687e-07,2.4764889835562519e-07,1.1983683243301625e-07,5.8690089926873965e-08,2.9081386543225726e-08,1.4574573658595244e-08,7.3852030474142887e-09,3.7824426852427083e-09,1.957429190062636e-09,1.0232165341512764e-09,5.4011315329736431e-10,2.878125882976191e-10,1.5478150615758234e-10,8.3983388358812411e-11,4.5964008847423275e-11,2.5367754682742025e-11,1.4114952816434586e-11,7.9160376692547893e-12,4.4737222161596018e-12,2.5472318351251052e-12,1.4608831576337606e-12,8.437675899025198e-13,4.9068948424805161e-13,2.8726762337462007e-13,1.692720352896374e-13,1.0037554640621475e-13,5.9888469881161394e-14],[12.244897959183675,10.303613419479436,8.362359723289094,6.4264421392395557,4.5613251040554434,2.9469827481746416,1.7426026268554065,0.95921360422263557,0.50078585378095486,0.25199824651943503,0.12376813161574041,0.059892741970301255,0.028754252280625503,0.013765421707652853,0.0065953064227113056,0.0031710106318467296,0.0015329019958697787,0.00074607767125759762,0.00036595663801047666,0.00018102692723920896,9.0348076435210886e-05,4.550695066138984e-05,2.3135853383568646e-05,1.1873172924740201e-05,6.1505653733064537e-06,3.21588543315313e-06,1.6969790286929735e-06,9.0361454158748705e-07,4.8545848719193737e-07,2.630922359276552e-07,1.4380419891962027e-07,7.9261178699629966e-08,4.4044454994919314e-08,2.4670588057524162e-08,1.3926477961033681e-08,7.9212434427335501e-09,4.5389312222912368e-09,2.6196387831729265e-09,1.5225721895184362e-09,8.9101707383191136e-10,5.2491716793568009e-10,3.1125702901527604e-10,1.857378073890993e-10,1.1152325593673383e-10,6.7367102512301636e-11,4.0933888475954196e-11,2.5015448247185443e-11,1.5373161313748912e-11,9.4992452031057368e-12,5.9010507200519593e-12],[14.285714285714286,12.344429745920147,10.403148485651883,8.4629297007926461,6.5449683571250059,4.7429162665389306,3.2058273707264835,2.033036397997976,1.2231816399743884,0.70656838363641361,0.39604215250487984,0.21728492682452161,0.11748895107412138,0.062943073017983964,0.0335466276607298,0.017842186598139631,0.0094923126826354925,0.0050605819761132959,0.0027072216055191653,0.0014547453359414105,0.00078581913866415491,0.0004269494110122219,0.00023341385974795688,0.00012843958319405267,7.1150459807964783e-05,3.9684008795919296e-05,2.2286386096346731e-05,1.2602527780355158e-05,7.1756596021908852e-06,4.1136983113733183e-06,2.3743269804414968e-06,1.3795899409357747e-06,8.0689948201881459e-07,4.7501056859833382e-07,2.8141878342114268e-07,1.6777156540622386e-07,1.0063457872627824e-07,6.0727729644261527e-08,3.6862499355088851e-08,2.2505435613772162e-08,1.3817906930707813e-08,8.530944011523348e-09,5.2954197593397652e-09,3.304467377204935e-09,2.0727673299937891e-09,1.3067691856017425e-09,8.279397857220684e-10,5.2711278279893128e-10,3.371846406166113e-10,2.1669410862061544e-10],[16.326530612244898,14.385246072447666,12.443961918938186,10.502894987958395,8.568589518986073,6.6832163287656918,4.9466302295746072,3.472440599635906,2.3234701691405419,1.4932565501215889,0.92922843878883388,0.56401064082541108,0.33599766202591264,0.19746404570542531,0.1149545203952963,0.066507300440878048,0.038339003040834041,0.022066157342915255,0.012700623281736323,0.007319555423813795,0.0042280141757956302,0.002449723657919213,0.0014245866417475182,0.00083186782573202098,0.00048794218401396715,0.0002875726767808456,0.00017032483382990651,0.00010139593485671916,6.0675934215186382e-05,3.649982499805257e-05,2.2072701562877333e-05,1.34187520255706e-05,8.2007538310752896e-06,5.0380995603871849e-06,3.1112286720033413e-06,1.9311941211423909e-06,1.2048193887833262e-06,7.5542361208260869e-07,4.7599271424015821e-07,3.0138264408564215e-07,1.9173893189282745e-07,1.2255800975991469e-07,7.8700440031471818e-08,5.0766963412592097e-08,3.2894117410032322e-08,2.1406855923091534e-08,1.3991038242499062e-08,9.1827881931244736e-09,6.0519082963883068e-09,4.0046939512197069e-09],[18.367346938775512,16.426062398978143,14.484777909387754,12.543539584933638,10.60434093345072,8.6848192588272379,6.8419876560831661,5.1671610682715237,3.7443096460987846,2.6139039402831106,1.7675622836440148,1.1643832402968153,0.75117878067143184,0.47677791184009966,0.29888376445313969,0.1856521974236105,0.11456583494981754,0.070388297058868066,0.043131378420938282,0.026396545469709931,0.016153171876920697,0.0098929596340669029,0.0060684189905925306,0.0037304896573366955,0.0022993529938046715,0.0014215477960580411,0.00088179027696095626,0.00054893495701571586,0.00034301149061581951,0.00021517407103739368,0.00013552211465281622,8.5704137395176214e-05,5.4423494236152605e-05,3.4703780075353132e-05,2.2221747650080141e-05,1.4288609517969648e-05,9.2258480599597076e-06,5.9815994425061944e-06,3.8941242647306672e-06,2.5454685430394535e-06,1.6706015643196583e-06,1.1007919299689349e-06,7.2818773078790437e-07,4.8357595428374389e-07,3.2236349984121925e-07,2.1570629837943019e-07,1.4487422302310438e-07,9.7657585772609579e-08,6.6066682492378919e-08,4.4853434002822999e-08],[20.408163265306122,18.466878725508746,16.525594192866219,14.584319911638493,12.64366586686128,10.710736898732591,8.8153144863996147,7.0194523361566414,5.4004256550350558,4.019886140171371,2.9043377114256792,2.04491380001142,1.4089790920283187,0.95374947641013996,0.63647092894199853,0.41999707753239157,0.27475661284636455,0.17857323301504913,0.115512215092065,0.074477989614354478,0.047923753801042579,0.030806227540874753,0.019799587834474469,0.012732247579634426,0.0081965992458968157,0.0052850177197445239,0.0034143743455755521,0.0022108795907270357,0.001435225663614953,0.00093425844258554144,0.0006099277300174611,0.00039940367053509316,0.00026236947595224347,0.0001729086989209162,0.00011432690916657654,7.5844917768983031e-05,5.0485065062668647e-05,3.3718206487867567e-05,2.2596092565652028e-05,1.5193856451520233e-05,1.0250942288844126e-05,6.9392623580463486e-06,4.7131039427081127e-06,3.2116892692240945e-06,2.1957348435873897e-06,1.5060242359791586e-06,1.0362738151814337e-06,7.1530549607668717e-07,4.9529779671125038e-07,3.4401853255265544e-07],[22.448979591836736,20.507695052039359,18.566410513352142,16.625128356839483,14.684037927355959,12.745953208596436,10.825641178819502,8.961373118528325,7.2129731425102275,5.6434235989379999,4.2981696311448356,3.1947714825682461,2.3245279961488734,1.6608496543045677,1.1687445628849602,0.81222195536149222,0.55876382933811009,0.38130632361072792,0.25856921609947903,0.17449653496542239,0.11734214645681573,0.078712301770602178,0.05271612918114682,0.035276514346132548,0.023601824891902906,0.015796305290689427,0.010580601402237821,0.0070953431720726934,0.0047652017882658937,0.0032058858035644844,0.0021610684472431925,0.0014598939501060115,0.00098848745873160448,0.00067092050301920461,0.00045652434776080001,0.00031144701324367034,0.00021303883762064865,0.0001461196315196275,0.000100496040891602,6.930918379658953e-05,4.7933704105139322e-05,3.3243224664518943e-05,2.3119474202766674e-05,1.6123661531456507e-05,1.1276036517728544e-05,7.9077102303105754e-06,5.5608268662292758e-06,3.9211545427852041e-06,2.7724583537268874e-06,1.9655414838118691e-06],[24.489795918367349,22.548511378569973,20.607226838958873,18.665942878407282,16.724719446578188,14.784665965455826,12.852884278479111,10.951593306937266,9.1226502081108869,7.4199453443619152,5.8939654963492831,4.5784871492161443,3.4852052537108129,2.6058675983718125,1.9184272084452711,1.3938426581832513,1.0015717075619097,0.71314425328380704,0.50399649303887006,0.3540508654745933,0.24753626323148081,0.17243178059294473,0.11978548394060251,0.083050884613537601,0.057508504561251006,0.039794130747739076,0.027530843415305706,0.019050934922604595,0.013190612845422611,0.0091410892179290548,0.0063420212636934592,0.0044060518404592935,0.0030658039917395574,0.0021368799626212756,0.0014921553425151952,0.0010439842725886595,0.00073191327602095332,0.00051421388121856981,0.00036205385447841791,0.00025548725074486019,0.00018069615287042177,0.00012809294311139194,9.1013901322779681e-05,6.4819121097490031e-05,4.6271706767137292e-05,3.3109052344315972e-05,2.3746345849480401e-05,1.7071195257488089e-05,1.2301130746612907e-05,8.8845559484381019e-06],[26.530612244897959,24.589327705100583,22.648043165336794,20.706758772617817,18.765493943825039,16.824687415368153,14.887696858377021,12.966930103206664,11.089828386733823,9.2979661416612007,7.6380887157922217,6.1504419373386714,4.8603703171921389,3.7756390248533833,2.8885521832722283,2.1805548922473541,1.6272303411097688,1.2024508748637635,0.88123897137579821,0.64139751375918141,0.4641910656994237,0.33439926564238931,0.24001397089654741,0.17177542411444491,0.12267123585955808,0.087467087111952058,0.062300879941355247,0.044349397904639154,0.03156420858311787,0.022467877731906366,0.01599982968437777,0.01140154096026369,0.0081320530586798112,0.0058063838402679091,0.0041509659559266221,0.002971594605242496,0.0021304793653733993,0.0015298729588605932,0.0011004238098430465,0.00079290604902269857,0.00057235591643311177,0.00041391815697076027,0.00029990517294902277,0.000217715110991478,0.00015835775630844559,0.00011541033122550192,8.4277333058541039e-05,6.1665437050926293e-05,4.5210595102829166e-05,3.3212910674061897e-05],[28.571428571428573,26.630144031631197,24.688859491840294,22.747574990986422,20.806296971303766,18.865200311753689,16.925859401585292,14.99503165822563,13.089936714250012,11.240551243202077,9.4858325330778612,7.8655033134662098,6.411654741452967,5.1434835523182745,4.0660727959959519,3.1723050675411066,2.4463632799487769,1.8674821756979156,1.4131367672728272,1.0613445311243712,0.79208430500975968,0.58799590854534811,0.43456985364904321,0.32001861122380992,0.23497790214824277,0.17214049356885819,0.12588614603596793,0.091942608889778343,0.067093255321459599,0.048935097947392314,0.035684373196279262,0.026023798770491324,0.018984625365270985,0.013856783098139591,0.010121163952226592,0.0073990248076423459,0.0054144432110383306,0.0039666128761512501,0.0029094906718828209,0.0021368969689877539,0.0015716382773283098,0.0011575831735917974,0.00085389882202444381,0.00063086370169641859,0.00046682771949591376,0.00034600619536056393,0.00025687916638810534,0.00019102976153114164,0.00014230091961592957,0.00010618288487657525],[30.612244897959183,28.670960358161807,26.729675818365756,24.78839128929933,22.847108961574783,20.905899308222732,18.965498800291918,17.029529819017526,15.108477708954263,13.222971729599422,11.403312760138608,9.6847342196238735,8.1006384825525863,6.6766989694070702,5.4275803509564113,4.356506567138517,3.4569203282695611,2.7151879015992613,2.1134686380424785,1.6322005580669465,1.2519646344523876,0.95470639341299801,0.72440984719011325,0.54736088615313916,0.41213491926954582,0.3094203290393498,0.23176025655881016,0.17326832263809733,0.12935234625373382,0.096464472648738031,0.071885630701563841,0.053545741371270161,0.039877448059082443,0.02969938175171144,0.022124391856279346,0.016488266056778167,0.012294898868845217,0.0091744436553909681,0.0068515776776515297,0.0051215615183633212,0.0038322549896744537,0.0028706538326849149,0.0021528384954224329,0.0016164865793303444,0.0012153044845968717,0.00091489159502619079,0.00068967126685147082,0.00052061482284903367,0.00039355421392836629,0.00029793122483778595],[32.653061224489797,30.711776684692421,28.770492144895332,26.829207608168787,24.887923837876372,22.946669600459611,21.005789975916791,19.067208589718661,17.137179037972146,15.229434864893456,13.366432657531384,11.577312099951467,9.8932604591492144,8.3422377365513505,6.944881199271812,5.7124756948994104,4.6469403382810839,3.7422416117227613,2.9865131002431777,2.3642867909861653,1.8584568775776678,1.4517999317939205,1.1280212816508222,0.87238180589468151,0.67199532405182527,0.51589157292889087,0.39492809141085061,0.30161634102477164,0.2299090407905926,0.17497989365929456,0.1330146008817561,0.10102322289970311,0.076678006081668082,0.058177080502132994,0.044132314685830509,0.033478570857138623,0.025401246563472646,0.01927903626344929,0.01463911084762759,0.011122272983404638,0.0084560283515912604,0.0064338762365411528,0.0048994473158384261,0.003734394408765801,0.0028491732834950365,0.0021760391515993696,0.001663735651464042,0.0012734728186492884,0.0009758843680279343,0.00074872756904076875],[34.693877551020407,32.752593011223034,30.811308471425718,28.870023932539098,26.928739667053641,24.987467582568605,23.046370089215081,21.106463753596252,19.171425844607576,17.250183003525027,15.358805041228109,13.520232888261098,11.761597905803136,10.110154443387234,8.589283330449792,7.2156626666255299,5.9980280757064222,4.9373741094236507,4.0281481056938162,3.2599331063279244,2.6192083645385402,2.0909198676928362,1.6597287724909897,1.3109061718219177,1.0309041496681663,0.80766259517011374,0.63071887272721039,0.49118240745645148,0.38162537723287793,0.29592836698643898,0.22910843477034715,0.17714761437183046,0.13683267678058186,0.10561180883061461,0.081470381461772323,0.062825778059430015,0.048439978346561496,0.037347953605352313,0.028799701909958841,0.022213776340217983,0.017140323387424522,0.013231879371127075,0.010220423474118528,0.0078994298129512752,0.0061098833330325703,0.00472941891251355,0.0036639084767206773,0.0028409585609160473,0.0022048934205962795,0.0017128898316864857],[36.734693877551024,34.793409337753651,32.852124797956286,30.910840258438306,28.969555818775508,27.028276480615517,25.087079169867277,23.146500258258115,21.20868186690144,19.279326417718668,17.369638517654476,15.497036801959911,13.683975312166332,11.955188885923192,10.334322136543047,8.8409482445239256,7.4886192921975692,6.2841274554430697,5.2278078805662211,4.3145450083407582,3.5351245672880296,2.8776408126679094,2.3287664805936306,1.8747853293829504,1.5023575613428637,1.1990336495611409,0.95355582368019931,0.75599473955830909,0.59776752890627938,0.47157710090053673,0.371304394847221,0.29187715343504816,0.22913166989963507,0.17967822591090377,0.14077659411773613,0.11022486653872599,0.086262756841876564,0.06748917621606354,0.052793090939419862,0.041296265122958586,0.032306343753841393,0.025278743025318573,0.019785919268133806,0.015492738702096803,0.012136837981185061,0.009513031895540161,0.007460979314673391,0.005855456444296539,0.0045987059876093431,0.0036144321121645631],[38.775510204081634,36.834225664284261,34.892941124486882,32.951656584778007,31.010372082381078,29.069089749744947,27.127846304554751,25.186924984624817,23.247566357693842,21.313367898697646,19.391991309830427,17.496306259395531,15.644222309927589,13.857085593368872,12.15714009357988,10.564822621058212,9.0965570144993606,7.7634132207170445,6.5706870033921483,5.5182416517087916,4.6013569011626068,3.8118268352269684,3.139097954053149,2.5713064809184605,2.0961382329915423,1.7014845035240711,1.3759009325128568,1.1088952276011934,0.89107748906945083,0.71420755167490224,0.57117029714557388,0.45590456904046883,0.36330559265606288,0.28911549621289101,0.22981203626465097,0.18250206237234967,0.14482356789282402,0.11485824359624819,0.091055132221980917,0.072165132405143773,0.057185595004049627,0.045313991970492296,0.035909538525865148,0.028461654660965285,0.022564219576459987,0.017894673329798993,0.014197134145493062,0.011268815196997684,0.0089491338221493327,0.0071110051625567633],[40.816326530612244,38.875041990814871,36.933757451017492,34.992472911249003,33.051188385732438,31.109904797345465,29.168639823276987,27.227543417098019,25.28733173372256,23.350254252047208,21.421473797465183,19.510302473315814,17.630628972799229,15.800199271054197,14.038904672313283,12.366575573936526,10.800851310070112,9.3555546281739055,8.0397722803427421,6.8576372996374708,5.8086754228513584,4.8885230457894018,4.08982760002284,3.403177683833384,2.8179581840566374,2.3230710969720896,1.9074989528202799,1.5607128236811327,1.2729418578839971,1.0353283694040494,0.83999415506478314,0.68004203506417671,0.54951322569272909,0.44331716128649079,0.35714646603009825,0.28738630098824069,0.23102443018412999,0.18556608226635163,0.14895597922870896,0.119508675670146,0.095847507602085158,0.076851900451274546,0.061612455081749506,0.049393055729373803,0.039599175668948938,0.031751558204340891,0.025464495159268852,0.020427993348405005,0.016393198491793631,0.013160527171601766],[42.857142857142861,40.915858317345489,38.974573777548109,37.033289237760442,35.092004703532837,33.150720580245938,31.209445456955649,29.268259031511825,27.327574235457242,25.388789102377938,23.455344506098037,21.533870523744991,19.634905071375012,17.772784291131252,15.964637864194057,14.228748799616792,12.582701297934378,11.04172156045162,9.6174821121794487,8.3174749575192806,7.1449221892168993,6.0991091939939253,5.1759939843194402,4.3689522661851399,3.6695449199231618,3.0682289192389369,2.5549654081473356,2.1197051509092457,1.7527504882333442,1.4450047787307252,1.18812645751464,0.97460689961714575,0.79779068525232688,0.65185478047356415,0.5317604007038752,0.43318846065509087,0.35246685322236404,0.28649550257445977,0.23267325735340605,0.18882921905395178,0.15315999447024287,0.12417356138094493,0.10063988298218951,0.081548043099979872,0.06606945276318843,0.053526559794418782,0.043366445507322493,0.035138692578853825,0.028476938047906464,0.023083572479489528],[44.897959183673471,42.956674643876099,41.015390104078719,39.074105564284693,37.132821026704285,35.191536672030395,33.250256713678965,31.309023715020938,29.368075854711918,27.428278574676856,25.491906417192872,23.563621177211708,21.651282357639005,19.766214179216448,17.92274623705665,16.137107587862072,14.425946285020455,12.804807103907748,11.286847197876,9.8819574394064276,8.5963392622896713,7.4324957645709517,6.3895429651364921,5.4637290410246955,4.6490559922977468,3.9379184468333222,3.3216993086091353,2.7912858049044207,2.3374891257699204,1.9513652461808881,1.6244439107229844,1.3488780016955815,1.1175276586762202,0.92399357057126075,0.76261264722145583,0.62842741833346594,0.51713843219895805,0.42504690644729815,0.34899306993084478,0.28629409751773816,0.23468429291363146,0.19225920163630184,0.15742460354120436,0.12885080228867252,0.10543225836229364,0.086252366694132943,0.070553028692265096,0.057708586038651366,0.047203649783805812,0.038614357376020647],[46.938775510204081,44.997490970406709,43.056206430609329,41.114921890813136,39.173637351915595,37.232352895622384,35.291070609169324,33.349813350082258,31.408718711241917,29.468321222910234,27.530115478448788,25.597347680925559,23.675800585729039,21.774260890461907,19.904444603415751,18.080342218518688,16.317125491456565,14.629858505151628,13.032262885019282,11.535726943428912,10.148660586153014,8.8762143738473647,7.7203201343063661,6.6799767362790554,5.7516944588418362,4.9300176515095764,4.2080606819920163,3.5780105978891754,3.0315675627871652,2.5603088519965844,2.1559732421233289,1.810670090686525,1.5170218155928659,1.2682505524405556,1.0582201839708842,0.88144429573545935,0.73306937981931952,0.608841119475799,0.50506006548198412,0.41853159583099231,0.34651380568101153,0.28666593191111378,0.23699907582812108,0.19583033201146538,0.1617409365477871,0.13353868705393457,0.11022463374239766,0.090963871730286416,0.075060159566850748,0.061934030813081131],[48.979591836734699,47.038307296937326,45.097022757139946,43.155738217343,41.214453677917746,39.273169176331315,37.331885756814565,35.390615768779831,33.449438893156376,31.508684963875194,29.569331930911652,27.633623435974023,25.705768556958223,23.792487969422446,21.903186613874531,20.049648986297083,18.245300416221774,16.504189376864701,14.83989068872383,13.264512072558375,11.787930992698566,10.417321798907725,9.1569742984322886,8.008363749609952,6.9704105074216258,6.0398619903883208,5.211735196743625,4.4797696503647728,3.8368544168905423,3.2754060285289341,2.7876853163665025,2.3660496974821026,2.0031434151238194,1.6920319224762324,1.4262885065676141,1.2000418531617836,1.0079929860777401,0.8454092226190042,0.7081017309491866,0.59239213711627592,0.49507252646296163,0.41336218471032682,0.34486356118588946,0.28751921988438767,0.23957096788120502,0.19952190132263437,0.1661017692270752,0.13823580618192888,0.11501700912250201,0.095681714972754683],[51.020408163265309,49.079123623467936,47.137839083670556,45.19655454387334,43.255270004232642,41.313985482165556,39.372701505279188,37.431424788529988,35.490201621622433,33.549235550466832,31.609164667153212,29.671530887604291,27.73937170552745,25.81776833013312,23.914158971559676,22.03828621599904,20.201755659825114,18.417286721803904,16.697799708023691,15.055496283015607,13.501064137587651,12.04308966121199,10.687712338123131,9.4385130017328187,8.2966001324813838,7.2608442785641962,6.3282078193858169,5.4941220659686678,4.7528726409866309,4.09796447303642,3.5224477300708052,3.0191945608449284,2.5811231787941953,2.2013705877479186,1.8734183268013886,1.5911773223549996,1.3490386194876862,1.1418967345527369,0.96515188618580616,0.81469662427141021,0.68689153211591236,0.57853382541381215,0.48682187460650317,0.40931796914179941,0.34391103754869068,0.28878053773016266,0.24236233105189076,0.20331704093299874,0.17050115916496322,0.1429409883326187],[53.061224489795919,51.119939949998546,49.178655410201166,47.237370870403858,45.296086330673589,43.354801799215053,41.413517545235635,39.472237244322521,37.530987887650078,35.589895204309542,33.649374830736306,31.710481938121813,29.775393716754042,27.847915936704737,25.933860206413328,24.041158979060672,22.179656773467645,20.360602158142726,18.595932283322401,16.897473403305415,15.276177431584443,13.741487045844831,12.300883874677343,10.959637136012912,9.7207406343842777,8.5850068977312048,7.5512780497067666,6.6167117256059704,5.7771043665444566,5.027221154701067,4.3611097844947082,3.7723829063625764,3.2544606822195377,2.8007701278874961,2.4049017497275269,2.0607265446687908,1.7624779427515964,1.5048039703037812,1.2827950275183628,1.0919924015842168,0.9283821313988474,0.7883782192385258,0.66879853128477862,0.56683609719481165,0.48002794179309483,0.40622307631691701,0.34355084822888982,0.29039049591155397,0.24534247171911616,0.20720187573882987],[55.102040816326529,53.160756276529156,51.219471736731776,49.278187196934425,47.336902657166277,45.395618121342395,43.454333728163249,41.513051503285112,39.571787249978449,37.630618754800913,35.689816541174324,33.750100472571134,31.813022800352147,29.881412384051451,27.959764764354645,26.054457776481712,24.173713349171301,22.32729128331847,20.525962968249491,18.78085334181872,17.102751971354685,15.501483204814562,13.985400142015926,12.561037245244307,11.23292893829635,10.003580576809671,8.8735649926219757,7.8417118208493299,6.9053564315900751,6.060618649502274,5.3026868509320444,4.6260891427023019,4.0249392291453958,3.4931497208904396,3.0246097816061823,2.6133271044201809,2.2535363420142964,1.9397774327998256,1.6669479417867255,1.4303337355202999,1.225622182548463,1.0489017347192036,0.89665129335941529,0.76572226626315754,0.65331572347738565,0.55695659227082928,0.47446641171808279,0.40393580304076382,0.34369750484945216,0.29230057024148248],[57.142857142857146,55.201572603059773,53.260288063262394,51.319003523465028,49.377718983680587,47.436434445800685,45.495149981972844,43.553866716283657,41.612593942607532,39.671379888970165,37.730400623507379,35.790146219208012,33.851718803170584,31.917208178850657,29.990063316451259,28.075358802647816,26.179873428500024,24.311943103350728,22.481102486404154,20.697571512682998,18.971665066155722,17.313205803511131,15.73100662693242,14.232467677393188,12.823309482905934,11.507443601697641,10.286967104636549,9.1622580997388994,8.1321455919919039,7.194127086643654,6.3446101350822133,5.5791582733226974,4.8927265598975538,4.2798765204169378,3.7349643513958313,3.2522995357609208,2.8262735345456544,2.4514599954701559,2.1226890622487424,1.835099001520204,1.5841686100195194,1.3657338337942928,1.1759918170906962,1.0114952750354904,0.86913970729808643,0.74614557952740945,0.64003722244761985,0.54861985174531824,0.46995580429648554,0.40234082138353777],[59.183673469387756,57.242388929590383,55.301104389793004,53.359819849995631,51.418535310204064,49.477250771343392,47.535966271296573,45.594682438187874,43.6534047632951,41.712163224757859,39.771072480918839,37.830465728015582,35.891123038869807,33.954580610299288,32.023466570529344,30.10178354008054,28.195060517629379,26.310324461840697,24.455882421952715,22.64094359430122,20.875137001760443,19.167990873681596,17.528435917582456,15.96438114937898,14.482393049064868,13.087490917535419,11.783056296326357,10.570843528774589,9.4510721636687514,8.4225793631344636,7.4830108556239026,6.6290312867266188,5.8565381870659685,5.160867508952407,4.5369822995396021,3.9796392822940234,3.4835307640453941,3.0434013328729073,2.6541402939140095,2.310851776971397,2.0089050300648434,1.7439676776484134,1.512024754995176,1.3093862034561248,1.1326852837092343,0.97887008129849473,0.84518997438357868,0.7291786312659525,0.6286348203903529,0.54160205733715872],[61.224489795918366,59.283205256120993,57.341920716323614,55.400636176526234,53.459351636731512,51.518067097397179,49.57678257859866,47.635498433765065,45.694217923149566,43.752959734915478,41.811798616445465,39.870960956206289,37.930997600583837,35.993033337369042,34.059059638035052,32.132210696197774,30.216955417908526,28.319152337242137,26.445943459198844,24.605495726354057,22.806625520277215,21.058357008469926,19.369468439247747,17.748074057876771,16.201276965105173,14.734913740873189,13.35339793881414,12.059658420514118,10.855160701912823,9.7399950125714909,8.7130131342770341,7.7719965885264344,6.9138406565391222,6.1347414000342582,5.4303758031985225,4.7960680211131788,4.2269372760849571,3.7180250772624603,3.2644011161338931,2.8612484292304199,2.5039292689047752,2.1880336474759261,1.909412786825996,1.6641997784812848,1.4488196943802265,1.2599912325971738,1.0947217723062783,0.95029747637308315,0.82426983853909164,0.71443983919174592],[63.265306122448983,61.324021582651611,59.382737042854231,57.441452503056858,55.500167963260701,53.558883423694859,51.617598895094233,49.676314577700964,47.735032416798546,45.793764099339711,43.852558426372269,41.911569199714165,39.971184764225583,38.032226116658059,36.096195388532635,34.165531861336973,32.243820049626059,30.335898921866352,28.447840312446374,26.586790456598472,24.760693173941668,22.977930745694501,21.246926618827359,19.575753323160171,17.971781773549885,16.441397394856544,14.989796917690576,13.620869192395226,12.337155079855968,11.139875810344662,10.029016053189522,9.0034469054196009,8.0610745529522845,7.1990019439902717,6.4136929691496043,5.7011309954988505,5.0569658882229014,4.4766457068600261,3.9555309944976997,3.4889909580167675,3.072481875387485,2.7016087963808424,2.3721720724307165,2.0802005101585763,1.8219730399035079,1.5940307691312565,1.3931811879012592,1.216496139732377,1.0613049896327045,0.92518422919988286],[65.306122448979593,63.364837909182221,61.423553369384841,59.482268829587461,57.540984289790664,55.599699750110346,53.658415216337573,51.717130802702243,49.775847675752743,47.834573168794776,45.893339200919222,43.952250297128899,42.011579951833582,40.071925980459355,38.134417179437321,36.200942352807431,34.274358075944292,32.358629548708755,30.458869729786912,28.581261080749854,26.732865315062767,24.921344066007642,23.154624199902933,21.440544915552046,19.786520918298429,18.199248896688438,16.684475473102701,15.246835608125686,13.889762398543624,12.615463015660232,11.424951389798821,10.318126023204812,9.2938806765621678,8.3502362159341779,7.4844832234455225,6.693326715502419,5.9730262004863555,5.3195261455432288,4.7285735819723307,4.1958209914382181,3.7169137551553355,3.2875623200624737,2.9035998635878411,2.5610266558973915,2.2560425633016443,1.9850692460164989,1.744763611789363,1.532024023497458,1.3439906481036505,1.1780411957239059],[67.34693877551021,65.405654235712831,63.464369695915458,61.523085156118086,59.581800616320983,57.640516076583417,55.699231540056438,53.757947072345843,51.816663376574397,49.875385070518469,47.934133075016668,45.992978478090009,44.05211378206787,42.111973505653879,40.173403334164547,38.237859625789312,36.307606389278519,34.385870868599326,32.476923536458507,30.586061395045107,28.719490451558379,26.884119355584971,25.087288072304943,23.336461614803852,21.638919427530681,20.001467233172022,18.430191701389418,16.930270796814007,15.505845406599178,14.159951683427195,12.894508893434505,11.71035451849226,10.607316788756847,9.5843144477047346,8.6394740648226964,7.7702563063271448,6.9735839884466273,6.2459662632157702,5.5836147733606794,4.9825489629137039,4.4386888890126848,3.9479348261705987,3.5062336886548806,3.1096328359800687,2.7543221957952539,2.4366658660844767,2.153224473211198,1.9007695905773705,1.6762914880143303,1.477001404272924],[69.387755102040813,67.446470562243434,65.505186022446068,63.563901482648689,61.622616942851437,59.681332403084966,57.740047865078196,55.798763366762998,53.857479334107282,51.916198685577186,49.974935165137211,48.033737170968834,46.092740178430162,44.152259606297449,42.212927507192504,40.27586285202468,38.342851689215152,36.41650545569081,34.500366007050054,32.598933993177653,30.717610082456218,28.862552459699813,27.040465776522197,25.258344396267269,23.523195811606271,21.841769053093024,20.220308886774468,18.664350928275752,17.178566660899584,15.766661628013075,14.43132533325106,13.174227881442036,11.996056151412844,10.896581177804535,9.8747482188473015,8.9287814593160277,8.0562962113876324,7.2544126316564821,6.5198662126558489,5.8491115173037045,5.2384167290770804,4.6839475461032833,4.1818397353856724,3.7282602836285754,3.3194575449819794,2.9518011117951719,2.6218123436438354,2.3261866045481892,2.0618082993363327,1.8257597862636921],[71.428571428571431,69.487286888774051,67.546002348976685,65.604717809179306,63.66343326938199,61.722148729600733,59.780864190792002,57.839579675031764,55.898295441701862,53.957013342224045,52.015742428259429,50.074515693755338,48.133428500469144,46.192709615716325,44.252830534014485,42.314648503963241,40.379566996806403,38.449688682344672,36.527933399531264,34.618097712273681,32.724841785625031,30.853600702398644,29.010428156305004,27.201788668912421,25.434319109097466,23.714581332694642,22.048825854975412,20.442782585351907,18.901489792622705,17.429167480744781,16.029136853632423,14.703783897921447,13.454562464247687,12.282030567923869,11.185912842147282,10.165181989989875,9.218152508497738,8.3425807223626549,7.5357661139315368,6.7946499504168258,6.1159081998719422,5.4960366358435913,4.9314268220991195,4.4184323280153954,3.9534250505666968,3.532841918182072,3.1532225385442132,2.811238542977252,2.5037154914940789,2.2276482512969995],[73.469387755102048,71.528103215304668,69.586818675507303,67.645534135709923,65.704249595912572,63.76296505612369,61.821680516876611,59.880395991102731,57.939111637551015,55.997828635221843,54.056552961231034,52.115307142889513,50.174158339734554,48.233272392135234,46.29300051651623,44.353997896367474,42.41736373380288,40.48478387185299,38.558652835437336,36.642153310075237,34.739277035308952,32.854779920811794,30.994073603919823,29.163063717147466,27.367950624332664,25.615010916066943,23.910377771846385,22.25983603308574,20.668644273086095,19.141392049314007,17.681896489047851,16.29313881341217,14.977238584395138,13.735461447648419,12.568254910886139,11.475306142519102,10.455615761132442,9.5075819680899016,8.6290900166815163,7.8176027951154339,7.0702491345760592,6.3839072691427674,5.7552816253358188,5.1809717777995452,4.6575329611872611,4.1815279745497556,3.7495706587659008,3.3583613797448315,3.0047151226857274,2.6855829088556717],[75.510204081632651,73.568919541835271,71.627635002037906,69.686350462240526,67.74506592244316,65.8037813826503,63.862496843161679,61.921212311600307,59.979927885617315,58.038644318915168,56.097365569288471,54.156107044355096,52.214916077892852,50.273912873071026,48.333358776394412,46.393753576952889,44.455955788800409,42.521312157452677,40.591777564717646,38.670005636819745,36.759393742233875,34.864072532747961,32.988837978993594,31.139031263624631,29.320377662860096,27.538799029158724,25.800215615170927,24.11035209492632,22.474560307476523,20.897668091630692,19.383860157636839,17.936593687265628,16.558548556806763,15.251609890818486,14.0168791202804,12.854708800143584,11.764756052379887,10.746049532275009,9.7970651541498199,8.9158063522985174,8.0998853033931404,7.3466022259867074,6.6530205476530213,6.0160363542138562,5.4324410861948103,4.8989769142439243,4.4123846053608808,3.969443988974696,3.5670073535366598,3.2020262598335307],[77.551020408163268,75.609735868365888,73.668451328568523,71.727166788771143,69.785882248973763,67.844597709178828,65.903313169556014,63.962028634627181,62.020744164762156,60.079460243659767,58.138179499489894,56.196912490221905,54.255692609109502,52.314606990830697,50.373849969249633,48.433802216730669,46.495132715387683,44.558913992596388,42.626735797395291,40.700800215183847,38.783982619660854,36.879847269222466,34.992612518791063,33.12706711001443,31.288444619855177,29.482267124899181,27.714171186737744,25.989729485856323,24.31428018715976,22.692773886110579,21.129645242116425,19.628713568860256,18.193114028998721,16.825258870557512,15.526826441434089,14.298774544125855,13.141374006784297,12.054258076950077,11.036483303417583,10.086597870221759,9.2027138023252135,8.3825800048503609,7.6236536704539368,6.9231681507058731,6.2781959081062979,5.6857056276835891,5.142612961836921,4.645824706784925,4.1922764659830847,3.7789640506197699],[79.591836734693885,77.650552194896505,75.70926765509914,73.76798311530176,71.826698575504395,69.885414035708322,67.944129496010376,66.002844959109296,64.061560462512389,62.120276317853467,60.178994275477351,58.237721584753686,56.29648183147512,54.355338201379105,52.414435137637653,50.474062246104474,48.534739827423408,46.597319779935262,44.663090575131072,42.733872086029393,40.812086007445998,38.900790309620007,37.003670798940554,35.124988301306779,33.269485160201469,31.442258855885164,29.648613176360378,27.893898424983625,26.183351815219709,24.521947814695991,22.914266147376672,21.3643828135287,19.875787146417849,18.451325812016009,17.093172907819742,15.802823989423914,14.58111095157642,13.428234177345345,12.343808184745541,11.32691707456015,10.376176345559543,9.4897980291812942,8.6656565498166955,7.901353194967605,7.1942775484883832,6.5416646767420623,5.9406472471830298,5.3883020939679867,4.8816910233293029,4.4178958740839001],[81.632653061224488,79.691368521427108,77.750083981629743,75.808799441832363,73.867514902034983,71.926230362238329,69.984945822498005,68.043661284434364,66.102376771464876,64.161092485151471,62.219809594690929,60.278533088255649,58.337279646553974,56.396095114298873,54.455086834196038,52.514474939791974,50.57466346744512,48.636327567349859,46.700508504094415,44.768704893678823,42.842947594930365,40.925847025280504,39.020604946631629,37.130987139566834,35.261257945598459,33.416081643828441,31.600398542108394,29.819285294644807,28.077809344626566,26.380886737237709,24.733151147873052,23.138840133263258,21.601702620140223,20.124929720118097,18.711109256347811,17.362202998179527,16.079544560685484,14.863855230986879,13.715274599274942,12.633402749418877,11.617350845702717,10.665797182506722,9.7770460915788036,8.9490874833966956,8.1796552000456799,7.4662827506079417,6.8063553676667681,6.1971576532682739,5.6359163681132749,5.1198381566473259],[83.673469387755105,81.732184847957726,79.79090030816036,77.84961576836298,75.908331228565601,73.967046688768633,72.025762149004223,70.084477610250957,68.143193087200345,66.201908710729001,64.260625264199575,62.319346187482566,60.378083294894964,58.436869873744428,56.495785699808586,54.554997998813221,52.614820133501652,50.675786177737066,48.738735522713341,46.804898389071312,44.875971469919634,42.954173260448108,41.042270758108799,39.143572576961226,37.261887382683341,35.401450232810859,33.566822384206965,31.762772116839535,29.994145046245194,28.265732351406861,26.582144530558175,24.947696960825034,23.366311923345876,21.841440075627418,20.376002770603378,18.972355247338633,17.632269612620725,16.356935716267607,15.146977486042005,14.002482000645287,12.923038500142198,11.907784616845277,10.955457311489546,10.064446278913877,9.2328479098879939,8.4585182333629589,7.7391235951356485,7.0721881396749495,6.4551374419105727,5.8853378797088993],[85.714285714285722,83.773001174488343,81.831716634690977,79.890432094893598,77.949147555096218,76.00786301529908,74.066578475520885,72.125293936356044,70.184009407065673,68.24272497295928,66.301441160491876,64.360160347232338,62.418890913911298,60.4776570515277,58.536518063023649,56.595600935261082,54.655148470914483,52.715582489895283,50.777578204755876,48.842142768929563,46.910689012196073,44.985094974676898,43.067741047489982,41.161518977555808,39.269810142750025,37.396433762451359,35.545568582262504,33.721653729606238,31.929275728388113,30.173049091666904,28.457497599233584,26.786942493660035,25.165402595868755,23.596509940398612,22.08344312090324,20.628879237222492,19.234964224358897,17.903300461380944,16.634949915038561,15.430450656954818,14.289844378433799,13.212712479103828,12.198218387987851,11.245153952368661,10.35198796863888,9.5169152026233164,8.7379045323702798,8.0127451271167232,7.3390898398463236,6.7144952295584552],[87.755102040816325,85.813817501018946,83.87253296122158,81.931248421424201,79.989963881626821,78.048679341829569,76.10739480204343,74.166110262631506,72.224825729459141,70.28354125834818,68.342257204185699,66.400975214145049,64.459701243142788,62.518452889533037,60.577274255608174,58.636261755775664,56.695603383650905,54.755631874007975,52.81688938620109,50.880198511429029,48.946732296037517,47.018075076033405,45.096266388601059,43.183821891961145,41.283727690878671,39.399407250219731,37.534662733537665,35.693594787253232,33.880506304615835,32.099796485556467,30.355851606959135,28.652938453892283,26.995105493262308,25.386095760400238,23.829274223992428,22.327571215312943,20.883442440848924,19.498845197793315,18.175229705946315,16.913543961294742,15.714250193670317,14.57735085073984,13.502422004957204,12.488652159130417,11.534884581125866,10.639661502985568,9.8012687522524544,9.0177796256698031,8.287097053886022,7.6069933304129549],[89.795918367346943,87.854633827549563,85.913349287752197,83.972064747954818,82.030780208157438,80.089495668360129,78.148211128569386,76.206926589008205,74.26564205340857,72.324357558436759,70.38307334406079,68.441790554160036,66.50051342735793,64.559254780552081,62.618047430041877,60.676964579093578,58.736151709423837,56.795871014201239,54.856557149353712,52.918880595482221,50.983812834385745,49.052686345299982,47.127242354423416,45.20966028691852,43.30256471527801,41.409007897006283,39.532428358432895,37.676588082588289,35.8454924741133,34.043298294181497,32.274215175724144,30.542406211658417,28.85189257004091,27.206466262660342,25.609614207815497,24.06445569770792,22.573694395752,21.139585112476531,19.763914878812855,18.447997269246557,17.192678524579343,15.998353772982369,14.864991529141903,13.792164641272258,12.779085930272984,11.824646901046677,10.927458082049391,10.085889747675296,9.2981119845954936,8.5621332664978453],[91.83673469387756,89.89545015408018,87.954165614282815,86.012881074485435,84.071596534688055,82.130311994890718,80.189027455097275,78.247742915445457,76.306458378320599,74.365173867897994,72.423889546938767,70.482606211732403,68.541326884724356,66.600060911983931,64.658832728789179,62.717697924668201,60.776769045852831,58.836252531123243,56.896496400875769,54.958046192639507,53.021704667253601,51.088589457052585,49.160182371541573,47.238364571870889,45.325433126862791,43.424096294136184,41.537446906689418,39.66891518879828,37.822203946393124,36.001210237733559,34.209938280415834,32.452408513627113,30.732567483798753,29.054202658871624,27.420865510855336,25.835805341357613,24.301915447657763,22.821692404821249,21.397208518320241,20.030096908221225,18.721548230493937,17.472317721079236,16.282741052869227,15.152757408070386,14.081938169208527,13.069519701415551,12.114438817706386,11.215369670760246,10.370760984808683,9.5788727178289861],[93.877551020408163,91.936266480610783,89.994981940813418,88.053697401016038,86.112412861218658,84.171128321421307,82.229843781626272,80.288559241919074,78.347274703831189,76.405990183361865,74.464705791244768,72.523422083157271,70.582141218338649,68.640870020913084,66.699626700164515,64.758453483071975,62.817437422483835,60.87674095806441,58.936642445820468,56.997585094614053,55.060230956897577,53.125515223440246,51.194695361851117,49.269389734169913,47.351601171458078,45.44372238335496,43.548521780923814,41.669110029770856,39.808889206831502,37.971487655132677,36.160684437037375,34.380327665441797,32.63425098291313,30.926192132672675,29.259717010303255,27.63815189048097,26.064525770038564,24.541524024183467,23.071453886857825,21.656221672416343,20.297321172306027,18.995832293123804,17.752428747694729,16.567393458488148,15.440640268612732,14.371740563765712,13.359953472558111,12.404258417187059,11.503388917683672,10.655866699161813],[95.91836734693878,93.9770828071414,92.035798267344035,90.094513727546655,88.153229187749275,86.211944647951924,84.270660108155951,82.329375568414733,80.388091029715866,78.446806502686911,76.505522062895452,74.564238099067097,72.622956156711126,70.681681225454383,68.74042688714411,66.799225232162073,64.858143593609071,62.917309732605986,60.976946092438872,59.037412285858444,57.099253396158318,55.163250307699727,53.230467421253088,51.302292909517277,49.380467135899274,47.467095877912598,45.564646370556538,43.67592569423887,41.804042473482077,39.95235407037918,38.124402352958541,36.323841653990272,34.554362720025495,32.819616328664942,31.123139890201152,29.468289821966053,27.858181862166049,26.295640838274288,24.783160774334299,23.322875649228486,21.916540628198426,20.565523195104738,19.27080331599641,18.032981561296957,16.852293995193435,15.728632594604854,14.661569973077221,13.650387243700685,12.694103947048852,11.791509083936106],[97.959183673469397,96.017899133672017,94.076614593874652,92.135330054077272,90.194045514279892,88.252760974482527,86.311476434686,84.370191894923792,82.428907355835491,80.48762282450636,78.54633835266263,76.605054212911554,74.663771513629129,72.722493908400466,70.781231537559663,68.840008801378843,66.898877786312752,64.957938948855173,63.017369927750387,61.077462191615787,59.138663861823304,57.201625769155996,55.267246871948046,53.336714756754802,51.411537113916445,49.493560771102509,47.584975938844892,45.688304594680361,43.806373227749063,41.942271332578414,40.099297972594165,38.28089937267498,36.490600832443548,34.731936299854404,33.008378753729403,31.323274172621275,29.679781377447661,28.080819484676049,26.52902414511675,25.026713209654055,23.575861985397133,22.178087841125311,20.83464359781545,19.546418899457208,18.313948596864577,17.137427084698245,16.016727499219904,14.951424700301267,13.940821014843252,12.983973799657896],[100,98.05871546020262,96.117430920405255,94.176146380607875,92.234861840810495,90.29357730101313,88.352292761216262,86.411008221441023,84.469723682103378,82.528439147944027,80.587154654476777,78.645870393351231,76.704587161020356,74.763307636795432,72.822039399563181,70.880801014150336,68.939632782145338,66.99861367855803,65.05788548654138,63.117684230456781,61.178377851783324,59.240507905548519,57.304832112732967,55.372364063607485,53.44440631232073,51.522573521058661,49.608803111238458,47.705351920973371,45.814778499875032,43.939911754676928,42.083807583600191,40.249695834247071,38.440920358434774,36.660875120481954,34.912939270628847,33.200413865772504,31.526462555979485,29.89405810810797,28.305936153576816,26.764557064574717,25.272076411589957,23.830324055807417,22.440791595085386,21.10462761724915,19.822640019068871,18.595304519166284,17.42277842112027,16.304918660555806,15.241303187737579,14.231254785985819]],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"surface"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Stock price"},"yaxis":{"title":"K","zaxis":{"title":"Call price"}},"zaxis":{"title":[]}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"colorbar":{"title":"","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"x":[0,2.0408163265306123,4.0816326530612246,6.1224489795918373,8.1632653061224492,10.204081632653061,12.244897959183675,14.285714285714286,16.326530612244898,18.367346938775512,20.408163265306122,22.448979591836736,24.489795918367349,26.530612244897959,28.571428571428573,30.612244897959183,32.653061224489797,34.693877551020407,36.734693877551024,38.775510204081634,40.816326530612244,42.857142857142861,44.897959183673471,46.938775510204081,48.979591836734699,51.020408163265309,53.061224489795919,55.102040816326529,57.142857142857146,59.183673469387756,61.224489795918366,63.265306122448983,65.306122448979593,67.34693877551021,69.387755102040813,71.428571428571431,73.469387755102048,75.510204081632651,77.551020408163268,79.591836734693885,81.632653061224488,83.673469387755105,85.714285714285722,87.755102040816325,89.795918367346943,91.83673469387756,93.877551020408163,95.91836734693878,97.959183673469397,100],"y":[0,2.0408163265306123,4.0816326530612246,6.1224489795918373,8.1632653061224492,10.204081632653061,12.244897959183675,14.285714285714286,16.326530612244898,18.367346938775512,20.408163265306122,22.448979591836736,24.489795918367349,26.530612244897959,28.571428571428573,30.612244897959183,32.653061224489797,34.693877551020407,36.734693877551024,38.775510204081634,40.816326530612244,42.857142857142861,44.897959183673471,46.938775510204081,48.979591836734699,51.020408163265309,53.061224489795919,55.102040816326529,57.142857142857146,59.183673469387756,61.224489795918366,63.265306122448983,65.306122448979593,67.34693877551021,69.387755102040813,71.428571428571431,73.469387755102048,75.510204081632651,77.551020408163268,79.591836734693885,81.632653061224488,83.673469387755105,85.714285714285722,87.755102040816325,89.795918367346943,91.83673469387756,93.877551020408163,95.91836734693878,97.959183673469397,100],"z":[[null,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[2.0408163265306123,0.29043377114256774,0.0047923753801042551,6.0992773001745893e-05,1.0250942288844112e-06,2.3967366486603431e-08,7.5648853704853836e-10,3.0956301231516447e-11,1.583207533850954e-12,9.8137896849610565e-14,7.1893931606459517e-15,6.0968911988858051e-16,5.8837183013325498e-17,6.3698375124128226e-18,7.6441677328715491e-19,1.0065622513510075e-19,1.4417250657957422e-20,2.2294634823569652e-21,3.6980160966439835e-22,6.5421264620556544e-23,1.2282324284152412e-23,2.4363251522255563e-24,5.0860238843866948e-25,1.1134946727299555e-25,2.5485889126050472e-26,6.0811334264402044e-27,1.5088001640803589e-27,3.8835950061809085e-28,1.0348426981742625e-28,2.849154340037394e-29,8.0908204451653241e-30,2.3659230874238087e-30,7.1136528517201809e-31,2.1961970797509568e-31,6.953190366872057e-32,2.254857722836581e-32,7.4817116825198546e-33,2.5373901830696466e-33,8.7875070778411644e-34,3.1049260323506096e-34,1.118365765864188e-34,4.1032328431826644e-35,1.5323629844425632e-35,5.8209378773387988e-36,2.247710182188891e-36,8.8173912823283795e-37,3.5119128463283428e-37,1.4194377181892049e-37,5.8188333642039077e-38,2.4182004565277333e-38],[4.0816326530612246,2.1421473797465183,0.58086754228513549,0.083999415506478159,0.0095847507602085102,0.0010570035439489076,0.00012198554600349179,1.5168983553796595e-05,2.0501884577688224e-06,3.0120484719583156e-07,4.7934732973206862e-08,8.2235293525080805e-09,1.5129770740970767e-09,2.9700569127730379e-10,6.1912602463032894e-11,1.3644629491984715e-11,3.166415067701908e-12,7.709284220355492e-13,1.9627579369922113e-13,5.209884295834018e-14,1.4378786321291903e-14,4.1160657403958226e-15,1.219378239777161e-15,3.7308445753570042e-16,1.17674366026651e-16,3.8196585281703346e-17,1.2739675024825645e-17,4.3597464332471692e-18,1.5288335465743098e-18,5.4868917464124272e-19,2.0131245027020151e-19,7.5429219965058548e-20,2.8834501315914844e-20,1.1235635002854284e-20,4.4589269647139304e-21,1.800819477312688e-21,7.3960321932879671e-22,3.0868689245571205e-22,1.3084252924111309e-22,5.6289660202740352e-23,2.4564648568304825e-23,1.0868320130786213e-23,4.8726503044511126e-24,2.2126480337064758e-24,1.017204776877339e-24,4.7322605621992155e-25,2.2269893454599109e-25,1.0597196489340882e-25,5.0971778252100944e-26,2.4773365883060127e-26],[6.1224489795918373,4.181179861644547,2.2806625520277217,0.87130131342770323,0.25039292689047743,0.061884065807870203,0.014377126140312751,0.0032976532113556528,0.00076645099793488936,0.00018297831900523833,4.5174038217605443e-05,1.1567926691784323e-05,3.0752826866532268e-06,8.4848951434648675e-07,2.4272924359596869e-07,7.1902099459810134e-08,2.2022227497459657e-08,6.9632389805168403e-09,2.2694656111456184e-09,7.6128609475921811e-10,2.6245858396784005e-10,9.2868903694549651e-11,3.3683551256150818e-11,1.2507724123592721e-11,4.7496226015528684e-12,1.8424643910365266e-12,7.2940155739811497e-13,2.9441369054883452e-13,1.21058446879446e-13,5.0666873430025979e-14,2.1568179481937931e-14,9.3315201715297139e-15,4.1006162918669409e-15,1.8290673596657384e-15,8.2763052377298159e-16,3.7968820159781724e-16,1.7651154903997748e-16,8.3111134295356383e-17,3.9617043643200836e-17,1.9109512537238493e-17,9.3235257985158014e-18,4.5994063922570612e-18,2.2932503198614678e-18,1.1552464513211079e-18,5.8779324731045567e-19,3.0196867540530188e-19,1.5658637440131688e-19,8.193597673483606e-20,4.3251751973872363e-20,2.3026429510277401e-20],[8.1632653061224492,6.2219809594690929,4.2842947594930365,2.4733151147873036,1.161735084570271,0.46461421939441694,0.16799883101295632,0.05747726019764815,0.01916950152041702,0.0063503116408681615,0.0021140070878978151,0.00071229332087375911,0.00024397109200698357,8.5162416914953253e-05,3.0337967107593191e-05,1.1036350781438666e-05,4.1003769155376448e-06,1.5556143360016707e-06,6.0240969439166312e-07,2.379963571200791e-07,9.5869465946413724e-08,3.9350220015735909e-08,1.6447058705016161e-08,6.9955191212495312e-09,3.0259541481941534e-09,1.3302772635024158e-09,5.9401138255460757e-10,2.692559058838121e-10,1.2382520492606579e-10,5.7742065927725497e-11,2.7289258983969429e-11,1.3064550859798936e-11,6.3328301354038159e-12,3.1067684250340638e-12,1.5418568440710984e-12,7.7379998841750101e-13,3.9255158739844226e-13,2.0122874348306646e-13,1.0419768591668036e-13,5.4482576404977234e-14,2.8757572642583807e-14,1.5318342688978531e-14,8.2321314807916452e-15,4.4620608100345336e-15,2.438756479554322e-15,1.3437031431879726e-15,7.4616891507140084e-16,4.1751434492045912e-16,2.3534873205330199e-16,1.3361904396086603e-16],[10.204081632653061,8.2627970964331094,6.32183293343064,4.4076572431998073,2.7002128275175279,1.4521688557128396,0.70448954601415936,0.31823546447099926,0.13737830642318227,0.057756107546032498,0.023961876900521289,0.0098997939172372346,0.0040982996229484078,0.001707187172787776,0.00071761283180747648,0.00030496386500873055,0.00013118473797612174,5.716345458328827e-05,2.5242532531334324e-05,1.1298046282826014e-05,5.1254711444220628e-06,2.3565519713540563e-06,1.0978674217936948e-06,5.1813690759071687e-07,2.4764889835562519e-07,1.1983683243301625e-07,5.8690089926873965e-08,2.9081386543225726e-08,1.4574573658595244e-08,7.3852030474142887e-09,3.7824426852427083e-09,1.957429190062636e-09,1.0232165341512764e-09,5.4011315329736431e-10,2.878125882976191e-10,1.5478150615758234e-10,8.3983388358812411e-11,4.5964008847423275e-11,2.5367754682742025e-11,1.4114952816434586e-11,7.9160376692547893e-12,4.4737222161596018e-12,2.5472318351251052e-12,1.4608831576337606e-12,8.437675899025198e-13,4.9068948424805161e-13,2.8726762337462007e-13,1.692720352896374e-13,1.0037554640621475e-13,5.9888469881161394e-14],[12.244897959183675,10.303613419479436,8.362359723289094,6.4264421392395557,4.5613251040554434,2.9469827481746416,1.7426026268554065,0.95921360422263557,0.50078585378095486,0.25199824651943503,0.12376813161574041,0.059892741970301255,0.028754252280625503,0.013765421707652853,0.0065953064227113056,0.0031710106318467296,0.0015329019958697787,0.00074607767125759762,0.00036595663801047666,0.00018102692723920896,9.0348076435210886e-05,4.550695066138984e-05,2.3135853383568646e-05,1.1873172924740201e-05,6.1505653733064537e-06,3.21588543315313e-06,1.6969790286929735e-06,9.0361454158748705e-07,4.8545848719193737e-07,2.630922359276552e-07,1.4380419891962027e-07,7.9261178699629966e-08,4.4044454994919314e-08,2.4670588057524162e-08,1.3926477961033681e-08,7.9212434427335501e-09,4.5389312222912368e-09,2.6196387831729265e-09,1.5225721895184362e-09,8.9101707383191136e-10,5.2491716793568009e-10,3.1125702901527604e-10,1.857378073890993e-10,1.1152325593673383e-10,6.7367102512301636e-11,4.0933888475954196e-11,2.5015448247185443e-11,1.5373161313748912e-11,9.4992452031057368e-12,5.9010507200519593e-12],[14.285714285714286,12.344429745920147,10.403148485651883,8.4629297007926461,6.5449683571250059,4.7429162665389306,3.2058273707264835,2.033036397997976,1.2231816399743884,0.70656838363641361,0.39604215250487984,0.21728492682452161,0.11748895107412138,0.062943073017983964,0.0335466276607298,0.017842186598139631,0.0094923126826354925,0.0050605819761132959,0.0027072216055191653,0.0014547453359414105,0.00078581913866415491,0.0004269494110122219,0.00023341385974795688,0.00012843958319405267,7.1150459807964783e-05,3.9684008795919296e-05,2.2286386096346731e-05,1.2602527780355158e-05,7.1756596021908852e-06,4.1136983113733183e-06,2.3743269804414968e-06,1.3795899409357747e-06,8.0689948201881459e-07,4.7501056859833382e-07,2.8141878342114268e-07,1.6777156540622386e-07,1.0063457872627824e-07,6.0727729644261527e-08,3.6862499355088851e-08,2.2505435613772162e-08,1.3817906930707813e-08,8.530944011523348e-09,5.2954197593397652e-09,3.304467377204935e-09,2.0727673299937891e-09,1.3067691856017425e-09,8.279397857220684e-10,5.2711278279893128e-10,3.371846406166113e-10,2.1669410862061544e-10],[16.326530612244898,14.385246072447666,12.443961918938186,10.502894987958395,8.568589518986073,6.6832163287656918,4.9466302295746072,3.472440599635906,2.3234701691405419,1.4932565501215889,0.92922843878883388,0.56401064082541108,0.33599766202591264,0.19746404570542531,0.1149545203952963,0.066507300440878048,0.038339003040834041,0.022066157342915255,0.012700623281736323,0.007319555423813795,0.0042280141757956302,0.002449723657919213,0.0014245866417475182,0.00083186782573202098,0.00048794218401396715,0.0002875726767808456,0.00017032483382990651,0.00010139593485671916,6.0675934215186382e-05,3.649982499805257e-05,2.2072701562877333e-05,1.34187520255706e-05,8.2007538310752896e-06,5.0380995603871849e-06,3.1112286720033413e-06,1.9311941211423909e-06,1.2048193887833262e-06,7.5542361208260869e-07,4.7599271424015821e-07,3.0138264408564215e-07,1.9173893189282745e-07,1.2255800975991469e-07,7.8700440031471818e-08,5.0766963412592097e-08,3.2894117410032322e-08,2.1406855923091534e-08,1.3991038242499062e-08,9.1827881931244736e-09,6.0519082963883068e-09,4.0046939512197069e-09],[18.367346938775512,16.426062398978143,14.484777909387754,12.543539584933638,10.60434093345072,8.6848192588272379,6.8419876560831661,5.1671610682715237,3.7443096460987846,2.6139039402831106,1.7675622836440148,1.1643832402968153,0.75117878067143184,0.47677791184009966,0.29888376445313969,0.1856521974236105,0.11456583494981754,0.070388297058868066,0.043131378420938282,0.026396545469709931,0.016153171876920697,0.0098929596340669029,0.0060684189905925306,0.0037304896573366955,0.0022993529938046715,0.0014215477960580411,0.00088179027696095626,0.00054893495701571586,0.00034301149061581951,0.00021517407103739368,0.00013552211465281622,8.5704137395176214e-05,5.4423494236152605e-05,3.4703780075353132e-05,2.2221747650080141e-05,1.4288609517969648e-05,9.2258480599597076e-06,5.9815994425061944e-06,3.8941242647306672e-06,2.5454685430394535e-06,1.6706015643196583e-06,1.1007919299689349e-06,7.2818773078790437e-07,4.8357595428374389e-07,3.2236349984121925e-07,2.1570629837943019e-07,1.4487422302310438e-07,9.7657585772609579e-08,6.6066682492378919e-08,4.4853434002822999e-08],[20.408163265306122,18.466878725508746,16.525594192866219,14.584319911638493,12.64366586686128,10.710736898732591,8.8153144863996147,7.0194523361566414,5.4004256550350558,4.019886140171371,2.9043377114256792,2.04491380001142,1.4089790920283187,0.95374947641013996,0.63647092894199853,0.41999707753239157,0.27475661284636455,0.17857323301504913,0.115512215092065,0.074477989614354478,0.047923753801042579,0.030806227540874753,0.019799587834474469,0.012732247579634426,0.0081965992458968157,0.0052850177197445239,0.0034143743455755521,0.0022108795907270357,0.001435225663614953,0.00093425844258554144,0.0006099277300174611,0.00039940367053509316,0.00026236947595224347,0.0001729086989209162,0.00011432690916657654,7.5844917768983031e-05,5.0485065062668647e-05,3.3718206487867567e-05,2.2596092565652028e-05,1.5193856451520233e-05,1.0250942288844126e-05,6.9392623580463486e-06,4.7131039427081127e-06,3.2116892692240945e-06,2.1957348435873897e-06,1.5060242359791586e-06,1.0362738151814337e-06,7.1530549607668717e-07,4.9529779671125038e-07,3.4401853255265544e-07],[22.448979591836736,20.507695052039359,18.566410513352142,16.625128356839483,14.684037927355959,12.745953208596436,10.825641178819502,8.961373118528325,7.2129731425102275,5.6434235989379999,4.2981696311448356,3.1947714825682461,2.3245279961488734,1.6608496543045677,1.1687445628849602,0.81222195536149222,0.55876382933811009,0.38130632361072792,0.25856921609947903,0.17449653496542239,0.11734214645681573,0.078712301770602178,0.05271612918114682,0.035276514346132548,0.023601824891902906,0.015796305290689427,0.010580601402237821,0.0070953431720726934,0.0047652017882658937,0.0032058858035644844,0.0021610684472431925,0.0014598939501060115,0.00098848745873160448,0.00067092050301920461,0.00045652434776080001,0.00031144701324367034,0.00021303883762064865,0.0001461196315196275,0.000100496040891602,6.930918379658953e-05,4.7933704105139322e-05,3.3243224664518943e-05,2.3119474202766674e-05,1.6123661531456507e-05,1.1276036517728544e-05,7.9077102303105754e-06,5.5608268662292758e-06,3.9211545427852041e-06,2.7724583537268874e-06,1.9655414838118691e-06],[24.489795918367349,22.548511378569973,20.607226838958873,18.665942878407282,16.724719446578188,14.784665965455826,12.852884278479111,10.951593306937266,9.1226502081108869,7.4199453443619152,5.8939654963492831,4.5784871492161443,3.4852052537108129,2.6058675983718125,1.9184272084452711,1.3938426581832513,1.0015717075619097,0.71314425328380704,0.50399649303887006,0.3540508654745933,0.24753626323148081,0.17243178059294473,0.11978548394060251,0.083050884613537601,0.057508504561251006,0.039794130747739076,0.027530843415305706,0.019050934922604595,0.013190612845422611,0.0091410892179290548,0.0063420212636934592,0.0044060518404592935,0.0030658039917395574,0.0021368799626212756,0.0014921553425151952,0.0010439842725886595,0.00073191327602095332,0.00051421388121856981,0.00036205385447841791,0.00025548725074486019,0.00018069615287042177,0.00012809294311139194,9.1013901322779681e-05,6.4819121097490031e-05,4.6271706767137292e-05,3.3109052344315972e-05,2.3746345849480401e-05,1.7071195257488089e-05,1.2301130746612907e-05,8.8845559484381019e-06],[26.530612244897959,24.589327705100583,22.648043165336794,20.706758772617817,18.765493943825039,16.824687415368153,14.887696858377021,12.966930103206664,11.089828386733823,9.2979661416612007,7.6380887157922217,6.1504419373386714,4.8603703171921389,3.7756390248533833,2.8885521832722283,2.1805548922473541,1.6272303411097688,1.2024508748637635,0.88123897137579821,0.64139751375918141,0.4641910656994237,0.33439926564238931,0.24001397089654741,0.17177542411444491,0.12267123585955808,0.087467087111952058,0.062300879941355247,0.044349397904639154,0.03156420858311787,0.022467877731906366,0.01599982968437777,0.01140154096026369,0.0081320530586798112,0.0058063838402679091,0.0041509659559266221,0.002971594605242496,0.0021304793653733993,0.0015298729588605932,0.0011004238098430465,0.00079290604902269857,0.00057235591643311177,0.00041391815697076027,0.00029990517294902277,0.000217715110991478,0.00015835775630844559,0.00011541033122550192,8.4277333058541039e-05,6.1665437050926293e-05,4.5210595102829166e-05,3.3212910674061897e-05],[28.571428571428573,26.630144031631197,24.688859491840294,22.747574990986422,20.806296971303766,18.865200311753689,16.925859401585292,14.99503165822563,13.089936714250012,11.240551243202077,9.4858325330778612,7.8655033134662098,6.411654741452967,5.1434835523182745,4.0660727959959519,3.1723050675411066,2.4463632799487769,1.8674821756979156,1.4131367672728272,1.0613445311243712,0.79208430500975968,0.58799590854534811,0.43456985364904321,0.32001861122380992,0.23497790214824277,0.17214049356885819,0.12588614603596793,0.091942608889778343,0.067093255321459599,0.048935097947392314,0.035684373196279262,0.026023798770491324,0.018984625365270985,0.013856783098139591,0.010121163952226592,0.0073990248076423459,0.0054144432110383306,0.0039666128761512501,0.0029094906718828209,0.0021368969689877539,0.0015716382773283098,0.0011575831735917974,0.00085389882202444381,0.00063086370169641859,0.00046682771949591376,0.00034600619536056393,0.00025687916638810534,0.00019102976153114164,0.00014230091961592957,0.00010618288487657525],[30.612244897959183,28.670960358161807,26.729675818365756,24.78839128929933,22.847108961574783,20.905899308222732,18.965498800291918,17.029529819017526,15.108477708954263,13.222971729599422,11.403312760138608,9.6847342196238735,8.1006384825525863,6.6766989694070702,5.4275803509564113,4.356506567138517,3.4569203282695611,2.7151879015992613,2.1134686380424785,1.6322005580669465,1.2519646344523876,0.95470639341299801,0.72440984719011325,0.54736088615313916,0.41213491926954582,0.3094203290393498,0.23176025655881016,0.17326832263809733,0.12935234625373382,0.096464472648738031,0.071885630701563841,0.053545741371270161,0.039877448059082443,0.02969938175171144,0.022124391856279346,0.016488266056778167,0.012294898868845217,0.0091744436553909681,0.0068515776776515297,0.0051215615183633212,0.0038322549896744537,0.0028706538326849149,0.0021528384954224329,0.0016164865793303444,0.0012153044845968717,0.00091489159502619079,0.00068967126685147082,0.00052061482284903367,0.00039355421392836629,0.00029793122483778595],[32.653061224489797,30.711776684692421,28.770492144895332,26.829207608168787,24.887923837876372,22.946669600459611,21.005789975916791,19.067208589718661,17.137179037972146,15.229434864893456,13.366432657531384,11.577312099951467,9.8932604591492144,8.3422377365513505,6.944881199271812,5.7124756948994104,4.6469403382810839,3.7422416117227613,2.9865131002431777,2.3642867909861653,1.8584568775776678,1.4517999317939205,1.1280212816508222,0.87238180589468151,0.67199532405182527,0.51589157292889087,0.39492809141085061,0.30161634102477164,0.2299090407905926,0.17497989365929456,0.1330146008817561,0.10102322289970311,0.076678006081668082,0.058177080502132994,0.044132314685830509,0.033478570857138623,0.025401246563472646,0.01927903626344929,0.01463911084762759,0.011122272983404638,0.0084560283515912604,0.0064338762365411528,0.0048994473158384261,0.003734394408765801,0.0028491732834950365,0.0021760391515993696,0.001663735651464042,0.0012734728186492884,0.0009758843680279343,0.00074872756904076875],[34.693877551020407,32.752593011223034,30.811308471425718,28.870023932539098,26.928739667053641,24.987467582568605,23.046370089215081,21.106463753596252,19.171425844607576,17.250183003525027,15.358805041228109,13.520232888261098,11.761597905803136,10.110154443387234,8.589283330449792,7.2156626666255299,5.9980280757064222,4.9373741094236507,4.0281481056938162,3.2599331063279244,2.6192083645385402,2.0909198676928362,1.6597287724909897,1.3109061718219177,1.0309041496681663,0.80766259517011374,0.63071887272721039,0.49118240745645148,0.38162537723287793,0.29592836698643898,0.22910843477034715,0.17714761437183046,0.13683267678058186,0.10561180883061461,0.081470381461772323,0.062825778059430015,0.048439978346561496,0.037347953605352313,0.028799701909958841,0.022213776340217983,0.017140323387424522,0.013231879371127075,0.010220423474118528,0.0078994298129512752,0.0061098833330325703,0.00472941891251355,0.0036639084767206773,0.0028409585609160473,0.0022048934205962795,0.0017128898316864857],[36.734693877551024,34.793409337753651,32.852124797956286,30.910840258438306,28.969555818775508,27.028276480615517,25.087079169867277,23.146500258258115,21.20868186690144,19.279326417718668,17.369638517654476,15.497036801959911,13.683975312166332,11.955188885923192,10.334322136543047,8.8409482445239256,7.4886192921975692,6.2841274554430697,5.2278078805662211,4.3145450083407582,3.5351245672880296,2.8776408126679094,2.3287664805936306,1.8747853293829504,1.5023575613428637,1.1990336495611409,0.95355582368019931,0.75599473955830909,0.59776752890627938,0.47157710090053673,0.371304394847221,0.29187715343504816,0.22913166989963507,0.17967822591090377,0.14077659411773613,0.11022486653872599,0.086262756841876564,0.06748917621606354,0.052793090939419862,0.041296265122958586,0.032306343753841393,0.025278743025318573,0.019785919268133806,0.015492738702096803,0.012136837981185061,0.009513031895540161,0.007460979314673391,0.005855456444296539,0.0045987059876093431,0.0036144321121645631],[38.775510204081634,36.834225664284261,34.892941124486882,32.951656584778007,31.010372082381078,29.069089749744947,27.127846304554751,25.186924984624817,23.247566357693842,21.313367898697646,19.391991309830427,17.496306259395531,15.644222309927589,13.857085593368872,12.15714009357988,10.564822621058212,9.0965570144993606,7.7634132207170445,6.5706870033921483,5.5182416517087916,4.6013569011626068,3.8118268352269684,3.139097954053149,2.5713064809184605,2.0961382329915423,1.7014845035240711,1.3759009325128568,1.1088952276011934,0.89107748906945083,0.71420755167490224,0.57117029714557388,0.45590456904046883,0.36330559265606288,0.28911549621289101,0.22981203626465097,0.18250206237234967,0.14482356789282402,0.11485824359624819,0.091055132221980917,0.072165132405143773,0.057185595004049627,0.045313991970492296,0.035909538525865148,0.028461654660965285,0.022564219576459987,0.017894673329798993,0.014197134145493062,0.011268815196997684,0.0089491338221493327,0.0071110051625567633],[40.816326530612244,38.875041990814871,36.933757451017492,34.992472911249003,33.051188385732438,31.109904797345465,29.168639823276987,27.227543417098019,25.28733173372256,23.350254252047208,21.421473797465183,19.510302473315814,17.630628972799229,15.800199271054197,14.038904672313283,12.366575573936526,10.800851310070112,9.3555546281739055,8.0397722803427421,6.8576372996374708,5.8086754228513584,4.8885230457894018,4.08982760002284,3.403177683833384,2.8179581840566374,2.3230710969720896,1.9074989528202799,1.5607128236811327,1.2729418578839971,1.0353283694040494,0.83999415506478314,0.68004203506417671,0.54951322569272909,0.44331716128649079,0.35714646603009825,0.28738630098824069,0.23102443018412999,0.18556608226635163,0.14895597922870896,0.119508675670146,0.095847507602085158,0.076851900451274546,0.061612455081749506,0.049393055729373803,0.039599175668948938,0.031751558204340891,0.025464495159268852,0.020427993348405005,0.016393198491793631,0.013160527171601766],[42.857142857142861,40.915858317345489,38.974573777548109,37.033289237760442,35.092004703532837,33.150720580245938,31.209445456955649,29.268259031511825,27.327574235457242,25.388789102377938,23.455344506098037,21.533870523744991,19.634905071375012,17.772784291131252,15.964637864194057,14.228748799616792,12.582701297934378,11.04172156045162,9.6174821121794487,8.3174749575192806,7.1449221892168993,6.0991091939939253,5.1759939843194402,4.3689522661851399,3.6695449199231618,3.0682289192389369,2.5549654081473356,2.1197051509092457,1.7527504882333442,1.4450047787307252,1.18812645751464,0.97460689961714575,0.79779068525232688,0.65185478047356415,0.5317604007038752,0.43318846065509087,0.35246685322236404,0.28649550257445977,0.23267325735340605,0.18882921905395178,0.15315999447024287,0.12417356138094493,0.10063988298218951,0.081548043099979872,0.06606945276318843,0.053526559794418782,0.043366445507322493,0.035138692578853825,0.028476938047906464,0.023083572479489528],[44.897959183673471,42.956674643876099,41.015390104078719,39.074105564284693,37.132821026704285,35.191536672030395,33.250256713678965,31.309023715020938,29.368075854711918,27.428278574676856,25.491906417192872,23.563621177211708,21.651282357639005,19.766214179216448,17.92274623705665,16.137107587862072,14.425946285020455,12.804807103907748,11.286847197876,9.8819574394064276,8.5963392622896713,7.4324957645709517,6.3895429651364921,5.4637290410246955,4.6490559922977468,3.9379184468333222,3.3216993086091353,2.7912858049044207,2.3374891257699204,1.9513652461808881,1.6244439107229844,1.3488780016955815,1.1175276586762202,0.92399357057126075,0.76261264722145583,0.62842741833346594,0.51713843219895805,0.42504690644729815,0.34899306993084478,0.28629409751773816,0.23468429291363146,0.19225920163630184,0.15742460354120436,0.12885080228867252,0.10543225836229364,0.086252366694132943,0.070553028692265096,0.057708586038651366,0.047203649783805812,0.038614357376020647],[46.938775510204081,44.997490970406709,43.056206430609329,41.114921890813136,39.173637351915595,37.232352895622384,35.291070609169324,33.349813350082258,31.408718711241917,29.468321222910234,27.530115478448788,25.597347680925559,23.675800585729039,21.774260890461907,19.904444603415751,18.080342218518688,16.317125491456565,14.629858505151628,13.032262885019282,11.535726943428912,10.148660586153014,8.8762143738473647,7.7203201343063661,6.6799767362790554,5.7516944588418362,4.9300176515095764,4.2080606819920163,3.5780105978891754,3.0315675627871652,2.5603088519965844,2.1559732421233289,1.810670090686525,1.5170218155928659,1.2682505524405556,1.0582201839708842,0.88144429573545935,0.73306937981931952,0.608841119475799,0.50506006548198412,0.41853159583099231,0.34651380568101153,0.28666593191111378,0.23699907582812108,0.19583033201146538,0.1617409365477871,0.13353868705393457,0.11022463374239766,0.090963871730286416,0.075060159566850748,0.061934030813081131],[48.979591836734699,47.038307296937326,45.097022757139946,43.155738217343,41.214453677917746,39.273169176331315,37.331885756814565,35.390615768779831,33.449438893156376,31.508684963875194,29.569331930911652,27.633623435974023,25.705768556958223,23.792487969422446,21.903186613874531,20.049648986297083,18.245300416221774,16.504189376864701,14.83989068872383,13.264512072558375,11.787930992698566,10.417321798907725,9.1569742984322886,8.008363749609952,6.9704105074216258,6.0398619903883208,5.211735196743625,4.4797696503647728,3.8368544168905423,3.2754060285289341,2.7876853163665025,2.3660496974821026,2.0031434151238194,1.6920319224762324,1.4262885065676141,1.2000418531617836,1.0079929860777401,0.8454092226190042,0.7081017309491866,0.59239213711627592,0.49507252646296163,0.41336218471032682,0.34486356118588946,0.28751921988438767,0.23957096788120502,0.19952190132263437,0.1661017692270752,0.13823580618192888,0.11501700912250201,0.095681714972754683],[51.020408163265309,49.079123623467936,47.137839083670556,45.19655454387334,43.255270004232642,41.313985482165556,39.372701505279188,37.431424788529988,35.490201621622433,33.549235550466832,31.609164667153212,29.671530887604291,27.73937170552745,25.81776833013312,23.914158971559676,22.03828621599904,20.201755659825114,18.417286721803904,16.697799708023691,15.055496283015607,13.501064137587651,12.04308966121199,10.687712338123131,9.4385130017328187,8.2966001324813838,7.2608442785641962,6.3282078193858169,5.4941220659686678,4.7528726409866309,4.09796447303642,3.5224477300708052,3.0191945608449284,2.5811231787941953,2.2013705877479186,1.8734183268013886,1.5911773223549996,1.3490386194876862,1.1418967345527369,0.96515188618580616,0.81469662427141021,0.68689153211591236,0.57853382541381215,0.48682187460650317,0.40931796914179941,0.34391103754869068,0.28878053773016266,0.24236233105189076,0.20331704093299874,0.17050115916496322,0.1429409883326187],[53.061224489795919,51.119939949998546,49.178655410201166,47.237370870403858,45.296086330673589,43.354801799215053,41.413517545235635,39.472237244322521,37.530987887650078,35.589895204309542,33.649374830736306,31.710481938121813,29.775393716754042,27.847915936704737,25.933860206413328,24.041158979060672,22.179656773467645,20.360602158142726,18.595932283322401,16.897473403305415,15.276177431584443,13.741487045844831,12.300883874677343,10.959637136012912,9.7207406343842777,8.5850068977312048,7.5512780497067666,6.6167117256059704,5.7771043665444566,5.027221154701067,4.3611097844947082,3.7723829063625764,3.2544606822195377,2.8007701278874961,2.4049017497275269,2.0607265446687908,1.7624779427515964,1.5048039703037812,1.2827950275183628,1.0919924015842168,0.9283821313988474,0.7883782192385258,0.66879853128477862,0.56683609719481165,0.48002794179309483,0.40622307631691701,0.34355084822888982,0.29039049591155397,0.24534247171911616,0.20720187573882987],[55.102040816326529,53.160756276529156,51.219471736731776,49.278187196934425,47.336902657166277,45.395618121342395,43.454333728163249,41.513051503285112,39.571787249978449,37.630618754800913,35.689816541174324,33.750100472571134,31.813022800352147,29.881412384051451,27.959764764354645,26.054457776481712,24.173713349171301,22.32729128331847,20.525962968249491,18.78085334181872,17.102751971354685,15.501483204814562,13.985400142015926,12.561037245244307,11.23292893829635,10.003580576809671,8.8735649926219757,7.8417118208493299,6.9053564315900751,6.060618649502274,5.3026868509320444,4.6260891427023019,4.0249392291453958,3.4931497208904396,3.0246097816061823,2.6133271044201809,2.2535363420142964,1.9397774327998256,1.6669479417867255,1.4303337355202999,1.225622182548463,1.0489017347192036,0.89665129335941529,0.76572226626315754,0.65331572347738565,0.55695659227082928,0.47446641171808279,0.40393580304076382,0.34369750484945216,0.29230057024148248],[57.142857142857146,55.201572603059773,53.260288063262394,51.319003523465028,49.377718983680587,47.436434445800685,45.495149981972844,43.553866716283657,41.612593942607532,39.671379888970165,37.730400623507379,35.790146219208012,33.851718803170584,31.917208178850657,29.990063316451259,28.075358802647816,26.179873428500024,24.311943103350728,22.481102486404154,20.697571512682998,18.971665066155722,17.313205803511131,15.73100662693242,14.232467677393188,12.823309482905934,11.507443601697641,10.286967104636549,9.1622580997388994,8.1321455919919039,7.194127086643654,6.3446101350822133,5.5791582733226974,4.8927265598975538,4.2798765204169378,3.7349643513958313,3.2522995357609208,2.8262735345456544,2.4514599954701559,2.1226890622487424,1.835099001520204,1.5841686100195194,1.3657338337942928,1.1759918170906962,1.0114952750354904,0.86913970729808643,0.74614557952740945,0.64003722244761985,0.54861985174531824,0.46995580429648554,0.40234082138353777],[59.183673469387756,57.242388929590383,55.301104389793004,53.359819849995631,51.418535310204064,49.477250771343392,47.535966271296573,45.594682438187874,43.6534047632951,41.712163224757859,39.771072480918839,37.830465728015582,35.891123038869807,33.954580610299288,32.023466570529344,30.10178354008054,28.195060517629379,26.310324461840697,24.455882421952715,22.64094359430122,20.875137001760443,19.167990873681596,17.528435917582456,15.96438114937898,14.482393049064868,13.087490917535419,11.783056296326357,10.570843528774589,9.4510721636687514,8.4225793631344636,7.4830108556239026,6.6290312867266188,5.8565381870659685,5.160867508952407,4.5369822995396021,3.9796392822940234,3.4835307640453941,3.0434013328729073,2.6541402939140095,2.310851776971397,2.0089050300648434,1.7439676776484134,1.512024754995176,1.3093862034561248,1.1326852837092343,0.97887008129849473,0.84518997438357868,0.7291786312659525,0.6286348203903529,0.54160205733715872],[61.224489795918366,59.283205256120993,57.341920716323614,55.400636176526234,53.459351636731512,51.518067097397179,49.57678257859866,47.635498433765065,45.694217923149566,43.752959734915478,41.811798616445465,39.870960956206289,37.930997600583837,35.993033337369042,34.059059638035052,32.132210696197774,30.216955417908526,28.319152337242137,26.445943459198844,24.605495726354057,22.806625520277215,21.058357008469926,19.369468439247747,17.748074057876771,16.201276965105173,14.734913740873189,13.35339793881414,12.059658420514118,10.855160701912823,9.7399950125714909,8.7130131342770341,7.7719965885264344,6.9138406565391222,6.1347414000342582,5.4303758031985225,4.7960680211131788,4.2269372760849571,3.7180250772624603,3.2644011161338931,2.8612484292304199,2.5039292689047752,2.1880336474759261,1.909412786825996,1.6641997784812848,1.4488196943802265,1.2599912325971738,1.0947217723062783,0.95029747637308315,0.82426983853909164,0.71443983919174592],[63.265306122448983,61.324021582651611,59.382737042854231,57.441452503056858,55.500167963260701,53.558883423694859,51.617598895094233,49.676314577700964,47.735032416798546,45.793764099339711,43.852558426372269,41.911569199714165,39.971184764225583,38.032226116658059,36.096195388532635,34.165531861336973,32.243820049626059,30.335898921866352,28.447840312446374,26.586790456598472,24.760693173941668,22.977930745694501,21.246926618827359,19.575753323160171,17.971781773549885,16.441397394856544,14.989796917690576,13.620869192395226,12.337155079855968,11.139875810344662,10.029016053189522,9.0034469054196009,8.0610745529522845,7.1990019439902717,6.4136929691496043,5.7011309954988505,5.0569658882229014,4.4766457068600261,3.9555309944976997,3.4889909580167675,3.072481875387485,2.7016087963808424,2.3721720724307165,2.0802005101585763,1.8219730399035079,1.5940307691312565,1.3931811879012592,1.216496139732377,1.0613049896327045,0.92518422919988286],[65.306122448979593,63.364837909182221,61.423553369384841,59.482268829587461,57.540984289790664,55.599699750110346,53.658415216337573,51.717130802702243,49.775847675752743,47.834573168794776,45.893339200919222,43.952250297128899,42.011579951833582,40.071925980459355,38.134417179437321,36.200942352807431,34.274358075944292,32.358629548708755,30.458869729786912,28.581261080749854,26.732865315062767,24.921344066007642,23.154624199902933,21.440544915552046,19.786520918298429,18.199248896688438,16.684475473102701,15.246835608125686,13.889762398543624,12.615463015660232,11.424951389798821,10.318126023204812,9.2938806765621678,8.3502362159341779,7.4844832234455225,6.693326715502419,5.9730262004863555,5.3195261455432288,4.7285735819723307,4.1958209914382181,3.7169137551553355,3.2875623200624737,2.9035998635878411,2.5610266558973915,2.2560425633016443,1.9850692460164989,1.744763611789363,1.532024023497458,1.3439906481036505,1.1780411957239059],[67.34693877551021,65.405654235712831,63.464369695915458,61.523085156118086,59.581800616320983,57.640516076583417,55.699231540056438,53.757947072345843,51.816663376574397,49.875385070518469,47.934133075016668,45.992978478090009,44.05211378206787,42.111973505653879,40.173403334164547,38.237859625789312,36.307606389278519,34.385870868599326,32.476923536458507,30.586061395045107,28.719490451558379,26.884119355584971,25.087288072304943,23.336461614803852,21.638919427530681,20.001467233172022,18.430191701389418,16.930270796814007,15.505845406599178,14.159951683427195,12.894508893434505,11.71035451849226,10.607316788756847,9.5843144477047346,8.6394740648226964,7.7702563063271448,6.9735839884466273,6.2459662632157702,5.5836147733606794,4.9825489629137039,4.4386888890126848,3.9479348261705987,3.5062336886548806,3.1096328359800687,2.7543221957952539,2.4366658660844767,2.153224473211198,1.9007695905773705,1.6762914880143303,1.477001404272924],[69.387755102040813,67.446470562243434,65.505186022446068,63.563901482648689,61.622616942851437,59.681332403084966,57.740047865078196,55.798763366762998,53.857479334107282,51.916198685577186,49.974935165137211,48.033737170968834,46.092740178430162,44.152259606297449,42.212927507192504,40.27586285202468,38.342851689215152,36.41650545569081,34.500366007050054,32.598933993177653,30.717610082456218,28.862552459699813,27.040465776522197,25.258344396267269,23.523195811606271,21.841769053093024,20.220308886774468,18.664350928275752,17.178566660899584,15.766661628013075,14.43132533325106,13.174227881442036,11.996056151412844,10.896581177804535,9.8747482188473015,8.9287814593160277,8.0562962113876324,7.2544126316564821,6.5198662126558489,5.8491115173037045,5.2384167290770804,4.6839475461032833,4.1818397353856724,3.7282602836285754,3.3194575449819794,2.9518011117951719,2.6218123436438354,2.3261866045481892,2.0618082993363327,1.8257597862636921],[71.428571428571431,69.487286888774051,67.546002348976685,65.604717809179306,63.66343326938199,61.722148729600733,59.780864190792002,57.839579675031764,55.898295441701862,53.957013342224045,52.015742428259429,50.074515693755338,48.133428500469144,46.192709615716325,44.252830534014485,42.314648503963241,40.379566996806403,38.449688682344672,36.527933399531264,34.618097712273681,32.724841785625031,30.853600702398644,29.010428156305004,27.201788668912421,25.434319109097466,23.714581332694642,22.048825854975412,20.442782585351907,18.901489792622705,17.429167480744781,16.029136853632423,14.703783897921447,13.454562464247687,12.282030567923869,11.185912842147282,10.165181989989875,9.218152508497738,8.3425807223626549,7.5357661139315368,6.7946499504168258,6.1159081998719422,5.4960366358435913,4.9314268220991195,4.4184323280153954,3.9534250505666968,3.532841918182072,3.1532225385442132,2.811238542977252,2.5037154914940789,2.2276482512969995],[73.469387755102048,71.528103215304668,69.586818675507303,67.645534135709923,65.704249595912572,63.76296505612369,61.821680516876611,59.880395991102731,57.939111637551015,55.997828635221843,54.056552961231034,52.115307142889513,50.174158339734554,48.233272392135234,46.29300051651623,44.353997896367474,42.41736373380288,40.48478387185299,38.558652835437336,36.642153310075237,34.739277035308952,32.854779920811794,30.994073603919823,29.163063717147466,27.367950624332664,25.615010916066943,23.910377771846385,22.25983603308574,20.668644273086095,19.141392049314007,17.681896489047851,16.29313881341217,14.977238584395138,13.735461447648419,12.568254910886139,11.475306142519102,10.455615761132442,9.5075819680899016,8.6290900166815163,7.8176027951154339,7.0702491345760592,6.3839072691427674,5.7552816253358188,5.1809717777995452,4.6575329611872611,4.1815279745497556,3.7495706587659008,3.3583613797448315,3.0047151226857274,2.6855829088556717],[75.510204081632651,73.568919541835271,71.627635002037906,69.686350462240526,67.74506592244316,65.8037813826503,63.862496843161679,61.921212311600307,59.979927885617315,58.038644318915168,56.097365569288471,54.156107044355096,52.214916077892852,50.273912873071026,48.333358776394412,46.393753576952889,44.455955788800409,42.521312157452677,40.591777564717646,38.670005636819745,36.759393742233875,34.864072532747961,32.988837978993594,31.139031263624631,29.320377662860096,27.538799029158724,25.800215615170927,24.11035209492632,22.474560307476523,20.897668091630692,19.383860157636839,17.936593687265628,16.558548556806763,15.251609890818486,14.0168791202804,12.854708800143584,11.764756052379887,10.746049532275009,9.7970651541498199,8.9158063522985174,8.0998853033931404,7.3466022259867074,6.6530205476530213,6.0160363542138562,5.4324410861948103,4.8989769142439243,4.4123846053608808,3.969443988974696,3.5670073535366598,3.2020262598335307],[77.551020408163268,75.609735868365888,73.668451328568523,71.727166788771143,69.785882248973763,67.844597709178828,65.903313169556014,63.962028634627181,62.020744164762156,60.079460243659767,58.138179499489894,56.196912490221905,54.255692609109502,52.314606990830697,50.373849969249633,48.433802216730669,46.495132715387683,44.558913992596388,42.626735797395291,40.700800215183847,38.783982619660854,36.879847269222466,34.992612518791063,33.12706711001443,31.288444619855177,29.482267124899181,27.714171186737744,25.989729485856323,24.31428018715976,22.692773886110579,21.129645242116425,19.628713568860256,18.193114028998721,16.825258870557512,15.526826441434089,14.298774544125855,13.141374006784297,12.054258076950077,11.036483303417583,10.086597870221759,9.2027138023252135,8.3825800048503609,7.6236536704539368,6.9231681507058731,6.2781959081062979,5.6857056276835891,5.142612961836921,4.645824706784925,4.1922764659830847,3.7789640506197699],[79.591836734693885,77.650552194896505,75.70926765509914,73.76798311530176,71.826698575504395,69.885414035708322,67.944129496010376,66.002844959109296,64.061560462512389,62.120276317853467,60.178994275477351,58.237721584753686,56.29648183147512,54.355338201379105,52.414435137637653,50.474062246104474,48.534739827423408,46.597319779935262,44.663090575131072,42.733872086029393,40.812086007445998,38.900790309620007,37.003670798940554,35.124988301306779,33.269485160201469,31.442258855885164,29.648613176360378,27.893898424983625,26.183351815219709,24.521947814695991,22.914266147376672,21.3643828135287,19.875787146417849,18.451325812016009,17.093172907819742,15.802823989423914,14.58111095157642,13.428234177345345,12.343808184745541,11.32691707456015,10.376176345559543,9.4897980291812942,8.6656565498166955,7.901353194967605,7.1942775484883832,6.5416646767420623,5.9406472471830298,5.3883020939679867,4.8816910233293029,4.4178958740839001],[81.632653061224488,79.691368521427108,77.750083981629743,75.808799441832363,73.867514902034983,71.926230362238329,69.984945822498005,68.043661284434364,66.102376771464876,64.161092485151471,62.219809594690929,60.278533088255649,58.337279646553974,56.396095114298873,54.455086834196038,52.514474939791974,50.57466346744512,48.636327567349859,46.700508504094415,44.768704893678823,42.842947594930365,40.925847025280504,39.020604946631629,37.130987139566834,35.261257945598459,33.416081643828441,31.600398542108394,29.819285294644807,28.077809344626566,26.380886737237709,24.733151147873052,23.138840133263258,21.601702620140223,20.124929720118097,18.711109256347811,17.362202998179527,16.079544560685484,14.863855230986879,13.715274599274942,12.633402749418877,11.617350845702717,10.665797182506722,9.7770460915788036,8.9490874833966956,8.1796552000456799,7.4662827506079417,6.8063553676667681,6.1971576532682739,5.6359163681132749,5.1198381566473259],[83.673469387755105,81.732184847957726,79.79090030816036,77.84961576836298,75.908331228565601,73.967046688768633,72.025762149004223,70.084477610250957,68.143193087200345,66.201908710729001,64.260625264199575,62.319346187482566,60.378083294894964,58.436869873744428,56.495785699808586,54.554997998813221,52.614820133501652,50.675786177737066,48.738735522713341,46.804898389071312,44.875971469919634,42.954173260448108,41.042270758108799,39.143572576961226,37.261887382683341,35.401450232810859,33.566822384206965,31.762772116839535,29.994145046245194,28.265732351406861,26.582144530558175,24.947696960825034,23.366311923345876,21.841440075627418,20.376002770603378,18.972355247338633,17.632269612620725,16.356935716267607,15.146977486042005,14.002482000645287,12.923038500142198,11.907784616845277,10.955457311489546,10.064446278913877,9.2328479098879939,8.4585182333629589,7.7391235951356485,7.0721881396749495,6.4551374419105727,5.8853378797088993],[85.714285714285722,83.773001174488343,81.831716634690977,79.890432094893598,77.949147555096218,76.00786301529908,74.066578475520885,72.125293936356044,70.184009407065673,68.24272497295928,66.301441160491876,64.360160347232338,62.418890913911298,60.4776570515277,58.536518063023649,56.595600935261082,54.655148470914483,52.715582489895283,50.777578204755876,48.842142768929563,46.910689012196073,44.985094974676898,43.067741047489982,41.161518977555808,39.269810142750025,37.396433762451359,35.545568582262504,33.721653729606238,31.929275728388113,30.173049091666904,28.457497599233584,26.786942493660035,25.165402595868755,23.596509940398612,22.08344312090324,20.628879237222492,19.234964224358897,17.903300461380944,16.634949915038561,15.430450656954818,14.289844378433799,13.212712479103828,12.198218387987851,11.245153952368661,10.35198796863888,9.5169152026233164,8.7379045323702798,8.0127451271167232,7.3390898398463236,6.7144952295584552],[87.755102040816325,85.813817501018946,83.87253296122158,81.931248421424201,79.989963881626821,78.048679341829569,76.10739480204343,74.166110262631506,72.224825729459141,70.28354125834818,68.342257204185699,66.400975214145049,64.459701243142788,62.518452889533037,60.577274255608174,58.636261755775664,56.695603383650905,54.755631874007975,52.81688938620109,50.880198511429029,48.946732296037517,47.018075076033405,45.096266388601059,43.183821891961145,41.283727690878671,39.399407250219731,37.534662733537665,35.693594787253232,33.880506304615835,32.099796485556467,30.355851606959135,28.652938453892283,26.995105493262308,25.386095760400238,23.829274223992428,22.327571215312943,20.883442440848924,19.498845197793315,18.175229705946315,16.913543961294742,15.714250193670317,14.57735085073984,13.502422004957204,12.488652159130417,11.534884581125866,10.639661502985568,9.8012687522524544,9.0177796256698031,8.287097053886022,7.6069933304129549],[89.795918367346943,87.854633827549563,85.913349287752197,83.972064747954818,82.030780208157438,80.089495668360129,78.148211128569386,76.206926589008205,74.26564205340857,72.324357558436759,70.38307334406079,68.441790554160036,66.50051342735793,64.559254780552081,62.618047430041877,60.676964579093578,58.736151709423837,56.795871014201239,54.856557149353712,52.918880595482221,50.983812834385745,49.052686345299982,47.127242354423416,45.20966028691852,43.30256471527801,41.409007897006283,39.532428358432895,37.676588082588289,35.8454924741133,34.043298294181497,32.274215175724144,30.542406211658417,28.85189257004091,27.206466262660342,25.609614207815497,24.06445569770792,22.573694395752,21.139585112476531,19.763914878812855,18.447997269246557,17.192678524579343,15.998353772982369,14.864991529141903,13.792164641272258,12.779085930272984,11.824646901046677,10.927458082049391,10.085889747675296,9.2981119845954936,8.5621332664978453],[91.83673469387756,89.89545015408018,87.954165614282815,86.012881074485435,84.071596534688055,82.130311994890718,80.189027455097275,78.247742915445457,76.306458378320599,74.365173867897994,72.423889546938767,70.482606211732403,68.541326884724356,66.600060911983931,64.658832728789179,62.717697924668201,60.776769045852831,58.836252531123243,56.896496400875769,54.958046192639507,53.021704667253601,51.088589457052585,49.160182371541573,47.238364571870889,45.325433126862791,43.424096294136184,41.537446906689418,39.66891518879828,37.822203946393124,36.001210237733559,34.209938280415834,32.452408513627113,30.732567483798753,29.054202658871624,27.420865510855336,25.835805341357613,24.301915447657763,22.821692404821249,21.397208518320241,20.030096908221225,18.721548230493937,17.472317721079236,16.282741052869227,15.152757408070386,14.081938169208527,13.069519701415551,12.114438817706386,11.215369670760246,10.370760984808683,9.5788727178289861],[93.877551020408163,91.936266480610783,89.994981940813418,88.053697401016038,86.112412861218658,84.171128321421307,82.229843781626272,80.288559241919074,78.347274703831189,76.405990183361865,74.464705791244768,72.523422083157271,70.582141218338649,68.640870020913084,66.699626700164515,64.758453483071975,62.817437422483835,60.87674095806441,58.936642445820468,56.997585094614053,55.060230956897577,53.125515223440246,51.194695361851117,49.269389734169913,47.351601171458078,45.44372238335496,43.548521780923814,41.669110029770856,39.808889206831502,37.971487655132677,36.160684437037375,34.380327665441797,32.63425098291313,30.926192132672675,29.259717010303255,27.63815189048097,26.064525770038564,24.541524024183467,23.071453886857825,21.656221672416343,20.297321172306027,18.995832293123804,17.752428747694729,16.567393458488148,15.440640268612732,14.371740563765712,13.359953472558111,12.404258417187059,11.503388917683672,10.655866699161813],[95.91836734693878,93.9770828071414,92.035798267344035,90.094513727546655,88.153229187749275,86.211944647951924,84.270660108155951,82.329375568414733,80.388091029715866,78.446806502686911,76.505522062895452,74.564238099067097,72.622956156711126,70.681681225454383,68.74042688714411,66.799225232162073,64.858143593609071,62.917309732605986,60.976946092438872,59.037412285858444,57.099253396158318,55.163250307699727,53.230467421253088,51.302292909517277,49.380467135899274,47.467095877912598,45.564646370556538,43.67592569423887,41.804042473482077,39.95235407037918,38.124402352958541,36.323841653990272,34.554362720025495,32.819616328664942,31.123139890201152,29.468289821966053,27.858181862166049,26.295640838274288,24.783160774334299,23.322875649228486,21.916540628198426,20.565523195104738,19.27080331599641,18.032981561296957,16.852293995193435,15.728632594604854,14.661569973077221,13.650387243700685,12.694103947048852,11.791509083936106],[97.959183673469397,96.017899133672017,94.076614593874652,92.135330054077272,90.194045514279892,88.252760974482527,86.311476434686,84.370191894923792,82.428907355835491,80.48762282450636,78.54633835266263,76.605054212911554,74.663771513629129,72.722493908400466,70.781231537559663,68.840008801378843,66.898877786312752,64.957938948855173,63.017369927750387,61.077462191615787,59.138663861823304,57.201625769155996,55.267246871948046,53.336714756754802,51.411537113916445,49.493560771102509,47.584975938844892,45.688304594680361,43.806373227749063,41.942271332578414,40.099297972594165,38.28089937267498,36.490600832443548,34.731936299854404,33.008378753729403,31.323274172621275,29.679781377447661,28.080819484676049,26.52902414511675,25.026713209654055,23.575861985397133,22.178087841125311,20.83464359781545,19.546418899457208,18.313948596864577,17.137427084698245,16.016727499219904,14.951424700301267,13.940821014843252,12.983973799657896],[100,98.05871546020262,96.117430920405255,94.176146380607875,92.234861840810495,90.29357730101313,88.352292761216262,86.411008221441023,84.469723682103378,82.528439147944027,80.587154654476777,78.645870393351231,76.704587161020356,74.763307636795432,72.822039399563181,70.880801014150336,68.939632782145338,66.99861367855803,65.05788548654138,63.117684230456781,61.178377851783324,59.240507905548519,57.304832112732967,55.372364063607485,53.44440631232073,51.522573521058661,49.608803111238458,47.705351920973371,45.814778499875032,43.939911754676928,42.083807583600191,40.249695834247071,38.440920358434774,36.660875120481954,34.912939270628847,33.200413865772504,31.526462555979485,29.89405810810797,28.305936153576816,26.764557064574717,25.272076411589957,23.830324055807417,22.440791595085386,21.10462761724915,19.822640019068871,18.595304519166284,17.42277842112027,16.304918660555806,15.241303187737579,14.231254785985819]],"type":"surface","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<figcaption class="figure-caption">Figure&nbsp;2.11: Call value as <span class="math inline">\(S_0\)</span> and <span class="math inline">\(K\)</span> change, an interactive view.</figcaption>
</figure>
</div>
</div>
<p>An interesting case is the value of the put as a function of the time to maturity. Let’s see the simplest case.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>TT.seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> <span class="dv">25</span>, <span class="at">length.out =</span> <span class="dv">50</span>)</span>
<span id="cb23-2"><a href="#cb23-2"></a>p.TT <span class="ot">&lt;-</span> <span class="fu">mapply</span>(p.bs, S0, K, rf, TT.seq, sigma)</span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="fu">plot</span>(TT.seq, p.TT, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">ylab =</span> <span class="st">"Put value"</span>, <span class="at">xlab =</span> <span class="st">"T"</span>)</span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="fu">points</span>(TT, p, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">19</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-epatitmh" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-epatitmh-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.12: European put as <span class="math inline">\(T\)</span> increases: the mysterious hump.</figcaption>
</figure>
</div>
</div>
</div>
<p>The put option price first increases as the time to maturity increases and after reaching a maximum, the put option price decreases. What is the mathematical expression for the time to maturity which makes the put option price maximum? What is the reason or logic behind this mysterious hump? Those are interesting questions to address.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>p1.bs <span class="ot">&lt;-</span> <span class="cf">function</span>(S, K, rf, TT, sigma) {</span>
<span id="cb24-2"><a href="#cb24-2"></a>  d1 <span class="ot">&lt;-</span> (<span class="fu">log</span>(S <span class="sc">/</span> K) <span class="sc">+</span> (rf <span class="sc">+</span> sigma<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> TT) <span class="sc">/</span> (sigma <span class="sc">*</span> <span class="fu">sqrt</span>(TT))</span>
<span id="cb24-3"><a href="#cb24-3"></a>  d2 <span class="ot">&lt;-</span> d1 <span class="sc">-</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(TT)</span>
<span id="cb24-4"><a href="#cb24-4"></a>  p1 <span class="ot">&lt;-</span> K <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>rf <span class="sc">*</span> TT) <span class="sc">*</span> <span class="fu">pnorm</span>(<span class="sc">-</span>d2)</span>
<span id="cb24-5"><a href="#cb24-5"></a>}</span>
<span id="cb24-6"><a href="#cb24-6"></a></span>
<span id="cb24-7"><a href="#cb24-7"></a>p2.bs <span class="ot">&lt;-</span> <span class="cf">function</span>(S, K, rf, TT, sigma) {</span>
<span id="cb24-8"><a href="#cb24-8"></a>  d1 <span class="ot">&lt;-</span> (<span class="fu">log</span>(S <span class="sc">/</span> K) <span class="sc">+</span> (rf <span class="sc">+</span> sigma<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> TT) <span class="sc">/</span> (sigma <span class="sc">*</span> <span class="fu">sqrt</span>(TT))</span>
<span id="cb24-9"><a href="#cb24-9"></a>  d2 <span class="ot">&lt;-</span> d1 <span class="sc">-</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(TT)</span>
<span id="cb24-10"><a href="#cb24-10"></a>  p2 <span class="ot">&lt;-</span> S <span class="sc">*</span> <span class="fu">pnorm</span>(<span class="sc">-</span>d1)</span>
<span id="cb24-11"><a href="#cb24-11"></a>}</span>
<span id="cb24-12"><a href="#cb24-12"></a></span>
<span id="cb24-13"><a href="#cb24-13"></a>TT.seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> <span class="dv">25</span>, <span class="at">length.out =</span> <span class="dv">50</span>)</span>
<span id="cb24-14"><a href="#cb24-14"></a>p1.TT <span class="ot">&lt;-</span> <span class="fu">mapply</span>(p1.bs, S0, K, rf, TT.seq, sigma)</span>
<span id="cb24-15"><a href="#cb24-15"></a>p2.TT <span class="ot">&lt;-</span> <span class="fu">mapply</span>(p2.bs, S0, K, rf, TT.seq, sigma)</span>
<span id="cb24-16"><a href="#cb24-16"></a><span class="fu">plot</span>(TT.seq, p.TT, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">ylab =</span> <span class="st">"Put value"</span>, <span class="at">xlab =</span> <span class="st">"T"</span>,</span>
<span id="cb24-17"><a href="#cb24-17"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">25</span>))</span>
<span id="cb24-18"><a href="#cb24-18"></a><span class="fu">lines</span>(TT.seq, p1.TT, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb24-19"><a href="#cb24-19"></a><span class="fu">lines</span>(TT.seq, p2.TT, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb24-20"><a href="#cb24-20"></a><span class="fu">points</span>(TT, p, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">19</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s illustrate the case when time to maturity and the stock price at time zero changes.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>p.S0.T <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">50</span>, <span class="at">ncol =</span> <span class="dv">50</span>)</span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>) { <span class="co"># Is there an easier way to do this?</span></span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>) {</span>
<span id="cb25-4"><a href="#cb25-4"></a>    p.S0.T[i, j] <span class="ot">&lt;-</span> <span class="fu">p.bs</span>(S0.seq[i], K, rf, TT.seq[j], sigma) } }</span>
<span id="cb25-5"><a href="#cb25-5"></a>p.S0.T.plot <span class="ot">&lt;-</span> <span class="fu">persp</span>(S0.seq, TT.seq, p.S0.T, <span class="at">zlab =</span> <span class="st">"Put"</span>, <span class="at">xlab =</span> <span class="st">"S0"</span>, </span>
<span id="cb25-6"><a href="#cb25-6"></a>               <span class="at">ylab =</span> <span class="st">"T"</span>, <span class="at">theta =</span> <span class="dv">330</span>, <span class="at">phi =</span> <span class="dv">10</span>, <span class="at">expand =</span>  <span class="fl">0.5</span>, </span>
<span id="cb25-7"><a href="#cb25-7"></a>               <span class="at">col =</span> <span class="st">"orange"</span>, <span class="at">shade =</span> <span class="fl">0.2</span>, <span class="at">ticktype =</span> <span class="st">"detailed"</span>) </span>
<span id="cb25-8"><a href="#cb25-8"></a><span class="fu">points</span>(<span class="fu">trans3d</span>(S0, TT, p, p.S0.T.plot), <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-epvasatcap" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-epvasatcap-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.13: European put value as <span class="math inline">\(S_0\)</span> and <span class="math inline">\(T\)</span> change: a plane.</figcaption>
</figure>
</div>
</div>
</div>
<p>That is not quite clear. So, here is the contour view.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">contour</span>(S0.seq, TT.seq, p.S0.T, <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[<span class="dv">0</span>])), </span>
<span id="cb26-2"><a href="#cb26-2"></a>        <span class="at">ylab =</span> <span class="st">"T"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">nlevels =</span> <span class="dv">40</span>, <span class="at">drawlabels =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="fu">points</span>(S0, TT, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">cex =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-pvasatcacvothp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-pvasatcacvothp-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.14: Put value as <span class="math inline">\(S_0\)</span> and <span class="math inline">\(T\)</span> change, a contour view, or the hypnotic plot.</figcaption>
</figure>
</div>
</div>
</div>
<p>Now the mysterious hump is clearer than before. Remember the value of <span class="math inline">\(put(S_0=50, K=50, rf=0.05, T=1, \sigma = 0.3) = \$4.677099\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">plot_ly</span>(<span class="at">type =</span> <span class="st">"surface"</span> , <span class="at">x =</span> S0.seq, <span class="at">y =</span> TT.seq , <span class="at">z =</span> p.S0.T ) <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="fu">layout</span>(<span class="at">scene =</span> <span class="fu">list</span>(<span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Stock price"</span>), </span>
<span id="cb27-3"><a href="#cb27-3"></a>                    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"T"</span>, </span>
<span id="cb27-4"><a href="#cb27-4"></a>                    <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Put price"</span>))))  <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="fu">hide_colorbar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-pvasatcaiv" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div class="plotly html-widget html-fill-item" id="htmlwidget-2b457dffac8d75e29913" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-2b457dffac8d75e29913">{"x":{"visdat":{"4cc025386e8c":["function () ","plotlyVisDat"]},"cur_data":"4cc025386e8c","attrs":{"4cc025386e8c":{"x":[0,2.0408163265306123,4.0816326530612246,6.1224489795918373,8.1632653061224492,10.204081632653061,12.244897959183675,14.285714285714286,16.326530612244898,18.367346938775512,20.408163265306122,22.448979591836736,24.489795918367349,26.530612244897959,28.571428571428573,30.612244897959183,32.653061224489797,34.693877551020407,36.734693877551024,38.775510204081634,40.816326530612244,42.857142857142861,44.897959183673471,46.938775510204081,48.979591836734699,51.020408163265309,53.061224489795919,55.102040816326529,57.142857142857146,59.183673469387756,61.224489795918366,63.265306122448983,65.306122448979593,67.34693877551021,69.387755102040813,71.428571428571431,73.469387755102048,75.510204081632651,77.551020408163268,79.591836734693885,81.632653061224488,83.673469387755105,85.714285714285722,87.755102040816325,89.795918367346943,91.83673469387756,93.877551020408163,95.91836734693878,97.959183673469397,100],"y":[1,1.489795918367347,1.9795918367346939,2.4693877551020407,2.9591836734693877,3.4489795918367347,3.9387755102040813,4.4285714285714288,4.9183673469387754,5.408163265306122,5.8979591836734695,6.3877551020408161,6.8775510204081627,7.3673469387755102,7.8571428571428568,8.3469387755102034,8.8367346938775508,9.3265306122448983,9.816326530612244,10.306122448979592,10.795918367346939,11.285714285714285,11.775510204081632,12.26530612244898,12.755102040816325,13.244897959183673,13.73469387755102,14.224489795918368,14.714285714285714,15.204081632653061,15.693877551020408,16.183673469387756,16.673469387755102,17.163265306122447,17.653061224489797,18.142857142857142,18.632653061224488,19.122448979591837,19.612244897959183,20.102040816326529,20.591836734693878,21.081632653061224,21.571428571428569,22.061224489795919,22.551020408163264,23.04081632653061,23.530612244897959,24.020408163265305,24.510204081632651,25],"z":[[47.561471225035703,46.410847280607243,45.288059637861465,44.19243487113647,43.123315846522303,42.08006132772514,41.062045591466514,40.06865805218694,39.099302895828913,38.153398722479452,37.230378197658034,36.329687712040695,35.450787049416149,34.593149062674875,33.756259357636814,32.939615984527933,32.142729136920792,31.365120857958406,30.6063247536852,29.865885713313251,29.143359636255877,28.438313165764985,27.750323429012262,27.078977783458559,26.423873569359046,25.784617868255953,25.160827267313902,24.552127629356516,23.958153868466407,23.378549731013909,22.812967581983237,22.261068196467953,21.722520556210608,21.197001651064575,20.684196285259024,20.183796888350773,19.695503330749631,19.219022743706692,18.754069343657459,18.300364260814579,17.857635371907293,17.425617136967301,17.004050440063207,16.592682433887926,16.191266388105909,15.799561541369217,15.417332956913633,15.044351381648294,14.680393108654252,14.325239843009504],[45.520654898505093,44.370030954076633,43.247243311330905,42.151618544627887,41.082499521269142,40.039245025275399,39.021229488372491,38.027843012918019,37.058491867890801,36.112599443765504,35.189607408444736,34.288976697803321,33.410188037396587,32.55274184701954,31.716157535773082,30.899972302103777,30.103739601847693,29.327027450432723,28.569416701522314,27.830499409195127,27.109877344656365,26.407160707060193,25.721967043462186,25.053920375348557,24.402650517716474,23.767792570054045,23.148986555524559,22.545877184100995,21.958113716444146,21.385349907311479,20.82724400975183,20.283458823962452,19.753661777253431,19.237525023956508,18.734725556266039,18.244945318882479,17.767871321943517,17.30319574808788,16.850616050625057,16.40983504070708,15.98056096214259,15.562507553085171,15.155394094291546,14.758945444001439,14.372892059759602,13.996970007697229,13.630920959928833,13.274492180813375,12.927436502884525,12.58951229328245],[43.479838571974483,42.329214627557327,41.206426990339224,40.110802466165055,39.041686485087553,37.998450247470259,36.980503403755442,35.987306091706479,35.018373912213185,34.073274166026607,33.151615690544702,32.25303588008822,31.377187855670762,30.523729558738026,29.692315494144221,28.882591154506954,28.09418979123739,27.326731056925855,26.579821035083835,25.853053229269161,25.146010163148564,24.458265323770121,23.789385251832407,23.138931641457631,22.506463357820493,21.891538315448102,21.293715185097664,20.712554914838311,20.147622063070713,19.598485949161507,19.064721632292311,18.545910731902016,18.041642104391482,17.551512391046479,17.075126451766533,16.61209769841404,16.162048340594435,15.724609555564797,15.299421592824988,14.886133822825892,14.484404738164917,14.093901914649015,13.714301938699004,13.345290306748234,12.986561301552952,12.63781784967644,12.298771363828941,11.969141573234532,11.648656344747391,11.337051497047753],[41.439022245446822,40.288398317438762,39.165612089445055,38.070008487055986,37.001015984960034,35.958204737260296,34.94130123217618,33.950152130733606,32.9846647329015,32.044750343476821,31.130283026394586,30.241075588515248,29.376869685006383,28.537335723786786,27.722078722468073,26.930647244815312,26.162543486009866,25.417233315828412,24.694155611481111,23.99273055612208,23.312366792992176,22.652467450131233,22.012435117685357,21.391675890775883,20.789602600213975,20.205637350419263,19.639213474609459,19.089777005243686,18.556787744914033,18.039720010545459,17.53806311246823,17.051321619911381,16.579015455775863,16.120679856119459,15.675865223507564,15.244136898119576,14.825074866113072,14.418273421108175,14.023340791645925,13.639898744995261,13.267582175644959,12.906038685144626,12.554928158589806,12.213922341926931,11.882704423340916,11.560968621244662,11.248419780785548,10.944772980294324,10.649753148705919,10.363094694662829],[39.398205920915601,38.247583394454125,37.124837954043059,36.02953627970426,34.961636712680999,33.921449401280753,32.909437735762253,31.926021726755103,30.971456294564923,30.045783086835009,29.148830850380335,28.280240957379533,27.439502446814032,26.625987808066846,25.838985301245138,25.077726254611861,24.341407160513899,23.629207029377042,22.940300695851704,22.273868802268908,21.629105123368113,21.005221801322154,20.401452960375636,19.817057078937069,19.251318418459274,18.703547743595877,18.173082515812858,17.65928670108784,17.161550299673696,16.679288680419482,16.211941782357215,15.758973230960816,15.319869404682912,14.894138478297359,14.4813094626083,14.080931254751672,13.692571709241685,13.315816736814014,12.9502694357667,12.595549258727122,12.251291216444898,11.917145119224372,11.592774855886313,11.277857709625392,10.97208370976073,10.675155018124466,10.386785348669552,10.106699418781197,9.8346324307295543,9.5703295816912952],[37.357389764391911,36.206795976489758,35.084438349241225,33.990879009609046,32.927438539619146,31.89557318081166,30.896391257500337,29.930467781691092,28.997854849517857,28.09817509202103,27.230732773584695,26.394613988324817,25.58876714440845,24.812063644934916,24.063341782227944,23.34143747528481,22.645205132760456,21.973531302621861,21.325343151407893,20.699613293836805,20.095362083645391,19.511658167140812,18.947617872551593,18.402403841933118,17.87522319226926,17.365325406153694,16.872000090732165,16.394574699594088,15.932412281036481,15.484909293987286,15.051493517279908,14.631622067057457,14.224779529519363,13.830476211048216,13.448246504282672,13.077647366440541,12.718256904789119,12.369673063353666,12.031512404565495,11.703408979448527,11.385013280032215,11.075991267893366,10.776023473021635,10.484804157539786,10.202040539167349,9.9274520696783988,9.6607697639604364,9.4017355756249934,9.1501018154464173,8.9056306092119772],[35.316577708130005,34.166236336560623,33.045779526662237,31.958085476297992,30.906261814833552,29.892439006890097,28.91750702007602,27.981322078102494,27.083018680073231,26.221282724687182,25.394553203750256,24.60115931266396,23.839408837460553,23.107642555890877,22.404265906983376,21.727765863171769,21.076718381241164,20.449789995643783,19.845735883276568,19.263395905370885,18.701689589080296,18.159610655623212,17.636221469956382,17.130647636526202,16.642072868648402,16.169734197079634,15.712917544264254,15.270953666621352,14.843214452856252,14.429109558199396,14.028083350432041,13.639612142062733,13.263201683093765,12.898384889823433,12.544719786651985,12.201787639630169,11.869191262340717,11.546553476531166,11.233515711660177,10.929736729146406,10.634891458602851,10.348669934697421,10.070776324504877,9.8009280363128575,9.5388549018256228,9.2842984245821896,9.0370110881818668,8.7967557185994512,8.5633048954833146,8.3364404078718337],[33.275810030763857,32.12674381139216,31.012350754178385,29.938648445956893,28.909627106297336,27.926647914449202,26.989134145012837,26.095363780238635,25.243044141512996,24.42966932073,23.652724802733104,22.909796385094552,22.198622384768782,21.517113435945589,20.863354424440359,20.235597071702784,19.632248067965001,19.051855521374073,18.49309524188557,17.954757653630981,17.435735712382858,16.935013968671768,16.451658787199637,15.984809665257661,15.533671560765473,15.097508128846684,14.675635765408913,14.267418361636953,13.872262681508523,13.489614283618828,13.118953917762958,12.759794335359427,12.411677460662325,12.074171876723966,11.74687058624022,11.42938901278923,11.121363212634948,10.822448271289378,10.532316862490379,10.250657950230135,9.9771756170279406,9.7115880038405535,9.4536263488940726,9.203034114348478,8.9595661911079389,8.7229881732989458,8.4930756949828528,8.2696138225731346,8.0523964972104558,7.8412260220284331],[31.235314976575328,30.090635170232609,28.990639352143237,27.94335368303345,26.951329311304608,26.013340235931771,25.126289412388047,24.286391276413415,23.489784991625449,22.732817907206957,22.012156682780251,21.324813455218653,20.668132669744018,20.039761667435275,19.43761639115349,18.859847560616075,18.30480962386147,17.771033279051814,17.257201633736422,16.762129743741987,16.284747151440591,15.824083019881643,15.379253481713448,14.949450862658676,14.533934484938442,14.132022800028508,13.74308663974722,13.366543409070998,13.001852073307401,12.648508816787894,12.306043270674284,11.97401522441619,11.652011749418534,11.339644675074348,11.036548366912974,10.742377764561439,10.456806643811166,10.179526072564935,9.9102430350074648,9.6486792021597481,9.3945698301732854,9.1476627704044695,8.9077175775692581,8.67450470418588,8.4478047711285633,8.2274079054859257,8.0131131380842593,7.8047278540313432,7.602067290487887,7.4049540766039135],[29.195931502316277,28.062656919501819,26.990302376241129,25.985243878110403,25.045691332854364,24.166405256170265,23.341295763421286,22.564519124510689,21.830854430272581,21.135775092519182,20.475403089680064,19.846426321950279,19.246011783489511,18.671726673955209,18.121470890346906,17.593420851237578,17.085983360425047,16.597757917995395,16.127505962755215,15.674125732549715,15.236631653621163,14.814137376357664,14.405841749980631,14.011017172041397,13.628999863537302,13.259181711689791,12.901003394492733,12.553948557981286,12.217538862034152,11.891329745999901,11.574906793575133,11.267882598753747,10.969894052553352,10.680599984570495,10.399679104969101,10.12682820184874,9.8617605565257591,9.6042045454456968,9.3539024025093482,9.1106091197570507,8.8740914677899099,8.6441271201509515,8.4205038682538493,8.2030189154190332,7.9914782402286288,7.7856960207985857,7.5854941127352511,7.3907015745318896,7.2011542349986524,7.0166942980321547],[27.159888223315381,26.050617213124109,25.023560026440336,24.078191747781062,23.206058063205028,22.397374653492275,21.643260638025669,20.936240647724485,20.270180720345838,19.640077369621725,19.041838273450672,18.472094002671486,17.92804680674567,17.407352289300093,16.908027646700532,16.428380561243529,15.966953911630412,15.522482541758741,15.093859231630356,14.68010771888342,14.280361152880721,13.893844761694881,13.519861808555063,13.157782134641197,12.807032749490098,12.467090053498374,12.137473369896522,11.817739534025165,11.50747834152649,11.206308698383509,10.913875347688084,10.629846072877072,10.353909296636861,10.085772010002852,9.8251579783202789,9.5718061804022128,9.3254694449639395,9.0859132546456181,8.8529146929768032,8.6262615137347609,8.4057513154943084,8.1911908069114787,7.9823951505436455,7.7791873748778437,7.5813978457911748,7.388863789960574,7.2014288638209809,7.0189427625792176,6.8412608645556023,6.6682439067716279],[25.131798811886977,24.065387016257883,23.104068613211986,22.235532010955215,21.443773053392963,20.714939289548763,20.038111168233527,19.404874318432995,18.808740303678224,18.244658273203999,17.708646114368552,17.197521009245222,16.708703978617216,16.24007755450598,15.789881253061179,15.356633998595946,14.939075903518116,14.536124083582393,14.146838758448174,13.770396971223079,13.406072012230757,13.053217157612185,12.71125270407021,12.379655545241944,12.057950725348284,11.745704544028396,11.442518887763967,11.148026538508709,10.86188726637063,10.583784555599731,10.313422845372839,10.050525191569495,9.7948312747997477,9.546095694766711,9.3040865026455659,9.0685839322955299,8.8393792983596295,8.6162740350754845,8.3990788542429016,8.1876130045182904,7.9817036172207887,7.781185126288146,7.5858987520252743,7.3956920399340511,7.2104184472699089,7.0299369710936741,6.8541118125203777,6.6828120726451639,6.5159114762778048,6.3532881201647813],[23.119516164154732,22.120240186271403,21.245632220006623,20.469010705353469,19.767647500884213,19.124914971619042,18.528935057490727,17.971149253154127,17.445278679322122,16.946622310069724,16.471588801289982,16.017381514414851,15.581783342346071,15.163007146221332,14.759589971294655,14.370316967670126,13.99416581023589,13.630265498372527,13.277865400214555,12.936311702044513,12.60502928320226,12.283507616348404,11.971289689316626,11.667963219828177,11.373153627745427,11.086518367263146,10.807742320671434,10.536534027625905,10.272622577090409,10.015755028690851,9.7656942599114807,9.522217158037785,9.2851130928975678,9.0541826196376576,8.8292363709862904,8.6100941064162519,8.3965838918763502,8.1885413886974128,7.9858092342024536,7.7882364996857127,7.595678213942894,7.4079949425674805,7.2250524148768482,7.046721191675104,6.8728763681594707,6.7033973071807429,6.5381673988141209,6.3770738428147924,6.2200074510462811,6.0668624673984253],[21.13445991800716,20.229734833799711,19.461045098029309,18.78813246838099,18.183823134761415,17.630481825994671,17.116451547464365,16.633794527932025,16.176938761765609,15.741860267006592,15.325576732013104,14.925825138521208,14.540850891862993,14.169266394021777,13.809954009462274,13.461998108484156,13.124636585414249,12.797225687354699,12.479214109616887,12.170123651646295,11.869534589088623,11.577074483829037,11.292409532514705,11.015237811566692,10.745283954474612,10.482294921667414,10.226036611584497,9.9762911250077924,9.7328545407901466,9.4955350949340271,9.264151680043053,9.0385326009219042,8.8185145362507793,8.6039416670244862,8.3946649406967691,8.1905414463396227,7.9914338810775503,7.7972100919288172,7.6077426802322483,7.4229086582498649,7.2425891494537327,7.0666691255402947,6.8950371744485137,6.7275852946538368,6.5642087118176757,6.4048057145297079,6.2492775064179815,6.0975280723434295,5.9494640567588535,5.8049946526131624],[19.191213064298896,18.408430901328241,17.761229503799495,17.199874370021902,16.695904118161081,16.232561000034977,15.799505425697671,15.390067684078456,14.999773634677211,14.625517592059726,14.265077697279329,13.916820695403482,13.57951585838498,13.252214163746299,12.934167781604435,12.624775187371229,12.323542986025602,12.030058883898381,11.743972247789868,11.46497992221135,11.192815750085174,10.9272427402865,10.668047152036355,10.415033984237828,10.168023505860669,9.9268485654564831,9.6913524891197866,9.461387426605409,9.2368130413849716,9.0174954665279259,8.8033064673717352,8.5941227660226822,8.3898254932051319,8.1902997408381211,7.9954341946609597,7.8051208307545279,7.6192546632730034,7.4377335333757548,7.260457931423602,7.0873308461222644,6.9182576355642036,6.7531459161194984,6.5919054659171259,6.4344481402861753,6.2806877970278094,6.1305402297900553,5.9839231081398037,5.8407559231863786,5.7009599378209579,5.5644581408064608],[17.30644624667239,16.669708367270641,16.154717736179055,15.708684314288998,15.305246425703206,14.93023654372529,14.575526374799068,14.236198618848611,13.909147542835745,13.592339930409603,13.284402902895387,12.984383371079641,12.691602230058441,12.405563123005463,12.125893795018619,11.852307526206722,11.584577273278331,11.322518044761431,11.065974720490267,10.814813535682141,10.568916070444956,10.32817497571976,10.092490917065772,9.8617703813960311,9.6359241005892002,9.41486591933967,9.1985119848508212,8.9867801707823727,8.779589672250129,8.5768607259408771,8.3785144217430521,8.1844725811861885,7.9946576844411039,7.8089928323573181,7.6274017334915127,7.4498087086545404,7.2761387074188439,7.1063173324579978,6.9402708686615542,6.7779263147742537,6.6192114159150188,6.4640546957889189,6.3123854877503653,6.1641339641358801,6.0192311634807325,5.877609015380278,5.7392003628664678,5.6039389822510399,5.471759600446112,5.3425979098158667],[15.497430598407856,15.024857464525088,14.647449844330492,14.316671927375292,14.011319984567834,13.721166669641402,13.440927557431117,13.167746586963275,12.900039774942634,12.636921351128521,12.377901514567727,12.122719668560345,11.87124900236376,11.623440349858065,11.379288472489556,11.138811533850385,10.90203852661131,10.669001588382397,10.439731369124358,10.214254324002896,9.9925912288083971,9.7747564725363638,9.5607578414111689,9.3505966093528592,9.1442678143380309,8.9417606418638318,8.7430588640591669,8.5481413010309293,8.3569822830171372,8.1695520999105646,7.9858174300531735,7.8057417437599774,7.6292856793903425,7.4564073913332347,7.2870628702703586,7.1212062367046851,6.9587900091122572,6.79976534827422,6.6440822794309469,6.4916898939098786,6.342536531839774,6.1965699474953748,6.0537374587303532,5.9139860818614096,5.7772626532684281,5.6435139388783728,5.5126867326063316,5.3847279447378504,5.2595846811523472,5.1372043142093888],[13.780473567147144,13.482511059296588,13.242820029360772,13.023910687254666,12.812086009056603,12.601954603133397,12.391435897805213,12.179878169077476,11.967268892836916,11.753877982287447,11.540088647317067,11.326315174283089,11.112962997276874,10.900410063966726,10.68899914374115,10.479035786085541,10.270789150647181,10.0644942243232,9.860354626045897,9.6585455710331143,9.4592167703674157,9.2624951550021102,9.0684873761473099,8.8772820685156297,8.688951881355873,8.5035552914984791,8.3211382167376122,8.1417354490722609,7.9653719269491408,7.7920638644653621,7.6218197539427424,7.4546412566311275,7.2905239946725198,7.1294582559339519,6.9714296219266076,6.8164195277819699,6.6644057621507944,6.5153629139180849,6.3692627717755927,6.2260746819499033,6.0857658687360416,5.9483017219223298,5.8136460547011541,5.6817613352322365,5.5526088946525878,5.4261491140020848,5.302341592249638,5.1811452973569487,5.0625187020993909,4.9464199061730225],[12.169568801912515,12.04841032010993,11.941894636038356,11.828788638115853,11.704354241272465,11.568466240046092,11.422356510002967,11.267577883852603,11.105653920989361,10.937965729284048,10.765725681418433,10.589983084534975,10.411640567521136,10.231472808472354,10.050144384262778,9.8682256513805218,9.6862064433861814,9.5045077148881401,9.3234913780625224,9.1434685972404655,8.9647067881446727,8.7874355366862904,8.6118516188928229,8.4381232729433826,8.2663938478599199,8.0967849312647893,7.92939904036764,7.7643219454313614,7.6016246828259515,7.44136530490524,7.2835904059061445,7.1283364565188263,6.975630974420838,6.8254935536774699,6.6779367722982501,6.5329669942571309,6.3905850798128627,6.2507870159111079,6.1135644767344166,5.9789053230296965,5.8467940476348206,5.7172121736072556,5.5901386104954138,5.4655499735608952,5.3434208701362351,5.2237241567695278,5.1064311703503877,4.9915119360190108,4.8789353543214382,4.7686693697814277],[10.675443046263961,10.725447150799678,10.743731110953266,10.728364060278036,10.684101148661934,10.616092117050009,10.528778448348007,10.425803676827121,10.310126859377212,10.184156780624489,10.049866897121106,9.9088861849694059,9.7625692845726419,9.6120504723684146,9.4582853782093377,9.3020834872298668,9.1441336963974607,8.9850246023401787,8.8252607582592564,8.6652758183147114,8.5054432559882169,8.3460851740343429,8.1874795998348251,8.029866568512503,7.8734532280141076,7.7184181491459354,7.5649149847032442,7.4130755921285552,7.2630127112275868,7.1148222706678812,6.9685853830421634,6.8243700772796725,6.6822328084523122,6.542219778037782,6.4043680920821844,6.268706780156597,6.1352576943005017,6.0040363041158162,5.8750524016836305,5.748310727916718,5.623811530250431,5.5015510601484019,5.3815220177045084,5.2637139496175145,5.148113605966226,5.034705260493884,4.9234709984985923,4.8143909759047734,4.7074436526434162,4.6026060030849498],[9.3050637727471255,9.5139071065419714,9.645741277315512,9.7186986366962955,9.7467411733489442,9.7399568967390238,9.7057306354473223,9.6495985428845259,9.5758083072109947,9.4876861794593861,9.3878826502255599,9.27854119259068,9.1614171205072878,9.0379632752258434,8.9093931042066572,8.7767279760943993,8.6408332716898109,8.5024463304654532,8.3621983848786883,8.2206319868607807,8.0782150062795051,7.9353519887052197,7.7923934548873284,7.6496435784957795,7.5073665733600574,7.3657920443619114,7.2251194990305239,7.0855221740893519,6.9471502987842042,6.8101338920201782,6.6745851711846678,6.5406006356185173,6.4082628759860407,6.277642151529288,6.1487977698083975,6.0217792976066731,5.8966276268969011,5.7733759158812505,5.6520504219441863,5.5326712407524123,5.4152529635846909,5.2998052631904784,5.1863334169895889,5.0748387751805364,4.9653191802796179,4.8577693437299754,4.7521811844722972,4.6485441337333455,4.5468454097459636,4.447070265650189],[8.0615759826720677,8.4118363419052926,8.6440579189173583,8.7951529993888364,8.8873500589725083,8.9350823211219037,8.9482968575355137,8.934167969447028,8.8980555677623805,8.8440769630909539,8.7754664815756804,8.6948116728614036,8.6042141761257689,8.5054026737628234,8.3998142998245147,8.2886546498931786,8.1729428941333921,8.0535462815752314,7.9312069363437256,7.8065629526632847,7.6801652051559,7.5524908924335312,7.4239545575597816,7.2949171365638783,7.165693449093939,7.0365584461410648,6.9077524570666595,6.7794856241921071,6.6519416726732929,6.525281132609333,6.3996441067410297,6.2751526588369124,6.1519128836136074,6.0300167078240294,5.9095434632563979,5.7905612652881668,5.6731282249327499,5.5572935177008835,5.443098328842213,5.3305766914590338,5.2197562314550172,5.110658831190892,5.0033012219816353,4.8976955141196132,4.7938496718926054,4.6917679400423662,4.5914512272446757,4.4928974514582958,4.3961018513657866,4.3010572675955707],[6.944578674611158,7.4154670773296338,7.7338778524945404,7.952638235854927,8.100843267420597,8.1965105532961893,8.2516979444482814,8.2749312072593852,8.272490526480194,8.249150201197935,8.2086314648919299,8.1538938360840696,8.0873303283178277,8.0109027187619972,7.9262379797495299,7.8346987129731609,7.7374356866697553,7.635427748594374,7.5295126419459812,7.420411140978997,7.3087461977986496,7.1950583069431477,7.0798179632823199,6.9634358584061493,6.8462712976343632,6.7286392025723414,6.6108159786772838,6.4930444641668297,6.3755381294032141,6.2584846602051716,6.1420490312880309,6.0263761550190003,5.9115931743267156,5.7978114557797706,5.6851283287104089,5.5736286081852837,5.4633859331511294,5.3544639458582628,5.2469173344221467,5.1407927569189429,5.036129662565699,4.9329610231880654,4.8313139862307617,4.7312104589431119,4.6326676320137548,4.5356984497868664,4.4403120332287092,4.3465140609971016,4.2543071132723496,4.1636909824159609],[5.9506290644125244,6.5196515320079946,6.9097661028800417,7.1858226285597091,7.3821145029213255,7.5193947793790699,7.6113481557150724,7.6675528124436312,7.6950128916746454,7.6990246013144983,7.6836995710033023,7.6522981724082193,7.6074510235759636,7.5513114444297589,7.4856635277962571,7.412000697271381,7.331584063057889,7.2454865975391396,7.1546271362058267,7.059796935058932,6.9616806877742521,6.8608733550953982,6.7578937844554634,6.6531958382833691,6.547177566388406,6.4401888266327569,6.3325376627225616,6.2244956776743878,6.1163025891017808,6.0081701129320768,5.9002852920309294,5.7928133630206711,5.6859002365682842,5.5796746523136065,5.4742500584740421,5.3697262573077262,5.2661908505269821,5.1637205130388573,5.0623821187547531,4.9622337384304176,4.8633255263961779,4.7657005104803565,4.669395297309805,4.5744407034074364,4.4808623210313279,4.388681026461045,4.2979134373918111,4.2085723252128675,4.1206669871946131,4.0342035829683578],[5.073866288129949,5.7182699883278687,6.1659142547997732,6.4892963249183797,6.7261401048009031,6.8990633710222529,7.0228916380334638,7.1079595478238708,7.1618030317972732,7.1901090954783573,7.1972867185983649,7.1868289401179606,7.1615526637628566,7.1237632477167203,7.0753709028602731,7.0179751345886814,6.9529273617787144,6.8813782491314566,6.8043140906589183,6.7225851958932941,6.6369283320359544,6.5479846787125062,6.4563143471675346,6.3624082355915164,6.26669779496868,6.1695631386321033,6.0713398261717977,5.9723245768750557,5.8727801116496083,5.7729392800070372,5.6730085964149035,5.5731712855107824,5.4735899164141815,5.3744086913010047,5.2757554415160408,5.1777433750500821,5.080472611646198,4.9840315357078149,4.888497992242935,4.7939403470527626,4.700418429071533,4.6079843700438072,4.5166833544717253,4.426554290889098,4.3376304139513699,4.2499398255140015,4.163505981762059,4.0783481325147077,3.9944817180304746,3.91191872795897],[4.3066650631988956,5.0045923247215391,5.4963518518241248,5.8576984531121727,6.128055059764991,6.3310631108995814,6.4822237353577563,6.5923466033265612,6.6693175852662101,6.7190908840758272,6.746285381317163,6.7545628600017036,6.7468784995839766,6.7256528047934072,6.6928931967992682,6.6502822248593887,6.5992429832676205,6.5409885608328207,6.4765600537653079,6.4068562249422714,6.3326569541707824,6.2546420009638988,6.1734061784941545,6.0894717447793454,6.003298611070373,5.9152928199236117,5.825813638335438,5.7351795324906725,5.6436732319445522,5.5515460467981237,5.4590215677208453,5.3662988527537916,5.2735551847115527,5.1809484672582764,5.0886193153141654,4.9966928855786437,4.9052804850572294,4.8144809891155118,4.7243820954250442,4.6350614359601767,4.5465875657561181,4.4590208442963402,4.3724142230431298,4.2868139506655876,4.2022602058814318,4.118787666453656,4.0364260217236065,3.955200435080978,3.8751319619375573,3.7962379280610787],[3.6402544240854624,4.3715830687851263,4.8951133651606291,5.2858119425378245,5.5832059599067989,5.8111861317732068,5.9855009786455895,6.1171761810798486,6.2142802036465348,6.2829207167114642,6.3278460452163099,6.3528279062994315,6.3609155880246089,6.3546108044463292,6.3359915954258508,6.3068023627536327,6.2685207369613725,6.2224081873953452,6.1695489715682319,6.1108805561896915,6.0472176920356189,5.9792716928103866,5.9076660386508273,5.8329491273229781,5.7556047863202089,5.6760610087348953,5.594697266496425,5.5118506740698052,5.4278212156818508,5.3428762038713691,5.2572541026598296,5.171167822090597,5.0848075702694517,4.9983433328960727,4.9119270375339168,4.8256944497344501,4.7397668400189392,4.6542524541826777,4.569247814084032,4.4848388717557039,4.4011020361279423,4.3181050887284851,4.2359080023005005,4.1545636742617642,4.0741185852412105,3.9946133915116988,3.9160834589428086,3.8385593450859332,3.762067235144237,3.6866293368470697],[3.0652609262340249,3.8121477181631072,4.3563653035940746,4.7686313747000373,5.0871856122793133,5.3354844072314087,5.5291427743948987,5.6791707635619666,5.7936691671042695,5.8787966759975312,5.9393583979357647,5.9791827630610381,6.0013731284284031,6.0084816061185435,6.0026326816731483,5.9856133241898295,5.9589400877522216,5.9239100184870948,5.8816399139072155,5.8330970428898388,5.7791234976234653,5.7204557237491667,5.6577403489518439,5.5915471343890717,5.5223796642625063,5.4506842387454864,5.3768573261797865,5.3012518498060412,5.2241825240603692,5.1459304099807195,5.0667468245542482,4.9868567120926324,4.9064615649313899,4.8257419644509838,4.7448598005405769,4.6639602173765287,4.5831733251744042,4.5026157109480867,4.422391775932585,4.342594922938126,4.2633086133003557,4.1846073101193397,4.1065573220155063,4.0292175595777211,3.9526402149609816,3.876871373647691,3.8019515661686119,3.7279162665481409,3.6547963433616446,3.582618468544486],[2.5721561809042282,3.3193231286789597,3.8744989580041498,4.3014088631856904,4.6358533237498012,4.9002749037068156,5.1098271446403238,5.2753028122597865,5.4047031401713923,5.5041473526088946,5.5784328363086644,5.6313972921625979,5.6661623310043634,5.685302821919441,5.6909679560635702,5.6849698879707606,5.6688499967483184,5.6439293238987895,5.6113475853071302,5.5720937774192052,5.5270304956630074,5.4769134787372922,5.4224074788738053,5.3640992699374532,5.3025084008823615,5.2380961549649676,5.1712730676980172,5.1024052770796722,5.0318199201640805,4.9598097450363348,4.8866370728486208,4.8125372180195383,4.7377214540216253,4.6623795959487024,4.5866822582108906,4.5107828354692048,4.4348192467084768,4.3589154757145518,4.2831829358325511,4.207721682479665,4.132621493267612,4.0579628326023691,3.9838177151492453,3.9102504804839882,3.8373184895198307,3.765072751844373,3.6935584918711797,3.6228156606692541,3.552879399447253,3.4837804599128748],[2.1516039339802173,2.8864177211345048,3.4441944523376389,3.8796824312482947,4.2253442183622649,4.5021378752905115,4.7244823314416067,4.9027822007360875,5.0448259815611944,5.1566150238970483,5.2428826699384974,5.3074342063932534,5.3533778659899767,5.3832867558867363,5.3993154165495234,5.4032856621916219,5.3967510685736793,5.3810462732193258,5.3573252518532195,5.3265914479173526,5.2897217835125643,5.2474860080715127,5.2005624476175356,5.1495509419067833,5.0949835605665488,5.0373335475611132,4.9770228394355502,4.9144284257111579,4.8498877619482279,4.7837034020905342,4.7161469830606464,4.6474626685489406,4.5778701386314715,4.5075671958774306,4.4367320459448765,4.3655253005556558,4.29409174261676,4.222561886685444,4.1510533626296819,4.0796721459619256,4.008513654725836,3.9376637298410277,3.8671995133393957,3.7971902368636803,3.7276979310701397,3.6587780651215551,3.5904801242268265,3.5228481321401364,3.455921124644159,3.3897335792829644],[1.7947121859283754,2.507108664031275,3.0604614954394229,3.4992907461951361,3.8520703343593592,4.137910255688789,4.3702756480326723,4.5590423442166017,4.7116912567056097,4.8340392475453111,4.9307072506521923,5.0054320372509249,5.0612808740076609,5.1008035957922093,5.1261430262567425,5.1391168916677215,5.1412797406195629,5.1339705336798529,5.1183497633638879,5.095428792554423,5.066093319511543,5.0311223476243496,4.991203671003138,4.9469466283739232,4.8988926926004428,4.8475243287113807,4.7932724543725671,4.7365227630440963,4.677621114539523,4.6168781554365497,4.5545732992969024,4.490958171449603,4.4262596033752102,4.360682246182324,4.294410860317547,4.2276123287709426,4.1604374330838461,4.0930224250204583,4.0254904215114609,3.9579526461728771,3.8905095371565248,3.8232517381518507,3.7562609869159136,3.6896109136666011,3.6233677599609209,3.5575910272361817,3.4923340629702246,3.4276445913797065,3.3635651946911844,3.3001337502638255],[1.4932018323699641,2.1755035349429477,2.7186616998838531,3.1563774570228631,3.5127157123343107,3.8046756678280094,4.0446006185741368,4.2417257263153481,4.4031469044854283,4.5344411365402362,4.6400761544976312,4.7236894177577433,4.7882834762878304,4.8363662332102626,4.8700538962142303,4.8911480359374426,4.9011942749778017,4.9015276849521756,4.8933083931811066,4.8775498616698965,4.8551416014947559,4.8268676054624917,4.7934214463647731,4.7554187498798282,4.7134075794546169,4.667877145040948,4.6192651547356105,4.5679640588921195,4.5143263836957921,4.4586693110089293,4.4012786302890676,4.3424121642534468,4.2823027510275065,4.2211608505425673,4.1591768310219868,4.0965229818316029,4.0333552912520076,3.9698150214630004,3.9060301079126125,3.8421164060409803,3.7781788048610383,3.714312224021854,3.6506025085837419,3.5871272337285314,3.5239564299427037,3.4611532377885883,3.3987745001737881,3.3368712990046285,3.2754894422352319,3.2146699065755104],[1.2395060078118867,1.8861736370183007,2.4145166940447069,2.8473878086902502,3.2042272290487777,3.499752219946858,3.74506318226085,3.9486693247639639,4.1172203637870659,4.2560084775123048,4.3693144716186847,4.4606506553959768,4.5329346990769013,4.588616579925989,4.6297730159433392,4.6581789239950293,4.6753623390878563,4.6826472219831263,4.6811872557978633,4.67199284039072,4.6559528830648205,4.6338525595142741,4.6063879188604258,4.5741779914367706,4.5377749015637816,4.4976723724139882,4.4543129243088542,4.4080940032125717,4.3593732270627248,4.3084728998483781,4.2556839141097811,4.2012691396877111,4.1454663785574892,4.0884909513066283,4.0305379694088499,3.9717843382742846,3.9123905286323124,3.8525021477613057,3.7922513371333593,3.7317580189725383,3.6711310108592148,3.610469024716465,3.5498615641800466,3.4893897323961336,3.4291269606438317,3.3691396667868472,3.3094878513776975,3.2502256382322163,3.1914017654329738,3.1330600319838608],[1.0268147457576493,1.634165439455999,2.1441055915436511,2.5690596946133528,2.9238025499811684,3.2206789754272833,3.4694675309451757,3.677890287919972,3.8521043584006538,3.9970817804083563,4.1168892108834019,4.214892541868311,4.2939077139560293,4.3563132486825218,4.4041353746464953,4.4391133096907458,4.4627499852115937,4.4763519460306131,4.4810610955796504,4.4778802204754617,4.4676937137603998,4.4512845513276629,4.4293483143472061,4.402504860437559,4.3713081066548645,4.3362542835792262,4.2977889418321125,4.2563129332351251,4.2121875435502742,4.1657389187710923,4.1172618996918677,4.0670233580940183,4.0152651109699971,3.9622064757288591,3.9080465185208624,3.8529660390985163,3.7971293285530221,3.7406857304866454,3.683771031439,3.6265087024731772,3.5690110105846253,3.5113800158951736,3.4537084683357944,3.3960806156241601,3.3385729327431437,3.2812547817716728,3.2241890097682924,3.1674324914264029,3.1110366223804067,3.0550477683211352],[0.84907858125582258,1.4149957260470201,1.9038547516129043,2.3184108663666088,2.6688762605120555,2.9652017604672842,3.2158019903043122,3.4275721012569491,3.6061434607368774,3.7561412954567963,3.8813967940307856,3.985112329633667,4.069988290997844,4.138320470827658,4.1920753276502616,4.2329486694381462,4.2624118611024899,4.281748569886008,4.2920842684320473,4.2944101408644784,4.2896026216116576,4.2784394945116926,4.2616132583761495,4.2397423016593541,4.2133803069871689,4.1830242146187624,4.1491210043427218,4.1120735020567238,4.0722453761793584,4.0299654570670329,3.9855314875432422,3.9392133928551472,3.8912561426365677,3.8418822648631057,3.7912940616439137,3.7396755684793881,3.6871942919214455,3.6340027550916285,3.5802398759993981,3.5260321998700737,3.4714950035887679,3.4167332877766508,3.3618426698440698,3.3069101895369366,3.25201503694807,3.1972292116546717,3.142618120527668,3.0882411208059999,3.0341520142122484,2.9803994971842105],[0.70098297301251922,1.2246351092249474,1.6905221938125514,2.0927236459473963,2.4371049820999282,2.7312587984859817,2.9822252329087648,3.19605139925015,3.3778214985711559,3.5317949975249716,3.6615515936143321,3.7701167964067785,3.8600643619470443,3.9335981306639596,3.9926170754296555,4.0387671007612864,4.0734825044062637,4.0980193859678096,4.1134827629017412,4.1208487425091906,4.1209827837406481,4.1146548443815592,4.1025520292954116,4.0852892192896704,4.0634180567341458,4.0374345850091542,4.007785778058305,3.9748751492421306,3.9390675919895921,3.9006935759434418,3.8600527995438583,3.8174173819072887,3.7730346623878548,3.727129664565636,3.6799072719824966,3.6315541552778874,3.5822404841037923,3.5321214520404376,3.4813386384731548,3.430021227854545,3.3782871038276325,3.3262438332177107,3.273989552825828,3.2216137702060075,3.1691980881255488,3.116816861147095,3.0645377916959013,3.0124224720557051,2.9605268779464593,2.908901818656989],[0.5779033745770974,1.0594836816208169,1.501178533644862,1.8895281765346281,2.2263520769286025,2.5169665237634034,2.7670530192413745,2.9818055162638011,3.1657498289908448,3.3227675138494526,3.4561754567408656,3.5688123154550544,3.6631165940479393,3.7411928049439664,3.8048661351723405,3.8557271959144899,3.8951685913762111,3.9244148657991635,3.94454712836004,3.9565234051927112,3.9611955534945729,3.9593233986193805,3.9515866170176857,3.9385947795942187,3.9208958854308378,3.898983649701429,3.8733037578189666,3.8442592571491279,3.8122152254854482,3.7775028299808726,3.7404228698939175,3.7012488802041892,3.6602298600133465,3.617592679004995,3.5735442065724565,3.5282732011347613,3.4819519913341264,3.4347379759959948,3.3867749657409609,3.3381943858126468,3.289116356903687,3.2396506684258308,3.1898976567005652,3.1399489988798033,3.0898884319910556,3.0397924052953482,2.9897306731151252,2.9397668344051944,2.889958824579085,2.8403593644468907],[0.47584873790344417,0.9163417787669097,1.3331858843093096,1.7065849954550787,2.0346723839119418,2.3206058215552297,2.5687455932828307,2.7834408249537921,2.9686564757488343,3.1278899554999482,3.2641881500660714,3.3801958497601863,3.4782098804726527,3.5602297051416523,3.6280016969582123,3.6830567791405704,3.7267420264886688,3.7602470766249985,3.7846261960654211,3.8008167528394781,3.8096547318118166,3.8118878182309679,3.8081864785966681,3.7991533874463155,3.7853314829349909,3.7672108810041687,3.7452348352808027,3.7198048956223726,3.6912853907381065,3.660007338196686,3.6262718672754,3.5903532256414623,3.5525014290930503,3.5129446039830996,3.4718910640733505,3.429531157082323,3.3860389108302629,3.3415735044343289,3.2962805862986464,3.2502934575412632,3.2037341368940773,3.1567143209155577,3.1093362514980369,3.0616935010742758,3.0138716845848914,2.9659491061207133,2.9179973471704495,2.87008180255871,2.8222621694303962,2.774592894007204],[0.39139936253393381,0.79237813589238026,1.184175820477078,1.5418675103175064,1.8602973030917083,2.1406088614051688,2.3858958075686134,2.5996818782634223,2.7853761071711149,2.9460906034240892,3.0845986589345538,3.2033467906572204,3.3044856596589378,3.3899054293362614,3.4612697679678082,3.520046409061421,3.5675337736450583,3.6048838158756871,3.6331214944511947,3.6531613297612804,3.6658214867129777,3.6718357743898133,3.6718638980878904,3.6665002462088463,3.6562814474981336,3.6416928940292603,3.6231743918165895,3.6011250732206008,3.5759076825143179,3.5478523272788145,3.5172597729577015,3.4844043453082647,3.4495364951279934,3.412885071093136,3.3746593394805435,3.3350507836825387,3.2942347115453394,3.2523716944866043,3.2096088589327598,3.1660810477455374,3.1219118668846644,3.0772146305033683,3.0320932159323912,2.9866428385250656,2.9409507550689402,2.8950969033835081,2.8491544847901822,2.8031904953362967,2.7572662109596062,2.7114376311772435],[0.32164339510425721,0.68509714297852708,1.0520272156418127,1.3935447983362872,1.7016204478298009,1.975546629387007,2.2172180145704887,2.4293613481894347,2.6148408192641952,2.7763863947546481,2.9164972736657013,3.0374195655281913,3.1411549826644904,3.2294814394344948,3.3039770185647184,3.3660435592544786,3.416928342018771,3.4577433771254507,3.4894822733062325,3.5130348638418978,3.5291998384820182,3.5386956404591219,3.5421698718230896,3.5402074240112293,3.5333375219484306,3.5220398426840474,3.5067498450945855,3.4878634259273396,3.4657409993429704,3.4407110818350217,3.4130734515942471,3.3831019406781992,3.3510469094061257,3.3171374449329716,3.2815833197136564,3.2445767403408685,3.2062939128516303,3.1668964469065797,3.1265326181319866,3.0853385052812627,3.0434390166390877,3.0009488181918549,2.9579731744680982,2.9146087115669661,2.8709441107047171,2.8270607395873881,2.783033228036818,2.7389299935357823,2.6948137216979182,2.650741806094798],[0.26411496292626158,0.59230642991647731,0.93484453705597392,1.2599650226640104,1.5571840092432252,1.8241172193259931,2.0615377336760448,2.2714107387433229,2.4560716809483623,2.6178751529500897,2.7590483978705418,2.8816369438932918,2.9874922545038531,3.0782781878393779,3.1554852535821976,3.2204474003412722,3.2743588504276531,3.3182898723835192,3.3532010629334197,3.3799560441974856,3.3993326396703418,3.4120326600169761,3.418690451677235,3.4198803607890413,3.4161232541551803,3.4078922241810909,3.3956175890949032,3.3796912848710177,3.3604707317832281,3.3382822466258233,3.3134240613458292,3.2861690000029995,3.2567668584537306,3.2254465247684023,3.1924178729771207,3.1578734581498531,3.121990036926046,3.0849299343059462,3.0468422747080237,3.0078640929057667,2.9681213384161276,2.9277297851667625,2.8867958567730674,2.8454173764704667,2.8036842496406242,2.7616790859144431,2.7194777670079375,2.6771499657299769,2.6347596209774484,2.5923653729903307],[0.21673588206243899,0.51208563703044963,0.83093700298851481,1.1396396617960818,1.4256659204506263,1.6851349092914676,1.9177820834456183,2.1248518401038217,2.3081709940795356,2.4697285053393294,2.6114840166881015,2.7352839763862979,2.8428295821116549,2.9356698254482998,3.015206440694655,3.0827041160035069,3.1393026035612994,3.1860290452277376,3.2238097041613649,3.2534807506797341,3.2757979888638715,3.2914455314467403,3.3010434885366173,3.3051547599472491,3.304291027281538,3.2989180391998403,3.2894602763006642,3.276305073363952,3.2598062677415163,3.2402874341290109,3.2180447581400684,3.1933495941398173,3.1664507466838026,3.1375765095974395,3.1069364921428946,3.0747232577712156,3.0411137975650315,3.0062708575652235,2.9703441366754175,2.9334713696915791,2.895779308158104,2.8573846101629714,2.8183946488142748,2.7789082479569087,2.7390163526640268,2.6988026411498525,2.6583440839788803,2.6177114557749714,2.5769698040480371,2.5361788792439763],[0.1777620850304058,0.44275693245270942,0.73879886797148586,1.0312286733669787,1.3058678656050082,1.5575200251268839,1.7849709552827751,1.9887888844617816,2.1703152191266541,2.3311854330622053,2.4730977664910236,2.5977025063383135,2.7065516679234394,2.8010794299881017,2.8825982354155224,2.9523026933589245,3.0112771216313758,3.0605045176507186,3.1008757934898323,3.1331986809796799,3.1582060254857192,3.1765633578947785,3.1888757262982272,3.1956938164923168,3.1975194131635822,3.1948102625034398,3.1879843982995819,3.1774239908927848,3.1634787738294108,3.1464690977484713,3.1266886556610975,3.1044069186480239,3.0798713162799025,3.0533091918179043,3.0249295584834357,2.9949246797728462,2.9634714938970887,2.9307328999048843,2.8968589208570195,2.8619877575180084,2.8262467443816699,2.7897532184156391,2.7526153096667225,2.7149326617883922,2.6767970896114313,2.6382931800592448,2.5994988419940235,2.5604858099548347,2.5213201062011223,2.4820624649949301],[0.14573532817548673,0.38285761356167436,0.65709099555364636,0.93352665733428131,1.1967041472989042,1.4402895753575287,1.6622088956657519,1.8624013604436342,2.0417485173073713,2.2015464007388843,2.3432395516071516,2.4682861988368421,2.5780911940005478,2.6739747001699739,2.7571599490951915,2.8287711351846232,2.8898365721928254,2.9412944207176865,2.9839994948722381,3.0187303282650637,3.0461960600017299,3.067042918388406,3.0818602035999483,3.0911857402129606,3.095510808744697,3.0952845852540305,3.0909181273169768,3.0827879478211502,3.071239217724123,3.0565886367914379,3.03912700831745,3.019121550489587,2.9968179736983962,2.9724423498938042,2.9462027971274418,2.9182909997361266,2.8888835822180718,2.8581433527193214,2.8262204301641281,2.7932532674062598,2.7593695813242167,2.7246871995095669,2.6893148320817515,2.6533527761856752,2.6168935598723988,2.5800225313128857,2.5428183986362236,2.5053537251054778,2.4676953838355833,2.429904975809694],[0.11944032456474418,0.33111496236016835,0.58462379848672441,0.84545004182037697,1.0971914032628938,1.3325486298132558,1.548677658497212,1.7449374414664724,1.9217768611086523,2.0801680161047731,2.2213106577136896,2.346476037057684,2.4569246471084272,2.5538640669931132,2.6384289123656499,2.7116730476765243,2.774568559139027,2.8280083653911436,2.8728106758547201,2.9097242684301108,2.9394339999507064,2.9625662218532298,2.979693926307303,2.9913415381872825,2.9979893210579771,3.000077395696108,2.9980093864880661,2.9921557197116178,2.9828566014998326,2.9704247042056555,2.955147589166204,2.9372898922616661,2.9170952966335597,2.8947883147472595,2.8705758998150115,2.8446489045286762,2.8171834031326841,2.7883418911164592,2.758274375225592,2.7271193650769758,2.695004776403723,2.6620487548387368,2.6283604281571771,2.5940405940242099,2.5591823495231019,2.5238716680574327,2.4881879286198432,2.4522044018885296,2.4159886971430566,2.3796031735756373],[0.097867168367030688,0.28642340302554681,0.52034156781786578,0.76602528461531261,1.006439147350549,1.2334824064084984,1.4436293860502039,1.6357079833244903,1.8097626670283251,1.966458173055095,2.1067593156336102,2.2317562403142075,2.3425685401784744,2.4402931787795286,2.525977191864178,2.6006045628780301,2.6650912293248128,2.720284715295298,2.7669663311480068,2.8058547213116363,2.8376100373986111,2.8628383108390878,2.8820957787371988,2.89589302572851,2.9046988709608401,2.9089439694643104,2.9090241211386973,2.9053032945110031,2.8981163801113161,2.8877716921594017,2.874553238742926,2.8587227807441273,2.8405216990292703,2.8201726882295826,2.7978812940461215,2.773837309548318,2.7482160444925223,2.7211794803118718,2.6928773221482132,2.6634479581221835,2.6330193349706805,2.6017097582195081,2.5696286241964579,2.5368770904191713,2.5035486902048039,2.4697298967364345,2.4355006412768057,2.4009347897359077,2.3661005813685323,2.3310610329950845],[0.080178739090844275,0.24782392419551957,0.46330817052775197,0.69437806198802532,0.92364109903490776,1.1423490257102689,1.3463803757400674,1.5340810472822684,1.7051199067766234,1.8598716348751259,1.9990766732011229,2.1236505625949205,2.2345759901507627,2.3328417212264494,2.4194086228357135,2.4951915596894576,2.5610506620226365,2.6177881278904902,2.666148261331557,2.706819354760678,2.740436567854089,2.7675852860970425,2.7888046458239462,2.8045910389952731,2.8154014898272157,2.8216568446606218,2.8237447471208577,2.8220223895093581,2.816819042768921,2.8084383739980621,2.7971605640932591,2.7832442397889183,2.7669282348655382,2.7484331950729994,2.7279630406699855,2.7057062996061765,2.681837323394439,2.6565173967134905,2.6298957507945699,2.6021104897063507,2.5732894377751152,2.543550915569182,2.5130044511388312,2.4817514325338754,2.4498857070171227,2.4174941318487027,2.3846570810284686,2.3514489119467683,2.3179383955024941,2.284189112897248],[0.065682672055164426,0.21448567071237945,0.41269406642105366,0.62972340195686938,0.84806725878705214,1.0584728904017235,1.2563053900158829,1.4394769066179407,1.6073096558594493,1.7599060177626935,1.897793136603342,2.0217189343514157,2.132533616328347,2.2311205379638084,2.318356124429501,2.395087151563275,2.4621185105618277,2.5202073346050247,2.5700609783861958,2.6123373043661902,2.6476463144943407,2.6765525268627126,2.6995777220443378,2.717203826001878,2.7298757868106347,2.7380043601531181,2.7419687554566474,2.7421191180928526,2.7387788379579128,2.732246684031439,2.7227987701313037,2.7106903603187709,2.696157524102579,2.6794186522950132,2.6606758444522547,2.6401161785275162,2.6179128728373362,2.5942263497935638,2.5692052101534042,2.5429871258312442,2.5156996586246883,2.4874610115501121,2.4583807188682147,2.4285602803112933,2.3980937445027459,2.3670682460838872,2.3355645006317309,2.3036572610611685,2.2714157388524607,2.2389039931274404],[0.05380743357998774,0.18568957284438858,0.36776457593057366,0.5713567098978718,0.77905668278907791,0.9812386458994915,1.1728324676493669,1.3513634966691299,1.5158360412759047,1.6660981379948492,1.8024750461130932,1.9255544139544849,2.0360587271006416,2.134769020848533,2.2224792682306402,2.2999694126704204,2.3679898691186994,2.4272531340150039,2.4784298132119496,2.5221473849995171,2.5589906348313853,2.5895030848895928,2.6141889860137368,2.6335155957665064,2.6479155672020798,2.6577893383685951,2.6635074552762772,2.6654127889560004,2.6638226254164565,2.6590306190851396,2.6513086078495474,2.640908292525137,2.6280627864127073,2.6129880422027489,2.5958841642621837,2.5769366145862538,2.5563173206073118,2.534185692752922,2.5106895592249066,2.4859660249871638,2.4601422614406832,2.4333362327549848,2.4056573643307857,2.3772071583990178,2.3480797613211148,2.3183624867473207,2.2881362984139133,2.2574762560161243,2.2264519272797463,2.1951277690690265],[0.044082028825405906,0.16081386004909315,0.32786931892353177,0.51864562902540934,0.71601090868727812,0.91008567873572099,1.0954381963060444,1.2692522708031957,1.4302425528934828,1.5780206891960367,1.7127216543860007,1.8347804185674592,1.9447967662434271,2.0434527425601399,2.1314620738577128,2.2095393175544933,2.2783813407864377,2.338656575246107,2.3909992032886747,2.4360064732647873,2.4742379897793745,2.5062162330202402,2.5324278223241241,2.5533252079099942,2.5693285848989391,2.5808278962633069,2.5881848393690117,2.5917348226958143,2.591788840569309,2.5886352478607262,2.5825414259468817,2.573755337329882,2.5625069702399914,2.5490096769912793,2.5334614113079206,2.5160458706166904,2.4969335496321583,2.4762827115991399,2.4542402834071324,2.4309426805263312,2.4065165673828424,2.3810795584257445,2.3547408647623502,2.3276018908650893,2.2997567854931442,2.2712929506297677,2.2422915119150391,2.2128277537554686,2.1829715220160271,2.15278759694674]],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"surface"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Stock price"},"yaxis":{"title":"T","zaxis":{"title":"Put price"}},"zaxis":{"title":[]}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"colorbar":{"title":"","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"x":[0,2.0408163265306123,4.0816326530612246,6.1224489795918373,8.1632653061224492,10.204081632653061,12.244897959183675,14.285714285714286,16.326530612244898,18.367346938775512,20.408163265306122,22.448979591836736,24.489795918367349,26.530612244897959,28.571428571428573,30.612244897959183,32.653061224489797,34.693877551020407,36.734693877551024,38.775510204081634,40.816326530612244,42.857142857142861,44.897959183673471,46.938775510204081,48.979591836734699,51.020408163265309,53.061224489795919,55.102040816326529,57.142857142857146,59.183673469387756,61.224489795918366,63.265306122448983,65.306122448979593,67.34693877551021,69.387755102040813,71.428571428571431,73.469387755102048,75.510204081632651,77.551020408163268,79.591836734693885,81.632653061224488,83.673469387755105,85.714285714285722,87.755102040816325,89.795918367346943,91.83673469387756,93.877551020408163,95.91836734693878,97.959183673469397,100],"y":[1,1.489795918367347,1.9795918367346939,2.4693877551020407,2.9591836734693877,3.4489795918367347,3.9387755102040813,4.4285714285714288,4.9183673469387754,5.408163265306122,5.8979591836734695,6.3877551020408161,6.8775510204081627,7.3673469387755102,7.8571428571428568,8.3469387755102034,8.8367346938775508,9.3265306122448983,9.816326530612244,10.306122448979592,10.795918367346939,11.285714285714285,11.775510204081632,12.26530612244898,12.755102040816325,13.244897959183673,13.73469387755102,14.224489795918368,14.714285714285714,15.204081632653061,15.693877551020408,16.183673469387756,16.673469387755102,17.163265306122447,17.653061224489797,18.142857142857142,18.632653061224488,19.122448979591837,19.612244897959183,20.102040816326529,20.591836734693878,21.081632653061224,21.571428571428569,22.061224489795919,22.551020408163264,23.04081632653061,23.530612244897959,24.020408163265305,24.510204081632651,25],"z":[[47.561471225035703,46.410847280607243,45.288059637861465,44.19243487113647,43.123315846522303,42.08006132772514,41.062045591466514,40.06865805218694,39.099302895828913,38.153398722479452,37.230378197658034,36.329687712040695,35.450787049416149,34.593149062674875,33.756259357636814,32.939615984527933,32.142729136920792,31.365120857958406,30.6063247536852,29.865885713313251,29.143359636255877,28.438313165764985,27.750323429012262,27.078977783458559,26.423873569359046,25.784617868255953,25.160827267313902,24.552127629356516,23.958153868466407,23.378549731013909,22.812967581983237,22.261068196467953,21.722520556210608,21.197001651064575,20.684196285259024,20.183796888350773,19.695503330749631,19.219022743706692,18.754069343657459,18.300364260814579,17.857635371907293,17.425617136967301,17.004050440063207,16.592682433887926,16.191266388105909,15.799561541369217,15.417332956913633,15.044351381648294,14.680393108654252,14.325239843009504],[45.520654898505093,44.370030954076633,43.247243311330905,42.151618544627887,41.082499521269142,40.039245025275399,39.021229488372491,38.027843012918019,37.058491867890801,36.112599443765504,35.189607408444736,34.288976697803321,33.410188037396587,32.55274184701954,31.716157535773082,30.899972302103777,30.103739601847693,29.327027450432723,28.569416701522314,27.830499409195127,27.109877344656365,26.407160707060193,25.721967043462186,25.053920375348557,24.402650517716474,23.767792570054045,23.148986555524559,22.545877184100995,21.958113716444146,21.385349907311479,20.82724400975183,20.283458823962452,19.753661777253431,19.237525023956508,18.734725556266039,18.244945318882479,17.767871321943517,17.30319574808788,16.850616050625057,16.40983504070708,15.98056096214259,15.562507553085171,15.155394094291546,14.758945444001439,14.372892059759602,13.996970007697229,13.630920959928833,13.274492180813375,12.927436502884525,12.58951229328245],[43.479838571974483,42.329214627557327,41.206426990339224,40.110802466165055,39.041686485087553,37.998450247470259,36.980503403755442,35.987306091706479,35.018373912213185,34.073274166026607,33.151615690544702,32.25303588008822,31.377187855670762,30.523729558738026,29.692315494144221,28.882591154506954,28.09418979123739,27.326731056925855,26.579821035083835,25.853053229269161,25.146010163148564,24.458265323770121,23.789385251832407,23.138931641457631,22.506463357820493,21.891538315448102,21.293715185097664,20.712554914838311,20.147622063070713,19.598485949161507,19.064721632292311,18.545910731902016,18.041642104391482,17.551512391046479,17.075126451766533,16.61209769841404,16.162048340594435,15.724609555564797,15.299421592824988,14.886133822825892,14.484404738164917,14.093901914649015,13.714301938699004,13.345290306748234,12.986561301552952,12.63781784967644,12.298771363828941,11.969141573234532,11.648656344747391,11.337051497047753],[41.439022245446822,40.288398317438762,39.165612089445055,38.070008487055986,37.001015984960034,35.958204737260296,34.94130123217618,33.950152130733606,32.9846647329015,32.044750343476821,31.130283026394586,30.241075588515248,29.376869685006383,28.537335723786786,27.722078722468073,26.930647244815312,26.162543486009866,25.417233315828412,24.694155611481111,23.99273055612208,23.312366792992176,22.652467450131233,22.012435117685357,21.391675890775883,20.789602600213975,20.205637350419263,19.639213474609459,19.089777005243686,18.556787744914033,18.039720010545459,17.53806311246823,17.051321619911381,16.579015455775863,16.120679856119459,15.675865223507564,15.244136898119576,14.825074866113072,14.418273421108175,14.023340791645925,13.639898744995261,13.267582175644959,12.906038685144626,12.554928158589806,12.213922341926931,11.882704423340916,11.560968621244662,11.248419780785548,10.944772980294324,10.649753148705919,10.363094694662829],[39.398205920915601,38.247583394454125,37.124837954043059,36.02953627970426,34.961636712680999,33.921449401280753,32.909437735762253,31.926021726755103,30.971456294564923,30.045783086835009,29.148830850380335,28.280240957379533,27.439502446814032,26.625987808066846,25.838985301245138,25.077726254611861,24.341407160513899,23.629207029377042,22.940300695851704,22.273868802268908,21.629105123368113,21.005221801322154,20.401452960375636,19.817057078937069,19.251318418459274,18.703547743595877,18.173082515812858,17.65928670108784,17.161550299673696,16.679288680419482,16.211941782357215,15.758973230960816,15.319869404682912,14.894138478297359,14.4813094626083,14.080931254751672,13.692571709241685,13.315816736814014,12.9502694357667,12.595549258727122,12.251291216444898,11.917145119224372,11.592774855886313,11.277857709625392,10.97208370976073,10.675155018124466,10.386785348669552,10.106699418781197,9.8346324307295543,9.5703295816912952],[37.357389764391911,36.206795976489758,35.084438349241225,33.990879009609046,32.927438539619146,31.89557318081166,30.896391257500337,29.930467781691092,28.997854849517857,28.09817509202103,27.230732773584695,26.394613988324817,25.58876714440845,24.812063644934916,24.063341782227944,23.34143747528481,22.645205132760456,21.973531302621861,21.325343151407893,20.699613293836805,20.095362083645391,19.511658167140812,18.947617872551593,18.402403841933118,17.87522319226926,17.365325406153694,16.872000090732165,16.394574699594088,15.932412281036481,15.484909293987286,15.051493517279908,14.631622067057457,14.224779529519363,13.830476211048216,13.448246504282672,13.077647366440541,12.718256904789119,12.369673063353666,12.031512404565495,11.703408979448527,11.385013280032215,11.075991267893366,10.776023473021635,10.484804157539786,10.202040539167349,9.9274520696783988,9.6607697639604364,9.4017355756249934,9.1501018154464173,8.9056306092119772],[35.316577708130005,34.166236336560623,33.045779526662237,31.958085476297992,30.906261814833552,29.892439006890097,28.91750702007602,27.981322078102494,27.083018680073231,26.221282724687182,25.394553203750256,24.60115931266396,23.839408837460553,23.107642555890877,22.404265906983376,21.727765863171769,21.076718381241164,20.449789995643783,19.845735883276568,19.263395905370885,18.701689589080296,18.159610655623212,17.636221469956382,17.130647636526202,16.642072868648402,16.169734197079634,15.712917544264254,15.270953666621352,14.843214452856252,14.429109558199396,14.028083350432041,13.639612142062733,13.263201683093765,12.898384889823433,12.544719786651985,12.201787639630169,11.869191262340717,11.546553476531166,11.233515711660177,10.929736729146406,10.634891458602851,10.348669934697421,10.070776324504877,9.8009280363128575,9.5388549018256228,9.2842984245821896,9.0370110881818668,8.7967557185994512,8.5633048954833146,8.3364404078718337],[33.275810030763857,32.12674381139216,31.012350754178385,29.938648445956893,28.909627106297336,27.926647914449202,26.989134145012837,26.095363780238635,25.243044141512996,24.42966932073,23.652724802733104,22.909796385094552,22.198622384768782,21.517113435945589,20.863354424440359,20.235597071702784,19.632248067965001,19.051855521374073,18.49309524188557,17.954757653630981,17.435735712382858,16.935013968671768,16.451658787199637,15.984809665257661,15.533671560765473,15.097508128846684,14.675635765408913,14.267418361636953,13.872262681508523,13.489614283618828,13.118953917762958,12.759794335359427,12.411677460662325,12.074171876723966,11.74687058624022,11.42938901278923,11.121363212634948,10.822448271289378,10.532316862490379,10.250657950230135,9.9771756170279406,9.7115880038405535,9.4536263488940726,9.203034114348478,8.9595661911079389,8.7229881732989458,8.4930756949828528,8.2696138225731346,8.0523964972104558,7.8412260220284331],[31.235314976575328,30.090635170232609,28.990639352143237,27.94335368303345,26.951329311304608,26.013340235931771,25.126289412388047,24.286391276413415,23.489784991625449,22.732817907206957,22.012156682780251,21.324813455218653,20.668132669744018,20.039761667435275,19.43761639115349,18.859847560616075,18.30480962386147,17.771033279051814,17.257201633736422,16.762129743741987,16.284747151440591,15.824083019881643,15.379253481713448,14.949450862658676,14.533934484938442,14.132022800028508,13.74308663974722,13.366543409070998,13.001852073307401,12.648508816787894,12.306043270674284,11.97401522441619,11.652011749418534,11.339644675074348,11.036548366912974,10.742377764561439,10.456806643811166,10.179526072564935,9.9102430350074648,9.6486792021597481,9.3945698301732854,9.1476627704044695,8.9077175775692581,8.67450470418588,8.4478047711285633,8.2274079054859257,8.0131131380842593,7.8047278540313432,7.602067290487887,7.4049540766039135],[29.195931502316277,28.062656919501819,26.990302376241129,25.985243878110403,25.045691332854364,24.166405256170265,23.341295763421286,22.564519124510689,21.830854430272581,21.135775092519182,20.475403089680064,19.846426321950279,19.246011783489511,18.671726673955209,18.121470890346906,17.593420851237578,17.085983360425047,16.597757917995395,16.127505962755215,15.674125732549715,15.236631653621163,14.814137376357664,14.405841749980631,14.011017172041397,13.628999863537302,13.259181711689791,12.901003394492733,12.553948557981286,12.217538862034152,11.891329745999901,11.574906793575133,11.267882598753747,10.969894052553352,10.680599984570495,10.399679104969101,10.12682820184874,9.8617605565257591,9.6042045454456968,9.3539024025093482,9.1106091197570507,8.8740914677899099,8.6441271201509515,8.4205038682538493,8.2030189154190332,7.9914782402286288,7.7856960207985857,7.5854941127352511,7.3907015745318896,7.2011542349986524,7.0166942980321547],[27.159888223315381,26.050617213124109,25.023560026440336,24.078191747781062,23.206058063205028,22.397374653492275,21.643260638025669,20.936240647724485,20.270180720345838,19.640077369621725,19.041838273450672,18.472094002671486,17.92804680674567,17.407352289300093,16.908027646700532,16.428380561243529,15.966953911630412,15.522482541758741,15.093859231630356,14.68010771888342,14.280361152880721,13.893844761694881,13.519861808555063,13.157782134641197,12.807032749490098,12.467090053498374,12.137473369896522,11.817739534025165,11.50747834152649,11.206308698383509,10.913875347688084,10.629846072877072,10.353909296636861,10.085772010002852,9.8251579783202789,9.5718061804022128,9.3254694449639395,9.0859132546456181,8.8529146929768032,8.6262615137347609,8.4057513154943084,8.1911908069114787,7.9823951505436455,7.7791873748778437,7.5813978457911748,7.388863789960574,7.2014288638209809,7.0189427625792176,6.8412608645556023,6.6682439067716279],[25.131798811886977,24.065387016257883,23.104068613211986,22.235532010955215,21.443773053392963,20.714939289548763,20.038111168233527,19.404874318432995,18.808740303678224,18.244658273203999,17.708646114368552,17.197521009245222,16.708703978617216,16.24007755450598,15.789881253061179,15.356633998595946,14.939075903518116,14.536124083582393,14.146838758448174,13.770396971223079,13.406072012230757,13.053217157612185,12.71125270407021,12.379655545241944,12.057950725348284,11.745704544028396,11.442518887763967,11.148026538508709,10.86188726637063,10.583784555599731,10.313422845372839,10.050525191569495,9.7948312747997477,9.546095694766711,9.3040865026455659,9.0685839322955299,8.8393792983596295,8.6162740350754845,8.3990788542429016,8.1876130045182904,7.9817036172207887,7.781185126288146,7.5858987520252743,7.3956920399340511,7.2104184472699089,7.0299369710936741,6.8541118125203777,6.6828120726451639,6.5159114762778048,6.3532881201647813],[23.119516164154732,22.120240186271403,21.245632220006623,20.469010705353469,19.767647500884213,19.124914971619042,18.528935057490727,17.971149253154127,17.445278679322122,16.946622310069724,16.471588801289982,16.017381514414851,15.581783342346071,15.163007146221332,14.759589971294655,14.370316967670126,13.99416581023589,13.630265498372527,13.277865400214555,12.936311702044513,12.60502928320226,12.283507616348404,11.971289689316626,11.667963219828177,11.373153627745427,11.086518367263146,10.807742320671434,10.536534027625905,10.272622577090409,10.015755028690851,9.7656942599114807,9.522217158037785,9.2851130928975678,9.0541826196376576,8.8292363709862904,8.6100941064162519,8.3965838918763502,8.1885413886974128,7.9858092342024536,7.7882364996857127,7.595678213942894,7.4079949425674805,7.2250524148768482,7.046721191675104,6.8728763681594707,6.7033973071807429,6.5381673988141209,6.3770738428147924,6.2200074510462811,6.0668624673984253],[21.13445991800716,20.229734833799711,19.461045098029309,18.78813246838099,18.183823134761415,17.630481825994671,17.116451547464365,16.633794527932025,16.176938761765609,15.741860267006592,15.325576732013104,14.925825138521208,14.540850891862993,14.169266394021777,13.809954009462274,13.461998108484156,13.124636585414249,12.797225687354699,12.479214109616887,12.170123651646295,11.869534589088623,11.577074483829037,11.292409532514705,11.015237811566692,10.745283954474612,10.482294921667414,10.226036611584497,9.9762911250077924,9.7328545407901466,9.4955350949340271,9.264151680043053,9.0385326009219042,8.8185145362507793,8.6039416670244862,8.3946649406967691,8.1905414463396227,7.9914338810775503,7.7972100919288172,7.6077426802322483,7.4229086582498649,7.2425891494537327,7.0666691255402947,6.8950371744485137,6.7275852946538368,6.5642087118176757,6.4048057145297079,6.2492775064179815,6.0975280723434295,5.9494640567588535,5.8049946526131624],[19.191213064298896,18.408430901328241,17.761229503799495,17.199874370021902,16.695904118161081,16.232561000034977,15.799505425697671,15.390067684078456,14.999773634677211,14.625517592059726,14.265077697279329,13.916820695403482,13.57951585838498,13.252214163746299,12.934167781604435,12.624775187371229,12.323542986025602,12.030058883898381,11.743972247789868,11.46497992221135,11.192815750085174,10.9272427402865,10.668047152036355,10.415033984237828,10.168023505860669,9.9268485654564831,9.6913524891197866,9.461387426605409,9.2368130413849716,9.0174954665279259,8.8033064673717352,8.5941227660226822,8.3898254932051319,8.1902997408381211,7.9954341946609597,7.8051208307545279,7.6192546632730034,7.4377335333757548,7.260457931423602,7.0873308461222644,6.9182576355642036,6.7531459161194984,6.5919054659171259,6.4344481402861753,6.2806877970278094,6.1305402297900553,5.9839231081398037,5.8407559231863786,5.7009599378209579,5.5644581408064608],[17.30644624667239,16.669708367270641,16.154717736179055,15.708684314288998,15.305246425703206,14.93023654372529,14.575526374799068,14.236198618848611,13.909147542835745,13.592339930409603,13.284402902895387,12.984383371079641,12.691602230058441,12.405563123005463,12.125893795018619,11.852307526206722,11.584577273278331,11.322518044761431,11.065974720490267,10.814813535682141,10.568916070444956,10.32817497571976,10.092490917065772,9.8617703813960311,9.6359241005892002,9.41486591933967,9.1985119848508212,8.9867801707823727,8.779589672250129,8.5768607259408771,8.3785144217430521,8.1844725811861885,7.9946576844411039,7.8089928323573181,7.6274017334915127,7.4498087086545404,7.2761387074188439,7.1063173324579978,6.9402708686615542,6.7779263147742537,6.6192114159150188,6.4640546957889189,6.3123854877503653,6.1641339641358801,6.0192311634807325,5.877609015380278,5.7392003628664678,5.6039389822510399,5.471759600446112,5.3425979098158667],[15.497430598407856,15.024857464525088,14.647449844330492,14.316671927375292,14.011319984567834,13.721166669641402,13.440927557431117,13.167746586963275,12.900039774942634,12.636921351128521,12.377901514567727,12.122719668560345,11.87124900236376,11.623440349858065,11.379288472489556,11.138811533850385,10.90203852661131,10.669001588382397,10.439731369124358,10.214254324002896,9.9925912288083971,9.7747564725363638,9.5607578414111689,9.3505966093528592,9.1442678143380309,8.9417606418638318,8.7430588640591669,8.5481413010309293,8.3569822830171372,8.1695520999105646,7.9858174300531735,7.8057417437599774,7.6292856793903425,7.4564073913332347,7.2870628702703586,7.1212062367046851,6.9587900091122572,6.79976534827422,6.6440822794309469,6.4916898939098786,6.342536531839774,6.1965699474953748,6.0537374587303532,5.9139860818614096,5.7772626532684281,5.6435139388783728,5.5126867326063316,5.3847279447378504,5.2595846811523472,5.1372043142093888],[13.780473567147144,13.482511059296588,13.242820029360772,13.023910687254666,12.812086009056603,12.601954603133397,12.391435897805213,12.179878169077476,11.967268892836916,11.753877982287447,11.540088647317067,11.326315174283089,11.112962997276874,10.900410063966726,10.68899914374115,10.479035786085541,10.270789150647181,10.0644942243232,9.860354626045897,9.6585455710331143,9.4592167703674157,9.2624951550021102,9.0684873761473099,8.8772820685156297,8.688951881355873,8.5035552914984791,8.3211382167376122,8.1417354490722609,7.9653719269491408,7.7920638644653621,7.6218197539427424,7.4546412566311275,7.2905239946725198,7.1294582559339519,6.9714296219266076,6.8164195277819699,6.6644057621507944,6.5153629139180849,6.3692627717755927,6.2260746819499033,6.0857658687360416,5.9483017219223298,5.8136460547011541,5.6817613352322365,5.5526088946525878,5.4261491140020848,5.302341592249638,5.1811452973569487,5.0625187020993909,4.9464199061730225],[12.169568801912515,12.04841032010993,11.941894636038356,11.828788638115853,11.704354241272465,11.568466240046092,11.422356510002967,11.267577883852603,11.105653920989361,10.937965729284048,10.765725681418433,10.589983084534975,10.411640567521136,10.231472808472354,10.050144384262778,9.8682256513805218,9.6862064433861814,9.5045077148881401,9.3234913780625224,9.1434685972404655,8.9647067881446727,8.7874355366862904,8.6118516188928229,8.4381232729433826,8.2663938478599199,8.0967849312647893,7.92939904036764,7.7643219454313614,7.6016246828259515,7.44136530490524,7.2835904059061445,7.1283364565188263,6.975630974420838,6.8254935536774699,6.6779367722982501,6.5329669942571309,6.3905850798128627,6.2507870159111079,6.1135644767344166,5.9789053230296965,5.8467940476348206,5.7172121736072556,5.5901386104954138,5.4655499735608952,5.3434208701362351,5.2237241567695278,5.1064311703503877,4.9915119360190108,4.8789353543214382,4.7686693697814277],[10.675443046263961,10.725447150799678,10.743731110953266,10.728364060278036,10.684101148661934,10.616092117050009,10.528778448348007,10.425803676827121,10.310126859377212,10.184156780624489,10.049866897121106,9.9088861849694059,9.7625692845726419,9.6120504723684146,9.4582853782093377,9.3020834872298668,9.1441336963974607,8.9850246023401787,8.8252607582592564,8.6652758183147114,8.5054432559882169,8.3460851740343429,8.1874795998348251,8.029866568512503,7.8734532280141076,7.7184181491459354,7.5649149847032442,7.4130755921285552,7.2630127112275868,7.1148222706678812,6.9685853830421634,6.8243700772796725,6.6822328084523122,6.542219778037782,6.4043680920821844,6.268706780156597,6.1352576943005017,6.0040363041158162,5.8750524016836305,5.748310727916718,5.623811530250431,5.5015510601484019,5.3815220177045084,5.2637139496175145,5.148113605966226,5.034705260493884,4.9234709984985923,4.8143909759047734,4.7074436526434162,4.6026060030849498],[9.3050637727471255,9.5139071065419714,9.645741277315512,9.7186986366962955,9.7467411733489442,9.7399568967390238,9.7057306354473223,9.6495985428845259,9.5758083072109947,9.4876861794593861,9.3878826502255599,9.27854119259068,9.1614171205072878,9.0379632752258434,8.9093931042066572,8.7767279760943993,8.6408332716898109,8.5024463304654532,8.3621983848786883,8.2206319868607807,8.0782150062795051,7.9353519887052197,7.7923934548873284,7.6496435784957795,7.5073665733600574,7.3657920443619114,7.2251194990305239,7.0855221740893519,6.9471502987842042,6.8101338920201782,6.6745851711846678,6.5406006356185173,6.4082628759860407,6.277642151529288,6.1487977698083975,6.0217792976066731,5.8966276268969011,5.7733759158812505,5.6520504219441863,5.5326712407524123,5.4152529635846909,5.2998052631904784,5.1863334169895889,5.0748387751805364,4.9653191802796179,4.8577693437299754,4.7521811844722972,4.6485441337333455,4.5468454097459636,4.447070265650189],[8.0615759826720677,8.4118363419052926,8.6440579189173583,8.7951529993888364,8.8873500589725083,8.9350823211219037,8.9482968575355137,8.934167969447028,8.8980555677623805,8.8440769630909539,8.7754664815756804,8.6948116728614036,8.6042141761257689,8.5054026737628234,8.3998142998245147,8.2886546498931786,8.1729428941333921,8.0535462815752314,7.9312069363437256,7.8065629526632847,7.6801652051559,7.5524908924335312,7.4239545575597816,7.2949171365638783,7.165693449093939,7.0365584461410648,6.9077524570666595,6.7794856241921071,6.6519416726732929,6.525281132609333,6.3996441067410297,6.2751526588369124,6.1519128836136074,6.0300167078240294,5.9095434632563979,5.7905612652881668,5.6731282249327499,5.5572935177008835,5.443098328842213,5.3305766914590338,5.2197562314550172,5.110658831190892,5.0033012219816353,4.8976955141196132,4.7938496718926054,4.6917679400423662,4.5914512272446757,4.4928974514582958,4.3961018513657866,4.3010572675955707],[6.944578674611158,7.4154670773296338,7.7338778524945404,7.952638235854927,8.100843267420597,8.1965105532961893,8.2516979444482814,8.2749312072593852,8.272490526480194,8.249150201197935,8.2086314648919299,8.1538938360840696,8.0873303283178277,8.0109027187619972,7.9262379797495299,7.8346987129731609,7.7374356866697553,7.635427748594374,7.5295126419459812,7.420411140978997,7.3087461977986496,7.1950583069431477,7.0798179632823199,6.9634358584061493,6.8462712976343632,6.7286392025723414,6.6108159786772838,6.4930444641668297,6.3755381294032141,6.2584846602051716,6.1420490312880309,6.0263761550190003,5.9115931743267156,5.7978114557797706,5.6851283287104089,5.5736286081852837,5.4633859331511294,5.3544639458582628,5.2469173344221467,5.1407927569189429,5.036129662565699,4.9329610231880654,4.8313139862307617,4.7312104589431119,4.6326676320137548,4.5356984497868664,4.4403120332287092,4.3465140609971016,4.2543071132723496,4.1636909824159609],[5.9506290644125244,6.5196515320079946,6.9097661028800417,7.1858226285597091,7.3821145029213255,7.5193947793790699,7.6113481557150724,7.6675528124436312,7.6950128916746454,7.6990246013144983,7.6836995710033023,7.6522981724082193,7.6074510235759636,7.5513114444297589,7.4856635277962571,7.412000697271381,7.331584063057889,7.2454865975391396,7.1546271362058267,7.059796935058932,6.9616806877742521,6.8608733550953982,6.7578937844554634,6.6531958382833691,6.547177566388406,6.4401888266327569,6.3325376627225616,6.2244956776743878,6.1163025891017808,6.0081701129320768,5.9002852920309294,5.7928133630206711,5.6859002365682842,5.5796746523136065,5.4742500584740421,5.3697262573077262,5.2661908505269821,5.1637205130388573,5.0623821187547531,4.9622337384304176,4.8633255263961779,4.7657005104803565,4.669395297309805,4.5744407034074364,4.4808623210313279,4.388681026461045,4.2979134373918111,4.2085723252128675,4.1206669871946131,4.0342035829683578],[5.073866288129949,5.7182699883278687,6.1659142547997732,6.4892963249183797,6.7261401048009031,6.8990633710222529,7.0228916380334638,7.1079595478238708,7.1618030317972732,7.1901090954783573,7.1972867185983649,7.1868289401179606,7.1615526637628566,7.1237632477167203,7.0753709028602731,7.0179751345886814,6.9529273617787144,6.8813782491314566,6.8043140906589183,6.7225851958932941,6.6369283320359544,6.5479846787125062,6.4563143471675346,6.3624082355915164,6.26669779496868,6.1695631386321033,6.0713398261717977,5.9723245768750557,5.8727801116496083,5.7729392800070372,5.6730085964149035,5.5731712855107824,5.4735899164141815,5.3744086913010047,5.2757554415160408,5.1777433750500821,5.080472611646198,4.9840315357078149,4.888497992242935,4.7939403470527626,4.700418429071533,4.6079843700438072,4.5166833544717253,4.426554290889098,4.3376304139513699,4.2499398255140015,4.163505981762059,4.0783481325147077,3.9944817180304746,3.91191872795897],[4.3066650631988956,5.0045923247215391,5.4963518518241248,5.8576984531121727,6.128055059764991,6.3310631108995814,6.4822237353577563,6.5923466033265612,6.6693175852662101,6.7190908840758272,6.746285381317163,6.7545628600017036,6.7468784995839766,6.7256528047934072,6.6928931967992682,6.6502822248593887,6.5992429832676205,6.5409885608328207,6.4765600537653079,6.4068562249422714,6.3326569541707824,6.2546420009638988,6.1734061784941545,6.0894717447793454,6.003298611070373,5.9152928199236117,5.825813638335438,5.7351795324906725,5.6436732319445522,5.5515460467981237,5.4590215677208453,5.3662988527537916,5.2735551847115527,5.1809484672582764,5.0886193153141654,4.9966928855786437,4.9052804850572294,4.8144809891155118,4.7243820954250442,4.6350614359601767,4.5465875657561181,4.4590208442963402,4.3724142230431298,4.2868139506655876,4.2022602058814318,4.118787666453656,4.0364260217236065,3.955200435080978,3.8751319619375573,3.7962379280610787],[3.6402544240854624,4.3715830687851263,4.8951133651606291,5.2858119425378245,5.5832059599067989,5.8111861317732068,5.9855009786455895,6.1171761810798486,6.2142802036465348,6.2829207167114642,6.3278460452163099,6.3528279062994315,6.3609155880246089,6.3546108044463292,6.3359915954258508,6.3068023627536327,6.2685207369613725,6.2224081873953452,6.1695489715682319,6.1108805561896915,6.0472176920356189,5.9792716928103866,5.9076660386508273,5.8329491273229781,5.7556047863202089,5.6760610087348953,5.594697266496425,5.5118506740698052,5.4278212156818508,5.3428762038713691,5.2572541026598296,5.171167822090597,5.0848075702694517,4.9983433328960727,4.9119270375339168,4.8256944497344501,4.7397668400189392,4.6542524541826777,4.569247814084032,4.4848388717557039,4.4011020361279423,4.3181050887284851,4.2359080023005005,4.1545636742617642,4.0741185852412105,3.9946133915116988,3.9160834589428086,3.8385593450859332,3.762067235144237,3.6866293368470697],[3.0652609262340249,3.8121477181631072,4.3563653035940746,4.7686313747000373,5.0871856122793133,5.3354844072314087,5.5291427743948987,5.6791707635619666,5.7936691671042695,5.8787966759975312,5.9393583979357647,5.9791827630610381,6.0013731284284031,6.0084816061185435,6.0026326816731483,5.9856133241898295,5.9589400877522216,5.9239100184870948,5.8816399139072155,5.8330970428898388,5.7791234976234653,5.7204557237491667,5.6577403489518439,5.5915471343890717,5.5223796642625063,5.4506842387454864,5.3768573261797865,5.3012518498060412,5.2241825240603692,5.1459304099807195,5.0667468245542482,4.9868567120926324,4.9064615649313899,4.8257419644509838,4.7448598005405769,4.6639602173765287,4.5831733251744042,4.5026157109480867,4.422391775932585,4.342594922938126,4.2633086133003557,4.1846073101193397,4.1065573220155063,4.0292175595777211,3.9526402149609816,3.876871373647691,3.8019515661686119,3.7279162665481409,3.6547963433616446,3.582618468544486],[2.5721561809042282,3.3193231286789597,3.8744989580041498,4.3014088631856904,4.6358533237498012,4.9002749037068156,5.1098271446403238,5.2753028122597865,5.4047031401713923,5.5041473526088946,5.5784328363086644,5.6313972921625979,5.6661623310043634,5.685302821919441,5.6909679560635702,5.6849698879707606,5.6688499967483184,5.6439293238987895,5.6113475853071302,5.5720937774192052,5.5270304956630074,5.4769134787372922,5.4224074788738053,5.3640992699374532,5.3025084008823615,5.2380961549649676,5.1712730676980172,5.1024052770796722,5.0318199201640805,4.9598097450363348,4.8866370728486208,4.8125372180195383,4.7377214540216253,4.6623795959487024,4.5866822582108906,4.5107828354692048,4.4348192467084768,4.3589154757145518,4.2831829358325511,4.207721682479665,4.132621493267612,4.0579628326023691,3.9838177151492453,3.9102504804839882,3.8373184895198307,3.765072751844373,3.6935584918711797,3.6228156606692541,3.552879399447253,3.4837804599128748],[2.1516039339802173,2.8864177211345048,3.4441944523376389,3.8796824312482947,4.2253442183622649,4.5021378752905115,4.7244823314416067,4.9027822007360875,5.0448259815611944,5.1566150238970483,5.2428826699384974,5.3074342063932534,5.3533778659899767,5.3832867558867363,5.3993154165495234,5.4032856621916219,5.3967510685736793,5.3810462732193258,5.3573252518532195,5.3265914479173526,5.2897217835125643,5.2474860080715127,5.2005624476175356,5.1495509419067833,5.0949835605665488,5.0373335475611132,4.9770228394355502,4.9144284257111579,4.8498877619482279,4.7837034020905342,4.7161469830606464,4.6474626685489406,4.5778701386314715,4.5075671958774306,4.4367320459448765,4.3655253005556558,4.29409174261676,4.222561886685444,4.1510533626296819,4.0796721459619256,4.008513654725836,3.9376637298410277,3.8671995133393957,3.7971902368636803,3.7276979310701397,3.6587780651215551,3.5904801242268265,3.5228481321401364,3.455921124644159,3.3897335792829644],[1.7947121859283754,2.507108664031275,3.0604614954394229,3.4992907461951361,3.8520703343593592,4.137910255688789,4.3702756480326723,4.5590423442166017,4.7116912567056097,4.8340392475453111,4.9307072506521923,5.0054320372509249,5.0612808740076609,5.1008035957922093,5.1261430262567425,5.1391168916677215,5.1412797406195629,5.1339705336798529,5.1183497633638879,5.095428792554423,5.066093319511543,5.0311223476243496,4.991203671003138,4.9469466283739232,4.8988926926004428,4.8475243287113807,4.7932724543725671,4.7365227630440963,4.677621114539523,4.6168781554365497,4.5545732992969024,4.490958171449603,4.4262596033752102,4.360682246182324,4.294410860317547,4.2276123287709426,4.1604374330838461,4.0930224250204583,4.0254904215114609,3.9579526461728771,3.8905095371565248,3.8232517381518507,3.7562609869159136,3.6896109136666011,3.6233677599609209,3.5575910272361817,3.4923340629702246,3.4276445913797065,3.3635651946911844,3.3001337502638255],[1.4932018323699641,2.1755035349429477,2.7186616998838531,3.1563774570228631,3.5127157123343107,3.8046756678280094,4.0446006185741368,4.2417257263153481,4.4031469044854283,4.5344411365402362,4.6400761544976312,4.7236894177577433,4.7882834762878304,4.8363662332102626,4.8700538962142303,4.8911480359374426,4.9011942749778017,4.9015276849521756,4.8933083931811066,4.8775498616698965,4.8551416014947559,4.8268676054624917,4.7934214463647731,4.7554187498798282,4.7134075794546169,4.667877145040948,4.6192651547356105,4.5679640588921195,4.5143263836957921,4.4586693110089293,4.4012786302890676,4.3424121642534468,4.2823027510275065,4.2211608505425673,4.1591768310219868,4.0965229818316029,4.0333552912520076,3.9698150214630004,3.9060301079126125,3.8421164060409803,3.7781788048610383,3.714312224021854,3.6506025085837419,3.5871272337285314,3.5239564299427037,3.4611532377885883,3.3987745001737881,3.3368712990046285,3.2754894422352319,3.2146699065755104],[1.2395060078118867,1.8861736370183007,2.4145166940447069,2.8473878086902502,3.2042272290487777,3.499752219946858,3.74506318226085,3.9486693247639639,4.1172203637870659,4.2560084775123048,4.3693144716186847,4.4606506553959768,4.5329346990769013,4.588616579925989,4.6297730159433392,4.6581789239950293,4.6753623390878563,4.6826472219831263,4.6811872557978633,4.67199284039072,4.6559528830648205,4.6338525595142741,4.6063879188604258,4.5741779914367706,4.5377749015637816,4.4976723724139882,4.4543129243088542,4.4080940032125717,4.3593732270627248,4.3084728998483781,4.2556839141097811,4.2012691396877111,4.1454663785574892,4.0884909513066283,4.0305379694088499,3.9717843382742846,3.9123905286323124,3.8525021477613057,3.7922513371333593,3.7317580189725383,3.6711310108592148,3.610469024716465,3.5498615641800466,3.4893897323961336,3.4291269606438317,3.3691396667868472,3.3094878513776975,3.2502256382322163,3.1914017654329738,3.1330600319838608],[1.0268147457576493,1.634165439455999,2.1441055915436511,2.5690596946133528,2.9238025499811684,3.2206789754272833,3.4694675309451757,3.677890287919972,3.8521043584006538,3.9970817804083563,4.1168892108834019,4.214892541868311,4.2939077139560293,4.3563132486825218,4.4041353746464953,4.4391133096907458,4.4627499852115937,4.4763519460306131,4.4810610955796504,4.4778802204754617,4.4676937137603998,4.4512845513276629,4.4293483143472061,4.402504860437559,4.3713081066548645,4.3362542835792262,4.2977889418321125,4.2563129332351251,4.2121875435502742,4.1657389187710923,4.1172618996918677,4.0670233580940183,4.0152651109699971,3.9622064757288591,3.9080465185208624,3.8529660390985163,3.7971293285530221,3.7406857304866454,3.683771031439,3.6265087024731772,3.5690110105846253,3.5113800158951736,3.4537084683357944,3.3960806156241601,3.3385729327431437,3.2812547817716728,3.2241890097682924,3.1674324914264029,3.1110366223804067,3.0550477683211352],[0.84907858125582258,1.4149957260470201,1.9038547516129043,2.3184108663666088,2.6688762605120555,2.9652017604672842,3.2158019903043122,3.4275721012569491,3.6061434607368774,3.7561412954567963,3.8813967940307856,3.985112329633667,4.069988290997844,4.138320470827658,4.1920753276502616,4.2329486694381462,4.2624118611024899,4.281748569886008,4.2920842684320473,4.2944101408644784,4.2896026216116576,4.2784394945116926,4.2616132583761495,4.2397423016593541,4.2133803069871689,4.1830242146187624,4.1491210043427218,4.1120735020567238,4.0722453761793584,4.0299654570670329,3.9855314875432422,3.9392133928551472,3.8912561426365677,3.8418822648631057,3.7912940616439137,3.7396755684793881,3.6871942919214455,3.6340027550916285,3.5802398759993981,3.5260321998700737,3.4714950035887679,3.4167332877766508,3.3618426698440698,3.3069101895369366,3.25201503694807,3.1972292116546717,3.142618120527668,3.0882411208059999,3.0341520142122484,2.9803994971842105],[0.70098297301251922,1.2246351092249474,1.6905221938125514,2.0927236459473963,2.4371049820999282,2.7312587984859817,2.9822252329087648,3.19605139925015,3.3778214985711559,3.5317949975249716,3.6615515936143321,3.7701167964067785,3.8600643619470443,3.9335981306639596,3.9926170754296555,4.0387671007612864,4.0734825044062637,4.0980193859678096,4.1134827629017412,4.1208487425091906,4.1209827837406481,4.1146548443815592,4.1025520292954116,4.0852892192896704,4.0634180567341458,4.0374345850091542,4.007785778058305,3.9748751492421306,3.9390675919895921,3.9006935759434418,3.8600527995438583,3.8174173819072887,3.7730346623878548,3.727129664565636,3.6799072719824966,3.6315541552778874,3.5822404841037923,3.5321214520404376,3.4813386384731548,3.430021227854545,3.3782871038276325,3.3262438332177107,3.273989552825828,3.2216137702060075,3.1691980881255488,3.116816861147095,3.0645377916959013,3.0124224720557051,2.9605268779464593,2.908901818656989],[0.5779033745770974,1.0594836816208169,1.501178533644862,1.8895281765346281,2.2263520769286025,2.5169665237634034,2.7670530192413745,2.9818055162638011,3.1657498289908448,3.3227675138494526,3.4561754567408656,3.5688123154550544,3.6631165940479393,3.7411928049439664,3.8048661351723405,3.8557271959144899,3.8951685913762111,3.9244148657991635,3.94454712836004,3.9565234051927112,3.9611955534945729,3.9593233986193805,3.9515866170176857,3.9385947795942187,3.9208958854308378,3.898983649701429,3.8733037578189666,3.8442592571491279,3.8122152254854482,3.7775028299808726,3.7404228698939175,3.7012488802041892,3.6602298600133465,3.617592679004995,3.5735442065724565,3.5282732011347613,3.4819519913341264,3.4347379759959948,3.3867749657409609,3.3381943858126468,3.289116356903687,3.2396506684258308,3.1898976567005652,3.1399489988798033,3.0898884319910556,3.0397924052953482,2.9897306731151252,2.9397668344051944,2.889958824579085,2.8403593644468907],[0.47584873790344417,0.9163417787669097,1.3331858843093096,1.7065849954550787,2.0346723839119418,2.3206058215552297,2.5687455932828307,2.7834408249537921,2.9686564757488343,3.1278899554999482,3.2641881500660714,3.3801958497601863,3.4782098804726527,3.5602297051416523,3.6280016969582123,3.6830567791405704,3.7267420264886688,3.7602470766249985,3.7846261960654211,3.8008167528394781,3.8096547318118166,3.8118878182309679,3.8081864785966681,3.7991533874463155,3.7853314829349909,3.7672108810041687,3.7452348352808027,3.7198048956223726,3.6912853907381065,3.660007338196686,3.6262718672754,3.5903532256414623,3.5525014290930503,3.5129446039830996,3.4718910640733505,3.429531157082323,3.3860389108302629,3.3415735044343289,3.2962805862986464,3.2502934575412632,3.2037341368940773,3.1567143209155577,3.1093362514980369,3.0616935010742758,3.0138716845848914,2.9659491061207133,2.9179973471704495,2.87008180255871,2.8222621694303962,2.774592894007204],[0.39139936253393381,0.79237813589238026,1.184175820477078,1.5418675103175064,1.8602973030917083,2.1406088614051688,2.3858958075686134,2.5996818782634223,2.7853761071711149,2.9460906034240892,3.0845986589345538,3.2033467906572204,3.3044856596589378,3.3899054293362614,3.4612697679678082,3.520046409061421,3.5675337736450583,3.6048838158756871,3.6331214944511947,3.6531613297612804,3.6658214867129777,3.6718357743898133,3.6718638980878904,3.6665002462088463,3.6562814474981336,3.6416928940292603,3.6231743918165895,3.6011250732206008,3.5759076825143179,3.5478523272788145,3.5172597729577015,3.4844043453082647,3.4495364951279934,3.412885071093136,3.3746593394805435,3.3350507836825387,3.2942347115453394,3.2523716944866043,3.2096088589327598,3.1660810477455374,3.1219118668846644,3.0772146305033683,3.0320932159323912,2.9866428385250656,2.9409507550689402,2.8950969033835081,2.8491544847901822,2.8031904953362967,2.7572662109596062,2.7114376311772435],[0.32164339510425721,0.68509714297852708,1.0520272156418127,1.3935447983362872,1.7016204478298009,1.975546629387007,2.2172180145704887,2.4293613481894347,2.6148408192641952,2.7763863947546481,2.9164972736657013,3.0374195655281913,3.1411549826644904,3.2294814394344948,3.3039770185647184,3.3660435592544786,3.416928342018771,3.4577433771254507,3.4894822733062325,3.5130348638418978,3.5291998384820182,3.5386956404591219,3.5421698718230896,3.5402074240112293,3.5333375219484306,3.5220398426840474,3.5067498450945855,3.4878634259273396,3.4657409993429704,3.4407110818350217,3.4130734515942471,3.3831019406781992,3.3510469094061257,3.3171374449329716,3.2815833197136564,3.2445767403408685,3.2062939128516303,3.1668964469065797,3.1265326181319866,3.0853385052812627,3.0434390166390877,3.0009488181918549,2.9579731744680982,2.9146087115669661,2.8709441107047171,2.8270607395873881,2.783033228036818,2.7389299935357823,2.6948137216979182,2.650741806094798],[0.26411496292626158,0.59230642991647731,0.93484453705597392,1.2599650226640104,1.5571840092432252,1.8241172193259931,2.0615377336760448,2.2714107387433229,2.4560716809483623,2.6178751529500897,2.7590483978705418,2.8816369438932918,2.9874922545038531,3.0782781878393779,3.1554852535821976,3.2204474003412722,3.2743588504276531,3.3182898723835192,3.3532010629334197,3.3799560441974856,3.3993326396703418,3.4120326600169761,3.418690451677235,3.4198803607890413,3.4161232541551803,3.4078922241810909,3.3956175890949032,3.3796912848710177,3.3604707317832281,3.3382822466258233,3.3134240613458292,3.2861690000029995,3.2567668584537306,3.2254465247684023,3.1924178729771207,3.1578734581498531,3.121990036926046,3.0849299343059462,3.0468422747080237,3.0078640929057667,2.9681213384161276,2.9277297851667625,2.8867958567730674,2.8454173764704667,2.8036842496406242,2.7616790859144431,2.7194777670079375,2.6771499657299769,2.6347596209774484,2.5923653729903307],[0.21673588206243899,0.51208563703044963,0.83093700298851481,1.1396396617960818,1.4256659204506263,1.6851349092914676,1.9177820834456183,2.1248518401038217,2.3081709940795356,2.4697285053393294,2.6114840166881015,2.7352839763862979,2.8428295821116549,2.9356698254482998,3.015206440694655,3.0827041160035069,3.1393026035612994,3.1860290452277376,3.2238097041613649,3.2534807506797341,3.2757979888638715,3.2914455314467403,3.3010434885366173,3.3051547599472491,3.304291027281538,3.2989180391998403,3.2894602763006642,3.276305073363952,3.2598062677415163,3.2402874341290109,3.2180447581400684,3.1933495941398173,3.1664507466838026,3.1375765095974395,3.1069364921428946,3.0747232577712156,3.0411137975650315,3.0062708575652235,2.9703441366754175,2.9334713696915791,2.895779308158104,2.8573846101629714,2.8183946488142748,2.7789082479569087,2.7390163526640268,2.6988026411498525,2.6583440839788803,2.6177114557749714,2.5769698040480371,2.5361788792439763],[0.1777620850304058,0.44275693245270942,0.73879886797148586,1.0312286733669787,1.3058678656050082,1.5575200251268839,1.7849709552827751,1.9887888844617816,2.1703152191266541,2.3311854330622053,2.4730977664910236,2.5977025063383135,2.7065516679234394,2.8010794299881017,2.8825982354155224,2.9523026933589245,3.0112771216313758,3.0605045176507186,3.1008757934898323,3.1331986809796799,3.1582060254857192,3.1765633578947785,3.1888757262982272,3.1956938164923168,3.1975194131635822,3.1948102625034398,3.1879843982995819,3.1774239908927848,3.1634787738294108,3.1464690977484713,3.1266886556610975,3.1044069186480239,3.0798713162799025,3.0533091918179043,3.0249295584834357,2.9949246797728462,2.9634714938970887,2.9307328999048843,2.8968589208570195,2.8619877575180084,2.8262467443816699,2.7897532184156391,2.7526153096667225,2.7149326617883922,2.6767970896114313,2.6382931800592448,2.5994988419940235,2.5604858099548347,2.5213201062011223,2.4820624649949301],[0.14573532817548673,0.38285761356167436,0.65709099555364636,0.93352665733428131,1.1967041472989042,1.4402895753575287,1.6622088956657519,1.8624013604436342,2.0417485173073713,2.2015464007388843,2.3432395516071516,2.4682861988368421,2.5780911940005478,2.6739747001699739,2.7571599490951915,2.8287711351846232,2.8898365721928254,2.9412944207176865,2.9839994948722381,3.0187303282650637,3.0461960600017299,3.067042918388406,3.0818602035999483,3.0911857402129606,3.095510808744697,3.0952845852540305,3.0909181273169768,3.0827879478211502,3.071239217724123,3.0565886367914379,3.03912700831745,3.019121550489587,2.9968179736983962,2.9724423498938042,2.9462027971274418,2.9182909997361266,2.8888835822180718,2.8581433527193214,2.8262204301641281,2.7932532674062598,2.7593695813242167,2.7246871995095669,2.6893148320817515,2.6533527761856752,2.6168935598723988,2.5800225313128857,2.5428183986362236,2.5053537251054778,2.4676953838355833,2.429904975809694],[0.11944032456474418,0.33111496236016835,0.58462379848672441,0.84545004182037697,1.0971914032628938,1.3325486298132558,1.548677658497212,1.7449374414664724,1.9217768611086523,2.0801680161047731,2.2213106577136896,2.346476037057684,2.4569246471084272,2.5538640669931132,2.6384289123656499,2.7116730476765243,2.774568559139027,2.8280083653911436,2.8728106758547201,2.9097242684301108,2.9394339999507064,2.9625662218532298,2.979693926307303,2.9913415381872825,2.9979893210579771,3.000077395696108,2.9980093864880661,2.9921557197116178,2.9828566014998326,2.9704247042056555,2.955147589166204,2.9372898922616661,2.9170952966335597,2.8947883147472595,2.8705758998150115,2.8446489045286762,2.8171834031326841,2.7883418911164592,2.758274375225592,2.7271193650769758,2.695004776403723,2.6620487548387368,2.6283604281571771,2.5940405940242099,2.5591823495231019,2.5238716680574327,2.4881879286198432,2.4522044018885296,2.4159886971430566,2.3796031735756373],[0.097867168367030688,0.28642340302554681,0.52034156781786578,0.76602528461531261,1.006439147350549,1.2334824064084984,1.4436293860502039,1.6357079833244903,1.8097626670283251,1.966458173055095,2.1067593156336102,2.2317562403142075,2.3425685401784744,2.4402931787795286,2.525977191864178,2.6006045628780301,2.6650912293248128,2.720284715295298,2.7669663311480068,2.8058547213116363,2.8376100373986111,2.8628383108390878,2.8820957787371988,2.89589302572851,2.9046988709608401,2.9089439694643104,2.9090241211386973,2.9053032945110031,2.8981163801113161,2.8877716921594017,2.874553238742926,2.8587227807441273,2.8405216990292703,2.8201726882295826,2.7978812940461215,2.773837309548318,2.7482160444925223,2.7211794803118718,2.6928773221482132,2.6634479581221835,2.6330193349706805,2.6017097582195081,2.5696286241964579,2.5368770904191713,2.5035486902048039,2.4697298967364345,2.4355006412768057,2.4009347897359077,2.3661005813685323,2.3310610329950845],[0.080178739090844275,0.24782392419551957,0.46330817052775197,0.69437806198802532,0.92364109903490776,1.1423490257102689,1.3463803757400674,1.5340810472822684,1.7051199067766234,1.8598716348751259,1.9990766732011229,2.1236505625949205,2.2345759901507627,2.3328417212264494,2.4194086228357135,2.4951915596894576,2.5610506620226365,2.6177881278904902,2.666148261331557,2.706819354760678,2.740436567854089,2.7675852860970425,2.7888046458239462,2.8045910389952731,2.8154014898272157,2.8216568446606218,2.8237447471208577,2.8220223895093581,2.816819042768921,2.8084383739980621,2.7971605640932591,2.7832442397889183,2.7669282348655382,2.7484331950729994,2.7279630406699855,2.7057062996061765,2.681837323394439,2.6565173967134905,2.6298957507945699,2.6021104897063507,2.5732894377751152,2.543550915569182,2.5130044511388312,2.4817514325338754,2.4498857070171227,2.4174941318487027,2.3846570810284686,2.3514489119467683,2.3179383955024941,2.284189112897248],[0.065682672055164426,0.21448567071237945,0.41269406642105366,0.62972340195686938,0.84806725878705214,1.0584728904017235,1.2563053900158829,1.4394769066179407,1.6073096558594493,1.7599060177626935,1.897793136603342,2.0217189343514157,2.132533616328347,2.2311205379638084,2.318356124429501,2.395087151563275,2.4621185105618277,2.5202073346050247,2.5700609783861958,2.6123373043661902,2.6476463144943407,2.6765525268627126,2.6995777220443378,2.717203826001878,2.7298757868106347,2.7380043601531181,2.7419687554566474,2.7421191180928526,2.7387788379579128,2.732246684031439,2.7227987701313037,2.7106903603187709,2.696157524102579,2.6794186522950132,2.6606758444522547,2.6401161785275162,2.6179128728373362,2.5942263497935638,2.5692052101534042,2.5429871258312442,2.5156996586246883,2.4874610115501121,2.4583807188682147,2.4285602803112933,2.3980937445027459,2.3670682460838872,2.3355645006317309,2.3036572610611685,2.2714157388524607,2.2389039931274404],[0.05380743357998774,0.18568957284438858,0.36776457593057366,0.5713567098978718,0.77905668278907791,0.9812386458994915,1.1728324676493669,1.3513634966691299,1.5158360412759047,1.6660981379948492,1.8024750461130932,1.9255544139544849,2.0360587271006416,2.134769020848533,2.2224792682306402,2.2999694126704204,2.3679898691186994,2.4272531340150039,2.4784298132119496,2.5221473849995171,2.5589906348313853,2.5895030848895928,2.6141889860137368,2.6335155957665064,2.6479155672020798,2.6577893383685951,2.6635074552762772,2.6654127889560004,2.6638226254164565,2.6590306190851396,2.6513086078495474,2.640908292525137,2.6280627864127073,2.6129880422027489,2.5958841642621837,2.5769366145862538,2.5563173206073118,2.534185692752922,2.5106895592249066,2.4859660249871638,2.4601422614406832,2.4333362327549848,2.4056573643307857,2.3772071583990178,2.3480797613211148,2.3183624867473207,2.2881362984139133,2.2574762560161243,2.2264519272797463,2.1951277690690265],[0.044082028825405906,0.16081386004909315,0.32786931892353177,0.51864562902540934,0.71601090868727812,0.91008567873572099,1.0954381963060444,1.2692522708031957,1.4302425528934828,1.5780206891960367,1.7127216543860007,1.8347804185674592,1.9447967662434271,2.0434527425601399,2.1314620738577128,2.2095393175544933,2.2783813407864377,2.338656575246107,2.3909992032886747,2.4360064732647873,2.4742379897793745,2.5062162330202402,2.5324278223241241,2.5533252079099942,2.5693285848989391,2.5808278962633069,2.5881848393690117,2.5917348226958143,2.591788840569309,2.5886352478607262,2.5825414259468817,2.573755337329882,2.5625069702399914,2.5490096769912793,2.5334614113079206,2.5160458706166904,2.4969335496321583,2.4762827115991399,2.4542402834071324,2.4309426805263312,2.4065165673828424,2.3810795584257445,2.3547408647623502,2.3276018908650893,2.2997567854931442,2.2712929506297677,2.2422915119150391,2.2128277537554686,2.1829715220160271,2.15278759694674]],"type":"surface","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<figcaption class="figure-caption">Figure&nbsp;2.15: Put value as <span class="math inline">\(S_0\)</span> and <span class="math inline">\(T\)</span> change, an interactive view.</figcaption>
</figure>
</div>
</div>
</section>
<section id="put-call-parity." class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="put-call-parity."><span class="header-section-number">2.3</span> Put-call parity.</h2>
<p>The main idea behind the put-call parity is to understand how call and put option prices are related as today, at <span class="math inline">\(t=0\)</span>. In Hull, the procedure to derive the put-call parity starts with the definition of two portfolios: (1) a call and a bond; (2) a put and a stock. Then, derive the corresponding payoff of each portfolio at maturity. Doing this is relatively easy because we do not need a valuation method as we know the payoff functions for options, bonds and stocks. Given that we can demonstrate that the value of two different portfolios are the same at <span class="math inline">\(T\)</span>, then we can conclude that these two portfolios are worth the same at <span class="math inline">\(t=0\)</span> as well.</p>
<p>The put-call parity is: <span class="math inline">\(c+Ke^{-rT}=p+S_0\)</span>.</p>
<p>We can verify that this equation holds.</p>
<p><span class="math inline">\(p=c+Ke^{-rT}-S_0 \rightarrow p=7.115627+50e^{-0.05\times 1}- 50 \rightarrow p=\$4.677098\)</span>.</p>
<p><span class="math inline">\(c=p+S_0-Ke^{-rT} \rightarrow c=4.677098+50-50e^{-0.05\times 1} \rightarrow c=\$7.115627\)</span>.</p>
<p>Let’s take one step back and demonstrate that both portfolios are worth the same at maturity. We first define the assets payoffs.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>ST.seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">150</span>, <span class="at">length.out =</span> <span class="dv">50</span>)</span>
<span id="cb28-2"><a href="#cb28-2"></a>cT <span class="ot">&lt;-</span> <span class="fu">pmax</span>(ST.seq <span class="sc">-</span> K, <span class="dv">0</span>) <span class="co"># call payoff.</span></span>
<span id="cb28-3"><a href="#cb28-3"></a>pT <span class="ot">&lt;-</span> <span class="fu">pmax</span>(K <span class="sc">-</span> ST.seq, <span class="dv">0</span>) <span class="co"># put payoff.</span></span>
<span id="cb28-4"><a href="#cb28-4"></a>BT <span class="ot">&lt;-</span> <span class="fu">rep</span>(K, <span class="dv">50</span>) <span class="co"># bond payoff (at maturity).</span></span>
<span id="cb28-5"><a href="#cb28-5"></a>pc <span class="ot">&lt;-</span> <span class="fu">pmax</span>(ST.seq, K) <span class="co"># this will be important.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then we plot.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">0</span>))</span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb29-4"><a href="#cb29-4"></a><span class="co"># Portfolio A.</span></span>
<span id="cb29-5"><a href="#cb29-5"></a><span class="fu">plot</span>(ST.seq, cT, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylab =</span> <span class="st">"Payoff"</span>, </span>
<span id="cb29-6"><a href="#cb29-6"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[T])), <span class="at">lwd =</span> <span class="dv">2</span>, </span>
<span id="cb29-7"><a href="#cb29-7"></a>     <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">150</span>))</span>
<span id="cb29-8"><a href="#cb29-8"></a><span class="fu">lines</span>(ST.seq, (cT <span class="sc">+</span> BT), <span class="at">lwd =</span> <span class="dv">6</span>)</span>
<span id="cb29-9"><a href="#cb29-9"></a><span class="fu">lines</span>(ST.seq, BT, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb29-10"><a href="#cb29-10"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Call option"</span>, <span class="st">"Zero coupon bond"</span>, </span>
<span id="cb29-11"><a href="#cb29-11"></a>                           <span class="st">"Total (Portfolio A)"</span>),</span>
<span id="cb29-12"><a href="#cb29-12"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"black"</span>), <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>), </span>
<span id="cb29-13"><a href="#cb29-13"></a>       <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">cex =</span> <span class="fl">0.7</span>)</span>
<span id="cb29-14"><a href="#cb29-14"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb29-15"><a href="#cb29-15"></a><span class="co"># Portfolio C.</span></span>
<span id="cb29-16"><a href="#cb29-16"></a><span class="fu">plot</span>(ST.seq, (pT <span class="sc">+</span> ST.seq), <span class="at">lwd =</span> <span class="dv">6</span>, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylab =</span> <span class="st">""</span>, </span>
<span id="cb29-17"><a href="#cb29-17"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[T])), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">150</span>))</span>
<span id="cb29-18"><a href="#cb29-18"></a><span class="fu">lines</span>(ST.seq, ST.seq, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"orange"</span>)</span>
<span id="cb29-19"><a href="#cb29-19"></a><span class="fu">lines</span>(ST.seq, pT, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"purple"</span>)</span>
<span id="cb29-20"><a href="#cb29-20"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Put option"</span>, <span class="st">"Share"</span>, <span class="st">"Total (Portfolio C)"</span>),</span>
<span id="cb29-21"><a href="#cb29-21"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"purple"</span>, <span class="st">"orange"</span>, <span class="st">"black"</span>), <span class="at">lwd =</span> <span class="dv">2</span>, </span>
<span id="cb29-22"><a href="#cb29-22"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">cex =</span> <span class="fl">0.7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-paacptpcp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-paacptpcp-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.16: Portfolio A and C payoffs, the put-call parity.</figcaption>
</figure>
</div>
</div>
</div>
<p>The point here is that the black line (total) is the same in both cases. This is why we argue that the payoffs of both portfolios are worth the same. If this is so, then they are worth the same in time <span class="math inline">\(t=0\)</span>.</p>
<p>In sum, this is the payoff of portfolios A and C: <span class="math inline">\(\mathrm{max}(S_T,K)\)</span>. This is already stored in <tt><code>pc</code></tt>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="fu">plot</span>(ST.seq, pc, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylab =</span> <span class="st">"Payoff"</span>, </span>
<span id="cb30-3"><a href="#cb30-3"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[T])), <span class="at">lwd =</span> <span class="dv">5</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">150</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-paacp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-paacp-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.17: Portfolio A and C payoffs, <span class="math inline">\(\mathrm{max}(S_T,K)\)</span>.</figcaption>
</figure>
</div>
</div>
</div>
<p>Nice. We can manipulate the put-call parity to create a synthetic stock <span class="math inline">\(S_0\)</span>. This is:</p>
<p><span class="math inline">\(c+Ke^{-rT}=p+S_0 \rightarrow S_0 = c+Ke^{-rT}-p\)</span>.</p>
<p>Graphically:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="fu">plot</span>(ST.seq, (cT <span class="sc">+</span> BT <span class="sc">-</span> pT), <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylab =</span> <span class="st">"Payoff"</span>, </span>
<span id="cb31-3"><a href="#cb31-3"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[T])), </span>
<span id="cb31-4"><a href="#cb31-4"></a>     <span class="at">lwd =</span> <span class="dv">5</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">50</span>, <span class="dv">100</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">150</span>), <span class="at">col =</span> <span class="st">"orange"</span>)</span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="fu">lines</span>(ST.seq, cT, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>) <span class="co"># positive call.</span></span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="fu">lines</span>(ST.seq, BT, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>) <span class="co"># positive bond.</span></span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="fu">lines</span>(ST.seq, <span class="sc">-</span>pT, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"purple"</span>) <span class="co"># negative put.</span></span>
<span id="cb31-8"><a href="#cb31-8"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Call option"</span>, <span class="st">"Zero coupon bond"</span>, </span>
<span id="cb31-9"><a href="#cb31-9"></a>                               <span class="st">"Put option"</span>, <span class="st">"Total (stock)"</span>),</span>
<span id="cb31-10"><a href="#cb31-10"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"purple"</span>, <span class="st">"orange"</span>), <span class="at">lwd =</span> <span class="dv">2</span>, </span>
<span id="cb31-11"><a href="#cb31-11"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-asss" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-asss-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.18: A synthetic stock <span class="math inline">\(S_0\)</span>.</figcaption>
</figure>
</div>
</div>
</div>
<p>So, we created a stock that did not exist with a call, a bond and a put. We can manipulate the put-call parity to create a synthetic bond <span class="math inline">\(Ke^{-rT}\)</span>. This is:</p>
<p><span class="math inline">\(c+Ke^{-rT}=p+S_0 \rightarrow Ke^{-rT} = p+S_0-c\)</span>.</p>
<p>Graphically:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="fu">plot</span>(ST.seq, (<span class="sc">-</span>cT <span class="sc">+</span> ST.seq <span class="sc">+</span> pT), <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylab =</span> <span class="st">"Payoff"</span>, </span>
<span id="cb32-3"><a href="#cb32-3"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[T])), </span>
<span id="cb32-4"><a href="#cb32-4"></a>     <span class="at">lwd =</span> <span class="dv">5</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">50</span>, <span class="dv">100</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">150</span>), <span class="at">col =</span> <span class="st">"orange"</span>)</span>
<span id="cb32-5"><a href="#cb32-5"></a><span class="fu">lines</span>(ST.seq, <span class="sc">-</span>cT, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>) </span>
<span id="cb32-6"><a href="#cb32-6"></a><span class="fu">lines</span>(ST.seq, ST.seq, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>) </span>
<span id="cb32-7"><a href="#cb32-7"></a><span class="fu">lines</span>(ST.seq, pT, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"purple"</span>) </span>
<span id="cb32-8"><a href="#cb32-8"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Call option (short)"</span>, <span class="st">"Stock"</span>, </span>
<span id="cb32-9"><a href="#cb32-9"></a>                               <span class="st">"Put option"</span>, <span class="st">"Total (bond)"</span>),</span>
<span id="cb32-10"><a href="#cb32-10"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"purple"</span>, <span class="st">"orange"</span>), <span class="at">lwd =</span> <span class="dv">2</span>, </span>
<span id="cb32-11"><a href="#cb32-11"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">cex =</span> <span class="fl">0.7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-asbk" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-asbk-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.19: A synthetic bond <span class="math inline">\(Ke^{-rT}\)</span>.</figcaption>
</figure>
</div>
</div>
</div>
<p>There is an alternative to the Black-Scholes formula we indirectly review before. Next section introduces the binomial trees.</p>
</section>
</section>
<section id="binomial-trees." class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Binomial trees.</h1>
<p>Binomial trees are a flexible valuation method for options because we can use them to value not only European but also American options. This section is based in <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span> chapter 13.</p>
<section id="implementation." class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="implementation."><span class="header-section-number">3.1</span> Implementation.</h2>
<p>The function is the following.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>bin <span class="ot">&lt;-</span> <span class="cf">function</span>(S0, K, sigma, TM, r, steps) {</span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="co"># the parameters</span></span>
<span id="cb33-3"><a href="#cb33-3"></a>dt <span class="ot">&lt;-</span> TM <span class="sc">/</span> steps</span>
<span id="cb33-4"><a href="#cb33-4"></a>u <span class="ot">&lt;-</span> <span class="fu">exp</span>(sigma <span class="sc">*</span> <span class="fu">sqrt</span>(dt))</span>
<span id="cb33-5"><a href="#cb33-5"></a>d <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>sigma <span class="sc">*</span> <span class="fu">sqrt</span>(dt))</span>
<span id="cb33-6"><a href="#cb33-6"></a>a <span class="ot">&lt;-</span> <span class="fu">exp</span>(r <span class="sc">*</span> dt)</span>
<span id="cb33-7"><a href="#cb33-7"></a>p <span class="ot">&lt;-</span> (a <span class="sc">-</span> d) <span class="sc">/</span> (u <span class="sc">-</span> d)</span>
<span id="cb33-8"><a href="#cb33-8"></a>S <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, steps <span class="sc">+</span> <span class="dv">1</span>, steps)</span>
<span id="cb33-9"><a href="#cb33-9"></a>pam <span class="ot">&lt;-</span> S</span>
<span id="cb33-10"><a href="#cb33-10"></a>peu <span class="ot">&lt;-</span> S</span>
<span id="cb33-11"><a href="#cb33-11"></a>cam <span class="ot">&lt;-</span> S</span>
<span id="cb33-12"><a href="#cb33-12"></a>ceu <span class="ot">&lt;-</span> S</span>
<span id="cb33-13"><a href="#cb33-13"></a><span class="co"># the stock price process</span></span>
<span id="cb33-14"><a href="#cb33-14"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>steps) {</span>
<span id="cb33-15"><a href="#cb33-15"></a>    j <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb33-16"><a href="#cb33-16"></a>    do <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, i)</span>
<span id="cb33-17"><a href="#cb33-17"></a>    up <span class="ot">&lt;-</span> <span class="fu">rev</span>(do)</span>
<span id="cb33-18"><a href="#cb33-18"></a>    S[(<span class="dv">1</span><span class="sc">:</span>j), i] <span class="ot">&lt;-</span> S0 <span class="sc">*</span> (u <span class="sc">^</span> up) <span class="sc">*</span> (d <span class="sc">^</span> do) }</span>
<span id="cb33-19"><a href="#cb33-19"></a><span class="co"># the option prices at maturity.</span></span>
<span id="cb33-20"><a href="#cb33-20"></a>peu[(<span class="dv">1</span><span class="sc">:</span>(steps <span class="sc">+</span> <span class="dv">1</span>)), steps] <span class="ot">&lt;-</span> <span class="fu">pmax</span>(K <span class="sc">-</span> S[, i], <span class="dv">0</span>)</span>
<span id="cb33-21"><a href="#cb33-21"></a>pam[(<span class="dv">1</span><span class="sc">:</span>(steps <span class="sc">+</span> <span class="dv">1</span>)), steps] <span class="ot">&lt;-</span> <span class="fu">pmax</span>(K <span class="sc">-</span> S[, i], <span class="dv">0</span>)</span>
<span id="cb33-22"><a href="#cb33-22"></a>ceu[(<span class="dv">1</span><span class="sc">:</span>(steps <span class="sc">+</span> <span class="dv">1</span>)), steps] <span class="ot">&lt;-</span> <span class="fu">pmax</span>(S[, i] <span class="sc">-</span> K, <span class="dv">0</span>)</span>
<span id="cb33-23"><a href="#cb33-23"></a>cam[(<span class="dv">1</span><span class="sc">:</span>(steps <span class="sc">+</span> <span class="dv">1</span>)), steps] <span class="ot">&lt;-</span> <span class="fu">pmax</span>(S[, i] <span class="sc">-</span> K, <span class="dv">0</span>)</span>
<span id="cb33-24"><a href="#cb33-24"></a><span class="co"># the binomial method to price stock options.</span></span>
<span id="cb33-25"><a href="#cb33-25"></a><span class="cf">for</span>(j <span class="cf">in</span> steps<span class="sc">:</span><span class="dv">1</span>) { <span class="co"># this is a reverse loop from steps to 1.</span></span>
<span id="cb33-26"><a href="#cb33-26"></a>  cd <span class="ot">&lt;-</span> (<span class="fu">seq</span>(steps<span class="sc">:</span><span class="dv">1</span>)) <span class="co"># every round we compute less option prices.</span></span>
<span id="cb33-27"><a href="#cb33-27"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>cd[j]) { <span class="co"># option prices per step.</span></span>
<span id="cb33-28"><a href="#cb33-28"></a>    peu[i, (j <span class="sc">-</span> <span class="dv">1</span>)] <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>r <span class="sc">*</span> dt) <span class="sc">*</span> (p <span class="sc">*</span> peu[i, j] <span class="sc">+</span> </span>
<span id="cb33-29"><a href="#cb33-29"></a>                                       (<span class="dv">1</span> <span class="sc">-</span> p) <span class="sc">*</span> peu[(i <span class="sc">+</span> <span class="dv">1</span>), j])</span>
<span id="cb33-30"><a href="#cb33-30"></a>    ceu[i, (j <span class="sc">-</span> <span class="dv">1</span>)] <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>r <span class="sc">*</span> dt) <span class="sc">*</span> (p <span class="sc">*</span> ceu[i, j] <span class="sc">+</span> </span>
<span id="cb33-31"><a href="#cb33-31"></a>                                       (<span class="dv">1</span> <span class="sc">-</span> p) <span class="sc">*</span> ceu[(i <span class="sc">+</span> <span class="dv">1</span>), j])</span>
<span id="cb33-32"><a href="#cb33-32"></a>    pam[i, (j <span class="sc">-</span> <span class="dv">1</span>)] <span class="ot">&lt;-</span> <span class="fu">max</span>((K <span class="sc">-</span> S[i, (j <span class="sc">-</span> <span class="dv">1</span>)]), <span class="fu">exp</span>(<span class="sc">-</span>r <span class="sc">*</span> dt) <span class="sc">*</span> </span>
<span id="cb33-33"><a href="#cb33-33"></a>                           (p <span class="sc">*</span> pam[i, j] <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> p) <span class="sc">*</span> pam[(i <span class="sc">+</span> <span class="dv">1</span>), j]))</span>
<span id="cb33-34"><a href="#cb33-34"></a>    cam[i, (j <span class="sc">-</span> <span class="dv">1</span>)] <span class="ot">&lt;-</span> <span class="fu">max</span>((S[i, (j <span class="sc">-</span> <span class="dv">1</span>)] <span class="sc">-</span> K), <span class="fu">exp</span>(<span class="sc">-</span>r <span class="sc">*</span> dt) <span class="sc">*</span> </span>
<span id="cb33-35"><a href="#cb33-35"></a>                           (p <span class="sc">*</span> cam[i, j] <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> p) <span class="sc">*</span> cam[(i <span class="sc">+</span> <span class="dv">1</span>), j])) } }</span>
<span id="cb33-36"><a href="#cb33-36"></a><span class="co"># This is the final step in the binomial tree.</span></span>
<span id="cb33-37"><a href="#cb33-37"></a>p.eu <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>r <span class="sc">*</span> dt) <span class="sc">*</span> (p <span class="sc">*</span> peu[<span class="dv">1</span>, <span class="dv">1</span>] <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> p) <span class="sc">*</span> peu[<span class="dv">2</span>, <span class="dv">1</span>])</span>
<span id="cb33-38"><a href="#cb33-38"></a>c.eu <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>r <span class="sc">*</span> dt) <span class="sc">*</span> (p <span class="sc">*</span> ceu[<span class="dv">1</span>, <span class="dv">1</span>] <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> p) <span class="sc">*</span> ceu[<span class="dv">2</span>, <span class="dv">1</span>])</span>
<span id="cb33-39"><a href="#cb33-39"></a>p.am <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>r <span class="sc">*</span> dt) <span class="sc">*</span> (p <span class="sc">*</span> pam[<span class="dv">1</span>, <span class="dv">1</span>] <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> p) <span class="sc">*</span> pam[<span class="dv">2</span>, <span class="dv">1</span>])</span>
<span id="cb33-40"><a href="#cb33-40"></a>c.am <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>r <span class="sc">*</span> dt) <span class="sc">*</span> (p <span class="sc">*</span> cam[<span class="dv">1</span>, <span class="dv">1</span>] <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> p) <span class="sc">*</span> cam[<span class="dv">2</span>, <span class="dv">1</span>])</span>
<span id="cb33-41"><a href="#cb33-41"></a><span class="co"># Results.</span></span>
<span id="cb33-42"><a href="#cb33-42"></a>option <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(c.eu, p.eu, c.am, p.am)</span>
<span id="cb33-43"><a href="#cb33-43"></a>option</span>
<span id="cb33-44"><a href="#cb33-44"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can evaluate the function above to see how the price change depending on the number of steps in the binomial tree. Let’s evaluate the <tt><code>bin()</code></tt> function assuming <span class="math inline">\(S_0=\$50\)</span>, <span class="math inline">\(K=\$50\)</span>, <span class="math inline">\(rf=0.05\)</span>, <span class="math inline">\(T=1\)</span>, and <span class="math inline">\(\sigma=0.3\)</span> at different time steps.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>b1t <span class="ot">&lt;-</span> <span class="fu">bin</span>(S0, K, sigma, TT, rf, <span class="dv">1</span>)</span>
<span id="cb34-2"><a href="#cb34-2"></a>b4t <span class="ot">&lt;-</span> <span class="fu">bin</span>(S0, K, sigma, TT, rf, <span class="dv">4</span>)</span>
<span id="cb34-3"><a href="#cb34-3"></a>b20t <span class="ot">&lt;-</span> <span class="fu">bin</span>(S0, K, sigma, TT, rf, <span class="dv">20</span>)</span>
<span id="cb34-4"><a href="#cb34-4"></a>b50t <span class="ot">&lt;-</span> <span class="fu">bin</span>(S0, K, sigma, TT, rf, <span class="dv">50</span>)</span>
<span id="cb34-5"><a href="#cb34-5"></a>b200t <span class="ot">&lt;-</span> <span class="fu">bin</span>(S0, K, sigma, TT, rf, <span class="dv">200</span>)</span>
<span id="cb34-6"><a href="#cb34-6"></a>b500t <span class="ot">&lt;-</span> <span class="fu">bin</span>(S0, K, sigma, TT, rf, <span class="dv">500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>See the results.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>Black.Scholes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">c.eu =</span> c, <span class="at">p.eu =</span> p, <span class="at">c.am =</span> <span class="cn">NA</span>, <span class="at">p.am =</span> <span class="cn">NA</span>)</span>
<span id="cb35-2"><a href="#cb35-2"></a>bin.bs <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="st">"Binomial (1 step)"</span> <span class="ot">=</span> b1t, <span class="st">"Binomial (4 steps)"</span> <span class="ot">=</span> b4t,</span>
<span id="cb35-3"><a href="#cb35-3"></a>                <span class="st">"Binomial (20 steps)"</span> <span class="ot">=</span> b20t, <span class="st">"Binomial (50 steps)"</span> <span class="ot">=</span> b50t,</span>
<span id="cb35-4"><a href="#cb35-4"></a>                <span class="st">"Binomial (200 steps)"</span> <span class="ot">=</span> b200t, </span>
<span id="cb35-5"><a href="#cb35-5"></a>                <span class="st">"Binomial (500 steps)"</span> <span class="ot">=</span> b500t, </span>
<span id="cb35-6"><a href="#cb35-6"></a>                <span class="st">"Black-Scholes"</span> <span class="ot">=</span> Black.Scholes)</span>
<span id="cb35-7"><a href="#cb35-7"></a>bin.bs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                         c.eu     p.eu     c.am     p.am
Binomial (1 step)    8.481986 6.043457 8.481986 6.043457
Binomial (4 steps)   6.762001 4.323472 6.762001 4.767526
Binomial (20 steps)  7.042462 4.603934 7.042462 4.898985
Binomial (50 steps)  7.086241 4.647713 7.086241 4.921038
Binomial (200 steps) 7.108267 4.669738 7.108267 4.931581
Binomial (500 steps) 7.112682 4.674153 7.112682 4.933664
Black-Scholes        7.115627 4.677099       NA       NA</code></pre>
</div>
</div>
<p>In the extreme, as the number of steps increases, the binomial method converges to the Black-Scholes method. Let’s explore these differences.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">mapply</span>(bin, S0.seq, K, sigma, TT, rf, <span class="dv">1</span>)</span>
<span id="cb37-2"><a href="#cb37-2"></a>b2 <span class="ot">&lt;-</span> <span class="fu">mapply</span>(bin, S0.seq, K, sigma, TT, rf, <span class="dv">2</span>)</span>
<span id="cb37-3"><a href="#cb37-3"></a>b3 <span class="ot">&lt;-</span> <span class="fu">mapply</span>(bin, S0.seq, K, sigma, TT, rf, <span class="dv">3</span>)</span>
<span id="cb37-4"><a href="#cb37-4"></a>b4 <span class="ot">&lt;-</span> <span class="fu">mapply</span>(bin, S0.seq, K, sigma, TT, rf, <span class="dv">4</span>)</span>
<span id="cb37-5"><a href="#cb37-5"></a>b20 <span class="ot">&lt;-</span> <span class="fu">mapply</span>(bin, S0.seq, K, sigma, TT, rf, <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here, we compare the value of the binomial method and the Black-Scholes at different time steps as a function of <span class="math inline">\(S_0\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="fu">plot</span>(S0.seq, b1[<span class="dv">1</span>, ], <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">5</span>, </span>
<span id="cb38-2"><a href="#cb38-2"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[<span class="dv">0</span>])), <span class="at">ylab =</span> <span class="st">"European call"</span>)</span>
<span id="cb38-3"><a href="#cb38-3"></a><span class="fu">lines</span>(S0.seq, c.S0.s1, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">5</span>)</span>
<span id="cb38-4"><a href="#cb38-4"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"1 step binomial"</span>, <span class="st">"Black-Scholes"</span>),</span>
<span id="cb38-5"><a href="#cb38-5"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"black"</span>), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-osbabsc" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-osbabsc-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.1: One-step binomial and Black-Scholes comparison.</figcaption>
</figure>
</div>
</div>
</div>
<p>There are some differences between the binomial and the Black-Scholes. Let’s zoom to see the differences clearer.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="fu">plot</span>(S0.seq, b1[<span class="dv">1</span>,], <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">45</span>), </span>
<span id="cb39-2"><a href="#cb39-2"></a>     <span class="at">col =</span> <span class="st">"green"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[<span class="dv">0</span>])), </span>
<span id="cb39-3"><a href="#cb39-3"></a>     <span class="at">ylab =</span> <span class="st">"European call"</span>)</span>
<span id="cb39-4"><a href="#cb39-4"></a><span class="fu">lines</span>(S0.seq, b2[<span class="dv">1</span>,], <span class="at">col =</span> <span class="st">"purple"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-5"><a href="#cb39-5"></a><span class="fu">lines</span>(S0.seq, b3[<span class="dv">1</span>,], <span class="at">col =</span> <span class="st">"orange"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-6"><a href="#cb39-6"></a><span class="fu">lines</span>(S0.seq, b4[<span class="dv">1</span>,], <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-7"><a href="#cb39-7"></a><span class="fu">lines</span>(S0.seq, b20[<span class="dv">1</span>,], <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-8"><a href="#cb39-8"></a><span class="fu">lines</span>(S0.seq, c.S0.s1, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-9"><a href="#cb39-9"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"1 step binomial"</span>, <span class="st">"2 steps binomial"</span>, </span>
<span id="cb39-10"><a href="#cb39-10"></a>                             <span class="st">"3 steps binomial"</span>, <span class="st">"4 steps binomial"</span>,</span>
<span id="cb39-11"><a href="#cb39-11"></a>                             <span class="st">"20 steps binomial"</span>, <span class="st">"Black-Scholes"</span>),</span>
<span id="cb39-12"><a href="#cb39-12"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"green"</span>, <span class="st">"purple"</span>, <span class="st">"orange"</span>, <span class="st">"red"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>), </span>
<span id="cb39-13"><a href="#cb39-13"></a>       <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-babscaazv" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-babscaazv-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.2: Binomial and Black-Scholes convergence, a zoom view.</figcaption>
</figure>
</div>
</div>
</div>
<p>Not clear yet. Let’s see a panel view.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>))</span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb40-3"><a href="#cb40-3"></a><span class="fu">plot</span>(S0.seq, c.S0.s1, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">45</span>), </span>
<span id="cb40-4"><a href="#cb40-4"></a>     <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">6</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">"European call"</span>)</span>
<span id="cb40-5"><a href="#cb40-5"></a><span class="fu">lines</span>(S0.seq, b2[<span class="dv">1</span>,], <span class="at">col =</span> <span class="st">"purple"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb40-6"><a href="#cb40-6"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"2-steps"</span>),</span>
<span id="cb40-7"><a href="#cb40-7"></a>       <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb40-8"><a href="#cb40-8"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb40-9"><a href="#cb40-9"></a><span class="fu">plot</span>(S0.seq, c.S0.s1, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">45</span>), </span>
<span id="cb40-10"><a href="#cb40-10"></a>     <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">6</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>)</span>
<span id="cb40-11"><a href="#cb40-11"></a><span class="fu">lines</span>(S0.seq, b3[<span class="dv">1</span>,], <span class="at">col =</span> <span class="st">"orange"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb40-12"><a href="#cb40-12"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"3-steps"</span>),</span>
<span id="cb40-13"><a href="#cb40-13"></a>       <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb40-14"><a href="#cb40-14"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb40-15"><a href="#cb40-15"></a><span class="fu">plot</span>(S0.seq, c.S0.s1, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">45</span>), </span>
<span id="cb40-16"><a href="#cb40-16"></a>     <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">6</span>, <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[<span class="dv">0</span>])), </span>
<span id="cb40-17"><a href="#cb40-17"></a>     <span class="at">ylab =</span> <span class="st">"European call"</span>)</span>
<span id="cb40-18"><a href="#cb40-18"></a><span class="fu">lines</span>(S0.seq, b4[<span class="dv">1</span>,], <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb40-19"><a href="#cb40-19"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"4-steps"</span>), <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb40-20"><a href="#cb40-20"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb40-21"><a href="#cb40-21"></a><span class="fu">plot</span>(S0.seq, c.S0.s1, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">45</span>), </span>
<span id="cb40-22"><a href="#cb40-22"></a>     <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">6</span>, <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[<span class="dv">0</span>])), <span class="at">ylab =</span> <span class="st">""</span>)</span>
<span id="cb40-23"><a href="#cb40-23"></a><span class="fu">lines</span>(S0.seq, b20[<span class="dv">1</span>,], <span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb40-24"><a href="#cb40-24"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"20-steps"</span>),</span>
<span id="cb40-25"><a href="#cb40-25"></a>       <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-babscapv" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-babscapv-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.3: Binomial and Black-Scholes convergence, a panel view.</figcaption>
</figure>
</div>
</div>
</div>
<p>As stated above, the binomial method converges to the Black-Scholes as time steps increase. We can also create a function to visualize the price path of the stock from <span class="math inline">\(S_0\)</span> to <span class="math inline">\(S_T\)</span> given the assumptions of the binomial method.</p>
</section>
<section id="stock-price-paths." class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="stock-price-paths."><span class="header-section-number">3.2</span> Stock price paths.</h2>
<p>In order to value option prices, we first need to understand the evolution of the underlying (in this case the stock price) from time zero to maturity, this is from <span class="math inline">\(S_0\)</span> to <span class="math inline">\(S_T\)</span>. The binomial method assumes that the price can increase or decrease with a certain probability in each time step. Here, we can show how the binomial tree method assumes this stock price evolution.</p>
<p>Let’s assume 10-steps, from <span class="math inline">\(t=0.1, t=0.2,..., t=1\)</span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># Function to generate stock prices paths given the binomial method.</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>S.paths <span class="ot">&lt;-</span> <span class="cf">function</span>(S0, sigma, TM, steps) {</span>
<span id="cb41-3"><a href="#cb41-3"></a>  dt <span class="ot">&lt;-</span> TM <span class="sc">/</span> steps</span>
<span id="cb41-4"><a href="#cb41-4"></a>  u <span class="ot">&lt;-</span> <span class="fu">exp</span>(sigma <span class="sc">*</span> dt<span class="sc">^</span><span class="fl">0.5</span>) <span class="co"># Here we set u and d as a function of sigma.</span></span>
<span id="cb41-5"><a href="#cb41-5"></a>  d <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>sigma <span class="sc">*</span> dt<span class="sc">^</span><span class="fl">0.5</span>)</span>
<span id="cb41-6"><a href="#cb41-6"></a>  S <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, (steps <span class="sc">+</span> <span class="dv">1</span>), (steps <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb41-7"><a href="#cb41-7"></a>  S[<span class="dv">1</span>, <span class="dv">1</span>] <span class="ot">&lt;-</span> S0</span>
<span id="cb41-8"><a href="#cb41-8"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>(steps <span class="sc">+</span> <span class="dv">1</span>)) {</span>
<span id="cb41-9"><a href="#cb41-9"></a>    do <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, i <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb41-10"><a href="#cb41-10"></a>    up <span class="ot">=</span> <span class="fu">rev</span>(do) <span class="co"># rev provides a reversed version of its argument. </span></span>
<span id="cb41-11"><a href="#cb41-11"></a>    S[(<span class="dv">1</span><span class="sc">:</span>i), i] <span class="ot">=</span> S0 <span class="sc">*</span> (u <span class="sc">^</span> up) <span class="sc">*</span> (d <span class="sc">^</span> do) }</span>
<span id="cb41-12"><a href="#cb41-12"></a>  S }</span>
<span id="cb41-13"><a href="#cb41-13"></a><span class="co"># Evaluate the function.</span></span>
<span id="cb41-14"><a href="#cb41-14"></a>Spaths <span class="ot">&lt;-</span> <span class="fu">S.paths</span>(<span class="dv">50</span>, <span class="fl">0.3</span>, <span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb41-15"><a href="#cb41-15"></a><span class="co"># A table.</span></span>
<span id="cb41-16"><a href="#cb41-16"></a><span class="fu">colnames</span>(Spaths) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>, <span class="dv">10</span>)))</span>
<span id="cb41-17"><a href="#cb41-17"></a><span class="fu">round</span>(Spaths, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       0   0.1   0.2   0.3   0.4   0.5   0.6   0.7    0.8    0.9      1
 [1,] 50 54.98 60.45 66.46 73.08 80.35 88.34 97.13 106.80 117.43 129.12
 [2,]  0 45.47 50.00 54.98 60.45 66.46 73.08 80.35  88.34  97.13 106.80
 [3,]  0  0.00 41.36 45.47 50.00 54.98 60.45 66.46  73.08  80.35  88.34
 [4,]  0  0.00  0.00 37.62 41.36 45.47 50.00 54.98  60.45  66.46  73.08
 [5,]  0  0.00  0.00  0.00 34.21 37.62 41.36 45.47  50.00  54.98  60.45
 [6,]  0  0.00  0.00  0.00  0.00 31.11 34.21 37.62  41.36  45.47  50.00
 [7,]  0  0.00  0.00  0.00  0.00  0.00 28.30 31.11  34.21  37.62  41.36
 [8,]  0  0.00  0.00  0.00  0.00  0.00  0.00 25.74  28.30  31.11  34.21
 [9,]  0  0.00  0.00  0.00  0.00  0.00  0.00  0.00  23.41  25.74  28.30
[10,]  0  0.00  0.00  0.00  0.00  0.00  0.00  0.00   0.00  21.29  23.41
[11,]  0  0.00  0.00  0.00  0.00  0.00  0.00  0.00   0.00   0.00  19.36</code></pre>
</div>
</div>
<p>This does not look like a typical binomial tree. In fact, it is not very clear whether a given price corresponds to an increase or decrease from a previous time step. We can make a few arrangements to visualize this as a tree.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>S.paths <span class="ot">&lt;-</span> <span class="cf">function</span>(S0, sigma, TM, steps) {</span>
<span id="cb43-2"><a href="#cb43-2"></a>  dt <span class="ot">&lt;-</span> TM <span class="sc">/</span> steps</span>
<span id="cb43-3"><a href="#cb43-3"></a>  u <span class="ot">&lt;-</span> <span class="fu">exp</span>(sigma <span class="sc">*</span> dt<span class="sc">^</span><span class="fl">0.5</span>)</span>
<span id="cb43-4"><a href="#cb43-4"></a>  d <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>sigma <span class="sc">*</span> dt<span class="sc">^</span><span class="fl">0.5</span>)</span>
<span id="cb43-5"><a href="#cb43-5"></a>  S <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">2</span> <span class="sc">*</span> ((steps <span class="sc">+</span> <span class="dv">1</span>)), (steps <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb43-6"><a href="#cb43-6"></a>  S2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, ((<span class="dv">2</span> <span class="sc">*</span> steps) <span class="sc">+</span> <span class="dv">2</span>), (steps <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb43-7"><a href="#cb43-7"></a>  S2[(steps <span class="sc">+</span> <span class="dv">1</span>), <span class="dv">1</span>] <span class="ot">&lt;-</span> S0</span>
<span id="cb43-8"><a href="#cb43-8"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>(steps <span class="sc">+</span> <span class="dv">1</span>)) {</span>
<span id="cb43-9"><a href="#cb43-9"></a>    do <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, i <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb43-10"><a href="#cb43-10"></a>    up <span class="ot">=</span> <span class="fu">rev</span>(do) <span class="co"># rev provides a reversed version of its argument. </span></span>
<span id="cb43-11"><a href="#cb43-11"></a>    S[(<span class="dv">1</span><span class="sc">:</span>i), i] <span class="ot">=</span> S0 <span class="sc">*</span> (u <span class="sc">^</span> up) <span class="sc">*</span> (d <span class="sc">^</span> do)</span>
<span id="cb43-12"><a href="#cb43-12"></a>    x <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, i) <span class="co"># These are the NA between stock prices.</span></span>
<span id="cb43-13"><a href="#cb43-13"></a>    r <span class="ot">=</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>, (steps <span class="sc">-</span> <span class="dv">1</span>)), <span class="dv">0</span>)) <span class="co"># These creates the blank spaces.</span></span>
<span id="cb43-14"><a href="#cb43-14"></a>    <span class="co"># Here we combine NA and stock prices for each column.</span></span>
<span id="cb43-15"><a href="#cb43-15"></a>    S2[(<span class="dv">1</span> <span class="sc">+</span> r[i])<span class="sc">:</span>((<span class="dv">2</span> <span class="sc">*</span> i) <span class="sc">+</span> r[i]), i] <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">rbind</span>(S[(<span class="dv">1</span><span class="sc">:</span>i), i], x))</span>
<span id="cb43-16"><a href="#cb43-16"></a>    }</span>
<span id="cb43-17"><a href="#cb43-17"></a>  S2 }</span>
<span id="cb43-18"><a href="#cb43-18"></a><span class="co"># Evaluate the function.</span></span>
<span id="cb43-19"><a href="#cb43-19"></a>Spaths <span class="ot">&lt;-</span> <span class="fu">S.paths</span>(<span class="dv">50</span>, <span class="fl">0.3</span>, <span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb43-20"><a href="#cb43-20"></a><span class="co"># A table.</span></span>
<span id="cb43-21"><a href="#cb43-21"></a><span class="fu">colnames</span>(Spaths) <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>, <span class="dv">10</span>))), <span class="dv">2</span>)</span>
<span id="cb43-22"><a href="#cb43-22"></a><span class="fu">round</span>(Spaths, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       0   0.1   0.2   0.3   0.4   0.5   0.6   0.7    0.8    0.9      1
 [1,] NA    NA    NA    NA    NA    NA    NA    NA     NA     NA 129.12
 [2,] NA    NA    NA    NA    NA    NA    NA    NA     NA 117.43     NA
 [3,] NA    NA    NA    NA    NA    NA    NA    NA 106.80     NA 106.80
 [4,] NA    NA    NA    NA    NA    NA    NA 97.13     NA  97.13     NA
 [5,] NA    NA    NA    NA    NA    NA 88.34    NA  88.34     NA  88.34
 [6,] NA    NA    NA    NA    NA 80.35    NA 80.35     NA  80.35     NA
 [7,] NA    NA    NA    NA 73.08    NA 73.08    NA  73.08     NA  73.08
 [8,] NA    NA    NA 66.46    NA 66.46    NA 66.46     NA  66.46     NA
 [9,] NA    NA 60.45    NA 60.45    NA 60.45    NA  60.45     NA  60.45
[10,] NA 54.98    NA 54.98    NA 54.98    NA 54.98     NA  54.98     NA
[11,] 50    NA 50.00    NA 50.00    NA 50.00    NA  50.00     NA  50.00
[12,] NA 45.47    NA 45.47    NA 45.47    NA 45.47     NA  45.47     NA
[13,] NA    NA 41.36    NA 41.36    NA 41.36    NA  41.36     NA  41.36
[14,] NA    NA    NA 37.62    NA 37.62    NA 37.62     NA  37.62     NA
[15,] NA    NA    NA    NA 34.21    NA 34.21    NA  34.21     NA  34.21
[16,] NA    NA    NA    NA    NA 31.11    NA 31.11     NA  31.11     NA
[17,] NA    NA    NA    NA    NA    NA 28.30    NA  28.30     NA  28.30
[18,] NA    NA    NA    NA    NA    NA    NA 25.74     NA  25.74     NA
[19,] NA    NA    NA    NA    NA    NA    NA    NA  23.41     NA  23.41
[20,] NA    NA    NA    NA    NA    NA    NA    NA     NA  21.29     NA
[21,] NA    NA    NA    NA    NA    NA    NA    NA     NA     NA  19.36
[22,] NA    NA    NA    NA    NA    NA    NA    NA     NA     NA     NA</code></pre>
</div>
</div>
<p>Graphically:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>nona <span class="ot">&lt;-</span> <span class="sc">!</span> <span class="fu">is.na</span>(Spaths)</span>
<span id="cb45-2"><a href="#cb45-2"></a>bin_paths <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">st =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)<span class="sc">/</span><span class="dv">10</span><span class="fl">-0.1</span>, <span class="at">pa =</span> Spaths[nona])</span>
<span id="cb45-3"><a href="#cb45-3"></a><span class="fu">plot</span>(bin_paths<span class="sc">$</span>st, bin_paths<span class="sc">$</span>pa, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[t])),</span>
<span id="cb45-4"><a href="#cb45-4"></a>     <span class="at">xlab =</span> <span class="st">"t"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-sbpfsts" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-sbpfsts-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.4: <span class="math inline">\(S_t\)</span> binomial paths from <span class="math inline">\(S_0\)</span> to <span class="math inline">\(S_T\)</span>.</figcaption>
</figure>
</div>
</div>
</div>
<p>Nice. Evaluate the function for a single 2-step case: <span class="math inline">\(S_0=\$50\)</span>, <span class="math inline">\(K=\$52\)</span>, <span class="math inline">\(\sigma = 0.3\)</span>, <span class="math inline">\(T=2\)</span>, <span class="math inline">\(rf=0.05\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="co"># bin &lt;- function(S0, K, sigma, TM, r, steps) {</span></span>
<span id="cb46-2"><a href="#cb46-2"></a>b2 <span class="ot">&lt;-</span> <span class="fu">mapply</span>(bin, <span class="dv">50</span>, <span class="dv">52</span>, <span class="fl">0.3</span>, <span class="dv">2</span>, <span class="fl">0.05</span>, <span class="dv">2</span>)</span>
<span id="cb46-3"><a href="#cb46-3"></a>b2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]    
c.eu 9.194163
p.eu 6.245708
c.am 9.194163
p.am 7.428402</code></pre>
</div>
</div>
<p>There is no difference between American and European call options theoretical prices as there are no incentives to exercise American call options early. The case of put options is different as incentives to exercise American put options early may arise. As a consequence, American put options are in general more expensive than European put options.</p>
<p>Let’s evaluate this difference in a 50-step case: <span class="math inline">\(K=\$52\)</span>, <span class="math inline">\(\sigma = 0.3\)</span>, <span class="math inline">\(T=2\)</span>, <span class="math inline">\(rf=0.05\)</span>, and different values of <span class="math inline">\(S_0\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>S.seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">80</span>, <span class="fl">0.5</span>)</span>
<span id="cb48-2"><a href="#cb48-2"></a>AEoptions <span class="ot">&lt;-</span> <span class="fu">mapply</span>(bin, S.seq, <span class="dv">52</span>, <span class="fl">0.3</span>, <span class="dv">1</span>, <span class="fl">0.05</span>, <span class="dv">50</span>)</span>
<span id="cb48-3"><a href="#cb48-3"></a><span class="fu">plot</span>(S.seq, <span class="fu">unlist</span>(AEoptions[<span class="dv">4</span>,]) <span class="sc">-</span> <span class="fu">unlist</span>(AEoptions[<span class="dv">2</span>,]), </span>
<span id="cb48-4"><a href="#cb48-4"></a>     <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lwd =</span> <span class="dv">5</span>, <span class="at">main =</span> <span class="st">"The value of being American."</span>,</span>
<span id="cb48-5"><a href="#cb48-5"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[<span class="dv">0</span>])),</span>
<span id="cb48-6"><a href="#cb48-6"></a>     <span class="at">ylab =</span> <span class="st">"American minus European put"</span>)</span>
<span id="cb48-7"><a href="#cb48-7"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">52</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb48-8"><a href="#cb48-8"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-tvobaotcobe" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-tvobaotcobe-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.5: The value of being American; or the cost of being European.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="real-vs.-risk-neutral-world." class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="real-vs.-risk-neutral-world."><span class="header-section-number">3.3</span> Real vs.&nbsp;risk-neutral world.</h2>
<p>This section is based on <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span> section 13.1. A stock price is currently $20, and it is known that at the end of 3 months it will be either $22 or $18. We are interested in valuing a European call option to buy the stock for $21 in 3 months. The risk-neutral probability <span class="math inline">\(p\)</span> for the case of <span class="math inline">\(rf=0.12\)</span>, <span class="math inline">\(T=3/12\)</span>, <span class="math inline">\(u=1.1\)</span> and <span class="math inline">\(d=0.9\)</span>:</p>
<p><span class="math inline">\(p = \frac{e^{rT}-d}{u-d} \rightarrow p = \frac{e^{0.12\times(3/12)}-0.9}{1.1-0.9} \rightarrow p = \$0.6522727\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># This is the substitution of equation 13.3.</span></span>
<span id="cb49-2"><a href="#cb49-2"></a>rnp <span class="ot">&lt;-</span> (<span class="fu">exp</span>(<span class="fl">0.12</span><span class="sc">*</span>(<span class="dv">3</span><span class="sc">/</span><span class="dv">12</span>))<span class="sc">-</span><span class="fl">0.9</span>)<span class="sc">/</span>(<span class="fl">1.1-0.9</span>)</span>
<span id="cb49-3"><a href="#cb49-3"></a>rnp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6522727</code></pre>
</div>
</div>
<p>Following <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span>, this option will have one of two values at the end of the 3 months. If the stock price turns out to be $22, the value of the option will be $1; if the stock price turns out to be $18, the value of the option will be zero. This is the European call option expected value at time <span class="math inline">\(T\)</span>:</p>
<p><span class="math inline">\([p\times(\$1)] + [(1-p)\times \$0]\)</span></p>
<p><span class="math inline">\(\rightarrow [0.6522727\times(\$1)] + [(1-0.6522727)\times \$0] = \$0.6522727\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>option_T <span class="ot">&lt;-</span> rnp <span class="sc">*</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> rnp) <span class="sc">*</span> <span class="dv">0</span></span>
<span id="cb51-2"><a href="#cb51-2"></a>option_T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6522727</code></pre>
</div>
</div>
<p>We can calculate the European call option value at <span class="math inline">\(t=0\)</span> according to the risk-neutral valuation. This option value <span class="math inline">\(f\)</span> is valid in the real world, not only in the risk-neutral world.</p>
<p><span class="math inline">\(f = \$0.6522727 \times e^{-rT} \rightarrow f = \$0.6522727 \times e^{-0.12\times3/12} \rightarrow f = \$0.6329951\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>option_0 <span class="ot">&lt;-</span> option_T <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.12</span><span class="sc">*</span>(<span class="dv">3</span><span class="sc">/</span><span class="dv">12</span>))</span>
<span id="cb53-2"><a href="#cb53-2"></a>option_0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6329951</code></pre>
</div>
</div>
<p>Suppose that, in the real world, we know the expected return on the stock is 16%. This is easily calculated as we have historical information of stock returns. It is also a reasonable assumption as this is higher than the risk-free rate. Then, the probability of an up movement in the real world <span class="math inline">\(p^*\)</span> is:</p>
<p><span class="math inline">\(p^* = \frac{e^{rT}-d}{u-d} \rightarrow p^* = \frac{e^{0.16\times(3/12)}-0.9}{1.1-0.9} \rightarrow p^* = 0.7040539\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="co"># Real world probability.</span></span>
<span id="cb55-2"><a href="#cb55-2"></a>p.real <span class="ot">&lt;-</span> (<span class="fu">exp</span>(<span class="fl">0.16</span><span class="sc">*</span>(<span class="dv">3</span><span class="sc">/</span><span class="dv">12</span>))<span class="sc">-</span><span class="fl">0.9</span>)<span class="sc">/</span>(<span class="fl">1.1-0.9</span>)</span>
<span id="cb55-3"><a href="#cb55-3"></a>p.real</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7040539</code></pre>
</div>
</div>
<p>This is the option expected value in the real world at time <span class="math inline">\(T\)</span>:</p>
<p><span class="math inline">\([p^*\times(\$1)] + [(1-p^*)\times \$0]\)</span></p>
<p><span class="math inline">\(\rightarrow 0.7040539\times(\$1) + (1-0.7040539)\times \$0 = \$0.7040539\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>option_T_real <span class="ot">&lt;-</span> p.real<span class="sc">*</span><span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">-</span>p.real)<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb57-2"><a href="#cb57-2"></a>option_T_real</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7040539</code></pre>
</div>
</div>
<p>Can we calculate the present value of $0.7040539? We only need the option discount factor in the real world. The problem is that we do not know this rate, it should be higher than the risk-free rate, even higher than the the expected return on the stock. It is not easy to know the correct discount rate of the option to apply to the expected payoff in the real world. Using risk-neutral valuation solves this problem because we know that in a risk-neutral world the expected return on all assets (and therefore the discount rate to use for all expected payoffs) is the risk-free rate.</p>
<p>What can we do to find out the option discount factor? Since we know the correct value of the option is <span class="math inline">\(f=\$0.6329951\)</span> in both real and risk-neutral world, we can deduce the real-world discount rate <span class="math inline">\(r\)</span> of this European call option.</p>
<p>We know this is true: <span class="math inline">\(\$0.6329951 = \$0.704053e^{-r\times3/12}\)</span>.</p>
<p>Then, solve for <span class="math inline">\(r\)</span>: <span class="math inline">\(\rightarrow \frac{\$0.6329951}{\$0.704053} = e^{-r\times3/12}\)</span>,</p>
<p><span class="math inline">\(\rightarrow log{\frac{\$0.6329951}{\$0.704053}} = -r\times3/12\)</span>,</p>
<p><span class="math inline">\(\rightarrow r = -log{\frac{\$0.6329951}{\$0.704053}}\times12/3\)</span>,</p>
<p><span class="math inline">\(\rightarrow r=0.4255688\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a>option.df <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log</span>(option_0<span class="sc">/</span>option_T_real)<span class="sc">*</span>(<span class="dv">12</span><span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb59-2"><a href="#cb59-2"></a>option.df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4255688</code></pre>
</div>
</div>
<p>The <em>implied</em> real-world discount rate for the option is 42.55688%. Let’s put everything in a function.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a>option.df.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(r) {</span>
<span id="cb61-2"><a href="#cb61-2"></a>  p.real <span class="ot">&lt;-</span> (<span class="fu">exp</span>(r<span class="sc">*</span>(<span class="dv">3</span><span class="sc">/</span><span class="dv">12</span>))<span class="sc">-</span><span class="fl">0.9</span>)<span class="sc">/</span>(<span class="fl">1.1-0.9</span>)</span>
<span id="cb61-3"><a href="#cb61-3"></a>  option_T_real <span class="ot">&lt;-</span> p.real<span class="sc">*</span><span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">-</span>p.real)<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb61-4"><a href="#cb61-4"></a>  option.df <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log</span>(option_0<span class="sc">/</span>option_T_real)<span class="sc">*</span>(<span class="dv">12</span><span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb61-5"><a href="#cb61-5"></a>option.df</span>
<span id="cb61-6"><a href="#cb61-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Evaluate for known values:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="fu">option.df.fun</span>(<span class="fl">0.12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.12</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="fu">option.df.fun</span>(<span class="fl">0.16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4255688</code></pre>
</div>
</div>
<p>Everything looks correct.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="co"># Evaluate the function in a range of values.</span></span>
<span id="cb66-2"><a href="#cb66-2"></a>r.seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.11</span>, <span class="fl">0.17</span>, <span class="fl">0.001</span>)</span>
<span id="cb66-3"><a href="#cb66-3"></a>df <span class="ot">&lt;-</span> <span class="fu">mapply</span>(option.df.fun, r.seq)</span>
<span id="cb66-4"><a href="#cb66-4"></a><span class="fu">plot</span>(r.seq, df, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lwd =</span> <span class="dv">5</span>, </span>
<span id="cb66-5"><a href="#cb66-5"></a>     <span class="at">xlab =</span> <span class="st">"Expected return of the stock (the underlying)"</span>,</span>
<span id="cb66-6"><a href="#cb66-6"></a>     <span class="at">ylab =</span> <span class="st">"Expected return of the option"</span>)</span>
<span id="cb66-7"><a href="#cb66-7"></a><span class="fu">points</span>(<span class="fl">0.12</span>, <span class="fl">0.12</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">cex =</span> <span class="dv">3</span>)</span>
<span id="cb66-8"><a href="#cb66-8"></a><span class="fu">points</span>(<span class="fl">0.16</span>, <span class="fl">0.4255688</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">cex =</span> <span class="dv">3</span>)</span>
<span id="cb66-9"><a href="#cb66-9"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fl">0.12</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb66-10"><a href="#cb66-10"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">option.df.fun</span>(<span class="fl">0.12</span>), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb66-11"><a href="#cb66-11"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fl">0.16</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb66-12"><a href="#cb66-12"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">option.df.fun</span>(<span class="fl">0.16</span>), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-rpbp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-rpbp-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.6: Red pill, blue pill.</figcaption>
</figure>
</div>
</div>
</div>
<p>As in the movie, <em>The Matrix</em>, the blue pill describes living life without knowing its meaning or running away from the truth in order to stay as is. This is equivalent to the risk-neutral world. The red pill is described as the solution for knowing the real truth in life. This is equivalent to the real-world.</p>
</section>
<section id="parrondos-paradox." class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="parrondos-paradox."><span class="header-section-number">3.4</span> Parrondo’s paradox.</h2>
<p>The Parrondo’s paradox is controversial in the literature, we are not going to elaborate on that. However, it is indeed interesting as it looks counterintuitive: <em>Can we combine two losing investments into a winner?</em></p>
<p>This video was created by Professor Humberto Barreto from DePauw University, Indiana, based on a now-defunct app from Alexander Bogomolny of the well-known maths site <em>Cut the Knot</em>. It illustrates the general idea of Parrondo’s paradox.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="fu">embed_url</span>(<span class="st">"https://youtu.be/cEuyfD2qVgQ"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/cEuyfD2qVgQ" width="533" height="300" frameborder="0" allowfullscreen="" data-external="1"></iframe>
</div>
</div>
</div>
</div>
<p>Consider asset A which has a known 6% gross return. In the context of a binomial tree: <span class="math inline">\([p\times(1+u)]+[(1-p)\times(1-d)]=1.06\)</span>. Let’s assume <span class="math inline">\(p=0.5\)</span>, so we have:</p>
<p><span class="math inline">\(0.5(1+u)+0.5(1-d)=1.06\)</span>.</p>
<p>Asset A has a known 40% volatility, so:</p>
<p><span class="math inline">\(0.4=\sqrt{0.5(1+u)^2+0.5(1-d)^2-1.06^2}\)</span>.</p>
<p>We have two equations and two unknown variables, so we can solve for <span class="math inline">\((1+u)\)</span> and <span class="math inline">\((1-d)\)</span>: <span class="math inline">\((1+u)=1.46\)</span> and <span class="math inline">\((1-d)=0.66\)</span>. In a period of 5 years, we would have a random path of ups (1.46) and downs (0.66) for asset A.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a>u <span class="ot">=</span> <span class="fl">0.46</span></span>
<span id="cb68-2"><a href="#cb68-2"></a>d <span class="ot">=</span> <span class="fl">0.34</span></span>
<span id="cb68-3"><a href="#cb68-3"></a><span class="fu">set.seed</span>(<span class="dv">2</span>, <span class="at">sample.kind =</span> <span class="st">"Rounding"</span>)</span>
<span id="cb68-4"><a href="#cb68-4"></a>a <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">+</span>u, <span class="dv">1</span><span class="sc">-</span>d), <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-5"><a href="#cb68-5"></a>a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.46 0.66 0.66 1.46 0.66</code></pre>
</div>
</div>
<p>Graphically:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="fu">barplot</span>(<span class="fu">c</span>(<span class="dv">0</span>, a<span class="dv">-1</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.6</span>, <span class="fl">0.6</span>), <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"Returns: u or d."</span>),</span>
<span id="cb70-2"><a href="#cb70-2"></a>        <span class="at">col =</span> <span class="fu">ifelse</span>(<span class="fu">c</span>(<span class="dv">0</span>, a<span class="dv">-1</span>) <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>))</span>
<span id="cb70-3"><a href="#cb70-3"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-fysouadfaa" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-fysouadfaa-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.7: 5-year simulation of <span class="math inline">\(u\)</span> and <span class="math inline">\(d\)</span> for asset A.</figcaption>
</figure>
</div>
</div>
</div>
<p>The evolution of $1 dollar invested in this 5 year period would look like this:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="fu">cumprod</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.4600000 0.9636000 0.6359760 0.9285250 0.6128265</code></pre>
</div>
</div>
<p>Graphically:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="fu">plot</span>(<span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(a)), <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">lwd =</span> <span class="dv">5</span>,</span>
<span id="cb73-2"><a href="#cb73-2"></a>     <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"Cumulative $ return"</span>), <span class="at">xlab =</span> <span class="fu">c</span>(<span class="st">"Year"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-fysocrfaa" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-fysocrfaa-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.8: 5-year simulation of cumulative returns for asset A.</figcaption>
</figure>
</div>
</div>
</div>
<p>Even simpler and quicker, a <span class="math inline">\(\$1\)</span> dollar invested at <span class="math inline">\(t=0\)</span> would lead to <span class="math inline">\(\$0.6128265\)</span> at <span class="math inline">\(t=5\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a><span class="fu">prod</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6128265</code></pre>
</div>
</div>
<p>Let’s use a function now.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a>binomial_tree <span class="ot">&lt;-</span> <span class="cf">function</span>(u, d, n) {</span>
<span id="cb76-2"><a href="#cb76-2"></a>  <span class="fu">prod</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">+</span>u, <span class="dv">1</span><span class="sc">-</span>d), n, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb76-3"><a href="#cb76-3"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>See if it works. Calculate the asset A cumulative return of a 5-year and 30-year investment.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>, <span class="at">sample.kind =</span> <span class="st">"Rounding"</span>)</span>
<span id="cb77-2"><a href="#cb77-2"></a><span class="fu">binomial_tree</span>(<span class="at">u =</span> <span class="fl">0.46</span>, <span class="at">d =</span> <span class="fl">0.34</span>, <span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6128265</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>, <span class="at">sample.kind =</span> <span class="st">"Rounding"</span>)</span>
<span id="cb79-2"><a href="#cb79-2"></a><span class="fu">binomial_tree</span>(<span class="at">u =</span> <span class="fl">0.46</span>, <span class="at">d =</span> <span class="fl">0.34</span>, <span class="at">n =</span> <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.805884</code></pre>
</div>
</div>
<p>It works, a <span class="math inline">\(\$1\)</span> dollar invested at <span class="math inline">\(t=0\)</span> would lead to <span class="math inline">\(\$0.6128265\)</span> in 5 years as we show before. And now we know that a <span class="math inline">\(\$1\)</span> dollar invested at <span class="math inline">\(t=0\)</span> would lead <span class="math inline">\(\$2.805884\)</span> in 30 years. Let’s view the 30 year case:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a>u <span class="ot">=</span> <span class="fl">0.46</span></span>
<span id="cb81-2"><a href="#cb81-2"></a>d <span class="ot">=</span> <span class="fl">0.34</span></span>
<span id="cb81-3"><a href="#cb81-3"></a>n <span class="ot">=</span> <span class="dv">30</span></span>
<span id="cb81-4"><a href="#cb81-4"></a><span class="fu">set.seed</span>(<span class="dv">2</span>, <span class="at">sample.kind =</span> <span class="st">"Rounding"</span>)</span>
<span id="cb81-5"><a href="#cb81-5"></a>a<span class="fl">.30</span> <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">+</span>u, <span class="dv">1</span><span class="sc">-</span>d), n, <span class="at">replace =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb81-6"><a href="#cb81-6"></a>a<span class="fl">.30</span> <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(<span class="at">year =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">30</span>), <span class="at">ret =</span> a<span class="fl">.30</span>))</span>
<span id="cb81-7"><a href="#cb81-7"></a></span>
<span id="cb81-8"><a href="#cb81-8"></a><span class="fu">ggplot</span>(a<span class="fl">.30</span>, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> ret)) <span class="sc">+</span></span>
<span id="cb81-9"><a href="#cb81-9"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb81-10"><a href="#cb81-10"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">5</span>, <span class="at">y =</span> <span class="fl">0.6128265</span>), <span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb81-11"><a href="#cb81-11"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Cumulative return"</span>, <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb81-12"><a href="#cb81-12"></a>       <span class="at">subtitle =</span> <span class="st">"Evolution of $1 invested in year 0."</span>) <span class="sc">+</span></span>
<span id="cb81-13"><a href="#cb81-13"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-tycraa" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-tycraa-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.9: 30-year cumulative return asset A.</figcaption>
</figure>
</div>
</div>
</div>
<p>These results represent one single path. So, if we are interested in the most likely value of our investment we need to simulate many paths and then estimate the median. Let’s simulate 10,000 paths and see the most likely value of our <span class="math inline">\(\$1\)</span> dollar investment in 30 years.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a>u <span class="ot">=</span> <span class="fl">0.46</span></span>
<span id="cb82-2"><a href="#cb82-2"></a>d <span class="ot">=</span> <span class="fl">0.34</span></span>
<span id="cb82-3"><a href="#cb82-3"></a>n <span class="ot">=</span> <span class="dv">30</span></span>
<span id="cb82-4"><a href="#cb82-4"></a><span class="fu">set.seed</span>(<span class="dv">2</span>, <span class="at">sample.kind =</span> <span class="st">"Rounding"</span>)</span>
<span id="cb82-5"><a href="#cb82-5"></a>a<span class="fl">.30</span>x10k <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">10000</span>, </span>
<span id="cb82-6"><a href="#cb82-6"></a>                  <span class="fu">cumprod</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">+</span>u, <span class="dv">1</span><span class="sc">-</span>d), n, <span class="at">replace =</span> <span class="cn">TRUE</span>))) <span class="sc">|&gt;</span></span>
<span id="cb82-7"><a href="#cb82-7"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb82-8"><a href="#cb82-8"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>)) <span class="sc">|&gt;</span></span>
<span id="cb82-9"><a href="#cb82-9"></a>  <span class="fu">gather</span>(V1<span class="sc">:</span>V10000, <span class="at">key =</span> name, <span class="at">value =</span> c.ret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>See the results.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a>a<span class="fl">.30</span>x10k <span class="sc">|&gt;</span></span>
<span id="cb83-2"><a href="#cb83-2"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> c.ret, <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb83-3"><a href="#cb83-3"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb83-4"><a href="#cb83-4"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">1</span>), <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb83-5"><a href="#cb83-5"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">legend.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb83-6"><a href="#cb83-6"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Cumulative return"</span>, <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb83-7"><a href="#cb83-7"></a>  <span class="at">subtitle =</span> <span class="st">"10,000 paths of the evolution of $1 invested in year 0."</span>) <span class="sc">+</span></span>
<span id="cb83-8"><a href="#cb83-8"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-tycraamp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-tycraamp-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.10: 30-year cumulative return asset A, many paths.</figcaption>
</figure>
</div>
</div>
</div>
<p>Most of these paths are concentrated in low cumulative returns by the end of the 30 years. In fact, 1,586 paths end up with a cumulative return lower than $1 by the end of the 30 years:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a>a<span class="fl">.30</span>x10k <span class="sc">|&gt;</span></span>
<span id="cb84-2"><a href="#cb84-2"></a>  <span class="fu">group_by</span>(name) <span class="sc">|&gt;</span></span>
<span id="cb84-3"><a href="#cb84-3"></a>  <span class="fu">filter</span>(c.ret <span class="sc">&lt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb84-4"><a href="#cb84-4"></a>  <span class="fu">filter</span>(<span class="fu">length</span>(year) <span class="sc">==</span> <span class="dv">30</span>) <span class="sc">|&gt;</span></span>
<span id="cb84-5"><a href="#cb84-5"></a>  <span class="fu">distinct</span>(name) <span class="sc">|&gt;</span></span>
<span id="cb84-6"><a href="#cb84-6"></a>  <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1586</code></pre>
</div>
</div>
<p>Let’s plot these 1,586 paths.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a>a<span class="fl">.30</span>x10k <span class="sc">|&gt;</span></span>
<span id="cb86-2"><a href="#cb86-2"></a>  <span class="fu">group_by</span>(name) <span class="sc">|&gt;</span></span>
<span id="cb86-3"><a href="#cb86-3"></a>  <span class="fu">filter</span>(c.ret <span class="sc">&lt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb86-4"><a href="#cb86-4"></a>  <span class="fu">filter</span>(<span class="fu">length</span>(year) <span class="sc">==</span> <span class="dv">30</span>) <span class="sc">|&gt;</span></span>
<span id="cb86-5"><a href="#cb86-5"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> c.ret, <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb86-6"><a href="#cb86-6"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb86-7"><a href="#cb86-7"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">1</span>), <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb86-8"><a href="#cb86-8"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">legend.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb86-9"><a href="#cb86-9"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Cumulative return"</span>, <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb86-10"><a href="#cb86-10"></a>  <span class="at">subtitle =</span> <span class="st">"1,586 paths of the evolution of $1 invested in year 0."</span>) <span class="sc">+</span></span>
<span id="cb86-11"><a href="#cb86-11"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-tycraa1sp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-tycraa1sp-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.11: 30-year cumulative return asset A, 1,586 selected paths.</figcaption>
</figure>
</div>
</div>
</div>
<p>The figure above looks still unclear as the concentration around $0 is still high. It is better to show the results in logarithm form.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a>a<span class="fl">.30</span>x10k <span class="sc">|&gt;</span></span>
<span id="cb87-2"><a href="#cb87-2"></a>  <span class="fu">group_by</span>(name) <span class="sc">|&gt;</span></span>
<span id="cb87-3"><a href="#cb87-3"></a>  <span class="fu">filter</span>(c.ret <span class="sc">&lt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb87-4"><a href="#cb87-4"></a>  <span class="fu">filter</span>(<span class="fu">length</span>(year) <span class="sc">==</span> <span class="dv">30</span>) <span class="sc">|&gt;</span></span>
<span id="cb87-5"><a href="#cb87-5"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> <span class="fu">log</span>(c.ret), <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb87-6"><a href="#cb87-6"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb87-7"><a href="#cb87-7"></a>  <span class="fu">geom_point</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.01</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb87-8"><a href="#cb87-8"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fu">log</span>(<span class="dv">1</span>)), <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb87-9"><a href="#cb87-9"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, </span>
<span id="cb87-10"><a href="#cb87-10"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb87-11"><a href="#cb87-11"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Log cumulative return"</span>, <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb87-12"><a href="#cb87-12"></a>  <span class="at">subtitle =</span> <span class="st">"Losing paths."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-tylcraa1sp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-tylcraa1sp-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.12: 30-year log cumulative return asset A, 1,586 selected paths.</figcaption>
</figure>
</div>
</div>
</div>
<p>The figure now resembles a binomial tree. The black circles are more transparent for less concentrated values and less transparent for more concentrated values.</p>
<p>Let’s do a similar plot for all the 10,000 paths.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a>a<span class="fl">.30</span>x10k <span class="sc">|&gt;</span></span>
<span id="cb88-2"><a href="#cb88-2"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> <span class="fu">log</span>(c.ret), <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb88-3"><a href="#cb88-3"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb88-4"><a href="#cb88-4"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fu">log</span>(<span class="dv">1</span>)), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb88-5"><a href="#cb88-5"></a>  <span class="fu">geom_point</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.01</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb88-6"><a href="#cb88-6"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">legend.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb88-7"><a href="#cb88-7"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Log cumulative returns"</span>, <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb88-8"><a href="#cb88-8"></a>  <span class="at">subtitle =</span> <span class="st">"10,000 paths of the evolution of $1 invested in year 0."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-tylcraamp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-tylcraamp-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.13: 30-year Log cumulative return asset A, many paths.</figcaption>
</figure>
</div>
</div>
</div>
<p>Here it is easier to see that the paths actually follow a binomial structure. Now, let’s see the summary statistics for the 10,000 possible investment value at year 30.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>, <span class="at">sample.kind =</span> <span class="st">"Rounding"</span>)</span>
<span id="cb89-2"><a href="#cb89-2"></a><span class="fu">summary</span>(<span class="fu">replicate</span>(<span class="dv">10000</span>, <span class="fu">binomial_tree</span>(<span class="at">u =</span> <span class="fl">0.46</span>, <span class="at">d =</span> <span class="fl">0.34</span>, <span class="dv">30</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
   0.000    0.117    0.573    5.816    2.806 3559.180 </code></pre>
</div>
</div>
<p>Not good news as our 30 year investment of <span class="math inline">\(\$1\)</span> in this asset A with 6% gross return and 40% volatility leads to <span class="math inline">\(\$0.5733923\)</span>. Even if we drop the <tt><code>set.seed()</code></tt>, we end with the same result.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="fu">median</span>(<span class="fu">replicate</span>(<span class="dv">10000</span>, <span class="fu">binomial_tree</span>(<span class="at">u =</span> <span class="fl">0.46</span>, <span class="at">d =</span> <span class="fl">0.34</span>, <span class="dv">30</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5733923</code></pre>
</div>
</div>
<p>It would be a mistake to consider the mean $5.816 as the estimated value of our investment in asset A since the maximum value is very high and not likely to happen. Note that the mean is very close to <span class="math inline">\((\$1+0.06)^{30}=\$5.743491\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a>(<span class="dv">1</span><span class="fl">+0.06</span>)<span class="sc">^</span><span class="dv">30</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.743491</code></pre>
</div>
</div>
<p>The asset A is then a loosing investment, <span class="math inline">\(\$1\)</span> would most likely lead to <span class="math inline">\(\$0.5733923\)</span> in 30 years.</p>
<p>Now, let’s consider an asset B. Asset B has a known excess return of <span class="math inline">\(-0.1\%\)</span>. In the context of a binomial tree:</p>
<p><span class="math inline">\(0.5(1+u)+0.5(1-d)=0.999\)</span>.</p>
<p>Asset B has no volatility, imagine is a Treasury Bill or a similar risk-free asset. Solving for <span class="math inline">\((1+u)\)</span> and <span class="math inline">\((1-d)\)</span> leads to <span class="math inline">\((1+u)=0.999\)</span> and <span class="math inline">\((1-d)=0.999\)</span>. Asset B is for sure a loosing investment as well.</p>
<p>In a period of 5 years, we would have a random path of ups and downs in the context of a binomial path. Although in this case the result is the same as we have no risk.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a>b <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">+</span>(<span class="sc">-</span><span class="fl">0.001</span>), <span class="dv">1</span><span class="sc">-</span>(<span class="fl">0.001</span>)), <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb95-2"><a href="#cb95-2"></a>b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.999 0.999 0.999 0.999 0.999</code></pre>
</div>
</div>
<p>The evolution of $1 dollar invested in this 5-year period would look like this:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="fu">cumprod</span>(b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.999000 0.998001 0.997003 0.996006 0.995010</code></pre>
</div>
</div>
<p>Or simply:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a><span class="fu">prod</span>(b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.99501</code></pre>
</div>
</div>
<p>As stated earlier, this asset B is a loosing investment. Let’s verify this for 5 and 30 years as we did before for the case of asset A:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a>binomial_tree <span class="ot">&lt;-</span> <span class="cf">function</span>(u, d, n) {</span>
<span id="cb101-2"><a href="#cb101-2"></a>  <span class="fu">prod</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">+</span>u, <span class="dv">1</span><span class="sc">-</span>d), n, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb101-3"><a href="#cb101-3"></a>}</span>
<span id="cb101-4"><a href="#cb101-4"></a><span class="fu">set.seed</span>(<span class="dv">2</span>, <span class="at">sample.kind =</span> <span class="st">"Rounding"</span>)</span>
<span id="cb101-5"><a href="#cb101-5"></a><span class="fu">binomial_tree</span>(<span class="at">u =</span> (<span class="sc">-</span><span class="fl">0.001</span>), <span class="at">d =</span> (<span class="fl">0.001</span>), <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.99501</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a><span class="fu">binomial_tree</span>(<span class="at">u =</span> (<span class="sc">-</span><span class="fl">0.001</span>), <span class="at">d =</span> (<span class="fl">0.001</span>), <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.970431</code></pre>
</div>
</div>
<p>It works, a <span class="math inline">\(\$1\)</span> dollar invested at <span class="math inline">\(t=0\)</span> would lead to <span class="math inline">\(\$0.99501\)</span> in 5 years. And now we know that a <span class="math inline">\(\$1\)</span> dollar invested at <span class="math inline">\(t=0\)</span> would lead to <span class="math inline">\(\$0.970431\)</span> in 30 years. These results represent one single path, but we do not need more as there is no risk. Let’s confirm:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>, <span class="at">sample.kind =</span> <span class="st">"Rounding"</span>)</span>
<span id="cb105-2"><a href="#cb105-2"></a><span class="fu">median</span>(<span class="fu">replicate</span>(<span class="dv">10000</span>, <span class="fu">binomial_tree</span>(<span class="at">u =</span> <span class="sc">-</span><span class="fl">0.001</span>, <span class="at">d =</span> <span class="fl">0.001</span>, <span class="dv">30</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.970431</code></pre>
</div>
</div>
<p>The result is the same. Asset B is a loosing investment as well. But, what if we combine both assets A and B in an equally weighted portfolio C?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>, <span class="at">sample.kind =</span> <span class="st">"Rounding"</span>)</span>
<span id="cb107-2"><a href="#cb107-2"></a><span class="fu">median</span>(<span class="fu">replicate</span>(<span class="dv">1</span>, <span class="fu">binomial_tree</span>(<span class="at">u =</span> (<span class="fl">0.46-0.001</span>)<span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb107-3"><a href="#cb107-3"></a>                                      <span class="at">d =</span> (<span class="fl">0.34+0.001</span>)<span class="sc">/</span><span class="dv">2</span>, <span class="dv">30</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.951197</code></pre>
</div>
</div>
<p>This is how we combine two losing investments into a winner.</p>
<p>The new asset C or portfolio C has a return of: <span class="math inline">\(0.06/2 - 0.001/2=0.0295%\)</span> or <span class="math inline">\(2.95\%\)</span>.</p>
<p>The volatility of C is <span class="math inline">\(\sqrt{0.5^2(0.4)^2+0.5^2(0)^2-0}=0.2\)</span> or <span class="math inline">\(20\%\)</span>.</p>
<p>Therefore, portfolio C has a lower return and risk than asset A. Given that A and B are uncorrelated, the diversification gain is high so we can combine two losing investments into a winner.</p>
<p>Let’s visualize how these assets behave. I have to set the seed to have nice results. But as we show before this works well when simulating many paths and computing the median to evaluate the expected cumulative return of each asset.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1"></a>u <span class="ot">=</span> <span class="fl">0.46</span></span>
<span id="cb109-2"><a href="#cb109-2"></a>d <span class="ot">=</span> <span class="fl">0.34</span></span>
<span id="cb109-3"><a href="#cb109-3"></a>xx <span class="ot">=</span> <span class="dv">8</span></span>
<span id="cb109-4"><a href="#cb109-4"></a><span class="fu">set.seed</span>(xx, <span class="at">sample.kind =</span> <span class="st">"Rounding"</span>)</span>
<span id="cb109-5"><a href="#cb109-5"></a>a30 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">+</span>u, <span class="dv">1</span><span class="sc">-</span>d), <span class="dv">30</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb109-6"><a href="#cb109-6"></a>u <span class="ot">=</span> <span class="sc">-</span> <span class="fl">0.001</span></span>
<span id="cb109-7"><a href="#cb109-7"></a>d <span class="ot">=</span> <span class="fl">0.001</span></span>
<span id="cb109-8"><a href="#cb109-8"></a>b30 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">+</span>u, <span class="dv">1</span><span class="sc">-</span>d), <span class="dv">30</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb109-9"><a href="#cb109-9"></a>u <span class="ot">=</span> (<span class="fl">0.46</span> <span class="sc">-</span> <span class="fl">0.001</span>)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb109-10"><a href="#cb109-10"></a>d <span class="ot">=</span> (<span class="fl">0.34</span> <span class="sc">+</span> <span class="fl">0.001</span>)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb109-11"><a href="#cb109-11"></a><span class="fu">set.seed</span>(xx, <span class="at">sample.kind =</span> <span class="st">"Rounding"</span>)</span>
<span id="cb109-12"><a href="#cb109-12"></a>c30 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">+</span>u, <span class="dv">1</span><span class="sc">-</span>d), <span class="dv">30</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Below, it is clear that portfolio C wins less when asset A wins. Similarly, portfolio C looses less when asset A losses. This is because portfolio C is less risky than asset A.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a>abc <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(</span>
<span id="cb110-2"><a href="#cb110-2"></a>  <span class="at">year =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>), <span class="at">A =</span> <span class="fu">cumprod</span>(a30), </span>
<span id="cb110-3"><a href="#cb110-3"></a>  <span class="at">B =</span> <span class="fu">cumprod</span>(b30), <span class="at">C =</span> <span class="fu">cumprod</span>(c30)))</span>
<span id="cb110-4"><a href="#cb110-4"></a><span class="fu">head</span>(abc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  year         A        B        C
1    1 1.4600000 0.999000 1.229500
2    2 2.1316000 0.998001 1.511670
3    3 1.4068560 0.997003 1.253930
4    4 0.9285250 0.996006 1.040135
5    5 1.3556464 0.995010 1.278846
6    6 0.8947267 0.994015 1.060803</code></pre>
</div>
</div>
<p>This is the cumulative return evolution for each asset and portfolio C in one single path.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1"></a>abc <span class="sc">|&gt;</span></span>
<span id="cb112-2"><a href="#cb112-2"></a>  <span class="fu">gather</span>(A<span class="sc">:</span>C, <span class="at">key =</span> name, <span class="at">value =</span> c.ret) <span class="sc">|&gt;</span></span>
<span id="cb112-3"><a href="#cb112-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> c.ret, <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb112-4"><a href="#cb112-4"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb112-5"><a href="#cb112-5"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">1</span>), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb112-6"><a href="#cb112-6"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Cumulative return"</span>, <span class="at">x =</span> <span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb112-7"><a href="#cb112-7"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-tycraabapcosp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-tycraabapcosp-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.14: 30-year cumulative returns asset A, B and portfolio C, one single path.</figcaption>
</figure>
</div>
</div>
</div>
<p>Now we plot the 10,000 possible values of the 30 year cumulative returns.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>, <span class="at">sample.kind =</span> <span class="st">"Rounding"</span>)</span>
<span id="cb113-2"><a href="#cb113-2"></a>bx <span class="ot">&lt;-</span> (<span class="fu">replicate</span>(<span class="dv">10000</span>, <span class="fu">binomial_tree</span>(<span class="at">u =</span> <span class="sc">-</span><span class="fl">0.001</span>, <span class="at">d =</span> <span class="fl">0.001</span>, <span class="dv">30</span>)))</span>
<span id="cb113-3"><a href="#cb113-3"></a><span class="fu">set.seed</span>(<span class="dv">2</span>, <span class="at">sample.kind =</span> <span class="st">"Rounding"</span>)</span>
<span id="cb113-4"><a href="#cb113-4"></a>cx <span class="ot">&lt;-</span> (<span class="fu">replicate</span>(<span class="dv">10000</span>, <span class="fu">binomial_tree</span>(<span class="at">u =</span> (<span class="fl">0.46-0.001</span>)<span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb113-5"><a href="#cb113-5"></a>                                      <span class="at">d =</span> (<span class="fl">0.34+0.001</span>)<span class="sc">/</span><span class="dv">2</span>, <span class="dv">30</span>)))</span>
<span id="cb113-6"><a href="#cb113-6"></a><span class="fu">set.seed</span>(<span class="dv">2</span>, <span class="at">sample.kind =</span> <span class="st">"Rounding"</span>)</span>
<span id="cb113-7"><a href="#cb113-7"></a>ax <span class="ot">&lt;-</span>(<span class="fu">replicate</span>(<span class="dv">10000</span>, <span class="fu">binomial_tree</span>(<span class="at">u =</span> <span class="fl">0.46</span>, <span class="at">d =</span> <span class="fl">0.34</span>, <span class="dv">30</span>)))</span>
<span id="cb113-8"><a href="#cb113-8"></a></span>
<span id="cb113-9"><a href="#cb113-9"></a>abcx <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(<span class="at">year =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>), <span class="at">A =</span> ax, <span class="at">B =</span> bx, <span class="at">C =</span> cx))</span>
<span id="cb113-10"><a href="#cb113-10"></a></span>
<span id="cb113-11"><a href="#cb113-11"></a>abcx <span class="sc">|&gt;</span></span>
<span id="cb113-12"><a href="#cb113-12"></a>  <span class="fu">gather</span>(A<span class="sc">:</span>C, <span class="at">key =</span> name, <span class="at">value =</span> c.ret) <span class="sc">|&gt;</span></span>
<span id="cb113-13"><a href="#cb113-13"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">30</span>) <span class="sc">|&gt;</span></span>
<span id="cb113-14"><a href="#cb113-14"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> <span class="fu">log</span>(c.ret), <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb113-15"><a href="#cb113-15"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb113-16"><a href="#cb113-16"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb113-17"><a href="#cb113-17"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb113-18"><a href="#cb113-18"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Log cumulative returns at year 30"</span>, <span class="at">x =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-tylcraabapcotfcr" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-tylcraabapcotfcr-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.15: 30-year log cumulative returns asset A, B and portfolio C, only the final cumulative return.</figcaption>
</figure>
</div>
</div>
</div>
<p>An alternative to the boxplot is a density plot.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a>abcx <span class="sc">|&gt;</span></span>
<span id="cb114-2"><a href="#cb114-2"></a>  <span class="fu">gather</span>(A<span class="sc">:</span>C, <span class="at">key =</span> name, <span class="at">value =</span> c.ret) <span class="sc">|&gt;</span></span>
<span id="cb114-3"><a href="#cb114-3"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">30</span>) <span class="sc">|&gt;</span></span>
<span id="cb114-4"><a href="#cb114-4"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"C"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb114-5"><a href="#cb114-5"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(c.ret), <span class="at">fill =</span> name)) <span class="sc">+</span></span>
<span id="cb114-6"><a href="#cb114-6"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb114-7"><a href="#cb114-7"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb114-8"><a href="#cb114-8"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb114-9"><a href="#cb114-9"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Log cumulative returns at year 30"</span>) <span class="sc">+</span></span>
<span id="cb114-10"><a href="#cb114-10"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-tylcraabapcotfcradv" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-tylcraabapcotfcradv-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.16: 30-year log cumulative returns asset A and portfolio C, only the final cumulative return, a density view.</figcaption>
</figure>
</div>
</div>
</div>
<p>Stock price paths are useful to value option stocks. Let’s review some stochastic processes in the next section.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb115-2"><a href="#cb115-2"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb115-3"><a href="#cb115-3"></a><span class="fu">library</span>(plotly)</span>
<span id="cb115-4"><a href="#cb115-4"></a><span class="fu">library</span>(vembedr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="wiener-processes." class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Wiener processes.</h1>
<p>Here we review stochastic process that are useful in finance, especially in the Black-Scholes context. This section is based on <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span>, chapter 14.</p>
<section id="the-basic-process." class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="the-basic-process."><span class="header-section-number">4.1</span> The basic process.</h2>
<p>A simple Wiener process.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1"></a><span class="co"># A typical Wiener process.</span></span>
<span id="cb116-2"><a href="#cb116-2"></a>TT <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb116-3"><a href="#cb116-3"></a>N <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb116-4"><a href="#cb116-4"></a>dt <span class="ot">&lt;-</span> TT <span class="sc">/</span> N</span>
<span id="cb116-5"><a href="#cb116-5"></a>Time <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> dt, <span class="at">to =</span> TT, <span class="at">by =</span> dt)</span>
<span id="cb116-6"><a href="#cb116-6"></a><span class="fu">set.seed</span>(<span class="dv">560746</span>) <span class="co"># for reproducibility purposes.</span></span>
<span id="cb116-7"><a href="#cb116-7"></a>delta_z <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">*</span> dt<span class="sc">^</span><span class="fl">0.5</span> </span>
<span id="cb116-8"><a href="#cb116-8"></a>z <span class="ot">&lt;-</span> <span class="dv">25</span> <span class="sc">+</span> <span class="fu">cumsum</span>(delta_z) <span class="co"># The initial price is 25.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Graphically:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1"></a><span class="fu">plot</span>(Time, z, <span class="at">type =</span> <span class="st">"l"</span>,</span>
<span id="cb117-2"><a href="#cb117-2"></a>     <span class="at">ylab =</span> <span class="st">"z in the texbook, it could be a stock price"</span>,</span>
<span id="cb117-3"><a href="#cb117-3"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>)</span>
<span id="cb117-4"><a href="#cb117-4"></a><span class="fu">lines</span>(Time, <span class="fu">seq</span>(<span class="dv">25</span>, (<span class="dv">25</span> <span class="sc">+</span> <span class="fu">sum</span>(delta_z)), <span class="at">length.out =</span> N), <span class="at">lty =</span> <span class="dv">2</span>,</span>
<span id="cb117-5"><a href="#cb117-5"></a>      <span class="at">col =</span> <span class="st">"purple"</span>)</span>
<span id="cb117-6"><a href="#cb117-6"></a><span class="fu">points</span>(Time[<span class="dv">1</span>], <span class="dv">25</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb117-7"><a href="#cb117-7"></a><span class="fu">points</span>(Time[N], z[N], <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb117-8"><a href="#cb117-8"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="fu">round</span>(z[N], <span class="dv">2</span>)), <span class="at">bg =</span> <span class="st">"white"</span>, </span>
<span id="cb117-9"><a href="#cb117-9"></a>       <span class="at">text.col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-wp1sfbtir" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-wp1sfbtir-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4.1: Wiener process 10,000 steps from blue <span class="math inline">\(z(0)=25\)</span> to <span class="math inline">\(z(T)=26.2\)</span> in red.</figcaption>
</figure>
</div>
</div>
</div>
<p>This is a 1,000 step version of four Wiener processes:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a><span class="fu">embed_url</span>(<span class="st">"https://youtu.be/X-VRWeqG_I8"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/X-VRWeqG_I8" width="533" height="300" frameborder="0" allowfullscreen="" data-external="1"></iframe>
</div>
</div>
</div>
</div>
<p>This is supposed to mimic (at some extent) the evolution of a stock price.</p>
<p>Now, we propose to produce 100 processes.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1"></a><span class="co"># 100 Wiener processes.</span></span>
<span id="cb119-2"><a href="#cb119-2"></a><span class="fu">set.seed</span>(<span class="dv">365633</span>)</span>
<span id="cb119-3"><a href="#cb119-3"></a>mat.delta_z <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">100</span> <span class="sc">*</span> N, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>), <span class="dv">100</span>, N) </span>
<span id="cb119-4"><a href="#cb119-4"></a>mat.z1 <span class="ot">&lt;-</span> <span class="dv">25</span> <span class="sc">+</span> <span class="fu">t</span>(<span class="fu">apply</span>(mat.delta_z, <span class="dv">1</span>, cumsum)) </span>
<span id="cb119-5"><a href="#cb119-5"></a>mat.z <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">cbind</span>(<span class="fu">matrix</span>(<span class="dv">25</span>, <span class="dv">100</span>), mat.z1))</span>
<span id="cb119-6"><a href="#cb119-6"></a>Time2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, Time)</span>
<span id="cb119-7"><a href="#cb119-7"></a>pred <span class="ot">&lt;-</span> <span class="fu">mean</span>(mat.z[(N <span class="sc">+</span> <span class="dv">1</span>), ])</span>
<span id="cb119-8"><a href="#cb119-8"></a><span class="co"># 95% range.</span></span>
<span id="cb119-9"><a href="#cb119-9"></a>rangetop <span class="ot">&lt;-</span> pred <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> <span class="fu">var</span>(mat.z[(N <span class="sc">+</span> <span class="dv">1</span>), ])<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb119-10"><a href="#cb119-10"></a>rangedown <span class="ot">&lt;-</span> pred <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> <span class="fu">var</span>(mat.z[(N <span class="sc">+</span> <span class="dv">1</span>), ])<span class="sc">^</span><span class="fl">0.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Graphically.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1"></a><span class="fu">matplot</span>(Time2, mat.z, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.3</span>),</span>
<span id="cb120-2"><a href="#cb120-2"></a>     <span class="at">ylab =</span> <span class="st">"z in the texbook, it could be a stock price"</span>,</span>
<span id="cb120-3"><a href="#cb120-3"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>)</span>
<span id="cb120-4"><a href="#cb120-4"></a><span class="fu">abline</span>(<span class="at">h =</span> pred, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb120-5"><a href="#cb120-5"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb120-6"><a href="#cb120-6"></a><span class="fu">lines</span>(Time2, <span class="fu">seq</span>(<span class="dv">25</span>, pred, <span class="at">length.out =</span> N <span class="sc">+</span> <span class="dv">1</span>), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb120-7"><a href="#cb120-7"></a><span class="fu">points</span>(Time2[N <span class="sc">+</span> <span class="dv">1</span>], pred, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb120-8"><a href="#cb120-8"></a><span class="fu">points</span>(<span class="dv">0</span>, <span class="dv">25</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb120-9"><a href="#cb120-9"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="fu">round</span>(pred, <span class="dv">2</span>)), <span class="at">bg =</span> <span class="st">"white"</span>, </span>
<span id="cb120-10"><a href="#cb120-10"></a>       <span class="at">text.col =</span> <span class="st">"red"</span>)</span>
<span id="cb120-11"><a href="#cb120-11"></a><span class="fu">abline</span>(<span class="at">h =</span> rangetop, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb120-12"><a href="#cb120-12"></a><span class="fu">abline</span>(<span class="at">h =</span> rangedown, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-owp1sipa2ritmat" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-owp1sipa2ritmat-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4.2: 100 Wiener process 10,000 steps, initial price at 25, red is the mean at <span class="math inline">\(T\)</span>.</figcaption>
</figure>
</div>
</div>
</div>
<p>Let’s confirm this 95% confidence interval.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a><span class="fu">sum</span>(mat.z[(N <span class="sc">+</span> <span class="dv">1</span>), ] <span class="sc">&gt;</span> rangetop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1"></a><span class="fu">sum</span>(mat.z[(N <span class="sc">+</span> <span class="dv">1</span>), ] <span class="sc">&lt;</span> rangedown)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
<p>This means that 5 paths are outside this 95% confidence interval. Confidence intervals are then correct.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1"></a><span class="fu">summary</span>(mat.z[(N <span class="sc">+</span> <span class="dv">1</span>), ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-155.23  -29.14   23.33   25.95   72.21  310.30 </code></pre>
</div>
</div>
<p>A potential problem is that <span class="math inline">\(z\)</span> values can be negative. This is problematic when we are interested to model stock prices.</p>
<p>Let’s explore deeper the stochastic process below.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb127-2"><a href="#cb127-2"></a>delta_z <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">*</span> dt<span class="sc">^</span><span class="fl">0.5</span> </span>
<span id="cb127-3"><a href="#cb127-3"></a>z <span class="ot">&lt;-</span> <span class="dv">25</span> <span class="sc">+</span> <span class="fu">cumsum</span>(delta_z)</span>
<span id="cb127-4"><a href="#cb127-4"></a><span class="do">### A stochastic process</span></span>
<span id="cb127-5"><a href="#cb127-5"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>))</span>
<span id="cb127-6"><a href="#cb127-6"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb127-7"><a href="#cb127-7"></a><span class="fu">plot</span>(Time, z, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, TT), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">22.5</span>, <span class="dv">26</span>),</span>
<span id="cb127-8"><a href="#cb127-8"></a>     <span class="at">main =</span> <span class="st">"Full 5-year period"</span>, <span class="at">ylab =</span> <span class="st">"z"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>)</span>
<span id="cb127-9"><a href="#cb127-9"></a><span class="fu">plot</span>(Time, delta_z, <span class="at">type =</span> <span class="st">"h"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, TT),</span>
<span id="cb127-10"><a href="#cb127-10"></a>     <span class="at">main =</span> <span class="st">"Full 5-year period"</span>, </span>
<span id="cb127-11"><a href="#cb127-11"></a>     <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(Delta,z)), <span class="at">xlab =</span> <span class="st">"Time"</span>)</span>
<span id="cb127-12"><a href="#cb127-12"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"orange"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb127-13"><a href="#cb127-13"></a><span class="fu">plot</span>(Time, z, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">24.9</span>, <span class="fl">25.35</span>),</span>
<span id="cb127-14"><a href="#cb127-14"></a>     <span class="at">main =</span> <span class="st">"Zoom: first month only"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>)</span>
<span id="cb127-15"><a href="#cb127-15"></a><span class="fu">plot</span>(Time, delta_z, <span class="at">type =</span> <span class="st">"h"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>), </span>
<span id="cb127-16"><a href="#cb127-16"></a>     <span class="at">col =</span> <span class="fu">ifelse</span>(delta_z <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.055</span>, <span class="fl">0.055</span>),</span>
<span id="cb127-17"><a href="#cb127-17"></a>     <span class="at">main =</span> <span class="st">"Zoom: first month only"</span>, </span>
<span id="cb127-18"><a href="#cb127-18"></a>     <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(Delta,z)), <span class="at">xlab =</span> <span class="st">"Time"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-aspwz" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-aspwz-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4.3: A stochastic process with zoom.</figcaption>
</figure>
</div>
</div>
</div>
<p>These processes are driven by a random component. The lower panel is revealing because we can see how the random component goes from positive to negative without any pattern, it is entirely random. Now, let’s explore the role of <span class="math inline">\(\Delta t\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>))</span>
<span id="cb128-2"><a href="#cb128-2"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb128-3"><a href="#cb128-3"></a><span class="fu">plot</span>(Time[(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> N, <span class="at">length.out =</span> <span class="dv">10</span>))],</span>
<span id="cb128-4"><a href="#cb128-4"></a>     z[(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> N, <span class="at">length.out =</span> <span class="dv">10</span>))], <span class="at">type =</span> <span class="st">"l"</span>,</span>
<span id="cb128-5"><a href="#cb128-5"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">22.5</span>, <span class="dv">26</span>), <span class="at">main =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Large "</span>,Delta,t)),</span>
<span id="cb128-6"><a href="#cb128-6"></a>     <span class="at">ylab =</span> <span class="st">"z"</span>)</span>
<span id="cb128-7"><a href="#cb128-7"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb128-8"><a href="#cb128-8"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">5</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb128-9"><a href="#cb128-9"></a><span class="fu">plot</span>(Time[(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> N, <span class="at">length.out =</span> <span class="dv">100</span>))],</span>
<span id="cb128-10"><a href="#cb128-10"></a>     z[(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> N, <span class="at">length.out =</span> <span class="dv">100</span>))], <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb128-11"><a href="#cb128-11"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">22.5</span>, <span class="dv">26</span>), <span class="at">ylab =</span> <span class="st">"z"</span>, </span>
<span id="cb128-12"><a href="#cb128-12"></a>     <span class="at">main =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Small "</span>,Delta,t)))</span>
<span id="cb128-13"><a href="#cb128-13"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb128-14"><a href="#cb128-14"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">5</span> , <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb128-15"><a href="#cb128-15"></a><span class="fu">plot</span>(Time[(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> N, <span class="at">length.out =</span> <span class="dv">1000</span>))],</span>
<span id="cb128-16"><a href="#cb128-16"></a>     z[(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> N, <span class="at">length.out =</span> <span class="dv">1000</span>))], <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb128-17"><a href="#cb128-17"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">22.5</span>, <span class="dv">26</span>), <span class="at">ylab =</span> <span class="st">"z"</span>, </span>
<span id="cb128-18"><a href="#cb128-18"></a>     <span class="at">main =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Even smaller "</span>,Delta,t)))</span>
<span id="cb128-19"><a href="#cb128-19"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb128-20"><a href="#cb128-20"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">5</span> , <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb128-21"><a href="#cb128-21"></a><span class="fu">plot</span>(Time, z, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">22.5</span>, <span class="dv">26</span>), <span class="co"># length 10,000</span></span>
<span id="cb128-22"><a href="#cb128-22"></a>     <span class="at">main =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"True process "</span>,Delta,t, <span class="st">" "</span>,</span>
<span id="cb128-23"><a href="#cb128-23"></a>                             <span class="st">"tends "</span>,<span class="st">"to "</span>,<span class="st">"zero"</span>)))</span>
<span id="cb128-24"><a href="#cb128-24"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb128-25"><a href="#cb128-25"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">5</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-wptrod" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-wptrod-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4.4: Wiener process, the role of <span class="math inline">\(\Delta t\)</span>.</figcaption>
</figure>
</div>
</div>
</div>
<p>The <span class="math inline">\(\Delta t\)</span> value determines how frequent are the changes in <span class="math inline">\(z\)</span>.</p>
<p>A few properties of stochastic processes.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1"></a><span class="fu">mean</span>(delta_z) <span class="co"># should be zero</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.0001461726</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1"></a><span class="fu">var</span>(delta_z)<span class="sc">^</span><span class="fl">0.5</span> <span class="co"># should be dt^.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02263698</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1"></a>dt<span class="sc">^</span><span class="fl">0.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02236068</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1"></a><span class="fu">var</span>(delta_z) <span class="co"># should be dt</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0005124328</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1"></a>dt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5e-04</code></pre>
</div>
</div>
</section>
<section id="the-generalized-wiener-process." class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="the-generalized-wiener-process."><span class="header-section-number">4.2</span> The generalized Wiener process.</h2>
<p>Now let’s analyze the case of the generalized Wiener process.</p>
<p><span class="math inline">\(\Delta x = a \Delta t + b \epsilon \sqrt{\Delta t}\)</span>. Assume <span class="math inline">\(a=1.5\)</span> and <span class="math inline">\(b=0.3\)</span>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1"></a><span class="co"># Figure 14.2</span></span>
<span id="cb139-2"><a href="#cb139-2"></a>TT <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb139-3"><a href="#cb139-3"></a>N <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb139-4"><a href="#cb139-4"></a>dt <span class="ot">&lt;-</span> TT <span class="sc">/</span> N</span>
<span id="cb139-5"><a href="#cb139-5"></a>Time <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> TT, <span class="at">by =</span> dt)</span>
<span id="cb139-6"><a href="#cb139-6"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb139-7"><a href="#cb139-7"></a>delta_z <span class="ot">&lt;-</span> <span class="fl">1.5</span> <span class="sc">*</span> <span class="fu">rnorm</span>(N, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">*</span> dt<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb139-8"><a href="#cb139-8"></a>delta_x <span class="ot">&lt;-</span> (<span class="fl">0.3</span> <span class="sc">*</span> dt) <span class="sc">+</span> delta_z</span>
<span id="cb139-9"><a href="#cb139-9"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(delta_x))</span>
<span id="cb139-10"><a href="#cb139-10"></a>z <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(delta_z))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Graphically:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1"></a><span class="fu">plot</span>(Time, x, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">7</span>, <span class="dv">22</span>))</span>
<span id="cb140-2"><a href="#cb140-2"></a><span class="fu">lines</span>(Time, z, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb140-3"><a href="#cb140-3"></a><span class="fu">lines</span>(Time, <span class="fl">0.3</span> <span class="sc">*</span> Time, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb140-4"><a href="#cb140-4"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb140-5"><a href="#cb140-5"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>)</span>
<span id="cb140-6"><a href="#cb140-6"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Generalized Wiener process"</span>, </span>
<span id="cb140-7"><a href="#cb140-7"></a>                             <span class="st">"Drift"</span>, <span class="st">"Basic Wiener process"</span>),</span>
<span id="cb140-8"><a href="#cb140-8"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lwd =</span> <span class="dv">3</span>, </span>
<span id="cb140-9"><a href="#cb140-9"></a>       <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-gwp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-gwp-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4.5: Generalized Wiener process.</figcaption>
</figure>
</div>
</div>
</div>
<p>Here, the generalized Wiener process <span class="math inline">\(\Delta x\)</span> is decomposed into the drift <span class="math inline">\(a \Delta t\)</span> and the basic Wiener process <span class="math inline">\(b \epsilon \sqrt{\Delta t}\)</span>. A zoom of the same plot.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1"></a><span class="co"># Figure 14.2 Zoom</span></span>
<span id="cb141-2"><a href="#cb141-2"></a><span class="fu">plot</span>(Time, x, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.6</span>, <span class="dv">1</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb141-3"><a href="#cb141-3"></a><span class="fu">lines</span>(Time, z, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">type =</span> <span class="st">"b"</span>)</span>
<span id="cb141-4"><a href="#cb141-4"></a><span class="fu">lines</span>(Time, <span class="fl">0.3</span> <span class="sc">*</span> Time, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">type =</span> <span class="st">"b"</span>)</span>
<span id="cb141-5"><a href="#cb141-5"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb141-6"><a href="#cb141-6"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>)</span>
<span id="cb141-7"><a href="#cb141-7"></a><span class="fu">abline</span>(<span class="at">v =</span> dt, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb141-8"><a href="#cb141-8"></a><span class="fu">abline</span>(<span class="at">v =</span> dt <span class="sc">*</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb141-9"><a href="#cb141-9"></a><span class="fu">abline</span>(<span class="at">v =</span> dt <span class="sc">*</span> <span class="dv">3</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb141-10"><a href="#cb141-10"></a><span class="fu">abline</span>(<span class="at">v =</span> dt <span class="sc">*</span> <span class="dv">4</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb141-11"><a href="#cb141-11"></a><span class="co">#points(dt, 0, pch = 1, col = "blue", lwd = 2)</span></span>
<span id="cb141-12"><a href="#cb141-12"></a><span class="co">#points(dt * 2, 0, pch = 1, col = "blue", lwd = 2)</span></span>
<span id="cb141-13"><a href="#cb141-13"></a><span class="co">#points(dt * 3, 0, pch = 1, col = "blue", lwd = 2)</span></span>
<span id="cb141-14"><a href="#cb141-14"></a><span class="co">#points(dt * 4, 0, pch = 1, col = "blue", lwd = 2)</span></span>
<span id="cb141-15"><a href="#cb141-15"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Generalized Wiener process"</span>, </span>
<span id="cb141-16"><a href="#cb141-16"></a>                           <span class="st">"Drift"</span>, <span class="st">"Basic Wiener process"</span>),</span>
<span id="cb141-17"><a href="#cb141-17"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="dv">1</span>, </span>
<span id="cb141-18"><a href="#cb141-18"></a>       <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-gwpzv" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-gwpzv-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4.6: Generalized Wiener process, zoom view.</figcaption>
</figure>
</div>
</div>
</div>
<p>This is a nice visual representation of: generalized = drift + Wiener.</p>
<p>See how the process changes when we consider a lower value of <span class="math inline">\(a\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb142-2"><a href="#cb142-2"></a>delta_xlow <span class="ot">&lt;-</span> (<span class="fl">0.15</span> <span class="sc">*</span> dt) <span class="sc">+</span> delta_z</span>
<span id="cb142-3"><a href="#cb142-3"></a>xlow <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(delta_xlow))</span>
<span id="cb142-4"><a href="#cb142-4"></a><span class="co"># Now plot.</span></span>
<span id="cb142-5"><a href="#cb142-5"></a><span class="fu">plot</span>(Time, xlow, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">7</span>, <span class="dv">22</span>), <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">ylab =</span> <span class="st">"x"</span>)</span>
<span id="cb142-6"><a href="#cb142-6"></a><span class="fu">lines</span>(Time, x, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb142-7"><a href="#cb142-7"></a><span class="fu">lines</span>(Time, z, <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb142-8"><a href="#cb142-8"></a><span class="fu">lines</span>(Time, <span class="fl">0.15</span> <span class="sc">*</span> Time, <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb142-9"><a href="#cb142-9"></a><span class="fu">lines</span>(Time, <span class="fl">0.3</span> <span class="sc">*</span> Time, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb142-10"><a href="#cb142-10"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb142-11"><a href="#cb142-11"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>)</span>
<span id="cb142-12"><a href="#cb142-12"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Original generalized Wiener process"</span>, </span>
<span id="cb142-13"><a href="#cb142-13"></a>    <span class="st">"Original drift"</span>, <span class="st">"New generalized Wiener process"</span>, <span class="st">"New drift"</span>,</span>
<span id="cb142-14"><a href="#cb142-14"></a>    <span class="st">"Basic Wiener process"</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>), </span>
<span id="cb142-15"><a href="#cb142-15"></a>    <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb142-16"><a href="#cb142-16"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"grey"</span>, <span class="st">"grey"</span>, <span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">cex =</span> <span class="fl">0.85</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-gwpla" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-gwpla-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4.7: Generalized Wiener process, lower a.</figcaption>
</figure>
</div>
</div>
</div>
<p>And a higher value of <span class="math inline">\(b\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb143-2"><a href="#cb143-2"></a>delta_zhigh <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">*</span> <span class="fu">rnorm</span>(N, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">*</span> dt<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb143-3"><a href="#cb143-3"></a>delta_xhigh <span class="ot">&lt;-</span> (<span class="fl">0.3</span> <span class="sc">*</span> dt) <span class="sc">+</span> delta_zhigh</span>
<span id="cb143-4"><a href="#cb143-4"></a>xhigh <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(delta_xhigh))</span>
<span id="cb143-5"><a href="#cb143-5"></a>zhigh <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(delta_zhigh))</span>
<span id="cb143-6"><a href="#cb143-6"></a><span class="fu">plot</span>(Time, xhigh, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">7</span>, <span class="dv">22</span>), <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">ylab =</span> <span class="st">"x"</span>)</span>
<span id="cb143-7"><a href="#cb143-7"></a><span class="fu">lines</span>(Time, x, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb143-8"><a href="#cb143-8"></a><span class="fu">lines</span>(Time, zhigh, <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb143-9"><a href="#cb143-9"></a><span class="fu">lines</span>(Time, z, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb143-10"><a href="#cb143-10"></a><span class="fu">lines</span>(Time, <span class="fl">0.3</span> <span class="sc">*</span> Time, <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb143-11"><a href="#cb143-11"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb143-12"><a href="#cb143-12"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>)</span>
<span id="cb143-13"><a href="#cb143-13"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"New generalized Wiener process"</span>, </span>
<span id="cb143-14"><a href="#cb143-14"></a>      <span class="st">"Original generalized Wiener process"</span>, <span class="st">"Drift"</span> ,</span>
<span id="cb143-15"><a href="#cb143-15"></a>      <span class="st">"New basic Wiener process"</span>, <span class="st">"Original basic Wiener process"</span>), </span>
<span id="cb143-16"><a href="#cb143-16"></a>      <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb143-17"><a href="#cb143-17"></a>      <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"grey"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"grey"</span>), <span class="at">cex =</span> <span class="fl">0.75</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-gwphb" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-gwphb-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4.8: Generalized Wiener process, higher b.</figcaption>
</figure>
</div>
</div>
</div>
<p>Note the changes are now more pronounced.</p>
<p>This is a replication of <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span>, table 14.1. Simulation of stock price when <span class="math inline">\(\mu= 0.15\)</span> and <span class="math inline">\(\sigma = 0.30\)</span> during 1-week periods.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1"></a><span class="co"># Table 14.1</span></span>
<span id="cb144-2"><a href="#cb144-2"></a><span class="fu">set.seed</span>(<span class="dv">19256</span>)</span>
<span id="cb144-3"><a href="#cb144-3"></a>delta_S <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb144-4"><a href="#cb144-4"></a>S <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">100</span>, <span class="dv">10</span>)</span>
<span id="cb144-5"><a href="#cb144-5"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb144-6"><a href="#cb144-6"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb144-7"><a href="#cb144-7"></a>  epsilon[i] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb144-8"><a href="#cb144-8"></a>  delta_S[i] <span class="ot">&lt;-</span> <span class="fl">0.15</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">/</span> <span class="dv">52</span>) <span class="sc">*</span> S[i] <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> ((<span class="dv">1</span> <span class="sc">/</span> <span class="dv">52</span>)<span class="sc">^</span><span class="fl">0.5</span>) <span class="sc">*</span> </span>
<span id="cb144-9"><a href="#cb144-9"></a>    epsilon[i] <span class="sc">*</span> S[i]</span>
<span id="cb144-10"><a href="#cb144-10"></a>  S[i<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> S[i] <span class="sc">+</span> delta_S[i]</span>
<span id="cb144-11"><a href="#cb144-11"></a>}</span>
<span id="cb144-12"><a href="#cb144-12"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">c</span>(epsilon, <span class="cn">NA</span>)</span>
<span id="cb144-13"><a href="#cb144-13"></a>delta_S <span class="ot">&lt;-</span> <span class="fu">c</span>(delta_S, <span class="cn">NA</span>)</span>
<span id="cb144-14"><a href="#cb144-14"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(S, epsilon, delta_S)</span>
<span id="cb144-15"><a href="#cb144-15"></a>results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          S    epsilon    delta_S
1  100.0000  0.8268625  3.7284174
2  103.7284  0.4957988  2.4387684
3  106.1672 -0.9313823 -3.8074983
4  102.3597 -0.1495925 -0.3417592
5  102.0179  0.7310239  3.3968957
6  105.4148 -0.6111472 -2.3761181
7  103.0387  1.2490868  5.6516490
8  108.6904 -0.6243389 -2.5096009
9  106.1808  0.6995349  3.3964067
10 109.5772  0.3612549  1.9629353
11 111.5401         NA         NA</code></pre>
</div>
</div>
<p>It is interesting to note that in <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span> the final simulated price is $111.54 and here it is $111.5401. Is this a pure coincidence?</p>
<p>A correlated process.</p>
<p><span class="math inline">\(\Delta x_1 = a_1 \Delta t + b_1 \epsilon_1 \sqrt{\Delta t}\)</span>,</p>
<p><span class="math inline">\(\Delta x_2 = a_2 \Delta t + b_2 \epsilon_2 \sqrt{\Delta t}\)</span>.</p>
<p>Where: <span class="math inline">\(\epsilon_1 = u\)</span>, and <span class="math inline">\(\epsilon_2=\rho u + \sqrt{1-\rho^{2}}v\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1"></a><span class="co"># Section 14.5</span></span>
<span id="cb146-2"><a href="#cb146-2"></a>rho <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb146-3"><a href="#cb146-3"></a>TT <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb146-4"><a href="#cb146-4"></a>steps <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb146-5"><a href="#cb146-5"></a>dt <span class="ot">&lt;-</span> TT <span class="sc">/</span> steps</span>
<span id="cb146-6"><a href="#cb146-6"></a>Time <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> dt, <span class="at">to =</span> TT, <span class="at">by =</span> dt)</span>
<span id="cb146-7"><a href="#cb146-7"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb146-8"><a href="#cb146-8"></a>e1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(steps, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb146-9"><a href="#cb146-9"></a>e2 <span class="ot">&lt;-</span> rho <span class="sc">*</span> e1 <span class="sc">+</span> ((<span class="dv">1</span> <span class="sc">-</span> rho<span class="sc">^</span><span class="dv">2</span>)<span class="sc">^</span><span class="fl">0.5</span>) <span class="sc">*</span> <span class="fu">rnorm</span>(steps, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb146-10"><a href="#cb146-10"></a>delta_z1 <span class="ot">&lt;-</span> <span class="fl">1.5</span> <span class="sc">*</span> e1 <span class="sc">*</span> dt<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb146-11"><a href="#cb146-11"></a>delta_z2 <span class="ot">&lt;-</span> <span class="fl">1.5</span> <span class="sc">*</span> e2 <span class="sc">*</span> dt<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb146-12"><a href="#cb146-12"></a>delta_x1 <span class="ot">&lt;-</span> (<span class="fl">0.3</span> <span class="sc">*</span> dt) <span class="sc">+</span> delta_z1</span>
<span id="cb146-13"><a href="#cb146-13"></a>delta_x2 <span class="ot">&lt;-</span> (<span class="fl">0.3</span> <span class="sc">*</span> dt) <span class="sc">+</span> delta_z2</span>
<span id="cb146-14"><a href="#cb146-14"></a>x1 <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(delta_x1)</span>
<span id="cb146-15"><a href="#cb146-15"></a>x2 <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(delta_x2)</span>
<span id="cb146-16"><a href="#cb146-16"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(x1, x2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Assume <span class="math inline">\(a=1.5\)</span>, <span class="math inline">\(b=0.3\)</span> and <span class="math inline">\(\rho=0.8\)</span>. Visually:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1"></a><span class="fu">plot</span>(Time, x1, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(x), <span class="fu">max</span>(x)), <span class="at">ylab =</span> <span class="st">"x1 and x2"</span>)</span>
<span id="cb147-2"><a href="#cb147-2"></a><span class="fu">lines</span>(Time, x2, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb147-3"><a href="#cb147-3"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-cpxax" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-cpxax-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4.9: Correlated processes x1 and x2.</figcaption>
</figure>
</div>
</div>
</div>
<!-- The following code needs revision. -->
<!-- ```{r fig.cap="Itô process. This figure needs revision."} -->
<!-- # Figure 14.2 with Itô process -->
<!-- TT <- 50 -->
<!-- N <- 200 -->
<!-- dt <- TT / N -->
<!-- Time <- seq(from = 0, to = TT, by = dt) -->
<!-- set.seed(1) -->
<!-- axt <- 0.3 + rnorm(N + 1, 0, 1) * 0.001 * Time -->
<!-- bxt <- 0.001 * Time + 0.1 -->
<!-- delta_z <- bxt * rnorm(N + 1, 0, 1) * dt^0.5 -->
<!-- delta_x <- (axt * dt) + delta_z -->
<!-- xI <- cumsum(delta_x) -->
<!-- zI <- cumsum(delta_z) -->
<!-- # Now plot. -->
<!-- plot(Time, xI, type = "l", lwd = 2, ylim = c(0, 18), ylab = "x") -->
<!-- lines(Time, zI, col = "red", lwd = 2) -->
<!-- lines(Time, axt * Time, col = "blue", lwd = 2) -->
<!-- abline(0, 0) -->
<!-- abline(v = 0) -->
<!-- legend("topleft", legend = c("Itô process",  -->
<!--                            "Stochastic drift", "Wiener process"), -->
<!--        col = c("black", "blue", "red"), lty = 1, bg = "white", lwd = 2) -->
<!-- ``` -->
<!-- This is a clear view of a typical Itô process. Taken from Esteban Moro. -->
<!-- ```{r echo=FALSE, out.width='50%', fig.align="center", fig.cap="Itô process."} -->
<!-- knitr::include_graphics('./pdf1.jpg') -->
<!-- ``` -->
<p>The model of stock price behavior implies that a stock’s price at time <span class="math inline">\(T\)</span>, given its price today, is lognormally distributed. The following is similar to example 15.1 in <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span>. In particular, consider a stock with an initial price of $40, an expected return of 16% per annum, and a volatility of 20% per annum.</p>
<p><span class="math inline">\(\frac{\Delta S}{S} = a \Delta t + b \epsilon \sqrt{\Delta t}\)</span>,</p>
<p><span class="math inline">\(\frac{\Delta S}{S} = 0.16 \Delta t + 0.2 \epsilon \sqrt{\Delta t}\)</span>,</p>
<p>Assume <span class="math inline">\(\Delta t = \frac{1}{365}\)</span>: <span class="math inline">\(\frac{\Delta S}{S} = 0.16 \frac{1}{365} + 0.2 \epsilon \sqrt{\frac{1}{365}}\)</span>,</p>
<p>Calculate the constants: ::: {.cell}</p>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1"></a><span class="fl">0.16</span><span class="sc">/</span><span class="dv">365</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0004383562</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1"></a><span class="fl">0.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">365</span>)<span class="sc">^</span><span class="fl">0.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01046848</code></pre>
</div>
<p>::: Finally: <span class="math inline">\(\Delta S = 0.0004383562 S + 0.01046848 S \epsilon\)</span>. The 100 simulated 6-months paths of the stock price <span class="math inline">\(S\)</span> are:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1"></a><span class="fu">set.seed</span>(<span class="dv">10101010</span>)</span>
<span id="cb152-2"><a href="#cb152-2"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb152-3"><a href="#cb152-3"></a>  delta_S <span class="ot">&lt;-</span> <span class="cn">NULL</span> </span>
<span id="cb152-4"><a href="#cb152-4"></a>  S <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">40</span>, <span class="dv">180</span>) <span class="co"># Now it is 40 for all days, the loop fill this out.</span></span>
<span id="cb152-5"><a href="#cb152-5"></a>  epsilon <span class="ot">&lt;-</span> <span class="cn">NULL</span> </span>
<span id="cb152-6"><a href="#cb152-6"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">180</span>) {</span>
<span id="cb152-7"><a href="#cb152-7"></a>    epsilon[i] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb152-8"><a href="#cb152-8"></a>    delta_S[i] <span class="ot">&lt;-</span> <span class="fl">0.16</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">/</span> <span class="dv">365</span>) <span class="sc">*</span> S[i] <span class="sc">+</span> <span class="fl">0.2</span> <span class="sc">*</span> ((<span class="dv">1</span> <span class="sc">/</span> <span class="dv">365</span>)<span class="sc">^</span><span class="fl">0.5</span>) <span class="sc">*</span></span>
<span id="cb152-9"><a href="#cb152-9"></a>      epsilon[i] <span class="sc">*</span> S[i]</span>
<span id="cb152-10"><a href="#cb152-10"></a>    S[i<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> S[i] <span class="sc">+</span> delta_S[i]</span>
<span id="cb152-11"><a href="#cb152-11"></a>    }</span>
<span id="cb152-12"><a href="#cb152-12"></a>  <span class="cf">if</span> (j<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb152-13"><a href="#cb152-13"></a>    <span class="fu">plot</span>(S, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">60</span>), </span>
<span id="cb152-14"><a href="#cb152-14"></a>         <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[t])), <span class="at">xlab =</span> <span class="st">"t (days)"</span>)</span>
<span id="cb152-15"><a href="#cb152-15"></a>    <span class="fu">points</span>(<span class="dv">0</span>, <span class="dv">40</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">cex =</span> <span class="dv">3</span>)</span>
<span id="cb152-16"><a href="#cb152-16"></a>    <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">10</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb152-17"><a href="#cb152-17"></a>    }</span>
<span id="cb152-18"><a href="#cb152-18"></a>  <span class="fu">lines</span>(S)</span>
<span id="cb152-19"><a href="#cb152-19"></a>  }</span>
<span id="cb152-20"><a href="#cb152-20"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fl">32.55</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb152-21"><a href="#cb152-21"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fl">56.56</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb152-22"><a href="#cb152-22"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">181</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-agbms1spp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-agbms1spp-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4.10: A geometric Brownian motion simulation: 100 stock price paths.</figcaption>
</figure>
</div>
</div>
</div>
<p>The code above can be problematic because we are not collecting all paths in an object. An alternative code is the following. Again, this is similar to example 15.1 in <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1"></a>S0 <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb153-2"><a href="#cb153-2"></a>nDays <span class="ot">&lt;-</span> <span class="dv">360</span></span>
<span id="cb153-3"><a href="#cb153-3"></a>mu <span class="ot">&lt;-</span> <span class="fl">0.16</span></span>
<span id="cb153-4"><a href="#cb153-4"></a>sig <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb153-5"><a href="#cb153-5"></a>TT <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb153-6"><a href="#cb153-6"></a>mean.logST <span class="ot">&lt;-</span> <span class="fu">log</span>(S0)<span class="sc">+</span>(mu <span class="sc">-</span> (sig<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">*</span> TT</span>
<span id="cb153-7"><a href="#cb153-7"></a>variance.logST <span class="ot">&lt;-</span> sig<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> TT</span>
<span id="cb153-8"><a href="#cb153-8"></a>lower.ST <span class="ot">&lt;-</span> <span class="fu">exp</span>(mean.logST <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>) <span class="sc">*</span> variance.logST<span class="sc">^</span><span class="fl">0.5</span>)</span>
<span id="cb153-9"><a href="#cb153-9"></a>upper.ST <span class="ot">&lt;-</span> <span class="fu">exp</span>(mean.logST <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> variance.logST<span class="sc">^</span><span class="fl">0.5</span>)</span>
<span id="cb153-10"><a href="#cb153-10"></a><span class="fu">set.seed</span>(<span class="dv">3</span>)</span>
<span id="cb153-11"><a href="#cb153-11"></a>nSim <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb153-12"><a href="#cb153-12"></a>SP_sim <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">180</span>, <span class="at">ncol =</span> nSim)</span>
<span id="cb153-13"><a href="#cb153-13"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nSim){</span>
<span id="cb153-14"><a href="#cb153-14"></a>  SVec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">180</span>)</span>
<span id="cb153-15"><a href="#cb153-15"></a>  SVec[<span class="dv">1</span>] <span class="ot">&lt;-</span> S0</span>
<span id="cb153-16"><a href="#cb153-16"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">180</span>){</span>
<span id="cb153-17"><a href="#cb153-17"></a>    DeltaS <span class="ot">&lt;-</span> mu <span class="sc">*</span> SVec[j <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">/</span> nDays) <span class="sc">+</span> sig <span class="sc">*</span> SVec[j <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span></span>
<span id="cb153-18"><a href="#cb153-18"></a>      <span class="fu">rnorm</span>(<span class="dv">1</span>) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">/</span> nDays)<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb153-19"><a href="#cb153-19"></a>    SVec[j] <span class="ot">&lt;-</span> SVec[j <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> DeltaS</span>
<span id="cb153-20"><a href="#cb153-20"></a>  }</span>
<span id="cb153-21"><a href="#cb153-21"></a>  SP_sim[, i] <span class="ot">&lt;-</span> SVec</span>
<span id="cb153-22"><a href="#cb153-22"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now, let’s plot the results.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1"></a><span class="fu">matplot</span>(SP_sim, <span class="at">type =</span> <span class="st">'l'</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span> ,<span class="fl">0.3</span>), <span class="at">lty =</span> <span class="dv">1</span>,</span>
<span id="cb154-2"><a href="#cb154-2"></a>        <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[t])),</span>
<span id="cb154-3"><a href="#cb154-3"></a>        <span class="at">xlab =</span> <span class="st">"Time"</span>)</span>
<span id="cb154-4"><a href="#cb154-4"></a><span class="fu">points</span>(<span class="dv">0</span>, S0, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="dv">3</span>)</span>
<span id="cb154-5"><a href="#cb154-5"></a><span class="fu">abline</span>(<span class="at">h =</span> lower.ST)</span>
<span id="cb154-6"><a href="#cb154-6"></a><span class="fu">abline</span>(<span class="at">h =</span> upper.ST)</span>
<span id="cb154-7"><a href="#cb154-7"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">180</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-agbms1spp2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-agbms1spp2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4.11: A geometric Brownian motion simulation: 1000 stock price paths.</figcaption>
</figure>
</div>
</div>
</div>
<p>Let’s verify that the there is a 95% probability that the stock price in 6 months will lie between 32.55 and 56.56.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1"></a><span class="dv">1</span> <span class="sc">-</span> (<span class="fu">sum</span>(SP_sim[<span class="dv">180</span>, ] <span class="sc">&lt;</span> lower.ST) <span class="sc">+</span> <span class="fu">sum</span>(SP_sim[<span class="dv">180</span>, ] <span class="sc">&gt;</span> upper.ST)) <span class="sc">/</span> <span class="dv">1000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.944</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1"></a>S0 <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb157-2"><a href="#cb157-2"></a>mu <span class="ot">&lt;-</span> <span class="fl">0.16</span></span>
<span id="cb157-3"><a href="#cb157-3"></a>sig <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb157-4"><a href="#cb157-4"></a>TT <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb157-5"><a href="#cb157-5"></a>mean.logST <span class="ot">&lt;-</span> <span class="fu">log</span>(S0)<span class="sc">+</span>(mu <span class="sc">-</span> (sig<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">*</span> TT</span>
<span id="cb157-6"><a href="#cb157-6"></a>variance.logST <span class="ot">&lt;-</span> sig<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> TT</span>
<span id="cb157-7"><a href="#cb157-7"></a>lower.ST <span class="ot">&lt;-</span> <span class="fu">exp</span>(mean.logST <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>) <span class="sc">*</span> variance.logST<span class="sc">^</span><span class="fl">0.5</span>)</span>
<span id="cb157-8"><a href="#cb157-8"></a>upper.ST <span class="ot">&lt;-</span> <span class="fu">exp</span>(mean.logST <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> variance.logST<span class="sc">^</span><span class="fl">0.5</span>)</span>
<span id="cb157-9"><a href="#cb157-9"></a>lower.ST</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 32.51491</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1"></a>upper.ST</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 56.6029</code></pre>
</div>
</div>
<p>Nice.</p>
<p>This is how a stock price evolves according to the Black-Scholes formula.</p>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="value-at-risk." class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Value at risk.</h1>
<p>Value at Risk (VaR) is an attempt to provide a single number summarizing the total risk in a portfolio of financial assets. Here, we develop and extend the example called <em>Investment in Four Stock Indices</em> in Chapters 22 and 23 of <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span>. The database used in this example <tt><code>dataR.txt</code></tt> is available <a href="https://github.com/mlozanoqf/tutorial_if/blob/main/dataR.txt">here</a>.</p>
<p>Suppose that we want to calculate VaR for a portfolio using a one-day time horizon, a 99% confidence level, and 501 days of data, from Monday August 6, 2006 to Thursday September 25, 2008.</p>
<section id="prepare-the-data." class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="prepare-the-data."><span class="header-section-number">5.1</span> Prepare the data.</h2>
<p>Load and prepare the database.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"dataR.txt"</span>, <span class="at">sep =</span> <span class="st">""</span>, <span class="at">header =</span> <span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Take a look of the database.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      DJIA FTSE100 USDGBP   CAC40 EURUSD   Nikkei YENUSD
1 11219.38  5828.8 1.9098 4956.34 0.7776 15154.06 115.00
2 11173.59  5818.1 1.9072 4967.95 0.7789 15464.66 115.08
3 11076.18  5860.5 1.9086 5025.15 0.7762 15656.59 115.17
4 11124.37  5823.4 1.8918 4976.64 0.7828 15630.91 115.41
5 11088.02  5820.1 1.8970 4985.52 0.7833 15565.02 116.07
6 11097.87  5870.9 1.8923 5046.93 0.7847 15857.11 116.45</code></pre>
</div>
</div>
<p>These are four international stock indices: Dow Jones Industrial Average (DJIA) in the US, the FTSE 100 in the UK, the CAC 40 in France, and the Nikkei 225 in Japan together with the corresponding exchange rates.</p>
<p>Because we are considering a US investor in this example, the value of the FTSE 100, CAC 40, and Nikkei 225 must be measured in US dollars. The <em>adjusted</em> US dollar equivalent of stock indices are calculated as:</p>
<p><span class="math inline">\(FTSE_{USD}=FTSE_{GBP}\times\frac{USD}{GBP}\)</span>.</p>
<p><span class="math inline">\(CAC_{USD}=\frac{CAC_{EUR}}{\frac{EUR}{USD}}\)</span>.</p>
<p><span class="math inline">\(Nikkei_{USD}=\frac{Nikkei_{JPY}}{\frac{JPY}{USD}}\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1"></a>df.Adj <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb164-2"><a href="#cb164-2"></a>  <span class="fu">mutate</span>(<span class="at">Day =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">501</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb164-3"><a href="#cb164-3"></a>  <span class="fu">mutate</span>(<span class="at">AFTSE100 =</span> FTSE100 <span class="sc">*</span> USDGBP) <span class="sc">%&gt;%</span></span>
<span id="cb164-4"><a href="#cb164-4"></a>  <span class="fu">mutate</span>(<span class="at">ACAC40 =</span> CAC40 <span class="sc">/</span> EURUSD) <span class="sc">%&gt;%</span></span>
<span id="cb164-5"><a href="#cb164-5"></a>  <span class="fu">mutate</span>(<span class="at">ANikkei =</span> Nikkei <span class="sc">/</span> YENUSD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The following is the US dollar equivalent of stock indices for historical simulation. This is the same as <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span>, Table 22.2:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1"></a>df.Adj <span class="sc">%&gt;%</span></span>
<span id="cb165-2"><a href="#cb165-2"></a>  <span class="fu">select</span>(Day, DJIA, AFTSE100, ACAC40, ANikkei) <span class="sc">%&gt;%</span></span>
<span id="cb165-3"><a href="#cb165-3"></a>  <span class="fu">slice</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">500</span>, <span class="dv">501</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Day     DJIA  AFTSE100   ACAC40  ANikkei
1   0 11219.38 11131.842 6373.894 131.7744
2   1 11173.59 11096.280 6378.162 134.3818
3   2 11076.18 11185.350 6474.040 135.9433
4   3 11124.37 11016.708 6357.486 135.4381
5 499 10825.17  9438.580 6033.935 114.2604
6 500 11022.06  9599.898 6200.396 112.8221</code></pre>
</div>
</div>
<p>The number of observations is 501 as we start on day zero. The <em>A</em> before the index name stands for <em>adjusted</em>. A graphical representation of the table above:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1"></a>df.Adj <span class="sc">%&gt;%</span></span>
<span id="cb167-2"><a href="#cb167-2"></a>  <span class="fu">mutate</span>(<span class="at">ANikkei =</span> ANikkei<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb167-3"><a href="#cb167-3"></a>  <span class="fu">mutate</span>(<span class="at">obs =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">502</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb167-4"><a href="#cb167-4"></a>  <span class="fu">select</span>(obs, DJIA, AFTSE100, ACAC40, ANikkei) <span class="sc">%&gt;%</span></span>
<span id="cb167-5"><a href="#cb167-5"></a>  <span class="fu">filter</span>(obs <span class="sc">&lt;</span> <span class="dv">502</span>) <span class="sc">%&gt;%</span></span>
<span id="cb167-6"><a href="#cb167-6"></a>  <span class="fu">gather</span>(IX, Adj, DJIA, AFTSE100, ACAC40, ANikkei) <span class="sc">%&gt;%</span></span>
<span id="cb167-7"><a href="#cb167-7"></a>  <span class="fu">mutate</span>(<span class="at">IX =</span> <span class="fu">as.factor</span>(IX)) <span class="sc">%&gt;%</span></span>
<span id="cb167-8"><a href="#cb167-8"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> obs, <span class="at">y =</span> Adj, <span class="at">col =</span> IX)) <span class="sc">+</span></span>
<span id="cb167-9"><a href="#cb167-9"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb167-10"><a href="#cb167-10"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"US dollar equivalent of stock indices"</span>, <span class="at">x =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb167-11"><a href="#cb167-11"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-aivnn" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-aivnn-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.1: Adjusted index values, Nikkei = Nikkei <span class="math inline">\(\times\)</span> 100.</figcaption>
</figure>
</div>
</div>
</div>
<p>The time-series starts on Monday August 6, 2006 and ends on Thursday September 25, 2008. These are 501 daily past observations. In the plot below, we also show the value of Friday September 26, 2008 as a dot, this is observation 502 and we call it <tt><code>tomorrow</code></tt>. This observation 502 is not included in the VaR estimation as it represents an unknown future value, but it will be useful for us to evaluate our estimations.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1"></a>tomorrow <span class="ot">&lt;-</span> df.Adj <span class="sc">%&gt;%</span></span>
<span id="cb168-2"><a href="#cb168-2"></a>  <span class="fu">mutate</span>(<span class="at">ANikkei =</span> ANikkei<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb168-3"><a href="#cb168-3"></a>  <span class="fu">mutate</span>(<span class="at">obs =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">502</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb168-4"><a href="#cb168-4"></a>  <span class="fu">select</span>(obs, DJIA, AFTSE100, ACAC40, ANikkei) <span class="sc">%&gt;%</span></span>
<span id="cb168-5"><a href="#cb168-5"></a>  <span class="fu">filter</span>(obs <span class="sc">==</span> <span class="dv">502</span>) <span class="sc">%&gt;%</span></span>
<span id="cb168-6"><a href="#cb168-6"></a>  <span class="fu">gather</span>(IX, Adj, DJIA, AFTSE100, ACAC40, ANikkei) <span class="sc">%&gt;%</span></span>
<span id="cb168-7"><a href="#cb168-7"></a>  <span class="fu">mutate</span>(<span class="at">IX =</span> <span class="fu">as.factor</span>(IX))</span>
<span id="cb168-8"><a href="#cb168-8"></a></span>
<span id="cb168-9"><a href="#cb168-9"></a>df.Adj <span class="sc">%&gt;%</span></span>
<span id="cb168-10"><a href="#cb168-10"></a>  <span class="fu">mutate</span>(<span class="at">ANikkei =</span> ANikkei<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb168-11"><a href="#cb168-11"></a>  <span class="fu">mutate</span>(<span class="at">obs =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">502</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb168-12"><a href="#cb168-12"></a>  <span class="fu">select</span>(obs, DJIA, AFTSE100, ACAC40, ANikkei) <span class="sc">%&gt;%</span></span>
<span id="cb168-13"><a href="#cb168-13"></a>  <span class="fu">filter</span>(obs <span class="sc">&gt;</span> <span class="dv">400</span>) <span class="sc">%&gt;%</span></span>
<span id="cb168-14"><a href="#cb168-14"></a>  <span class="fu">filter</span>(obs <span class="sc">&lt;</span> <span class="dv">502</span>) <span class="sc">%&gt;%</span></span>
<span id="cb168-15"><a href="#cb168-15"></a>  <span class="fu">gather</span>(IX, Adj, DJIA, AFTSE100, ACAC40, ANikkei) <span class="sc">%&gt;%</span></span>
<span id="cb168-16"><a href="#cb168-16"></a>  <span class="fu">mutate</span>(<span class="at">IX =</span> <span class="fu">as.factor</span>(IX)) <span class="sc">%&gt;%</span></span>
<span id="cb168-17"><a href="#cb168-17"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> obs, <span class="at">y =</span> Adj, <span class="at">col =</span> IX)) <span class="sc">+</span></span>
<span id="cb168-18"><a href="#cb168-18"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb168-19"><a href="#cb168-19"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(obs, Adj), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">data =</span> tomorrow) <span class="sc">+</span></span>
<span id="cb168-20"><a href="#cb168-20"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"US dollar equivalent of stock indices"</span>, <span class="at">x =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb168-21"><a href="#cb168-21"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-aivnnzv" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-aivnnzv-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.2: Adjusted index values, Nikkei = Nikkei <span class="math inline">\(\times\)</span> 100, zoom view.</figcaption>
</figure>
</div>
</div>
</div>
<p>The stock indices values of Friday September 26, 2008 are:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1"></a>tomorrow</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  obs       IX       Adj
1 502     DJIA 11143.130
2 502 AFTSE100  9379.123
3 502   ACAC40  6081.478
4 502  ANikkei 11216.788</code></pre>
</div>
</div>
</section>
<section id="historical-simulation." class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="historical-simulation."><span class="header-section-number">5.2</span> Historical simulation.</h2>
<p>The historical simulation method requires scenarios of the possible stock indices values for Friday September 26, 2008. In particular, we constructed 500 scenarios for Friday September 26, 2008 with 501 past observations. The historical simulation assumes that the stock index value of Friday September 26 2008 depends on the value of Thursday September 25 2008 times a percentage change (which could be positive or negative). The percentage changes are calculated as follows. The first percentage change is from Monday August 6 2006 to Tuesday August 7 2006. The second percentage change is from Tuesday August 7 2006 to Wednesday 8 2006, and so on. In sum, we assume that tomorrow may behave as the past 500 days.</p>
<p>Take the adjusted values as a reference:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1"></a>df.Adj <span class="sc">%&gt;%</span></span>
<span id="cb171-2"><a href="#cb171-2"></a>  <span class="fu">select</span>(Day, DJIA, AFTSE100, ACAC40, ANikkei) <span class="sc">%&gt;%</span></span>
<span id="cb171-3"><a href="#cb171-3"></a>  <span class="fu">slice</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">500</span>, <span class="dv">501</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Day     DJIA  AFTSE100   ACAC40  ANikkei
1   0 11219.38 11131.842 6373.894 131.7744
2   1 11173.59 11096.280 6378.162 134.3818
3   2 11076.18 11185.350 6474.040 135.9433
4   3 11124.37 11016.708 6357.486 135.4381
5 499 10825.17  9438.580 6033.935 114.2604
6 500 11022.06  9599.898 6200.396 112.8221</code></pre>
</div>
</div>
<p>The first three Dow Jones scenarios <span class="math inline">\(SDJIA\)</span> are:</p>
<p><span class="math inline">\(SDJIA_1 = 11022.06 \times \frac{11173.59}{11219.38} \rightarrow SDJIA_1 = 10977.08\)</span>.</p>
<p><span class="math inline">\(SDJIA_2 = 11022.06 \times \frac{11076.18}{11173.59} \rightarrow SDJIA_2 = 10925.97\)</span></p>
<p><span class="math inline">\(SDJIA_3 = 11022.06 \times \frac{11124.37}{11076.18} \rightarrow SDJIA_3 = 11070.01\)</span></p>
<p>The three Dow Jones possible values according to the historical approach for September 26, 2008 are: 10977.08, 10925.97 and 11070.01. We know the actual value is 11143.130, but this is only for evaluation purposes.</p>
<p>Scenarios generated for September 26, 2008:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1"></a>df.Adj.S <span class="ot">&lt;-</span> df.Adj <span class="sc">%&gt;%</span></span>
<span id="cb173-2"><a href="#cb173-2"></a>  <span class="fu">mutate</span>(<span class="at">obs =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">501</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb173-3"><a href="#cb173-3"></a>  <span class="fu">mutate</span>(<span class="at">SDJIA =</span> DJIA[<span class="dv">501</span>] <span class="sc">*</span> (DJIA<span class="sc">/</span><span class="fu">lag</span>(DJIA))) <span class="sc">%&gt;%</span></span>
<span id="cb173-4"><a href="#cb173-4"></a>  <span class="fu">mutate</span>(<span class="at">SFTSE100 =</span> AFTSE100[<span class="dv">501</span>] <span class="sc">*</span> (AFTSE100<span class="sc">/</span><span class="fu">lag</span>(AFTSE100))) <span class="sc">%&gt;%</span></span>
<span id="cb173-5"><a href="#cb173-5"></a>  <span class="fu">mutate</span>(<span class="at">SCAC40 =</span> ACAC40[<span class="dv">501</span>] <span class="sc">*</span> (ACAC40<span class="sc">/</span><span class="fu">lag</span>(ACAC40))) <span class="sc">%&gt;%</span></span>
<span id="cb173-6"><a href="#cb173-6"></a>  <span class="fu">mutate</span>(<span class="at">SNikkei =</span> ANikkei[<span class="dv">501</span>] <span class="sc">*</span> (ANikkei<span class="sc">/</span><span class="fu">lag</span>(ANikkei)))</span>
<span id="cb173-7"><a href="#cb173-7"></a></span>
<span id="cb173-8"><a href="#cb173-8"></a>df.Adj.S <span class="sc">%&gt;%</span></span>
<span id="cb173-9"><a href="#cb173-9"></a>  <span class="fu">select</span>(obs, SDJIA, SFTSE100, SCAC40, SNikkei) <span class="sc">%&gt;%</span></span>
<span id="cb173-10"><a href="#cb173-10"></a>  <span class="fu">slice</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">500</span>, <span class="dv">501</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  obs    SDJIA SFTSE100   SCAC40  SNikkei
1   1 10977.08 9569.230 6204.547 115.0545
2   2 10925.97 9676.957 6293.603 114.1331
3   3 11070.01 9455.160 6088.768 112.4028
4 499 10831.43 9383.488 6051.936 113.8498
5 500 11222.53 9763.974 6371.450 111.4019</code></pre>
</div>
</div>
<p>This is similar to Table 22.3, <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span>. Let’s see the scenarios above in a plot, including the actual values for September 26, 2008:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1"></a><span class="fu">levels</span>(tomorrow<span class="sc">$</span>IX) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">SCAC40 =</span> <span class="st">"ACAC40"</span>, <span class="at">SDJIA =</span> <span class="st">"DJIA"</span>, </span>
<span id="cb175-2"><a href="#cb175-2"></a>                         <span class="at">SFTSE100 =</span> <span class="st">"AFTSE100"</span>, <span class="at">SNikkei =</span> <span class="st">"ANikkei"</span>)</span>
<span id="cb175-3"><a href="#cb175-3"></a></span>
<span id="cb175-4"><a href="#cb175-4"></a>df.Adj.S <span class="sc">%&gt;%</span></span>
<span id="cb175-5"><a href="#cb175-5"></a>  <span class="fu">mutate</span>(<span class="at">SNikkei =</span> SNikkei<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb175-6"><a href="#cb175-6"></a>  <span class="fu">mutate</span>(<span class="at">obs =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">502</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-7"><a href="#cb175-7"></a>  <span class="fu">select</span>(obs, SDJIA, SFTSE100, SCAC40, SNikkei) <span class="sc">%&gt;%</span></span>
<span id="cb175-8"><a href="#cb175-8"></a>  <span class="fu">filter</span>(obs <span class="sc">&lt;</span> <span class="dv">502</span>) <span class="sc">%&gt;%</span></span>
<span id="cb175-9"><a href="#cb175-9"></a>  <span class="fu">gather</span>(IX, S, SDJIA, SFTSE100, SCAC40, SNikkei) <span class="sc">%&gt;%</span></span>
<span id="cb175-10"><a href="#cb175-10"></a>  <span class="fu">mutate</span>(<span class="at">IX =</span> <span class="fu">as.factor</span>(IX)) <span class="sc">%&gt;%</span></span>
<span id="cb175-11"><a href="#cb175-11"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> IX, <span class="at">fill =</span> IX)) <span class="sc">+</span></span>
<span id="cb175-12"><a href="#cb175-12"></a>  <span class="fu">geom_violin</span>(<span class="fu">aes</span>(IX, S), <span class="at">draw_quantiles =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb175-13"><a href="#cb175-13"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(IX, Adj), <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb175-14"><a href="#cb175-14"></a>             <span class="at">data =</span> tomorrow, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb175-15"><a href="#cb175-15"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Scenarios generated for September 26, 2008"</span>, <span class="at">x =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb175-16"><a href="#cb175-16"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-241-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>According to the example, an investor in the United States owns, on September 25, 2008, a portfolio worth $10 million consisting of 40% in the DJIA, 30% in the FTSE, 10% in the CAC, and 20% in the Nikkei. We can calculate the correspondent 500 scenarios of the possible portfolio value <span class="math inline">\(p\)</span> for September 26, 2008:</p>
<p><span class="math inline">\(p_1 = 4000 \frac{SDJIA_1}{DJIA_{sept.25.2008}} + 3000 \frac{SFTSE_1}{FTSE_{sept.25.2008}} + 1000 \frac{SCAC_1}{CAC_{sept.25.2008}} + 2000 \frac{SNikkei_1}{Nikkei_{sept.25.2008}}\)</span>,</p>
<p><span class="math inline">\(p_1 = 4000 \frac{10977.08}{11022.06} + 3000 \frac{9569.230}{9599.898} + 1000 \frac{6204.547}{6200.396} + 2000 \frac{115.0545}{112.8221}\)</span>,</p>
<p><span class="math inline">\(p_1 = \$10,014.334\)</span>.</p>
<p><span class="math inline">\(p_2 = 4000 \frac{SDJIA_2}{DJIA_{sept.25.2008}} + 3000 \frac{SFTSE_2}{FTSE_{sept.25.2008}} + 1000 \frac{SCAC_2}{CAC_{sept.25.2008}} + 2000 \frac{SNikkei_2}{Nikkei_{sept.25.2008}}\)</span>,</p>
<p><span class="math inline">\(p_2 = 4000 \frac{10925.97}{11022.06} + 3000 \frac{9676.957}{9599.898} + 1000 \frac{6293.603}{6200.396} + 2000 \frac{114.1331}{112.8221}\)</span>,</p>
<p><span class="math inline">\(p_2 = \$10,027.481\)</span>.</p>
<p>And so on.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1"></a>df.Adj.S <span class="ot">&lt;-</span> df.Adj.S <span class="sc">%&gt;%</span></span>
<span id="cb176-2"><a href="#cb176-2"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> (<span class="dv">4000</span> <span class="sc">*</span> SDJIA <span class="sc">/</span> DJIA[<span class="dv">501</span>]) <span class="sc">+</span> <span class="co"># Investment portfolio value</span></span>
<span id="cb176-3"><a href="#cb176-3"></a>             (<span class="dv">3000</span> <span class="sc">*</span> SFTSE100 <span class="sc">/</span> AFTSE100[<span class="dv">501</span>]) <span class="sc">+</span> </span>
<span id="cb176-4"><a href="#cb176-4"></a>             (<span class="dv">1000</span> <span class="sc">*</span> SCAC40 <span class="sc">/</span> ACAC40[<span class="dv">501</span>]) <span class="sc">+</span> </span>
<span id="cb176-5"><a href="#cb176-5"></a>             (<span class="dv">2000</span> <span class="sc">*</span> SNikkei <span class="sc">/</span> ANikkei[<span class="dv">501</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb176-6"><a href="#cb176-6"></a>  <span class="fu">mutate</span>(<span class="at">l =</span> <span class="dv">10000</span> <span class="sc">-</span> p) <span class="co"># Losses l</span></span>
<span id="cb176-7"><a href="#cb176-7"></a></span>
<span id="cb176-8"><a href="#cb176-8"></a>df.Adj.S <span class="sc">%&gt;%</span></span>
<span id="cb176-9"><a href="#cb176-9"></a>  <span class="fu">select</span>(obs, SDJIA, SFTSE100, SCAC40, SNikkei, p, l) <span class="sc">%&gt;%</span></span>
<span id="cb176-10"><a href="#cb176-10"></a>  <span class="fu">slice</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">500</span>, <span class="dv">501</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  obs    SDJIA SFTSE100   SCAC40  SNikkei         p          l
1   1 10977.08 9569.230 6204.547 115.0545 10014.334  -14.33385
2   2 10925.97 9676.957 6293.603 114.1331 10027.481  -27.48131
3   3 11070.01 9455.160 6088.768 112.4028  9946.736   53.26406
4 499 10831.43 9383.488 6051.936 113.8498  9857.465  142.53549
5 500 11222.53 9763.974 6371.450 111.4019 10126.439 -126.43897</code></pre>
</div>
</div>
<p>The <span class="math inline">\(l\)</span> stands for portfolio losses, it is <span class="math inline">\(l = \$10,000 - p\)</span>. Note that a negative loss represents a portfolio gain. Values above are exactly the same as in <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span> Table 22.3.</p>
<p>Visually.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1"></a>l <span class="ot">&lt;-</span> df.Adj.S <span class="sc">%&gt;%</span></span>
<span id="cb178-2"><a href="#cb178-2"></a>  <span class="fu">mutate</span>(<span class="at">obs =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">501</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb178-3"><a href="#cb178-3"></a>  <span class="fu">select</span>(obs, l) <span class="sc">%&gt;%</span></span>
<span id="cb178-4"><a href="#cb178-4"></a>  <span class="fu">filter</span>(obs <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> obs <span class="sc">&lt;</span> <span class="dv">501</span>) <span class="sc">%&gt;%</span></span>
<span id="cb178-5"><a href="#cb178-5"></a>  <span class="fu">select</span>(l) <span class="sc">%&gt;%</span></span>
<span id="cb178-6"><a href="#cb178-6"></a>  <span class="fu">unlist</span>()</span>
<span id="cb178-7"><a href="#cb178-7"></a></span>
<span id="cb178-8"><a href="#cb178-8"></a>l.tomorrow <span class="ot">&lt;-</span> df.Adj.S <span class="sc">%&gt;%</span></span>
<span id="cb178-9"><a href="#cb178-9"></a>  <span class="fu">mutate</span>(<span class="at">obs =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">501</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb178-10"><a href="#cb178-10"></a>  <span class="fu">select</span>(obs, l) <span class="sc">%&gt;%</span></span>
<span id="cb178-11"><a href="#cb178-11"></a>  <span class="fu">filter</span>(obs <span class="sc">==</span> <span class="dv">501</span>) <span class="sc">%&gt;%</span></span>
<span id="cb178-12"><a href="#cb178-12"></a>  <span class="fu">select</span>(l) <span class="sc">%&gt;%</span></span>
<span id="cb178-13"><a href="#cb178-13"></a>  <span class="fu">unlist</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1"></a><span class="fu">plot</span>(l, <span class="at">type =</span> <span class="st">"h"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, </span>
<span id="cb179-2"><a href="#cb179-2"></a>     <span class="at">xlab =</span> <span class="st">"500 scenarios (sorted by historical date)"</span>,</span>
<span id="cb179-3"><a href="#cb179-3"></a>     <span class="at">ylab =</span> <span class="st">"Portfolio gains (-) and losses (+)"</span>, </span>
<span id="cb179-4"><a href="#cb179-4"></a>     <span class="at">col =</span> <span class="fu">ifelse</span>(l <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>))</span>
<span id="cb179-5"><a href="#cb179-5"></a><span class="fu">points</span>(<span class="dv">501</span>, l.tomorrow, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb179-6"><a href="#cb179-6"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb179-7"><a href="#cb179-7"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>)</span>
<span id="cb179-8"><a href="#cb179-8"></a><span class="fu">lines</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">max</span>(l, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> <span class="dv">500</span>), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb179-9"><a href="#cb179-9"></a><span class="fu">lines</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">min</span>(l, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> <span class="dv">500</span>), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb179-10"><a href="#cb179-10"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fl">253.385</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"green"</span>)</span>
<span id="cb179-11"><a href="#cb179-11"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Gains"</span>, <span class="st">"Losses"</span>, <span class="st">"Historic VaR: 253.385"</span>),</span>
<span id="cb179-12"><a href="#cb179-12"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"green"</span>), <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-tis22witwtchtmpt" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-tis22witwtchtmpt-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.3: Today is September 25, 2008. What is the worst that can happen to my portfolio tomorrow?</figcaption>
</figure>
</div>
</div>
</div>
<p>Now, a histogram of losses.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1"></a><span class="fu">hist</span>(l, <span class="dv">15</span>, <span class="at">xlab =</span> <span class="st">"Portfolio losses (+) and gains (-)"</span>, <span class="at">main =</span> <span class="cn">NULL</span>)</span>
<span id="cb180-2"><a href="#cb180-2"></a><span class="fu">points</span>(l.tomorrow, <span class="dv">1</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb180-3"><a href="#cb180-3"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fl">253.385</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb180-4"><a href="#cb180-4"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Historic VaR: 253.385"</span>), <span class="at">col =</span> <span class="st">"red"</span>, </span>
<span id="cb180-5"><a href="#cb180-5"></a>       <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-holftscbs2a22ah" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-holftscbs2a22ah-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.4: Histogram of losses for the scenarios considered between September 25 and 26, 2008: a histogram.</figcaption>
</figure>
</div>
</div>
</div>
<p>The point refers to what really happened, and the red line is the VaR following a historic approach. Now, the same information but now using a density plot.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1"></a>densi <span class="ot">&lt;-</span> <span class="fu">density</span>(l, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb181-2"><a href="#cb181-2"></a><span class="fu">plot</span>(densi, <span class="at">main =</span> <span class="st">""</span>, <span class="at">xlab =</span> <span class="st">"Portfolio losses (+) and gains (-)"</span>)</span>
<span id="cb181-3"><a href="#cb181-3"></a><span class="fu">polygon</span>(densi, <span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">border =</span> <span class="st">"black"</span>)</span>
<span id="cb181-4"><a href="#cb181-4"></a><span class="fu">points</span>(l.tomorrow, <span class="dv">0</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb181-5"><a href="#cb181-5"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fl">253.385</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb181-6"><a href="#cb181-6"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Historic VaR: 253.385"</span>), <span class="at">col =</span> <span class="st">"red"</span>, </span>
<span id="cb181-7"><a href="#cb181-7"></a>       <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-holftscbs2a22adp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-holftscbs2a22adp-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.5: Histogram of losses for the scenarios considered between September 25 and 26, 2008: a density plot.</figcaption>
</figure>
</div>
</div>
</div>
<p>Here is a histogram that looks like the one in <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1"></a><span class="fu">hist</span>(l, <span class="dv">15</span>, <span class="at">axes =</span> F, <span class="at">lty =</span> <span class="st">"blank"</span>, <span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb182-2"><a href="#cb182-2"></a>     <span class="at">xlab =</span> <span class="st">"Portfolio losses (+) and gains (-)"</span>)</span>
<span id="cb182-3"><a href="#cb182-3"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">pos =</span> <span class="dv">0</span>)</span>
<span id="cb182-4"><a href="#cb182-4"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">pos =</span> <span class="dv">0</span>, <span class="at">las =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-f2holftscbs2a22" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-f2holftscbs2a22-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.6: Figure 22.3. Histogram of losses for the scenarios considered between September 25 and 26, 2008.</figcaption>
</figure>
</div>
</div>
</div>
<p>A table for the losses ranked. In particular, losses ranked from highest to lowest for 500 scenarios (first 15 values).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1"></a>Table22<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">scenario.number =</span> <span class="fu">order</span>(l, <span class="at">decreasing =</span> <span class="cn">TRUE</span>),</span>
<span id="cb183-2"><a href="#cb183-2"></a>                        <span class="st">`</span><span class="at">loss in positive values</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb183-3"><a href="#cb183-3"></a>                          l[<span class="fu">order</span>(l, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)])</span>
<span id="cb183-4"><a href="#cb183-4"></a><span class="fu">head</span>(Table22<span class="fl">.4</span>, <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     scenario.number loss.in.positive.values
l494             494                477.8410
l339             339                345.4351
l349             349                282.2038
l329             329                277.0413
l487             487                253.3850
l227             227                217.9740
l131             131                202.2555
l238             238                201.3892
l473             473                191.2691
l306             306                191.0497
l477             477                185.1269
l495             495                184.4496
l376             376                182.7072
l237             237                180.1048
l365             365                172.2237</code></pre>
</div>
</div>
<p>And the last values (not shown in Hull).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1"></a><span class="fu">tail</span>(Table22<span class="fl">.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     scenario.number loss.in.positive.values
l395             395               -224.5146
l489             489               -284.9247
l341             341               -307.9301
l377             377               -316.4893
l379             379               -333.0218
l497             497               -555.7954</code></pre>
</div>
</div>
<p>Note that one of the highest gains happens in scenario 497, almost at the end.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1"></a>VaR.hist <span class="ot">&lt;-</span> <span class="fl">253.3850</span>    </span>
<span id="cb187-2"><a href="#cb187-2"></a>Results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">VaR.method =</span> <span class="st">"Historical simulation, sub-optimal weights"</span>, </span>
<span id="cb187-3"><a href="#cb187-3"></a>                      <span class="at">VaR =</span> VaR.hist)</span>
<span id="cb187-4"><a href="#cb187-4"></a>Results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                  VaR.method     VaR
1 Historical simulation, sub-optimal weights 253.385</code></pre>
</div>
</div>
<p>We call sub-optimal weights because the allocation of 40% in the DJIA, 30% in the FTSE, 10% in the CAC, and 20% in the Nikkei is arbitrary. The VaR according to the historic approach is the highest 5th loss because the top 1% of 500 scenarios is the 5th scenario. We can view this in a barplot.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1"></a><span class="fu">barplot</span>(l[<span class="fu">order</span>(l, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)], </span>
<span id="cb189-2"><a href="#cb189-2"></a>        <span class="at">names.arg =</span> <span class="fu">order</span>(l, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500</span>), </span>
<span id="cb189-3"><a href="#cb189-3"></a>        <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">las =</span> <span class="dv">2</span>, <span class="at">cex.names =</span> <span class="dv">1</span>, <span class="at">ylab =</span> <span class="st">"Porfolio loss ($000s)"</span>,</span>
<span id="cb189-4"><a href="#cb189-4"></a>        <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">xlab =</span> <span class="st">"Scenario number (ranked)"</span>)</span>
<span id="cb189-5"><a href="#cb189-5"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fl">253.385</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb189-6"><a href="#cb189-6"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb189-7"><a href="#cb189-7"></a><span class="fu">abline</span>(<span class="at">h =</span> l.tomorrow, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"green"</span>)</span>
<span id="cb189-8"><a href="#cb189-8"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Historic VaR: 253.385"</span>, </span>
<span id="cb189-9"><a href="#cb189-9"></a>       <span class="st">"What really happened"</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"green"</span>), </span>
<span id="cb189-10"><a href="#cb189-10"></a>       <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-eot2iagvha1p2wrhig" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-eot2iagvha1p2wrhig-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.7: Extract of table 22.4 in a graph VaR historical approach 1 percent 253.385 What really happen in green.</figcaption>
</figure>
</div>
</div>
</div>
<p>The top 1% can be also estimated by implementing the <tt><code>quantile()</code></tt> function. In theory, this should be equivalent to taking the highest 5th loss, however when we implement the <tt><code>quantile()</code></tt> function leads to a different result.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1"></a>VaR.hist.quantile <span class="ot">&lt;-</span> <span class="fu">quantile</span>(l, <span class="fl">0.99</span>)</span>
<span id="cb190-2"><a href="#cb190-2"></a>VaR.hist.quantile</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     99% 
218.3281 </code></pre>
</div>
</div>
<p>The reason is that the <tt><code>quantile()</code></tt> function is continuous, and the historic simulation approach is discrete. With 500 discrete values we can take the highest 5th loss in the table above to represent the top 1% as we count: <span class="math inline">\(0.002 + 0.002 + 0.002 + 0.002 + 0.002 = 0.01\)</span>. However, if we want to fit 500 values in a continuous framework we have to start from 0, so from 0 to 100% we end up with different breaks as: <span class="math inline">\(0 + 0.002004008 + 0.002004008 + 0.002004008 + 0.002004008 = 0.008016032\)</span>. Then, in order to match the discrete and continuous approach we have to set 0.8016032% instead of 1%:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1"></a><span class="fu">quantile</span>(l, <span class="dv">1</span><span class="sc">-</span>(<span class="fl">0.008016032</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>99.1984% 
 253.385 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1"></a><span class="fu">quantile</span>(l, <span class="fl">0.991983968</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>99.1984% 
 253.385 </code></pre>
</div>
</div>
<p>Which is the same as the historical approach VaR. If we use the <tt><code>quantile()</code></tt> function at 1% we end up with:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1"></a><span class="fu">quantile</span>(l, <span class="fl">0.99</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     99% 
218.3281 </code></pre>
</div>
</div>
<p>A graphical approach:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.902</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.002</span>), </span>
<span id="cb198-2"><a href="#cb198-2"></a>     <span class="fu">quantile</span>(l, <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.902</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.002</span>)), <span class="at">cex =</span> <span class="fl">1.5</span>,</span>
<span id="cb198-3"><a href="#cb198-3"></a>     <span class="at">xlab =</span> <span class="st">"Confidence level (vertical line at 99%)"</span>, </span>
<span id="cb198-4"><a href="#cb198-4"></a>     <span class="at">ylab =</span> <span class="st">"Portfolio VaR"</span>)</span>
<span id="cb198-5"><a href="#cb198-5"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fl">0.99</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb198-6"><a href="#cb198-6"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">quantile</span>(l, <span class="fl">0.99</span>), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb198-7"><a href="#cb198-7"></a><span class="fu">abline</span>(<span class="at">h =</span> Table22<span class="fl">.4</span>[<span class="dv">5</span>, <span class="dv">2</span>], <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb198-8"><a href="#cb198-8"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"99% level"</span>, <span class="st">"Historic VaR: 253.385"</span>, </span>
<span id="cb198-9"><a href="#cb198-9"></a>                             <span class="st">"99% quantile VaR: 218.3281"</span>),</span>
<span id="cb198-10"><a href="#cb198-10"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-aqa" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-aqa-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.8: A quantile approach.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1"></a>ci <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">500</span>)</span>
<span id="cb199-2"><a href="#cb199-2"></a>ind <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>)</span>
<span id="cb199-3"><a href="#cb199-3"></a><span class="fu">tail</span>(<span class="fu">data.frame</span>(<span class="st">"quantile function"</span> <span class="ot">=</span> <span class="fu">quantile</span>(l, ci), </span>
<span id="cb199-4"><a href="#cb199-4"></a>                <span class="st">"scenario number"</span> <span class="ot">=</span> <span class="fu">order</span>(l),</span>
<span id="cb199-5"><a href="#cb199-5"></a>                <span class="st">"sort losses"</span> <span class="ot">=</span> <span class="fu">sort</span>(l)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>             quantile.function scenario.number sort.losses
98.9979960%           217.9740             227    217.9740
99.1983968%           253.3850             487    253.3850
99.3987976%           277.0413             329    277.0413
99.5991984%           282.2038             349    282.2038
99.7995992%           345.4351             339    345.4351
100.0000000%          477.8410             494    477.8410</code></pre>
</div>
</div>
<p>Summary of results.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1"></a>Results.updated <span class="ot">&lt;-</span> Results <span class="sc">%&gt;%</span></span>
<span id="cb201-2"><a href="#cb201-2"></a>  <span class="fu">add_row</span>(<span class="at">VaR.method =</span> </span>
<span id="cb201-3"><a href="#cb201-3"></a>            <span class="st">"Historical approximate quantile(), sub-optimal weights"</span>, </span>
<span id="cb201-4"><a href="#cb201-4"></a>          <span class="at">VaR =</span> VaR.hist.quantile) <span class="sc">%&gt;%</span></span>
<span id="cb201-5"><a href="#cb201-5"></a>  <span class="fu">arrange</span>(VaR.method)</span>
<span id="cb201-6"><a href="#cb201-6"></a>Results.updated</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                              VaR.method      VaR
1 Historical approximate quantile(), sub-optimal weights 218.3281
2             Historical simulation, sub-optimal weights 253.3850</code></pre>
</div>
</div>
</section>
<section id="model-building-approach." class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="model-building-approach."><span class="header-section-number">5.3</span> Model building approach.</h2>
<p>The drawback of this method is that it assumes a normal distribution and we know <span class="math inline">\(l\)</span> is not normal. The advantage of this method is its simplicity. Transform adjusted indices to returns.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1"></a>R <span class="ot">&lt;-</span> df.Adj <span class="sc">%&gt;%</span></span>
<span id="cb203-2"><a href="#cb203-2"></a>  <span class="fu">select</span>(Day, DJIA, AFTSE100, ACAC40, ANikkei) <span class="sc">%&gt;%</span></span>
<span id="cb203-3"><a href="#cb203-3"></a>  <span class="fu">mutate</span>(<span class="at">RDJIA =</span> (DJIA<span class="sc">-</span><span class="fu">lag</span>(DJIA))<span class="sc">/</span><span class="fu">lag</span>(DJIA)) <span class="sc">%&gt;%</span></span>
<span id="cb203-4"><a href="#cb203-4"></a>  <span class="fu">mutate</span>(<span class="at">RFTSE100 =</span> (AFTSE100<span class="sc">-</span><span class="fu">lag</span>(AFTSE100))<span class="sc">/</span><span class="fu">lag</span>(AFTSE100)) <span class="sc">%&gt;%</span></span>
<span id="cb203-5"><a href="#cb203-5"></a>  <span class="fu">mutate</span>(<span class="at">RCAC40 =</span> (ACAC40<span class="sc">-</span><span class="fu">lag</span>(ACAC40))<span class="sc">/</span><span class="fu">lag</span>(ACAC40)) <span class="sc">%&gt;%</span></span>
<span id="cb203-6"><a href="#cb203-6"></a>  <span class="fu">mutate</span>(<span class="at">Nikkei =</span> (ANikkei<span class="sc">-</span><span class="fu">lag</span>(ANikkei))<span class="sc">/</span><span class="fu">lag</span>(ANikkei)) <span class="sc">%&gt;%</span></span>
<span id="cb203-7"><a href="#cb203-7"></a>  <span class="fu">select</span>(RDJIA, RFTSE100, RCAC40, Nikkei) <span class="sc">%&gt;%</span></span>
<span id="cb203-8"><a href="#cb203-8"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb203-9"><a href="#cb203-9"></a></span>
<span id="cb203-10"><a href="#cb203-10"></a>R.tomorrow <span class="ot">&lt;-</span> R <span class="sc">%&gt;%</span></span>
<span id="cb203-11"><a href="#cb203-11"></a>  <span class="fu">slice</span>(<span class="dv">501</span>)</span>
<span id="cb203-12"><a href="#cb203-12"></a></span>
<span id="cb203-13"><a href="#cb203-13"></a>R <span class="ot">&lt;-</span> R <span class="sc">%&gt;%</span></span>
<span id="cb203-14"><a href="#cb203-14"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">501</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Replicate Hull’s table 23.5. This is the correlation matrix on September 25, 2008, calculated by giving equal weight to the last 500 daily returns.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1"></a>Rcor <span class="ot">&lt;-</span> <span class="fu">cor</span>(R)</span>
<span id="cb204-2"><a href="#cb204-2"></a>Table23<span class="fl">.5</span> <span class="ot">&lt;-</span> Rcor</span>
<span id="cb204-3"><a href="#cb204-3"></a>Table23<span class="fl">.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>               RDJIA  RFTSE100    RCAC40      Nikkei
RDJIA     1.00000000 0.4891059 0.4957096 -0.06189921
RFTSE100  0.48910594 1.0000000 0.9181083  0.20094221
RCAC40    0.49570963 0.9181083 1.0000000  0.21095096
Nikkei   -0.06189921 0.2009422 0.2109510  1.00000000</code></pre>
</div>
</div>
<p>Replicate Hull’s table 23.6. This is the covariance matrix on September 25, 2008, calculated by giving equal weight to the last 500 daily returns.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1"></a>Rcov <span class="ot">&lt;-</span> <span class="fu">cov</span>(R)</span>
<span id="cb206-2"><a href="#cb206-2"></a>Table23<span class="fl">.6</span> <span class="ot">&lt;-</span> Rcov</span>
<span id="cb206-3"><a href="#cb206-3"></a>Table23<span class="fl">.6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 RDJIA     RFTSE100       RCAC40        Nikkei
RDJIA     1.229524e-04 7.696591e-05 7.682514e-05 -9.493488e-06
RFTSE100  7.696591e-05 2.013973e-04 1.821076e-04  3.944302e-05
RCAC40    7.682514e-05 1.821076e-04 1.953506e-04  4.078130e-05
Nikkei   -9.493488e-06 3.944302e-05 4.078130e-05  1.913129e-04</code></pre>
</div>
</div>
<p>This covariance matrix is quite similar to the one in <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span>. We are not taking round values this explains minor differences.</p>
<p>The variance of the portfolio losses ($000s) is:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1"></a>Rsd <span class="ot">&lt;-</span> <span class="fu">apply</span>(R, <span class="dv">2</span>, sd)</span>
<span id="cb208-2"><a href="#cb208-2"></a>alpha <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4000</span>, <span class="dv">3000</span>, <span class="dv">1000</span>, <span class="dv">2000</span>)</span>
<span id="cb208-3"><a href="#cb208-3"></a>(Pvar <span class="ot">&lt;-</span> <span class="fu">t</span>(alpha) <span class="sc">%*%</span> Rcov <span class="sc">%*%</span> alpha) <span class="co"># equation in page 506 (chapter 22)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 8779.392</code></pre>
</div>
</div>
<p>This is slightly different as in <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span>: 8,761.833. The standard deviation is the square root of this:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1"></a>(Psd <span class="ot">&lt;-</span> Pvar<span class="sc">^</span><span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 93.69841</code></pre>
</div>
</div>
<p>As expected, this is a bit different as in <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span> (93.60). The one-day 99% VaR in is therefore:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1"></a>(VaR.ew <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.99</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">*</span> Psd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 217.9751</code></pre>
</div>
</div>
<p>In <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span>, this value is $217,757, which compares with $253,385, calculated using the historical simulation approach.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1"></a>Results.updated <span class="ot">&lt;-</span> Results.updated <span class="sc">%&gt;%</span></span>
<span id="cb214-2"><a href="#cb214-2"></a>  <span class="fu">add_row</span>(<span class="at">VaR.method =</span> </span>
<span id="cb214-3"><a href="#cb214-3"></a>            <span class="st">"Model building equally weighted, sub-optimal weights"</span>, </span>
<span id="cb214-4"><a href="#cb214-4"></a>          <span class="at">VaR =</span> VaR.ew) <span class="sc">%&gt;%</span></span>
<span id="cb214-5"><a href="#cb214-5"></a>  <span class="fu">arrange</span>(VaR.method)</span>
<span id="cb214-6"><a href="#cb214-6"></a>Results.updated</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                              VaR.method      VaR
1 Historical approximate quantile(), sub-optimal weights 218.3281
2             Historical simulation, sub-optimal weights 253.3850
3   Model building equally weighted, sub-optimal weights 217.9751</code></pre>
</div>
</div>
<p>We are interested to compare the equally weighted approach with the EWMA (exponentially weighted moving average method).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1"></a><span class="co"># Model building example -- EWMA</span></span>
<span id="cb216-2"><a href="#cb216-2"></a>covEWMA <span class="ot">&lt;-</span></span>
<span id="cb216-3"><a href="#cb216-3"></a>  <span class="cf">function</span>(factors, <span class="at">lambda =</span> <span class="fl">0.96</span>, <span class="at">return.cor =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb216-4"><a href="#cb216-4"></a>    factor.names  <span class="ot">=</span> <span class="fu">colnames</span>(factors)</span>
<span id="cb216-5"><a href="#cb216-5"></a>    t.factor      <span class="ot">=</span> <span class="fu">nrow</span>(factors)</span>
<span id="cb216-6"><a href="#cb216-6"></a>    k.factor      <span class="ot">=</span> <span class="fu">ncol</span>(factors)</span>
<span id="cb216-7"><a href="#cb216-7"></a>    factors       <span class="ot">=</span> <span class="fu">as.matrix</span>(factors)</span>
<span id="cb216-8"><a href="#cb216-8"></a>    t.names       <span class="ot">=</span> <span class="fu">rownames</span>(factors)</span>
<span id="cb216-9"><a href="#cb216-9"></a></span>
<span id="cb216-10"><a href="#cb216-10"></a>    cov.f.ewma <span class="ot">=</span> <span class="fu">array</span>(,<span class="fu">c</span>(t.factor, k.factor, k.factor))</span>
<span id="cb216-11"><a href="#cb216-11"></a>    cov.f <span class="ot">=</span> <span class="fu">var</span>(factors)  <span class="co"># unconditional variance as EWMA at time = 0</span></span>
<span id="cb216-12"><a href="#cb216-12"></a>    FF <span class="ot">=</span> (factors[<span class="dv">1</span>, ] <span class="sc">-</span> <span class="fu">mean</span>(factors)) <span class="sc">%*%</span> <span class="fu">t</span>(factors[<span class="dv">1</span>,] <span class="sc">-</span> <span class="fu">mean</span>(factors))</span>
<span id="cb216-13"><a href="#cb216-13"></a>    cov.f.ewma[<span class="dv">1</span>,,] <span class="ot">=</span> (<span class="dv">1</span> <span class="sc">-</span> lambda) <span class="sc">*</span> FF  <span class="sc">+</span> lambda <span class="sc">*</span> cov.f</span>
<span id="cb216-14"><a href="#cb216-14"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>t.factor) {</span>
<span id="cb216-15"><a href="#cb216-15"></a>    FF <span class="ot">=</span> (factors[i, ] <span class="sc">-</span> <span class="fu">mean</span>(factors)) <span class="sc">%*%</span> <span class="fu">t</span>(factors[i, ] <span class="sc">-</span> <span class="fu">mean</span>(factors))</span>
<span id="cb216-16"><a href="#cb216-16"></a>    cov.f.ewma[i,,] <span class="ot">=</span> (<span class="dv">1</span> <span class="sc">-</span> lambda) <span class="sc">*</span> FF  <span class="sc">+</span> lambda <span class="sc">*</span> cov.f.ewma[(i<span class="dv">-1</span>),,]</span>
<span id="cb216-17"><a href="#cb216-17"></a>    }</span>
<span id="cb216-18"><a href="#cb216-18"></a>    <span class="fu">dimnames</span>(cov.f.ewma) <span class="ot">=</span> <span class="fu">list</span>(t.names, factor.names, factor.names)</span>
<span id="cb216-19"><a href="#cb216-19"></a></span>
<span id="cb216-20"><a href="#cb216-20"></a>    <span class="cf">if</span>(return.cor) {</span>
<span id="cb216-21"><a href="#cb216-21"></a>      cor.f.ewma <span class="ot">=</span> cov.f.ewma</span>
<span id="cb216-22"><a href="#cb216-22"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(cor.f.ewma)[<span class="dv">1</span>]) {</span>
<span id="cb216-23"><a href="#cb216-23"></a>        cor.f.ewma[i, , ] <span class="ot">=</span> <span class="fu">cov2cor</span>(cov.f.ewma[i, ,])</span>
<span id="cb216-24"><a href="#cb216-24"></a>      }</span>
<span id="cb216-25"><a href="#cb216-25"></a>      <span class="fu">return</span>(cor.f.ewma)</span>
<span id="cb216-26"><a href="#cb216-26"></a>    } <span class="cf">else</span> {</span>
<span id="cb216-27"><a href="#cb216-27"></a>      <span class="fu">return</span>(cov.f.ewma)</span>
<span id="cb216-28"><a href="#cb216-28"></a>    }</span>
<span id="cb216-29"><a href="#cb216-29"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s implement this approach to our problem. Covariance matrix on September 25, 2008, calculated using the EWMA method with <span class="math inline">\(\lambda=0.94\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1"></a>Rdf <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(R)</span>
<span id="cb217-2"><a href="#cb217-2"></a>C <span class="ot">&lt;-</span> <span class="fu">covEWMA</span>(Rdf, <span class="at">lambda =</span> <span class="fl">0.94</span>)[<span class="dv">500</span>,,] </span>
<span id="cb217-3"><a href="#cb217-3"></a>Table23<span class="fl">.7</span> <span class="ot">&lt;-</span> C</span>
<span id="cb217-4"><a href="#cb217-4"></a>Table23<span class="fl">.7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 RDJIA     RFTSE100       RCAC40        Nikkei
RDJIA     4.798561e-04 0.0004300820 0.0004255278 -3.988656e-05
RFTSE100  4.300820e-04 0.0010312613 0.0009629563  2.093380e-04
RCAC40    4.255278e-04 0.0009629563 0.0009535018  1.679592e-04
Nikkei   -3.988656e-05 0.0002093380 0.0001679592  2.538340e-04</code></pre>
</div>
</div>
<p>The variance of portfolio losses is:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1"></a>(Pvar_EWMA <span class="ot">&lt;-</span> <span class="fu">t</span>(alpha) <span class="sc">%*%</span> C <span class="sc">%*%</span> alpha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 40977.52</code></pre>
</div>
</div>
<p>In <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span>, this value is 40,995.765. The standard deviation is the square root of this, or:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1"></a>(Psd_EWMA <span class="ot">&lt;-</span> Pvar_EWMA<span class="sc">^</span><span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 202.4291</code></pre>
</div>
</div>
<p>In <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span>, this value is 202.474. The one-day 99% VaR is therefore:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1"></a>(VaR.ewma <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.99</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">*</span> Psd_EWMA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 470.9204</code></pre>
</div>
</div>
<p>In <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span>, this value is 471,025, over twice as high as the value given when returns are equally weighted.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1"></a>Results.updated <span class="ot">&lt;-</span> Results.updated <span class="sc">%&gt;%</span></span>
<span id="cb225-2"><a href="#cb225-2"></a>  <span class="fu">add_row</span>(<span class="at">VaR.method =</span> <span class="st">"Model building EWMA, sub-optimal weights"</span>, </span>
<span id="cb225-3"><a href="#cb225-3"></a>          <span class="at">VaR =</span> VaR.ewma) <span class="sc">%&gt;%</span></span>
<span id="cb225-4"><a href="#cb225-4"></a>  <span class="fu">arrange</span>(VaR.method)</span>
<span id="cb225-5"><a href="#cb225-5"></a>Results.updated</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                              VaR.method      VaR
1 Historical approximate quantile(), sub-optimal weights 218.3281
2             Historical simulation, sub-optimal weights 253.3850
3               Model building EWMA, sub-optimal weights 470.9204
4   Model building equally weighted, sub-optimal weights 217.9751</code></pre>
</div>
</div>
<p>Let’s replicate Table 23.8. Volatilities (% per day) using equal weighting and EWMA.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1"></a>Table23<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Rsd <span class="sc">*</span> <span class="dv">100</span>, <span class="fu">diag</span>(C)<span class="sc">^</span><span class="fl">0.5</span> <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb227-2"><a href="#cb227-2"></a><span class="fu">colnames</span>(Table23<span class="fl">.8</span>) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Equal weighting"</span>, <span class="st">"EWMA"</span>)</span>
<span id="cb227-3"><a href="#cb227-3"></a><span class="fu">rownames</span>(Table23<span class="fl">.8</span>) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"DJIA"</span>, <span class="st">"FTSE 100"</span>, <span class="st">"CAC 40"</span>, <span class="st">"Nikkei 225"</span>)</span>
<span id="cb227-4"><a href="#cb227-4"></a><span class="fu">t</span>(Table23<span class="fl">.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                    DJIA FTSE 100   CAC 40 Nikkei 225
Equal weighting 1.108839 1.419145 1.397679   1.383159
EWMA            2.190562 3.211326 3.087882   1.593217</code></pre>
</div>
</div>
<p>The estimated daily standard deviations are much higher when EWMA is used than when data are equally weighted. This is because volatilities were much higher during the period immediately preceding September 25, 2008, than during the rest of the 500 days covered by the data.</p>
<p>The estimated daily standard deviations are much higher when EWMA is used than when data are equally weighted. This is because volatilities were much higher during the period immediately preceding September 25, 2008, than during the rest of the 500 days covered by the data.</p>
</section>
<section id="optimal-allocation." class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="optimal-allocation."><span class="header-section-number">5.4</span> Optimal allocation.</h2>
<p>The current sub-optimal portfolio weights are:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1"></a>W_hull <span class="ot">&lt;-</span> alpha <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb229-2"><a href="#cb229-2"></a>W_hullt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(W_hull)</span>
<span id="cb229-3"><a href="#cb229-3"></a><span class="fu">rownames</span>(W_hullt) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"DJIA"</span>, <span class="st">"FTSE 100"</span>, <span class="st">"CAC 40"</span>, <span class="st">"Nikkei 225"</span>)</span>
<span id="cb229-4"><a href="#cb229-4"></a><span class="fu">t</span>(W_hullt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       DJIA FTSE 100 CAC 40 Nikkei 225
W_hull  0.4      0.3    0.1        0.2</code></pre>
</div>
</div>
<p>Let’s calculate optimal weights.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1"></a>R <span class="ot">&lt;-</span> R <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb231-2"><a href="#cb231-2"></a>R.tomorrow <span class="ot">&lt;-</span> R.tomorrow <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb231-3"><a href="#cb231-3"></a>stocks<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"DJIA"</span>, <span class="st">"FTSE100"</span>, <span class="st">"CAC40"</span>, <span class="st">"Nikkei"</span>)</span>
<span id="cb231-4"><a href="#cb231-4"></a>sigma <span class="ot">&lt;-</span> <span class="fu">var</span>(R)</span>
<span id="cb231-5"><a href="#cb231-5"></a>sd <span class="ot">&lt;-</span> <span class="fu">diag</span>(sigma)<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb231-6"><a href="#cb231-6"></a>E <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(R)</span>
<span id="cb231-7"><a href="#cb231-7"></a>E.tomorrow <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(R.tomorrow)</span>
<span id="cb231-8"><a href="#cb231-8"></a>ones <span class="ot">&lt;-</span> <span class="fu">abs</span>(E <span class="sc">/</span> E)</span>
<span id="cb231-9"><a href="#cb231-9"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(ones) <span class="sc">%*%</span> <span class="fu">solve</span>(sigma) <span class="sc">%*%</span> ones)</span>
<span id="cb231-10"><a href="#cb231-10"></a>b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(ones) <span class="sc">%*%</span> <span class="fu">solve</span>(sigma) <span class="sc">%*%</span> E)</span>
<span id="cb231-11"><a href="#cb231-11"></a>c <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(E) <span class="sc">%*%</span> <span class="fu">solve</span>(sigma) <span class="sc">%*%</span> E)</span>
<span id="cb231-12"><a href="#cb231-12"></a>d <span class="ot">&lt;-</span> <span class="fu">c</span>(a <span class="sc">*</span> c <span class="sc">-</span> (b<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb231-13"><a href="#cb231-13"></a>g <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">solve</span>(sigma) <span class="sc">%*%</span> (c <span class="sc">*</span> ones <span class="sc">-</span> b <span class="sc">*</span> E) <span class="sc">/</span> d)</span>
<span id="cb231-14"><a href="#cb231-14"></a>h <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">solve</span>(sigma) <span class="sc">%*%</span> (a <span class="sc">*</span> E <span class="sc">-</span> b <span class="sc">*</span> ones) <span class="sc">/</span> d)</span>
<span id="cb231-15"><a href="#cb231-15"></a>ER <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">to =</span> <span class="fl">0.3</span>, <span class="at">by =</span> <span class="fl">0.0001</span>)</span>
<span id="cb231-16"><a href="#cb231-16"></a>S <span class="ot">&lt;-</span> ER</span>
<span id="cb231-17"><a href="#cb231-17"></a>W <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">length</span>(ER), <span class="at">ncol =</span> <span class="fu">length</span>(stocks))</span>
<span id="cb231-18"><a href="#cb231-18"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ER)){</span>
<span id="cb231-19"><a href="#cb231-19"></a>  W[i,] <span class="ot">&lt;-</span> g <span class="sc">+</span> h <span class="sc">*</span> ER[i]</span>
<span id="cb231-20"><a href="#cb231-20"></a>  ER[i] <span class="ot">&lt;-</span> W[i,] <span class="sc">%*%</span> E</span>
<span id="cb231-21"><a href="#cb231-21"></a>  S[i] <span class="ot">&lt;-</span> (<span class="fu">t</span>(W[i,]) <span class="sc">%*%</span> sigma <span class="sc">%*%</span> W[i, ])<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb231-22"><a href="#cb231-22"></a>  }</span>
<span id="cb231-23"><a href="#cb231-23"></a>W_min <span class="ot">&lt;-</span> (<span class="fu">solve</span>(sigma) <span class="sc">%*%</span> ones) <span class="sc">/</span> a</span>
<span id="cb231-24"><a href="#cb231-24"></a>R_min <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(W_min) <span class="sc">%*%</span> E)</span>
<span id="cb231-25"><a href="#cb231-25"></a>R_min.realized <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(W_min) <span class="sc">%*%</span> E.tomorrow)</span>
<span id="cb231-26"><a href="#cb231-26"></a>S_min <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(W_min) <span class="sc">%*%</span> sigma <span class="sc">%*%</span> W_min)<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb231-27"><a href="#cb231-27"></a><span class="co"># Allocation to mimic the return of the CAC40 but with lower risk</span></span>
<span id="cb231-28"><a href="#cb231-28"></a>W.cac40 <span class="ot">&lt;-</span> g <span class="sc">+</span> h <span class="sc">*</span> E[<span class="dv">3</span>]</span>
<span id="cb231-29"><a href="#cb231-29"></a>R_cac40 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(W.cac40) <span class="sc">%*%</span> E)</span>
<span id="cb231-30"><a href="#cb231-30"></a>R_cac40.realized <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(W.cac40) <span class="sc">%*%</span> E.tomorrow)</span>
<span id="cb231-31"><a href="#cb231-31"></a>S_cac40 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(W.cac40) <span class="sc">%*%</span> sigma <span class="sc">%*%</span> W.cac40)<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb231-32"><a href="#cb231-32"></a>R_hull.realized <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">t</span>(W_hull) <span class="sc">%*%</span> E.tomorrow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we have four different portfolio weights alternatives. Two of them are optimal. <em>Can we reduce the VaR by using optimal weights?</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1"></a>W <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(W_hull, W_min, W.cac40, <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>))</span>
<span id="cb232-2"><a href="#cb232-2"></a><span class="fu">rownames</span>(W) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"DJIA"</span>, <span class="st">"FTSE 100"</span>, <span class="st">"CAC 40"</span>, <span class="st">"Nikkei 225"</span>)</span>
<span id="cb232-3"><a href="#cb232-3"></a><span class="fu">colnames</span>(W) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Hull, sub-optimal weights"</span>, </span>
<span id="cb232-4"><a href="#cb232-4"></a>                 <span class="st">"minimum variance"</span>, <span class="st">"CAC40 target return"</span>, </span>
<span id="cb232-5"><a href="#cb232-5"></a>                 <span class="st">"naive 1/N"</span>)</span>
<span id="cb232-6"><a href="#cb232-6"></a><span class="fu">t</span>(W)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                               DJIA    FTSE 100     CAC 40 Nikkei 225
Hull, sub-optimal weights 0.4000000  0.30000000 0.10000000  0.2000000
minimum variance          0.5592378  0.03793305 0.02279301  0.3800361
CAC40 target return       0.6075003 -0.40341894 0.45978629  0.3361323
naive 1/N                 0.2500000  0.25000000 0.25000000  0.2500000</code></pre>
</div>
</div>
<p>In this <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span> example we assume portfolio weights remains constant. However, we can rebalance portfolio weights. Here, we have the time evolution of minimum variance optimal weights when we consider 5 US industry portfolios as investment assets:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1"></a><span class="fu">embed_url</span>(<span class="st">"https://youtu.be/paH1-bDPsA4"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/paH1-bDPsA4" width="533" height="300" frameborder="0" allowfullscreen="" data-external="1"></iframe>
</div>
</div>
</div>
</div>
<p>And a similar exercise but now with 10 US industry sorted portfolios:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1"></a><span class="fu">embed_url</span>(<span class="st">"https://youtu.be/DyjQbKm-NdE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/DyjQbKm-NdE" width="533" height="300" frameborder="0" allowfullscreen="" data-external="1"></iframe>
</div>
</div>
</div>
</div>
<p>Let’s go back to the main <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span> example and see the results graphically.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1"></a>W_hull <span class="ot">&lt;-</span> alpha <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb236-2"><a href="#cb236-2"></a>R_hull <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(W_hull) <span class="sc">%*%</span> E)</span>
<span id="cb236-3"><a href="#cb236-3"></a>S_hull <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(W_hull) <span class="sc">%*%</span> sigma <span class="sc">%*%</span> W_hull)<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb236-4"><a href="#cb236-4"></a></span>
<span id="cb236-5"><a href="#cb236-5"></a><span class="fu">plot</span>(S, ER, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">1.6</span>), </span>
<span id="cb236-6"><a href="#cb236-6"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.022</span>, <span class="fl">0.005</span>),</span>
<span id="cb236-7"><a href="#cb236-7"></a>     <span class="at">ylab =</span> <span class="st">"Expected return"</span>, <span class="at">xlab =</span> <span class="st">"Standard deviation"</span>)</span>
<span id="cb236-8"><a href="#cb236-8"></a><span class="fu">points</span>(<span class="fu">diag</span>(sigma)<span class="sc">^</span><span class="fl">0.5</span>, E)</span>
<span id="cb236-9"><a href="#cb236-9"></a><span class="fu">abline</span>(<span class="dv">0</span>, R_hull <span class="sc">/</span> S_hull, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb236-10"><a href="#cb236-10"></a><span class="fu">abline</span>(<span class="dv">0</span>, R_min <span class="sc">/</span> S_min, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb236-11"><a href="#cb236-11"></a><span class="fu">points</span>(S_min, R_min, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb236-12"><a href="#cb236-12"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb236-13"><a href="#cb236-13"></a><span class="fu">text</span>(S_min, R_min, <span class="st">"Minimum</span></span>
<span id="cb236-14"><a href="#cb236-14"></a><span class="st">     variance"</span>, <span class="at">pos =</span> <span class="dv">2</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb236-15"><a href="#cb236-15"></a><span class="fu">text</span>(sd, E, stocks, <span class="at">adj =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb236-16"><a href="#cb236-16"></a><span class="fu">points</span>(S_hull, R_hull, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb236-17"><a href="#cb236-17"></a><span class="fu">text</span>(S_hull, R_hull, <span class="st">"Hull's </span></span>
<span id="cb236-18"><a href="#cb236-18"></a><span class="st">     sub-optimal allocation"</span>, <span class="at">adj =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">pos =</span> <span class="dv">1</span>)</span>
<span id="cb236-19"><a href="#cb236-19"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>, </span>
<span id="cb236-20"><a href="#cb236-20"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"DJ=0.4,   FTSE=0.3,     CAC=0.1,     Nikkei=0.2"</span>,</span>
<span id="cb236-21"><a href="#cb236-21"></a>                            <span class="st">"DJ=0.56, FTSE=0.038, CAC=0.022, Nikkei=0.38"</span>),</span>
<span id="cb236-22"><a href="#cb236-22"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">cex =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-haistroiabaawner" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-haistroiabaawner-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.9: Hull’s allocation is sub-optimal, the red one is a better alternative, although with negative expected return.</figcaption>
</figure>
</div>
</div>
</div>
<p>The figure suggests that the (optimal) minimum variance alternative reduces the original portfolio risk. In fact, the minimum variance portfolio has a higher return and lower risk. This representation is an estimate of the future. We can evaluate what really happened by using the actual returns.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1"></a>(R_min.realized <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(W_min) <span class="sc">%*%</span> E.tomorrow))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2629549</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1"></a>(<span class="at">R_hull.realized =</span> <span class="fu">c</span>(<span class="fu">t</span>(W_hull) <span class="sc">%*%</span> E.tomorrow))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5583249</code></pre>
</div>
</div>
<p>This is interesting as it suggests that the sub-optimal allocation would lead to a realized return on Friday September 26, 2008 of -0.5583249%. On the other hand, following the optimal minimum variance allocation would lead to a portfolio gain of 0.2629549%. Hull’s sub-optimal portfolio allocation turns out to be problematic.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1"></a>W_hull <span class="ot">&lt;-</span> alpha <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb241-2"><a href="#cb241-2"></a>R_hull <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(W_hull) <span class="sc">%*%</span> E)</span>
<span id="cb241-3"><a href="#cb241-3"></a>S_hull <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(W_hull) <span class="sc">%*%</span> sigma <span class="sc">%*%</span> W_hull)<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb241-4"><a href="#cb241-4"></a></span>
<span id="cb241-5"><a href="#cb241-5"></a>W_1N <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.25</span>,<span class="fl">0.25</span>,<span class="fl">0.25</span>,<span class="fl">0.25</span>)</span>
<span id="cb241-6"><a href="#cb241-6"></a>R_1N <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(W_1N) <span class="sc">%*%</span> E)</span>
<span id="cb241-7"><a href="#cb241-7"></a>S_1N <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(W_1N) <span class="sc">%*%</span> sigma <span class="sc">%*%</span> W_1N)<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb241-8"><a href="#cb241-8"></a></span>
<span id="cb241-9"><a href="#cb241-9"></a><span class="fu">plot</span>(S, ER, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">1.6</span>), </span>
<span id="cb241-10"><a href="#cb241-10"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.022</span>, <span class="fl">0.005</span>),</span>
<span id="cb241-11"><a href="#cb241-11"></a>     <span class="at">ylab =</span> <span class="st">"Expected return"</span>, <span class="at">xlab =</span> <span class="st">"Standard deviation"</span>)</span>
<span id="cb241-12"><a href="#cb241-12"></a><span class="fu">points</span>(<span class="fu">diag</span>(sigma)<span class="sc">^</span><span class="fl">0.5</span>, E)</span>
<span id="cb241-13"><a href="#cb241-13"></a><span class="fu">abline</span>(<span class="dv">0</span>, R_hull <span class="sc">/</span> S_hull, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb241-14"><a href="#cb241-14"></a><span class="fu">abline</span>(<span class="dv">0</span>, R_min <span class="sc">/</span> S_min, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb241-15"><a href="#cb241-15"></a><span class="fu">abline</span>(<span class="dv">0</span>, R_1N <span class="sc">/</span> S_1N, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"purple"</span>)</span>
<span id="cb241-16"><a href="#cb241-16"></a><span class="fu">points</span>(S_min, R_min, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb241-17"><a href="#cb241-17"></a><span class="fu">points</span>(S_1N, R_1N, <span class="at">col =</span> <span class="st">"purple"</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb241-18"><a href="#cb241-18"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb241-19"><a href="#cb241-19"></a><span class="fu">text</span>(S_min, R_min, <span class="st">"Minimum</span></span>
<span id="cb241-20"><a href="#cb241-20"></a><span class="st">     variance"</span>, <span class="at">pos =</span> <span class="dv">2</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb241-21"><a href="#cb241-21"></a><span class="fu">text</span>(sd, E, stocks, <span class="at">adj =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb241-22"><a href="#cb241-22"></a><span class="fu">points</span>(S_hull, R_hull, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb241-23"><a href="#cb241-23"></a><span class="fu">text</span>(S_hull, R_hull, <span class="st">"Hull's</span></span>
<span id="cb241-24"><a href="#cb241-24"></a><span class="st">     sub-optimal allocation"</span>, <span class="at">adj =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">pos =</span> <span class="dv">1</span>)</span>
<span id="cb241-25"><a href="#cb241-25"></a><span class="fu">text</span>(S_1N, R_1N, <span class="st">"1/N alpha"</span>, <span class="at">adj =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">pos =</span> <span class="dv">3</span>)</span>
<span id="cb241-26"><a href="#cb241-26"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>,</span>
<span id="cb241-27"><a href="#cb241-27"></a>       <span class="at">legend =</span> </span>
<span id="cb241-28"><a href="#cb241-28"></a>         <span class="fu">c</span>(<span class="st">"Hull:    DJ=0.4,   FTSE=0.3,     CAC=0.1,     Nikkei=0.2"</span>,</span>
<span id="cb241-29"><a href="#cb241-29"></a><span class="st">"Minvar: DJ=0.56, FTSE=0.038, CAC=0.022, Nikkei=0.38"</span>,</span>
<span id="cb241-30"><a href="#cb241-30"></a><span class="st">"1/N:      DJ=0.25,  FTSE=0.25,  CAC=0.25,  Nikkei=0.25"</span>),</span>
<span id="cb241-31"><a href="#cb241-31"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>,<span class="st">"red"</span>, <span class="st">"purple"</span>), <span class="at">pch =</span> <span class="dv">19</span>, </span>
<span id="cb241-32"><a href="#cb241-32"></a><span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">cex =</span> <span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-haistroiabaawner2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-haistroiabaawner2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.10: Hull’s allocation is sub-optimal, the red one is a better alternative, although with negative expected return.</figcaption>
</figure>
</div>
</div>
</div>
<p>This <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span> example is static. If we consider a dynamic approach, then optimal portfolio weights may change as new data is available. As a result, we end up with different mean-variance frontiers. This is the time evolution of the US efficient frontier assuming 5 industry sorted portfolio as investment assets:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1"></a><span class="fu">embed_url</span>(<span class="st">"https://youtu.be/Fq4UlUCneyI"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/Fq4UlUCneyI" width="533" height="300" frameborder="0" allowfullscreen="" data-external="1"></iframe>
</div>
</div>
</div>
</div>
<p>In general, as we increase the number of investment assets, the mean-variance frontier expands. Here is the case of 10 versus 12 US industry sorted portfolios as investment assets:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1"></a><span class="fu">embed_url</span>(<span class="st">"https://youtu.be/_GnJRviyYJI"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/_GnJRviyYJI" width="533" height="300" frameborder="0" allowfullscreen="" data-external="1"></iframe>
</div>
</div>
</div>
</div>
<p>We can simulate 10,000 possible values for Friday September 26, 2008 given the mean and standard deviation estimates. The following histograms are generated as in this video:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1"></a><span class="fu">embed_url</span>(<span class="st">"https://youtu.be/P1Ky6-a8DE0"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/P1Ky6-a8DE0" width="533" height="300" frameborder="0" allowfullscreen="" data-external="1"></iframe>
</div>
</div>
</div>
</div>
<p>First, the minimum variance portfolio:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1"></a>set.seed <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb245-2"><a href="#cb245-2"></a>M <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, R_min, S_min)</span>
<span id="cb245-3"><a href="#cb245-3"></a><span class="fu">hist</span>(M, <span class="dv">100</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">450</span>), <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb245-4"><a href="#cb245-4"></a><span class="fu">abline</span>(<span class="at">v =</span> R_min.realized, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb245-5"><a href="#cb245-5"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">quantile</span>(M, <span class="fl">0.025</span>), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb245-6"><a href="#cb245-6"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">quantile</span>(M, <span class="fl">0.975</span>), <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-mvraroib" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-mvraroib-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.11: Minimum variance recommendation and realized outcome in blue.</figcaption>
</figure>
</div>
</div>
</div>
<p>Then, the sub-optimal allocation:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1"></a>set.seed <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb246-2"><a href="#cb246-2"></a>H <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, R_hull, S_hull)</span>
<span id="cb246-3"><a href="#cb246-3"></a><span class="fu">hist</span>(H, <span class="dv">100</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">450</span>), <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb246-4"><a href="#cb246-4"></a><span class="fu">abline</span>(<span class="at">v =</span> R_hull.realized, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb246-5"><a href="#cb246-5"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">quantile</span>(H, <span class="fl">0.025</span>), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb246-6"><a href="#cb246-6"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">quantile</span>(H, <span class="fl">0.975</span>), <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-hsoraro" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-hsoraro-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.12: Hull sub-optimal recommendation and realized outcome.</figcaption>
</figure>
</div>
</div>
</div>
<p>And finally, the portfolio that targets the CAC 40 expected return:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1"></a>set.seed <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb247-2"><a href="#cb247-2"></a>Ca <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, R_cac40, S_cac40)</span>
<span id="cb247-3"><a href="#cb247-3"></a><span class="fu">hist</span>(Ca, <span class="dv">100</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">450</span>), <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb247-4"><a href="#cb247-4"></a><span class="fu">abline</span>(<span class="at">v =</span> R_cac40.realized, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb247-5"><a href="#cb247-5"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">quantile</span>(C, <span class="fl">0.025</span>), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb247-6"><a href="#cb247-6"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">quantile</span>(C, <span class="fl">0.975</span>), <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-craro" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-craro-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.13: CAC40 recommendation and realized outcome.</figcaption>
</figure>
</div>
</div>
</div>
<p>Let’s see the portfolio that targets the CAC 40 expected return in a mean-variance plot:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1"></a><span class="fu">plot</span>(S, ER, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">1.6</span>),</span>
<span id="cb248-2"><a href="#cb248-2"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.022</span>, <span class="fl">0.007</span>), <span class="at">ylab =</span> <span class="st">"Expected return"</span>,</span>
<span id="cb248-3"><a href="#cb248-3"></a>     <span class="at">xlab =</span> <span class="st">"Standard deviation"</span>)</span>
<span id="cb248-4"><a href="#cb248-4"></a><span class="fu">points</span>(<span class="fu">diag</span>(sigma)<span class="sc">^</span><span class="fl">0.5</span>, E)</span>
<span id="cb248-5"><a href="#cb248-5"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb248-6"><a href="#cb248-6"></a><span class="fu">points</span>(S_cac40, R_cac40, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb248-7"><a href="#cb248-7"></a><span class="fu">points</span>(<span class="fl">0.68</span>, R_cac40.realized, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">pch =</span> <span class="dv">15</span>, <span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb248-8"><a href="#cb248-8"></a><span class="fu">text</span>(S_cac40, R_cac40, <span class="st">"CAC40</span></span>
<span id="cb248-9"><a href="#cb248-9"></a><span class="st">     expected return"</span>, <span class="at">pos =</span> <span class="dv">2</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb248-10"><a href="#cb248-10"></a><span class="fu">text</span>(sd,E,stocks,<span class="at">adj=</span><span class="sc">-</span><span class="fl">0.5</span>,<span class="at">cex=</span><span class="fl">0.8</span>)</span>
<span id="cb248-11"><a href="#cb248-11"></a>W_hull <span class="ot">=</span> alpha <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb248-12"><a href="#cb248-12"></a>R_hull <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">t</span>(W_hull) <span class="sc">%*%</span> E)</span>
<span id="cb248-13"><a href="#cb248-13"></a>S_hull <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">t</span>(W_hull) <span class="sc">%*%</span> sigma <span class="sc">%*%</span> W_hull)<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb248-14"><a href="#cb248-14"></a><span class="fu">points</span>(S_hull, R_hull, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb248-15"><a href="#cb248-15"></a><span class="fu">points</span>(<span class="fl">0.68</span>, R_hull.realized, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">pch =</span> <span class="dv">15</span>, <span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb248-16"><a href="#cb248-16"></a><span class="fu">abline</span>(<span class="dv">0</span>,R_hull <span class="sc">/</span> S_hull, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb248-17"><a href="#cb248-17"></a><span class="fu">abline</span>(<span class="dv">0</span>,R_cac40 <span class="sc">/</span> S_cac40, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb248-18"><a href="#cb248-18"></a><span class="fu">abline</span>(<span class="dv">0</span>,E[<span class="dv">3</span>] <span class="sc">/</span> sd[<span class="dv">3</span>], <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb248-19"><a href="#cb248-19"></a><span class="fu">abline</span>(<span class="at">v =</span> S_cac40, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb248-20"><a href="#cb248-20"></a><span class="fu">text</span>(S_hull, R_hull, <span class="st">"Hull's</span></span>
<span id="cb248-21"><a href="#cb248-21"></a><span class="st">     sub-optimal allocation"</span>, <span class="at">adj =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">pos =</span> <span class="dv">1</span>)</span>
<span id="cb248-22"><a href="#cb248-22"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>, </span>
<span id="cb248-23"><a href="#cb248-23"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"DJ=0.4,     FTSE=0.3,      CAC=0.1,     Nikkei=0.2"</span>,</span>
<span id="cb248-24"><a href="#cb248-24"></a>                          <span class="st">"DJ=0.607, FTSE=-0.403, CAC=0.459, Nikkei=0.336"</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), </span>
<span id="cb248-25"><a href="#cb248-25"></a>       <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">cex =</span> <span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-eoanoarce" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-eoanoarce-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.14: Estimation of a new optimal alpha: Replicate CAC40 ER.</figcaption>
</figure>
</div>
</div>
</div>
<p>These are the realized returns on Friday September 26, 2008.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1"></a>(R_min.realized)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2629549</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1"></a>(R_hull.realized)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5583249</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1"></a>(R_cac40.realized)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5183212</code></pre>
</div>
</div>
<p>As stated before, Hull’s sub-optimal portfolio allocation turns out to be problematic. His recommendation would lead to a loss -0.558% and the optimal minimum variance would lead to a positive return 0.2629%, and the optimal portfolio that targets the CAC 40 expected return leads to an even higher return 0.518%.</p>
</section>
<section id="model-building-approach-with-optimal-weights." class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="model-building-approach-with-optimal-weights."><span class="header-section-number">5.5</span> Model building approach with optimal weights.</h2>
<p>Now that we have two additional optimal portfolios, we can compute the corresponding VaR for the model building approach. First, the equally weighted case.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1"></a><span class="co"># Model building approach, equally weighted.</span></span>
<span id="cb255-2"><a href="#cb255-2"></a>alpha2 <span class="ot">&lt;-</span> <span class="fu">c</span>(W_min <span class="sc">*</span> <span class="dv">10000</span>)</span>
<span id="cb255-3"><a href="#cb255-3"></a>alpha3 <span class="ot">&lt;-</span> <span class="fu">c</span>(W.cac40 <span class="sc">*</span> <span class="dv">10000</span>)</span>
<span id="cb255-4"><a href="#cb255-4"></a><span class="co"># This is the minimum variance optimal portfolio.</span></span>
<span id="cb255-5"><a href="#cb255-5"></a>Pvar2 <span class="ot">&lt;-</span> <span class="fu">t</span>(alpha2) <span class="sc">%*%</span> Rcov <span class="sc">%*%</span> alpha2</span>
<span id="cb255-6"><a href="#cb255-6"></a>Psd2 <span class="ot">&lt;-</span> Pvar2<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb255-7"><a href="#cb255-7"></a>VaR.ew.optimal <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.99</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">*</span> Psd2</span>
<span id="cb255-8"><a href="#cb255-8"></a><span class="co"># This is optimal portfolio targeting the CAC 40 expected return.</span></span>
<span id="cb255-9"><a href="#cb255-9"></a>Pvar3 <span class="ot">&lt;-</span> <span class="fu">t</span>(alpha3) <span class="sc">%*%</span> Rcov <span class="sc">%*%</span> alpha3</span>
<span id="cb255-10"><a href="#cb255-10"></a>Psd3 <span class="ot">&lt;-</span> Pvar3<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb255-11"><a href="#cb255-11"></a>VaR.ew.optimal.cac <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.99</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">*</span> Psd3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Summary of results:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1"></a>Results.updated <span class="ot">&lt;-</span> Results.updated <span class="sc">%&gt;%</span></span>
<span id="cb256-2"><a href="#cb256-2"></a>  <span class="fu">add_row</span>(<span class="at">VaR.method =</span> </span>
<span id="cb256-3"><a href="#cb256-3"></a>        <span class="fu">c</span>(<span class="st">"Model building equally weighted, minimum variance weights"</span>, </span>
<span id="cb256-4"><a href="#cb256-4"></a>          <span class="st">"Model building equally weighted, targeting CAC40"</span>), </span>
<span id="cb256-5"><a href="#cb256-5"></a>          <span class="at">VaR =</span> <span class="fu">c</span>(VaR.ew.optimal, VaR.ew.optimal.cac)) <span class="sc">%&gt;%</span></span>
<span id="cb256-6"><a href="#cb256-6"></a>  <span class="fu">arrange</span>(VaR.method)</span>
<span id="cb256-7"><a href="#cb256-7"></a>Results.updated</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                                 VaR.method      VaR
1    Historical approximate quantile(), sub-optimal weights 218.3281
2                Historical simulation, sub-optimal weights 253.3850
3                  Model building EWMA, sub-optimal weights 470.9204
4 Model building equally weighted, minimum variance weights 194.3892
5      Model building equally weighted, sub-optimal weights 217.9751
6          Model building equally weighted, targeting CAC40 203.7821</code></pre>
</div>
</div>
<p>Second, the model building approach with EWMA.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1"></a>Pvar2_EWMA <span class="ot">&lt;-</span> <span class="fu">t</span>(alpha2) <span class="sc">%*%</span> C <span class="sc">%*%</span> alpha2</span>
<span id="cb258-2"><a href="#cb258-2"></a>Psd2_EWMA <span class="ot">&lt;-</span> Pvar2_EWMA<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb258-3"><a href="#cb258-3"></a>VaR.ewma.optimal <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.99</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">*</span> Psd2_EWMA</span>
<span id="cb258-4"><a href="#cb258-4"></a>VaR.ewma.optimal</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 338.2937</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1"></a>Pvar3_EWMA <span class="ot">&lt;-</span> <span class="fu">t</span>(alpha3) <span class="sc">%*%</span> C <span class="sc">%*%</span> alpha3</span>
<span id="cb260-2"><a href="#cb260-2"></a>Psd3_EWMA <span class="ot">&lt;-</span> Pvar3_EWMA<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb260-3"><a href="#cb260-3"></a>VaR.ewma.optimal.cac <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.99</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">*</span> Psd3_EWMA</span>
<span id="cb260-4"><a href="#cb260-4"></a>VaR.ewma.optimal.cac</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 347.9537</code></pre>
</div>
</div>
<p>Summary of results.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1"></a>Results.updated <span class="ot">&lt;-</span> Results.updated <span class="sc">%&gt;%</span></span>
<span id="cb262-2"><a href="#cb262-2"></a>  <span class="fu">add_row</span>(<span class="at">VaR.method =</span> </span>
<span id="cb262-3"><a href="#cb262-3"></a>            <span class="fu">c</span>(<span class="st">"Model building EWMA, minimum variance weights"</span>, </span>
<span id="cb262-4"><a href="#cb262-4"></a>              <span class="st">"Model building EWMA, targeting CAC40"</span>), </span>
<span id="cb262-5"><a href="#cb262-5"></a>          <span class="at">VaR =</span> <span class="fu">c</span>(VaR.ewma.optimal, VaR.ewma.optimal.cac)) <span class="sc">%&gt;%</span></span>
<span id="cb262-6"><a href="#cb262-6"></a>  <span class="fu">arrange</span>(VaR.method)</span>
<span id="cb262-7"><a href="#cb262-7"></a>Results.updated</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                                 VaR.method      VaR
1    Historical approximate quantile(), sub-optimal weights 218.3281
2                Historical simulation, sub-optimal weights 253.3850
3             Model building EWMA, minimum variance weights 338.2937
4                  Model building EWMA, sub-optimal weights 470.9204
5                      Model building EWMA, targeting CAC40 347.9537
6 Model building equally weighted, minimum variance weights 194.3892
7      Model building equally weighted, sub-optimal weights 217.9751
8          Model building equally weighted, targeting CAC40 203.7821</code></pre>
</div>
</div>
</section>
<section id="historic-approach-with-optimal-weights." class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="historic-approach-with-optimal-weights."><span class="header-section-number">5.6</span> Historic approach with optimal weights.</h2>
<p>Let’s go back to the historic approach. Now we can incorporate a comparison with the optimal weights.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1"></a>df.Adj.S <span class="ot">&lt;-</span> df.Adj.S <span class="sc">%&gt;%</span></span>
<span id="cb264-2"><a href="#cb264-2"></a>  <span class="fu">mutate</span>(<span class="at">p2 =</span> (alpha2[<span class="dv">1</span>] <span class="sc">*</span> SDJIA <span class="sc">/</span> DJIA[<span class="dv">501</span>]) <span class="sc">+</span> </span>
<span id="cb264-3"><a href="#cb264-3"></a>             (alpha2[<span class="dv">2</span>] <span class="sc">*</span> SFTSE100 <span class="sc">/</span> AFTSE100[<span class="dv">501</span>]) <span class="sc">+</span> </span>
<span id="cb264-4"><a href="#cb264-4"></a>             (alpha2[<span class="dv">3</span>] <span class="sc">*</span> SCAC40 <span class="sc">/</span> ACAC40[<span class="dv">501</span>]) <span class="sc">+</span> </span>
<span id="cb264-5"><a href="#cb264-5"></a>             (alpha2[<span class="dv">4</span>] <span class="sc">*</span> SNikkei <span class="sc">/</span> ANikkei[<span class="dv">501</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb264-6"><a href="#cb264-6"></a>  <span class="fu">mutate</span>(<span class="at">l2 =</span> <span class="dv">10000</span> <span class="sc">-</span> p2) <span class="sc">%&gt;%</span> <span class="co"># Losses l</span></span>
<span id="cb264-7"><a href="#cb264-7"></a>  <span class="fu">mutate</span>(<span class="at">p3 =</span> (alpha3[<span class="dv">1</span>] <span class="sc">*</span> SDJIA <span class="sc">/</span> DJIA[<span class="dv">501</span>]) <span class="sc">+</span> </span>
<span id="cb264-8"><a href="#cb264-8"></a>             (alpha3[<span class="dv">2</span>] <span class="sc">*</span> SFTSE100 <span class="sc">/</span> AFTSE100[<span class="dv">501</span>]) <span class="sc">+</span> </span>
<span id="cb264-9"><a href="#cb264-9"></a>             (alpha3[<span class="dv">3</span>] <span class="sc">*</span> SCAC40 <span class="sc">/</span> ACAC40[<span class="dv">501</span>]) <span class="sc">+</span> </span>
<span id="cb264-10"><a href="#cb264-10"></a>             (alpha3[<span class="dv">4</span>] <span class="sc">*</span> SNikkei <span class="sc">/</span> ANikkei[<span class="dv">501</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb264-11"><a href="#cb264-11"></a>  <span class="fu">mutate</span>(<span class="at">l3 =</span> <span class="dv">10000</span> <span class="sc">-</span> p3) <span class="co"># Losses l</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Calculate the new portfolio losses for optimal weights.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1"></a>l2 <span class="ot">&lt;-</span> df.Adj.S <span class="sc">%&gt;%</span></span>
<span id="cb265-2"><a href="#cb265-2"></a>  <span class="fu">filter</span>(obs <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> obs <span class="sc">&lt;</span> <span class="dv">501</span>) <span class="sc">%&gt;%</span></span>
<span id="cb265-3"><a href="#cb265-3"></a>  <span class="fu">select</span>(l2) <span class="sc">%&gt;%</span></span>
<span id="cb265-4"><a href="#cb265-4"></a>  <span class="fu">unlist</span>()</span>
<span id="cb265-5"><a href="#cb265-5"></a></span>
<span id="cb265-6"><a href="#cb265-6"></a>l2.tomorrow <span class="ot">&lt;-</span> df.Adj.S <span class="sc">%&gt;%</span></span>
<span id="cb265-7"><a href="#cb265-7"></a>  <span class="fu">filter</span>(obs <span class="sc">==</span> <span class="dv">501</span>) <span class="sc">%&gt;%</span></span>
<span id="cb265-8"><a href="#cb265-8"></a>  <span class="fu">select</span>(l2) <span class="sc">%&gt;%</span></span>
<span id="cb265-9"><a href="#cb265-9"></a>  <span class="fu">unlist</span>()</span>
<span id="cb265-10"><a href="#cb265-10"></a></span>
<span id="cb265-11"><a href="#cb265-11"></a>l3 <span class="ot">&lt;-</span> df.Adj.S <span class="sc">%&gt;%</span></span>
<span id="cb265-12"><a href="#cb265-12"></a>  <span class="fu">filter</span>(obs <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> obs <span class="sc">&lt;</span> <span class="dv">501</span>) <span class="sc">%&gt;%</span></span>
<span id="cb265-13"><a href="#cb265-13"></a>  <span class="fu">select</span>(l3) <span class="sc">%&gt;%</span></span>
<span id="cb265-14"><a href="#cb265-14"></a>  <span class="fu">unlist</span>()</span>
<span id="cb265-15"><a href="#cb265-15"></a></span>
<span id="cb265-16"><a href="#cb265-16"></a>l3.tomorrow <span class="ot">&lt;-</span> df.Adj.S <span class="sc">%&gt;%</span></span>
<span id="cb265-17"><a href="#cb265-17"></a>  <span class="fu">filter</span>(obs <span class="sc">==</span> <span class="dv">501</span>) <span class="sc">%&gt;%</span></span>
<span id="cb265-18"><a href="#cb265-18"></a>  <span class="fu">select</span>(l3) <span class="sc">%&gt;%</span></span>
<span id="cb265-19"><a href="#cb265-19"></a>  <span class="fu">unlist</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>As a reference, this is the <span class="citation" data-cites="Hull">Hull (<a href="#ref-Hull" role="doc-biblioref">2015</a>)</span> original case.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1"></a><span class="fu">plot</span>(l, <span class="at">type =</span> <span class="st">"h"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">600</span>, <span class="dv">600</span>), <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb266-2"><a href="#cb266-2"></a>     <span class="at">xlab =</span> <span class="st">"500 scenarios (sorted by historical date)"</span>,</span>
<span id="cb266-3"><a href="#cb266-3"></a><span class="at">ylab =</span> <span class="st">"Portfolio gains (-) and losses (+)"</span>, </span>
<span id="cb266-4"><a href="#cb266-4"></a><span class="at">col =</span> <span class="fu">ifelse</span>(l <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>))</span>
<span id="cb266-5"><a href="#cb266-5"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb266-6"><a href="#cb266-6"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>)</span>
<span id="cb266-7"><a href="#cb266-7"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">max</span>(l), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb266-8"><a href="#cb266-8"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">min</span>(l), <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-lwhsadfcn" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-lwhsadfcn-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.15: Losses with Hull’s suboptimal alpha DJ=0.4, FTSE=0.3, CAC=0.1, Nikkei=0.2.</figcaption>
</figure>
</div>
</div>
</div>
<p>The one-day 99% value at risk can be estimated as the fifth-worst loss.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1"></a><span class="fu">sort</span>(l)[<span class="dv">496</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   l487 
253.385 </code></pre>
</div>
</div>
<p>Now, let’s see the historical approach but with minimum variance optimal weights.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1"></a><span class="fu">plot</span>(l2, <span class="at">type =</span> <span class="st">"h"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">600</span>, <span class="dv">600</span>), <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb269-2"><a href="#cb269-2"></a>     <span class="at">xlab =</span> <span class="st">"500 scenarios (sorted by historical date)"</span>,</span>
<span id="cb269-3"><a href="#cb269-3"></a>     <span class="at">ylab =</span> <span class="st">"Portfolio gains (-) and losses (+)"</span>, </span>
<span id="cb269-4"><a href="#cb269-4"></a>     <span class="at">col =</span> <span class="fu">ifelse</span>(l2 <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>))</span>
<span id="cb269-5"><a href="#cb269-5"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb269-6"><a href="#cb269-6"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>)</span>
<span id="cb269-7"><a href="#cb269-7"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">max</span>(l2), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb269-8"><a href="#cb269-8"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">min</span>(l2), <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-lwhsadfcn2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-lwhsadfcn2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.16: Losses with optimal alpha DJ=0.56, FTSE=0.038, CAC=0.022, Nikkei=0.38.</figcaption>
</figure>
</div>
</div>
</div>
<p>See how the range of losses and gains is now reduced. The one-day 99% value at risk can be estimated as the fifth-worst loss.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1"></a><span class="fu">sort</span>(l2)[<span class="dv">496</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   l2487 
213.6898 </code></pre>
</div>
</div>
<p>Let’s update our table of results.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1"></a>Results.updated <span class="ot">&lt;-</span> Results.updated <span class="sc">%&gt;%</span></span>
<span id="cb272-2"><a href="#cb272-2"></a>  <span class="fu">add_row</span>(<span class="at">VaR.method =</span> <span class="st">"Historical simulation, minimum variance weights"</span>, </span>
<span id="cb272-3"><a href="#cb272-3"></a>          <span class="at">VaR =</span> <span class="fu">sort</span>(l2)[<span class="dv">496</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb272-4"><a href="#cb272-4"></a>  <span class="fu">arrange</span>(VaR.method)</span>
<span id="cb272-5"><a href="#cb272-5"></a>Results.updated</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                                 VaR.method      VaR
1    Historical approximate quantile(), sub-optimal weights 218.3281
2           Historical simulation, minimum variance weights 213.6898
3                Historical simulation, sub-optimal weights 253.3850
4             Model building EWMA, minimum variance weights 338.2937
5                  Model building EWMA, sub-optimal weights 470.9204
6                      Model building EWMA, targeting CAC40 347.9537
7 Model building equally weighted, minimum variance weights 194.3892
8      Model building equally weighted, sub-optimal weights 217.9751
9          Model building equally weighted, targeting CAC40 203.7821</code></pre>
</div>
</div>
<p>And this is the optimal portfolio targeting the CAC 40 expected return.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1"></a><span class="fu">plot</span>(l3, <span class="at">type =</span> <span class="st">"h"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">600</span>, <span class="dv">600</span>), <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb274-2"><a href="#cb274-2"></a>     <span class="at">xlab =</span> <span class="st">"500 scenarios (sorted by historical date)"</span>,</span>
<span id="cb274-3"><a href="#cb274-3"></a>     <span class="at">ylab =</span> <span class="st">"Portfolio gains (-) and losses (+)"</span>, </span>
<span id="cb274-4"><a href="#cb274-4"></a>     <span class="at">col =</span> <span class="fu">ifelse</span>(l3 <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>))</span>
<span id="cb274-5"><a href="#cb274-5"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb274-6"><a href="#cb274-6"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>)</span>
<span id="cb274-7"><a href="#cb274-7"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">max</span>(l3), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb274-8"><a href="#cb274-8"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">min</span>(l3), <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-lwcoadfcn" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-lwcoadfcn-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.17: Losses with CAC40 optimal alpha DJ=0.607, FTSE=-0.403, CAC=0.459, Nikkei=0.336.</figcaption>
</figure>
</div>
</div>
</div>
<p>Note that the range is reduced but allows for a higher gains. Let’s see these three together. The one-day 99% value at risk can be estimated as the fifth-worst loss.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1"></a><span class="fu">sort</span>(l3)[<span class="dv">496</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   l3494 
248.8909 </code></pre>
</div>
</div>
<p>Let’s update the table of results.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1"></a>Results.updated <span class="ot">&lt;-</span> Results.updated <span class="sc">%&gt;%</span></span>
<span id="cb277-2"><a href="#cb277-2"></a>  <span class="fu">add_row</span>(<span class="at">VaR.method =</span> <span class="st">"Historical simulation, targeting CAC40"</span>, </span>
<span id="cb277-3"><a href="#cb277-3"></a>          <span class="at">VaR =</span> <span class="fu">sort</span>(l3)[<span class="dv">496</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb277-4"><a href="#cb277-4"></a>  <span class="fu">arrange</span>(VaR.method)</span>
<span id="cb277-5"><a href="#cb277-5"></a>Results.updated</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                                  VaR.method      VaR
1     Historical approximate quantile(), sub-optimal weights 218.3281
2            Historical simulation, minimum variance weights 213.6898
3                 Historical simulation, sub-optimal weights 253.3850
4                     Historical simulation, targeting CAC40 248.8909
5              Model building EWMA, minimum variance weights 338.2937
6                   Model building EWMA, sub-optimal weights 470.9204
7                       Model building EWMA, targeting CAC40 347.9537
8  Model building equally weighted, minimum variance weights 194.3892
9       Model building equally weighted, sub-optimal weights 217.9751
10          Model building equally weighted, targeting CAC40 203.7821</code></pre>
</div>
</div>
<p>Let’s see the three historical approaches together.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">0</span>))</span>
<span id="cb279-2"><a href="#cb279-2"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb279-3"><a href="#cb279-3"></a><span class="fu">plot</span>(l, <span class="at">type =</span> <span class="st">"h"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">600</span>, <span class="dv">600</span>), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb279-4"><a href="#cb279-4"></a>     <span class="at">main =</span> <span class="st">"Hull original case."</span>, </span>
<span id="cb279-5"><a href="#cb279-5"></a>     <span class="at">ylab =</span> <span class="st">"Portfolio gains (-) and losses (+)"</span>,</span>
<span id="cb279-6"><a href="#cb279-6"></a>     <span class="at">col =</span> <span class="fu">ifelse</span>(l <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>))</span>
<span id="cb279-7"><a href="#cb279-7"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb279-8"><a href="#cb279-8"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>)</span>
<span id="cb279-9"><a href="#cb279-9"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">max</span>(l), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb279-10"><a href="#cb279-10"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">min</span>(l), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb279-11"><a href="#cb279-11"></a><span class="fu">plot</span>(l2, <span class="at">type =</span> <span class="st">"h"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">600</span>, <span class="dv">600</span>), <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb279-12"><a href="#cb279-12"></a>     <span class="at">main =</span> <span class="st">"Minimum variance."</span>,</span>
<span id="cb279-13"><a href="#cb279-13"></a>     <span class="at">xlab =</span> <span class="st">"500 scenarios sorted by historical date."</span>, <span class="at">ylab =</span> <span class="st">""</span>,</span>
<span id="cb279-14"><a href="#cb279-14"></a>     <span class="at">col =</span> <span class="fu">ifelse</span>(l2 <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>))</span>
<span id="cb279-15"><a href="#cb279-15"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb279-16"><a href="#cb279-16"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>)</span>
<span id="cb279-17"><a href="#cb279-17"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">max</span>(l2), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb279-18"><a href="#cb279-18"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">min</span>(l2), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb279-19"><a href="#cb279-19"></a><span class="fu">plot</span>(l3, <span class="at">type =</span> <span class="st">"h"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">600</span>, <span class="dv">600</span>), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb279-20"><a href="#cb279-20"></a>     <span class="at">main =</span> <span class="st">"Optimal targeting CAC 40."</span>, <span class="at">ylab =</span> <span class="st">""</span>,</span>
<span id="cb279-21"><a href="#cb279-21"></a>     <span class="at">col =</span> <span class="fu">ifelse</span>(l3 <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>))</span>
<span id="cb279-22"><a href="#cb279-22"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb279-23"><a href="#cb279-23"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>)</span>
<span id="cb279-24"><a href="#cb279-24"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">max</span>(l3), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb279-25"><a href="#cb279-25"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">min</span>(l3), <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-hsaoaoa" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-hsaoaoa-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.18: Hull’s suboptimal alpha (left); optimal alpha (center); optimal alpha CAC40 (right).</figcaption>
</figure>
</div>
</div>
</div>
<p>A quantile comparison.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1"></a>lq <span class="ot">&lt;-</span> <span class="fu">quantile</span>(l, <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>))</span>
<span id="cb280-2"><a href="#cb280-2"></a>lq2 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(l2, <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>))</span>
<span id="cb280-3"><a href="#cb280-3"></a>lq3 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(l3, <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>))</span>
<span id="cb280-4"><a href="#cb280-4"></a>ll <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(lq, lq2, lq3)</span>
<span id="cb280-5"><a href="#cb280-5"></a>colours <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"orange"</span>, <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1"></a><span class="fu">barplot</span>(<span class="fu">as.matrix</span>(<span class="fu">t</span>(ll)), <span class="at">beside =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> colours, </span>
<span id="cb281-2"><a href="#cb281-2"></a>        <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">60</span>, <span class="dv">60</span>), <span class="at">xlab =</span> <span class="st">"Quantiles"</span>, </span>
<span id="cb281-3"><a href="#cb281-3"></a>        <span class="at">ylab =</span> <span class="st">"Portfolio gains (-) and Losses (+)"</span>)</span>
<span id="cb281-4"><a href="#cb281-4"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="fu">c</span>(<span class="st">"Hull original"</span>,<span class="st">"Optimal minvar"</span>,</span>
<span id="cb281-5"><a href="#cb281-5"></a>                    <span class="st">"Replicating CAC40 ER"</span>), <span class="at">cex =</span> <span class="fl">1.3</span>, <span class="at">bty =</span> <span class="st">"n"</span>,</span>
<span id="cb281-6"><a href="#cb281-6"></a>       <span class="at">fill =</span> colours)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-qcold" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-qcold-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.19: Quantile comparison of losses distribution.</figcaption>
</figure>
</div>
</div>
</div>
<p>This document took 4.18 minutes to compile in Quarto version 1.3.450, and R version 4.3.2 (2023-10-31 ucrt).</p>
</section>
</section>
<section id="references." class="level1 unnumbered">
<h1 class="unnumbered">References.</h1>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-brealey2020principles" class="csl-entry" role="listitem">
Brealey, Richard A, Stewart C Myers, Franklin Allen, and Pitabas Mohanty. 2020. <em>Principles of Corporate Finance</em>. 13th ed. McGraw-Hill Education.
</div>
<div id="ref-Hull" class="csl-entry" role="listitem">
Hull, John C. 2015. <em>Options, Futures, and Other Derivatives</em>. 9th ed. Prentice Hall.
</div>
<div id="ref-knuth1984literate" class="csl-entry" role="listitem">
Knuth, Donald Ervin. 1984. <span>“Literate Programming.”</span> <em>The Computer Journal</em> 27 (2): 97–111.
</div>
<div id="ref-Rref" class="csl-entry" role="listitem">
R Core Team. 2024. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
</div>
</section>

</main>
<!-- /main column -->
<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-PJP1F03QR9"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-PJP1F03QR9');
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



<script src="index_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>